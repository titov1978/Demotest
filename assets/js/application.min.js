function randomNumber(m,n){return m=parseInt(m),n=parseInt(n),Math.floor(Math.random()*(n-m+1))+m}function findMinRang(searchNum,arr,prop){for(var elArr,elArrSearch,len=arr.length,range={min:0,index:0},i=len-1;i>=0;i--)if(elArr=arr[i],elArrSearch=prop&&elArr[prop]?elArr[prop]:elArr,elArr&&searchNum>=elArrSearch){range.min=elArr,range.index=i;break}return range}function getObjectByKey(obj,key,val){var objects=[];for(var i in obj)obj.hasOwnProperty(i)&&("object"==typeof obj[i]?objects=objects.concat(getObjectByKey(obj[i],key,val)):i==key&&obj[i]==val&&objects.push(obj));return objects}function sortBy(field,reverse,primer){var key=primer?function(x){return primer(x[field])}:function(x){return x[field]};return reverse=reverse?-1:1,function(a,b){return a=key(a),b=key(b),reverse*((a>b)-(b>a))}}function cloneObj(obj){if(!obj)return obj;try{return JSON.parse(JSON.stringify(obj))}catch(e){return angular.copy(obj)}}function removeProperties(obj,arrUnnecessaryProperties){for(var i=0,len=arrUnnecessaryProperties.length;i<len;i++)obj.hasOwnProperty(arrUnnecessaryProperties[i])>-1&&(obj[arrUnnecessaryProperties[i]]=void 0)}function stringToBoolean(value){switch("string"==typeof value&&(value=value.toLowerCase().trim()),value){case!1:case"false":case 0:case"0":case"no":case null:case"null":case"hidden":return!1;default:return!0}}function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}function calcTime(currentDate,offsetTimezone){var d,utc;return currentDate?("string"!=typeof currentDate&&(currentDate=currentDate.toString()),currentDate=currentDate.replace(/-/g,"/"),d=new Date(currentDate)):d=new Date,utc=offsetTimezone?new Date(d.getTime()-6e4*d.getTimezoneOffset()):d}function calculatePassedDays(one,two){var oneDay,firstDate,secondDate,now=new Date;return oneDay=864e5,one=calcTime(one),two&&(two=calcTime(two)),firstDate=new Date(one.getFullYear(),one.getMonth(),one.getDate()),secondDate=two?two:now,secondDate=new Date(secondDate.getFullYear(),secondDate.getMonth(),secondDate.getDate()),Math.round(Math.abs((secondDate.getTime()-firstDate.getTime())/oneDay))}function calculateMinutes(date){var diffMs,diffMn,date_now=new Date;return diffMs=Math.abs(date_now-date),diffMn=Math.floor(diffMs/1e3/60)}function calculateMinutesFromStr(dateStr){var arr,date,diffMn=null;return"string"==typeof dateStr&&(arr=dateStr.split(/-/),date=new Date(arr[0],arr[1]-1,arr[2],arr[3],arr[4],arr[5]),diffMn=calculateMinutes(date)),diffMn}function compareDates(d1,d2){var res=null;return d1.constructor===Date&&d2.constructor===Date&&(d1.setHours(0,0,0,0),d2.setHours(0,0,0,0),res=(d1>d2)-(d1<d2)),res}function getRights(duties){var canSignature=!1,canVisit=!1,canObserve=!1;duties.find(function(el){angular.forEach(el,function(duty){1==duty.level&&("collegue observation"!=duty.title.toLowerCase()?canVisit=!0:canObserve=!0,"signature"==duty.title.toLowerCase()&&(canSignature=!0))})});return{visit:canVisit,signature:canSignature,observe:canObserve}}function containsInArray(source,target){var result=source.filter(function(item){return target.indexOf(item)>-1});return result.length>0}function generateColor(colorStart,colorEnd,colorCount){for(var hex=function(c){var s="0123456789abcdef",i=parseInt(c);return 0===i||isNaN(c)?"00":(i=Math.round(Math.min(Math.max(0,i),255)),s.charAt((i-i%16)/16)+s.charAt(i%16))},convertToHex=function(rgb){return hex(rgb[0])+hex(rgb[1])+hex(rgb[2])},trim=function(s){return"#"==s.charAt(0)?s.substring(1,7):s},convertToRGB=function(hex){var color=[];return color[0]=parseInt(trim(hex).substring(0,2),16),color[1]=parseInt(trim(hex).substring(2,4),16),color[2]=parseInt(trim(hex).substring(4,6),16),color},start=convertToRGB(colorStart),end=convertToRGB(colorEnd),alpha=0,saida=[],i=0;i<colorCount;i++){var c=[];alpha+=1/colorCount,c[0]=start[0]*alpha+(1-alpha)*end[0],c[1]=start[1]*alpha+(1-alpha)*end[1],c[2]=start[2]*alpha+(1-alpha)*end[2],saida.push("#"+convertToHex(c))}return saida}function showDimmer(){angular.element("#general-shell").dimmer({template:{dimmer:function(){return $("<div>").attr("class","ui active inverted dimmer").html('<div class="ui large text loader">Ładowanie</div>')}},opacity:.1}).dimmer("show")}function hideDimmer(){angular.element("#general-shell").dimmer("hide")}function incrementLast(v){var res=null;return res=v.match(/\d+$/)?v.replace(/\d+$/,function(match){return parseInt(match,10)+1}):v+1}function sizeOf(obj){var _xLen,_x,_lsTotal=0;for(_x in obj)_xLen=2*(obj[_x].length+_x.length),_lsTotal+=_xLen;return _lsTotal/1024}Array.prototype.max||(Array.prototype.max=function(){return Math.max.apply(null,this)}),Array.prototype.min||(Array.prototype.min=function(){return Math.min.apply(null,this)}),Array.prototype.find||(Array.prototype.find=function(predicate){if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var value,list=Object(this),length=list.length>>>0,thisArg=arguments[1],i=0;i<length;i++)if(value=list[i],predicate.call(thisArg,value,i,list))return value}),Array.prototype.groupBy||(Array.prototype.groupBy=function(hash){function put(map,key,value){map[_hash(key)]||(map[_hash(key)]={},map[_hash(key)].group=[],map[_hash(key)].key=_hash(key)),map[_hash(key)].group.push(value)}var _hash=hash?hash:function(o){return o},_map={};return this.map(function(obj){put(_map,obj,obj)}),Object.keys(_map).map(function(key){return{key:_map[key].key,group:_map[key].group}})}),Array.prototype.unique||(Array.prototype.unique=function(){for(var a=[],i=0,l=this.length;i<l;i++)a.indexOf(this[i])===-1&&a.push(this[i]);return a}),Array.prototype.findIndex||(Array.prototype.findIndex=function(predicate){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var value,list=Object(this),length=list.length>>>0,thisArg=arguments[1],i=0;i<length;i++)if(value=list[i],predicate.call(thisArg,value,i,list))return i;return-1}),Array.prototype.diff=function(a){return this.filter(function(i){return a.indexOf(i)<0})},Array.prototype.intersection=function(a){return this.filter(function(i){return a.indexOf(i)!==-1})},function(){"use strict";angular.module("app",["app.core","app.filters","app.budgets","app.atlFilters","app.i18n","app.auth","app.layout","app.dashboard","app.clients","app.campaigns","app.detailing","app.gazetki","app.messaging","app.profile","notifier","ngDraggable","nvd3"])}(),function(){"use strict";angular.module("app.budgets",["app.core"])}(),function(){"use strict";angular.module("app.auth",["app.core"])}(),function(){"use strict";angular.module("blocks.exception",["blocks.logger"])}(),function(){"use strict";angular.module("blocks.router",["ui.router","blocks.logger"])}(),function(){"use strict";angular.module("app.campaigns",["app.core"])}(),function(){"use strict";angular.module("app.clients",["app.core"])}(),function(){"use strict";angular.module("app.core",["ngAnimate","ngSanitize","ngStorage","ngCookies","blocks.exception","blocks.logger","blocks.router","restangular","ngTagsInput","ui.router","pdf","chart.js","ui.grid","ui.grid.pagination"])}(),function(){"use strict";angular.module("blocks.logger",[])}(),function(){"use strict";angular.module("notifier",[])}(),function(){"use strict";angular.module("app.dashboard",["app.core"])}(),function(){"use strict";angular.module("app.detailing",["app.core"])}(),function(){"use strict";angular.module("app.atlFilters",[]).filter("selectedJobDuties",[function(){return function(objStaff,userData){if(objStaff){var tempStaff={};return angular.forEach(objStaff,function(value,key){(value.job_duties.indexOf("[4]")>-1||value.job_duties.indexOf("[5]")>-1||userData.id==key)&&(tempStaff[key]=value)}),tempStaff}return!1}}]).filter("selectedStepColor",[function(){return function(drugstores,stepName,stepColor){if(drugstores){if(stepName&&stepColor){var tempDrugstores=[];return angular.forEach(drugstores,function(drugstore){angular.forEach(drugstore.steps,function(step){step.identifier==stepName&&(step.color==stepColor||"white"==stepColor||step.specColor.length&&step.specColor.indexOf(stepColor)>-1)&&tempDrugstores.push(drugstore)})}),tempDrugstores}return drugstores}return!1}}]).filter("searchDrugstore",[function(){return function(drugstores,query,arrFields){var removeApostrophe=function(value){return value.replace(/ą/g,"a").replace(/ć/g,"c").replace(/ę/g,"e").replace(/ł/g,"l").replace(/ń/g,"n").replace(/ó/g,"o").replace(/ś/g,"s").replace(/ź/g,"z").replace(/ż/g,"z")};return!!drugstores&&(query?(query=removeApostrophe(query.toLowerCase()),drugstores.filter(function(drugstore,index){for(var field,key,val,arrSplit,str="",del="",i=0,len=arrFields.length;i<len;i++){if(field=arrFields[i],field.indexOf(".")!=-1){arrSplit=field.split("."),val=drugstore;for(var j=0,len2=arrSplit.length;j<len2;j++)key=arrSplit[j],val[key]&&(val=val[key])}else drugstore[field]&&(val=drugstore[field]);val&&(str+=del+val.toString().toLowerCase(),del=" ")}return str=removeApostrophe(str),str.indexOf(query)!=-1})):drugstores)}}])}(),function(){"use strict";angular.module("app.filters",[])}(),function(){"use strict";angular.module("app.gazetki",["app.core"])}(),function(){"use strict";angular.module("app.i18n",["pascalprecht.translate"])}(),function(){"use strict";angular.module("app.layout",["app.core"])}(),function(){"use strict";angular.module("app.messaging",["app.core"])}(),function(){"use strict";angular.module("app.profile",["app.core","ui.calendar"])}(),angular.module("ngDraggable",[]).service("ngDraggable",[function(){var scope=this;scope.inputEvent=function(event){return angular.isDefined(event.touches)?event.touches[0]:angular.isDefined(event.originalEvent)&&angular.isDefined(event.originalEvent.touches)?event.originalEvent.touches[0]:event}}]).directive("ngDrag",["$rootScope","$parse","$document","$window","ngDraggable",function($rootScope,$parse,$document,$window,ngDraggable){return{restrict:"A",link:function(scope,element,attrs){scope.value=attrs.ngDrag;var offset,_mx,_my,_tx,_ty,_mrx,_mry,_dragHandle,_centerAnchor=!1,_hasTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,_pressEvents="touchstart mousedown",_moveEvents="touchmove mousemove",_releaseEvents="touchend mouseup",_myid=scope.$id,_data=null,_dragOffset=null,_dragEnabled=!1,_pressTimer=null,onDragStartCallback=$parse(attrs.ngDragStart)||null,onDragStopCallback=$parse(attrs.ngDragStop)||null,onDragSuccessCallback=$parse(attrs.ngDragSuccess)||null,allowTransform=!angular.isDefined(attrs.allowTransform)||scope.$eval(attrs.allowTransform),getDragData=$parse(attrs.ngDragData),_deregisterRootMoveListener=angular.noop,initialize=function(){var dragHandles;element.attr("draggable","false"),dragHandles=element[0].querySelectorAll?angular.element(element[0].querySelectorAll("[ng-drag-handle]")):element.find("[ng-drag-handle]"),dragHandles.length&&(_dragHandle=dragHandles),toggleListeners(!0)},toggleListeners=function(enable){enable&&(scope.$on("$destroy",onDestroy),scope.$watch(attrs.ngDrag,onEnableChange),scope.$watch(attrs.ngCenterAnchor,onCenterAnchor),_dragHandle?_dragHandle.on(_pressEvents,onpress):element.on(_pressEvents,onpress),_hasTouch||"img"!=element[0].nodeName.toLowerCase()||element.on("mousedown",function(){return!1}))},onDestroy=function(enable){toggleListeners(!1)},onEnableChange=function(newVal,oldVal){_dragEnabled=newVal},onCenterAnchor=function(newVal,oldVal){angular.isDefined(newVal)&&(_centerAnchor=newVal||"true")},isClickableElement=function(evt){return angular.isDefined(angular.element(evt.target).attr("ng-cancel-drag"))},onpress=function(evt){_dragEnabled&&(isClickableElement(evt)||"mousedown"==evt.type&&0!==evt.button||(_hasTouch?(cancelPress(),_pressTimer=setTimeout(function(){cancelPress(),onlongpress(evt)},100),$document.on(_moveEvents,cancelPress),$document.on(_releaseEvents,cancelPress)):onlongpress(evt)))},cancelPress=function(){clearTimeout(_pressTimer),$document.off(_moveEvents,cancelPress),$document.off(_releaseEvents,cancelPress)},onlongpress=function(evt){_dragEnabled&&(evt.preventDefault(),offset=element[0].getBoundingClientRect(),_dragOffset=allowTransform?offset:{left:document.body.scrollLeft,top:document.body.scrollTop},element.centerX=element[0].offsetWidth/2,element.centerY=element[0].offsetHeight/2,_mx=ngDraggable.inputEvent(evt).pageX,_my=ngDraggable.inputEvent(evt).pageY,_mrx=_mx-offset.left,_mry=_my-offset.top,_centerAnchor?(_tx=_mx-element.centerX-$window.pageXOffset,_ty=_my-element.centerY-$window.pageYOffset):(_tx=_mx-_mrx-$window.pageXOffset,_ty=_my-_mry-$window.pageYOffset),$document.on(_moveEvents,onmove),$document.on(_releaseEvents,onrelease),_deregisterRootMoveListener=$rootScope.$on("draggable:_triggerHandlerMove",function(event,origEvent){onmove(origEvent)}))},onmove=function(evt){_dragEnabled&&(evt.preventDefault(),element.hasClass("dragging")||(_data=getDragData(scope),element.addClass("dragging"),$rootScope.$broadcast("draggable:start",{x:_mx,y:_my,tx:_tx,ty:_ty,event:evt,element:element,data:_data}),onDragStartCallback&&scope.$apply(function(){onDragStartCallback(scope,{$data:_data,$event:evt})})),_mx=ngDraggable.inputEvent(evt).pageX,_my=ngDraggable.inputEvent(evt).pageY,_centerAnchor?(_tx=_mx-element.centerX-_dragOffset.left,_ty=_my-element.centerY-_dragOffset.top):(_tx=_mx-_mrx-_dragOffset.left,_ty=_my-_mry-_dragOffset.top),moveElement(_tx,_ty),$rootScope.$broadcast("draggable:move",{x:_mx,y:_my,tx:_tx,ty:_ty,event:evt,element:element,data:_data,uid:_myid,dragOffset:_dragOffset}))},onrelease=function(evt){_dragEnabled&&(evt.preventDefault(),$rootScope.$broadcast("draggable:end",{x:_mx,y:_my,tx:_tx,ty:_ty,event:evt,element:element,data:_data,callback:onDragComplete,uid:_myid}),element.removeClass("dragging"),element.parent().find(".drag-enter").removeClass("drag-enter"),reset(),$document.off(_moveEvents,onmove),$document.off(_releaseEvents,onrelease),onDragStopCallback&&scope.$apply(function(){onDragStopCallback(scope,{$data:_data,$event:evt})}),_deregisterRootMoveListener())},onDragComplete=function(evt){onDragSuccessCallback&&scope.$apply(function(){onDragSuccessCallback(scope,{$data:_data,$event:evt})})},reset=function(){allowTransform?element.css({transform:"","z-index":"","-webkit-transform":"","-ms-transform":""}):element.css({position:"",top:"",left:""})},moveElement=function(x,y){allowTransform?element.css({transform:"matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+x+", "+y+", 0, 1)","z-index":99999,"-webkit-transform":"matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+x+", "+y+", 0, 1)","-ms-transform":"matrix(1, 0, 0, 1, "+x+", "+y+")"}):element.css({left:x+"px",top:y+"px",position:"fixed"})};initialize()}}}]).directive("ngDrop",["$parse","$timeout","$window","$document","ngDraggable",function($parse,$timeout,$window,$document,ngDraggable){return{restrict:"A",link:function(scope,element,attrs){scope.value=attrs.ngDrop,scope.isTouching=!1;var _lastDropTouch=null,_myid=scope.$id,_dropEnabled=!1,onDropCallback=$parse(attrs.ngDropSuccess),onDragStartCallback=$parse(attrs.ngDragStart),onDragStopCallback=$parse(attrs.ngDragStop),onDragMoveCallback=$parse(attrs.ngDragMove),initialize=function(){toggleListeners(!0)},toggleListeners=function(enable){enable&&(scope.$watch(attrs.ngDrop,onEnableChange),scope.$on("$destroy",onDestroy),scope.$on("draggable:start",onDragStart),scope.$on("draggable:move",onDragMove),scope.$on("draggable:end",onDragEnd))},onDestroy=function(enable){toggleListeners(!1)},onEnableChange=function(newVal,oldVal){_dropEnabled=newVal},onDragStart=function(evt,obj){_dropEnabled&&(isTouching(obj.x,obj.y,obj.element),attrs.ngDragStart&&$timeout(function(){onDragStartCallback(scope,{$data:obj.data,$event:obj})}))},onDragMove=function(evt,obj){_dropEnabled&&(isTouching(obj.x,obj.y,obj.element),attrs.ngDragMove&&$timeout(function(){onDragMoveCallback(scope,{$data:obj.data,$event:obj})}))},onDragEnd=function(evt,obj){return _dropEnabled&&_myid!==obj.uid?(isTouching(obj.x,obj.y,obj.element)&&(obj.callback&&obj.callback(obj),attrs.ngDropSuccess&&$timeout(function(){onDropCallback(scope,{$data:obj.data,$event:obj,$target:scope.$eval(scope.value)})})),attrs.ngDragStop&&$timeout(function(){onDragStopCallback(scope,{$data:obj.data,$event:obj})}),void updateDragStyles(!1,obj.element)):void updateDragStyles(!1,obj.element)},isTouching=function(mouseX,mouseY,dragElement){var touching=hitTest(mouseX,mouseY);return scope.isTouching=touching,touching&&(_lastDropTouch=element),updateDragStyles(touching,dragElement),touching},updateDragStyles=function(touching,dragElement){touching?(element.addClass("drag-enter"),dragElement.addClass("drag-over")):_lastDropTouch==element&&(_lastDropTouch=null,element.removeClass("drag-enter"),dragElement.removeClass("drag-over"))},hitTest=function(x,y){var bounds=element[0].getBoundingClientRect();return x-=$document[0].body.scrollLeft+$document[0].documentElement.scrollLeft,y-=$document[0].body.scrollTop+$document[0].documentElement.scrollTop,x>=bounds.left&&x<=bounds.right&&y<=bounds.bottom&&y>=bounds.top};initialize()}}}]).directive("ngDragClone",["$parse","$timeout","ngDraggable",function($parse,$timeout,ngDraggable){return{restrict:"A",link:function(scope,element,attrs){var img,_allowClone=!0;scope.clonedData={};var initialize=function(){img=element.find("img"),element.attr("draggable","false"),img.attr("draggable","false"),reset(),toggleListeners(!0)},toggleListeners=function(enable){enable&&(scope.$on("draggable:start",onDragStart),scope.$on("draggable:move",onDragMove),scope.$on("draggable:end",onDragEnd),preventContextMenu())},preventContextMenu=function(){img.off("mousedown touchstart touchmove touchend touchcancel",absorbEvent_),img.on("mousedown touchstart touchmove touchend touchcancel",absorbEvent_)},onDragStart=function(evt,obj,elm){_allowClone=!0,angular.isDefined(obj.data.allowClone)&&(_allowClone=obj.data.allowClone),_allowClone&&(scope.$apply(function(){scope.clonedData=obj.data}),element.css("width",obj.element[0].offsetWidth),element.css("height",obj.element[0].offsetHeight),moveElement(obj.tx,obj.ty))},onDragMove=function(evt,obj){_allowClone&&(_tx=obj.tx+obj.dragOffset.left,_ty=obj.ty+obj.dragOffset.top,moveElement(_tx,_ty))},onDragEnd=function(evt,obj){_allowClone&&reset()},reset=function(){element.css({left:0,top:0,position:"fixed","z-index":-1,visibility:"hidden"})},moveElement=function(x,y){element.css({transform:"matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+x+", "+y+", 0, 1)","z-index":99999,visibility:"visible","-webkit-transform":"matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+x+", "+y+", 0, 1)","-ms-transform":"matrix(1, 0, 0, 1, "+x+", "+y+")"})},absorbEvent_=function(event){var e=event;return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1,!1};initialize()}}}]).directive("ngPreventDrag",["$parse","$timeout",function($parse,$timeout){return{restrict:"A",link:function(scope,element,attrs){var initialize=function(){element.attr("draggable","false"),toggleListeners(!0)},toggleListeners=function(enable){enable&&element.on("mousedown touchstart touchmove touchend touchcancel",absorbEvent_)},absorbEvent_=function(event){var e=event.originalEvent;return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1,!1};initialize()}}}]).directive("ngCancelDrag",[function(){return{restrict:"A",link:function(scope,element,attrs){element.find("*").attr("ng-cancel-drag","ng-cancel-drag")}}}]).directive("ngDragScroll",["$window","$interval","$timeout","$document","$rootScope",function($window,$interval,$timeout,$document,$rootScope){return{restrict:"A",link:function(scope,element,attrs){var lastMouseEvent=null,config={verticalScroll:attrs.verticalScroll||!0,horizontalScroll:attrs.horizontalScroll||!0,activationDistance:attrs.activationDistance||75,scrollDistance:attrs.scrollDistance||15},reqAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,1e3/60)}}(),animationIsOn=!1,createInterval=function(){function nextFrame(callback){var args=Array.prototype.slice.call(arguments);animationIsOn&&reqAnimFrame(function(){$rootScope.$apply(function(){callback.apply(null,args),nextFrame(callback)})})}animationIsOn=!0,nextFrame(function(){if(lastMouseEvent){var viewportWidth=Math.max(document.documentElement.clientWidth,window.innerWidth||0),viewportHeight=Math.max(document.documentElement.clientHeight,window.innerHeight||0),scrollX=0,scrollY=0;if(config.horizontalScroll&&(lastMouseEvent.clientX<config.activationDistance?scrollX=-config.scrollDistance:lastMouseEvent.clientX>viewportWidth-config.activationDistance&&(scrollX=config.scrollDistance)),config.verticalScroll&&(lastMouseEvent.clientY<config.activationDistance?scrollY=-config.scrollDistance:lastMouseEvent.clientY>viewportHeight-config.activationDistance&&(scrollY=config.scrollDistance)),0!==scrollX||0!==scrollY){var currentScrollLeft=$window.pageXOffset||$document[0].documentElement.scrollLeft,currentScrollTop=$window.pageYOffset||$document[0].documentElement.scrollTop,elementTransform=element.css("transform");element.css("transform","initial"),$window.scrollBy(scrollX,scrollY);var horizontalScrollAmount=($window.pageXOffset||$document[0].documentElement.scrollLeft)-currentScrollLeft,verticalScrollAmount=($window.pageYOffset||$document[0].documentElement.scrollTop)-currentScrollTop;element.css("transform",elementTransform),lastMouseEvent.pageX+=horizontalScrollAmount,lastMouseEvent.pageY+=verticalScrollAmount,$rootScope.$emit("draggable:_triggerHandlerMove",lastMouseEvent)}}})},clearInterval=function(){animationIsOn=!1};scope.$on("draggable:start",function(event,obj){obj.element[0]===element[0]&&(animationIsOn||createInterval())}),scope.$on("draggable:end",function(event,obj){obj.element[0]===element[0]&&animationIsOn&&clearInterval()}),scope.$on("draggable:move",function(event,obj){obj.element[0]===element[0]&&(lastMouseEvent=obj.event)})}}}]),function(undefined){"use strict";function BudgetsManager($q,ApiV2Dataservice,Budget){function _retrieveInstance(id,data){var rep,instance=_pool[id];return data.budget=parseFloat(data.budget),data.actual=parseFloat(data.actual),data.variance=parseFloat(data.variance),data.reps_budgets&&data.reps_budgets.length>0?data.reps_budgets.forEach(function(repsBudget){rep=data.representants.find(function(representant){return repsBudget.rep_id==representant.id}),rep&&(rep.budget=parseFloat(repsBudget.budget),rep.actual=parseFloat(repsBudget.actual))}):data.representants.forEach(function(representant){representant.budget=0,representant.actual=0}),instance?instance.setData(data):(instance=new Budget(data),_pool[id]=instance),instance}function _load(rksId,budgetId,defer){var instance;return ApiV2Dataservice.setOneCallConfig({cache:!1}).tenant.custom.oauth.get("budgets","edit-representants-budgets/rks/"+rksId+"/budget/"+budgetId).then(function(res){instance=_retrieveInstance(budgetId,res.plain().resource),defer.resolve(instance)},function(err){defer.reject(err)}),defer.promise}function _search(id){return _pool[id]}function _drop(id){_search(id)&&delete _pool[id]}var manager,_pool={};return manager={list:function(query,rksId){return ApiV2Dataservice.tenant.custom.oauth.get("budgets","list/rks/"+rksId,{query:query}).then(function(res){return res.plain()},function(err){throw{message:err.data.message,hide_warning:!0}})},get:function(rksId,budgetId){var defer=$q.defer();return _load(rksId,budgetId,defer),defer.promise},reset:function(budgetId){var self=this;return _drop(budgetId),self}}}angular.module("app.core").factory("BudgetsManager",BudgetsManager),BudgetsManager.$inject=["$q","ApiV2Dataservice","BudgetModel"]}(),function(undefined){"use strict";function DetailingsManager($q,dataservice,Detailing){function _retrieveInstance(id,data){var instance=_pool[id];return instance?instance.setData(data):(instance=new Detailing(data),_pool[id]=instance),instance}function _search(id){return _pool[id]}function _load(id,defer){dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns",id).then(function(res){var plain=res.plain(),resource=_retrieveInstance(plain.resource.id,plain.resource);defer.resolve(resource)},function(err){defer.reject(err)})}var manager,_pool={};return manager={find:function(id){return _search(id)},fetch:function(id){var defer=$q.defer(),resource=_search(id);return resource&&!resource.drugs?defer.resolve(resource):_load(id,defer),defer.promise},index:function(filter){var deferred=$q.defer();return dataservice.tenant.index("campaigns",filter).then(function(res){var plain=res.plain(),resources=[];plain.forEach(function(data){var resource=_retrieveInstance(data.id,data);resources.push(resource)}),deferred.resolve(resources)},function(err){deferred.reject(err)}),deferred.promise},list:function(){return _pool},setData:function(data){var resource=_search(data.id);return resource?resource.setData(data):resource=_retrieveInstance(data),resource}}}angular.module("app.detailing").factory("DetailingsManager",DetailingsManager),DetailingsManager.$inject=["$q","dataservice","DetailingModel"]}(),function(undefined){"use strict";function DocumentsWorkflowManager($q,dataservice,$sessionStorage,notifier,principal,PORTAL_SERVER_URI,stepsService,MessagesManager,EmailsManager,QueueManager,TodoManager){function _createId(){return"_"+Math.random().toString(36).substr(2,9)}function _getRoute(docType){var routes={frame_contract:"frame-contracts",frame_contract_annex:"frame-contracts-annexes",campaign_proposal_contract:"campaigns-proposal-contracts",final_report:"final-report-invoices"};return routes[docType]}function _getTitle(docType){var titles={frame_contract:"Frame Contracts",frame_contract_annex:"Frame Contracts Annex",campaign_proposal_contract:"Campaign Proposal Contract",final_report:"Final Report Invoice"};return titles[docType]}function _searchDoc(docType){return angular.copy(_pool[docType])}function _sendData(data){var defer=$q.defer();return _queue.enqueue({action:"storeDocument",arguments:[_docType],data:data}),defer.resolve({}),defer.promise}function _sendDataToUpdate(id,data){var defer=$q.defer();return _queue.enqueue({action:"updateDocumentData",arguments:[_docType,id],data:data}),defer.resolve({}),defer.promise}function _sendMessage(data,metadata){var defer=$q.defer();return data.metadata=JSON.stringify({originator:{id:_identity.id,category:"representant"},document_type:_docType,drugstore_id:_parentData?_parentData.drugstoreId:_metadata?_metadata.drugstore_id:0,drugstore_name:_metadata?_metadata.drugstore_name:"",drugstore_nip:_metadata?_metadata.drugstore_nip:"",document_id:_doc.id,contract_id:_parentData?_createDocumentName():_metadata?_metadata.contract_id:"",campaign_id:_parentData?_parentData.campaignId:_metadata?_metadata.campaign_id:"",campaign_identifier:_parentData?_parentData.campaignIdentifier:_metadata?_metadata.campaign_identifier:"",campaign_step_unique_id:_parentData?_parentData.campaignStep.unique_id:_metadata?_metadata.campaign_step_unique_id:""}),MessagesManager.create(data).then(function(msg){msg.enqueue(_queue).then(function(res){defer.resolve(res)},function(err){defer.reject(err)})}),defer.promise}function _pregReplace(data,template){return template.replace(/\{\{([^}]+)\}\}/g,function(m,pattern){return data.hasOwnProperty(pattern)?data[pattern]:"==="})}function _enqueueTodo(todo){var defer=$q.defer();return _queue.enqueue({action:"createTodo",arguments:[],data:todo}),defer.resolve(todo),defer.promise}function _removeTodo(todoId){var defer=$q.defer();return _queue.enqueue({action:"removeTodo",arguments:[todoId],data:{}}),defer.resolve({}),defer.promise}function _createTodoConfirmation(from,to,template){var message=_formatRksSubject(template),todo=TodoManager.create({rks_id:_parentData.rksId,rep_id:_identity.id,campaign_id:_parentData?_parentData.campaignId:"",drugstore_id:_parentData?_parentData.drugstoreId:0,action_type:"campaign_proposal_contract"==_docType?"proposal":"final_report",action_done:"no",definition:JSON.stringify({message:message,document_id:0,contract_id:_createDocumentName(),total:_doc.total,campaign_step_unique_id:_parentData?_parentData.campaignStep.unique_id:""})});return _enqueueTodo(todo)}function _sendNotificationEmail(from,to,subject,template){var currentTenant=JSON.parse($sessionStorage.currentTenant),templateName="emails.portal-notification-email",name=_druggist.first_name+" "+_druggist.last_name,message=_pregReplace({first_name:_druggist.first_name,last_name:_druggist.last_name,document:_getTitle(_docType),link:"https://demo.3mind-solutions.com/bgx/#/".replace("bgx","TEVA_PROD"==currentTenant.name?"teva":"bgx")+"login?return="+_getRoute(_docType)+"/view/0&email="+_druggist.email},template);return EmailsManager.enqueue(_queue,_druggist.email,name,subject,message,templateName)}function _sendConfirmationEmail(from,to,subject,template){var currentTenant=JSON.parse($sessionStorage.currentTenant),templateName="emails.portal-confirmation-email",name=_druggist.first_name+" "+_druggist.last_name,message=_pregReplace({first_name:_druggist.first_name,last_name:_druggist.last_name,document:_getTitle(_docType),link:"https://demo.3mind-solutions.com/bgx/#/".replace("bgx","TEVA_PROD"==currentTenant.name?"teva":"bgx")+"login?return="+_getRoute(_docType)+"/view/0&email="+_druggist.email},template);return EmailsManager.enqueue(_queue,_druggist.email,name,subject,message,templateName)}function _updateProgress(data){return dataservice.tenant.update("campaigns-drugstores-progress",data.id,data)}function _formatAcceptanceSubject(template){var data;switch(_docType){case"campaign_proposal_contract":data={drugstore_name:_metadata?_metadata.drugstore_name:"",contract_id:_metadata?_metadata.contract_id:"",decision:"accept"==_decision?"Akceptacja":"Odrzucone"};break;case"final_report":data={drugstore_name:_metadata?_metadata.drugstore_name:"",contract_id:_metadata?_metadata.contract_id:"",decision:"accept"==_decision?"Akceptacja":"Odrzucone"}}return _pregReplace(data,template)}function _formatAcceptanceMessage(template){var data;switch(_docType){case"campaign_proposal_contract":data={decision:"accept"==_decision?"zaakceptował":"odrzucił",drugstore_name:_metadata?_metadata.drugstore_name:"",drugstore_nip:_metadata?_metadata.drugstore_nip:"",drugstore_address:_metadata?_metadata.drugstore_address:"",document_id:_metadata?_metadata.document_id:"",contract_id:_metadata?_metadata.contract_id:"",campaign_identifier:_metadata?_metadata.campaign_identifier:"",notification:"reject"==_decision?"<p>Przyczyna odrzucenia:</p><p>"+(_parameters.reason_of_reject?_parameters.reason_of_reject:"")+"</p>":""};break;case"final_report":data={decision:"accept"==_decision?"zaakceptował":"odrzucił",drugstore_name:_metadata?_metadata.drugstore_name:"",drugstore_nip:_metadata?_metadata.drugstore_nip:"",drugstore_address:_metadata?_metadata.drugstore_address:"",document_id:_metadata?_metadata.document_id:"",contract_id:_metadata?_metadata.contract_id:"",campaign_identifier:_metadata?_metadata.campaign_identifier:"",notification:"reject"==_decision?"<p>Przyczyna odrzucenia:</p><p>"+(_parameters.reason_of_reject?_parameters.reason_of_reject:"")+"</p>":""}}return _pregReplace(data,template)}function _sendNotificationMessage(from,to,subject,template){var data,subj,message;return subj=_formatAcceptanceSubject(subject),message=_formatAcceptanceMessage(template),data={message_category:"internal",unique_id:_createId(),from:_identity.id,to:_representantId||0,sender_category:"representant",addressee_category:"representant",subject:subj,message:message,attachments:"",is_sent:!0},_sendMessage(data)}function _formatRksSubject(template){
var data;switch(_docType){case"campaign_proposal_contract":data={drugstore_name:_parentData.drugstoreName,campaign_identifier:_parentData.campaignIdentifier};break;case"final_report":data={drugstore_name:_parentData.drugstoreName,campaign_identifier:_parentData.campaignIdentifier}}return _pregReplace(data,template)}function _formatRksMessage(buttons,template){var data;switch(_docType){case"campaign_proposal_contract":data={drugstore_name:_parentData.drugstoreName,drugstore_nip:_parentData.drugstoreNIP,campaign_name:_parentData.campaignName,document:_getTitle(_docType),document_id:_createDocumentName(),total:_doc.total,buttons:buttons};break;case"final_report":data={drugstore_name:_parentData.drugstoreName,drugstore_nip:_parentData.drugstoreNIP,campaign_name:_parentData.campaignName,document:_getTitle(_docType),document_id:_createDocumentName(),total:_doc.total,buttons:buttons}}return _pregReplace(data,template)}function _sendRksAcceptationMessage(from,to,subject,template){var data,subj,message;return subj=_formatAcceptanceSubject(subject),message=_formatAcceptanceMessage(template),data={message_category:"internal",unique_id:_createId(),from:_identity.id,to:_representantId||0,sender_category:"representant",addressee_category:"representant",subject:subj,message:message,attachments:"",is_sent:!0},_sendMessage(data)}function _sendDruggistAcceptationMessage(from,to,subject,template){var data,subj,message;return subj=_formatAcceptanceSubject(subject),message=_formatAcceptanceMessage(template),data={message_category:"internal",unique_id:_createId(),from:_identity.id,to:_representantId||0,sender_category:"representant",addressee_category:"representant",subject:subj,message:message,attachments:"",is_sent:!0},_sendMessage(data)}function _sendConfirmationMessage(from,to,subject,template){var data,subj,message,defer=$q.defer(),buttons='<div id="accept-and-reject-buttons" class="ui two buttons" style="white-space: nowrap;"><button class="positive ui button" ng-disabled="vm.tab!=\'inbox\'"ng-click="vm.showAcceptConfirmationWindow()">Zaakceptuj</button><button class="negative ui button" ng-disabled="vm.tab!=\'inbox\'"ng-click="vm.showRejectConfirmationWindow()">Odrzuć</button></div>';return _parentData.rksId?(subj=_formatRksSubject(subject),message=_formatRksMessage(buttons,template),data={message_category:"internal",unique_id:_createId(),from:_identity.id,to:_parentData.rksId,sender_category:"representant",addressee_category:"representant",subject:subj,message:message,attachments:"",is_sent:!0},_sendMessage(data).then(function(res){defer.resolve(res)},function(err){defer.reject(err)})):defer.reject("RKS for drugstore is not defined!"),defer.promise}function _executeAction(parameters,isDocAlreadyStored){var docDefinition=_searchDoc(_docType);switch(_parameters=parameters,_selectedStep.action){case"send":switch(_selectedStep.what_to_send){case"todo_confirmation":return _createTodoConfirmation(docDefinition.initiator,docDefinition.addressee,docDefinition.todo_confirmation_template);case"notification_email":return _sendNotificationEmail(docDefinition.initiator,docDefinition.addressee,docDefinition.notification_email_template.subject,isDocAlreadyStored?docDefinition.notification_email_template.secondary_message:docDefinition.notification_email_template.message);case"notification_message":return _sendNotificationMessage(docDefinition.initiator,docDefinition.addressee,docDefinition.notification_message_template.subject,docDefinition.notification_message_template.message);case"confirmation_email":return _sendConfirmationEmail(docDefinition.initiator,docDefinition.addressee,docDefinition.confirmation_email_template.subject,docDefinition.confirmation_email_template.message);case"confirmation_message":return _sendConfirmationMessage(docDefinition.initiator,docDefinition.addressee,docDefinition.confirmation_message_template.subject,docDefinition.confirmation_message_template.message);case"rks_acceptation_message":return _sendRksAcceptationMessage(docDefinition.initiator,docDefinition.addressee,docDefinition.rks_acceptation_message_template.subject,docDefinition.rks_acceptation_message_template.message);case"druggist_acceptation_message":return _sendDruggistAcceptationMessage(docDefinition.initiator,docDefinition.addressee,docDefinition.druggist_acceptation_message_template.subject,docDefinition.druggist_acceptation_message_template.message);case"absolutely_nothing_at_all":}break;case"confirm_or_reject":case"start_campaign":case"finish_campaign":case"do_nothing":default:var defer=$q.defer();return defer.reject("Wrong step!"),defer.promise}}function _enqueueSetCampaignStepStatus(campaignId,drugstoreId,data){var defer=$q.defer();return _queue.enqueue({action:"setCampaignStepStatus",arguments:[campaignId,drugstoreId],data:data}),defer.resolve({}),defer.promise}function storeCampaignStepStatus(campaignId,drugstoreId,data){return dataservice.tenant.customOauth.post("campaigns-drugstores-progress",data,"update-step-status/campaign/"+campaignId+"/drugstore/"+drugstoreId)}function _setCampaignStepStatus(){var data,defer=$q.defer();return _selectedStep.set_campaign_step_status&&"remain_unchanged"!==_selectedStep.set_campaign_step_status?(stepsService.setStepStatus(_parentData?_parentData.drugstoreId:_metadata.drugstore_id,_parentData?_parentData.campaignId:_metadata.campaign_id,_parentData?_parentData.campaignStep.unique_id:_metadata.campaign_step_unique_id,_selectedStep.set_campaign_step_status),data={step_unique_id:_parentData?_parentData.campaignStep.unique_id:_metadata.campaign_step_unique_id,step_status:_selectedStep.set_campaign_step_status},_enqueueSetCampaignStepStatus(_parentData?_parentData.campaignId:_metadata.campaign_id,_parentData?_parentData.drugstoreId:_metadata.drugstore_id,data).then(function(res){defer.resolve(res)},function(err){defer.reject(err)})):defer.resolve({}),defer.promise}function _setCampaignStepStatusCompleted(){var data,defer=$q.defer();return stepsService.setStepStatus(_parentData?_parentData.drugstoreId:_metadata.drugstore_id,_parentData?_parentData.campaignId:_metadata.campaign_id,_parentData?_parentData.campaignStep.unique_id:_metadata.campaign_step_unique_id,"completed"),data={step_unique_id:_parentData?_parentData.campaignStep.unique_id:_metadata.campaign_step_unique_id,step_status:"completed"},storeCampaignStepStatus(_parentData?_parentData.campaignId:_metadata.campaign_id,_parentData?_parentData.drugstoreId:_metadata.drugstore_id,data).then(function(res){defer.resolve(res)},function(err){defer.reject(err)}),defer.promise}function _importDocsWorkflowDefinition(docsWorkflowDefinition){try{_pool=JSON.parse(docsWorkflowDefinition)}catch(e){}}function _searchStep(id){return angular.copy(_steps[id])}function _selectWorkflowStep(order){_selectedStep=_searchStepByOrder(order)}function _searchStepByOrder(order){var filtered,retval;return filtered=Object.keys(_steps).filter(function(id){return _steps.hasOwnProperty(id)&&_steps[id].order===order}),filtered.length&&(retval=_searchStep(filtered.shift())),retval}function _getDocument(campaignId,drugstoreId,campaignProgressId){var defer=$q.defer();return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("documents-workflow",_docType+"/campaign/"+campaignId+"/drugstore/"+drugstoreId+"/progress/"+campaignProgressId).then(function(res){_doc=res.plain().resource,defer.resolve(res)}),defer.promise}function _getDocumentById(id){var defer=$q.defer();return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("documents-workflow",_docType+"/"+id).then(function(res){_doc=res.resource,defer.resolve(res)}),defer.promise}function _getWorkflowStatus(id){var defer=$q.defer();return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("documents-workflow","get-status/"+_docType+"/"+id).then(function(res){_workflowStatus=res.plain().resource,defer.resolve(_workflowStatus)}),defer.promise}function _updateWorkflowStatus(id,data){var defer=$q.defer();return _queue.enqueue({action:"updateWorkflowStatus",arguments:[_docType,id],data:data}),defer.resolve({}),defer.promise}function _createDocumentName(){var retval,drugstoreCPCSignDateString;return drugstoreCPCSignDateString=moment().format("DD-MM-YYYY"),retval=_parentData.promolineName+"_"+_parentData.campaignIdentifier+"_"+_parentData.drugstoreNIP+"_"+drugstoreCPCSignDateString}function _updateDocumentData(id,data){var defer=$q.defer();return data.staff_id=_identity.id,data.rks_id=_parentData.rksId,data.doc_id=_createDocumentName(),"RKS"==_selectedStep.addressee?(data.status="awaiting_rks",data.rks_status="pending"):(data.status="pending",data.rks_status="pending"),_sendDataToUpdate(id,data).then(function(res){defer.resolve(_doc)},function(err){console.log(err),notifier.error("Error",err.data.message)}),defer.promise}function _saveDoc(data){var defer=$q.defer();return data.staff_id=_identity.id,data.rks_id=_parentData.rksId,data.doc_id=_createDocumentName(),"RKS"==_selectedStep.addressee?(data.status="awaiting_rks",data.rks_status="pending"):(data.status="pending",data.rks_status="pending"),_sendData(data).then(function(res){defer.resolve(_doc)},function(err){console.log(err),notifier.error("Error",err.data.message)}),defer.promise}function _getDrugstoreEmail(drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("mailer","drugstore/"+drugstoreId+"/get-email")}function _commit(){var defer=$q.defer(),data={chain:_queue.stringify()};return dataservice.tenant.customOauth.post("documents-workflow",data,"apply-chain").then(function(res){defer.resolve(res)},function(err){console.log(err),defer.reject(err)}),defer.promise}function _updateMessage(decision,msg){var html='<div class="ui '+("accept"==decision?"positive":"error")+' message"><div class="header">Zlecenie zostało '+("accept"==decision?"zaakceptowane":"odrzucone")+".</div></div>";$("#accept-and-reject-buttons").replaceWith(html);var message=$("#selected-message").html();return msg.enqueueUpdate(_queue,{message:message})}function _sendReportToCompany(campaignId,drugstoreId,campaignProgressId){return dataservice.tenant.customOauth.post("documents-workflow",data,"send-report-to-company/campaign/"+campaignId+"/drugstore/"+drugstoreId+"/campaign-progress/"+campaignProgressId)}var _queue,_parentData,_parameters,_identity,_metadata,_representantId,_druggist,_workflowStatus,_selectedStep,_route,_decision,manager,_doc={},_pool={},_docType="",_steps={};return manager={init:function(docType,parentData,docsWorkflowDefinition){var defer=$q.defer();return _parentData=parentData,_docType=docType,_route=_getRoute(docType),_queue=new QueueManager,_metadata={drugstore_name:parentData.drugstoreName,drugstore_nip:parentData.drugstoreNIP,document_id:parentData.campaignId},principal.identity(!1,"mobile").then(function(identity){_identity=identity,_getDrugstoreEmail(parentData.drugstoreId).then(function(res){var plain=res.plain();plain.hasOwnProperty("addressee")&&(_druggist=plain.addressee),_importDocsWorkflowDefinition(docsWorkflowDefinition),_pool.hasOwnProperty(docType)&&(_steps=angular.copy(_pool[docType].steps)),_parentData.campaignProgressId?_getDocument(_parentData.campaignId,_parentData.drugstoreId,_parentData.campaignProgressId).then(function(res){_doc=angular.copy(res.plain().resource),_doc?_getWorkflowStatus(_doc.id).then(function(){defer.resolve(_doc)}):defer.resolve({})}):defer.resolve({})})}),defer.promise},setProgressId:function(id){_parentData?_parentData.campaignProgressId=id:_parentData={campaignProgressId:id}},start:function(id,docType,data){var defer=$q.defer();return _parentData=undefined,_docType=docType,_route=_getRoute(docType),_representantId=data.originator,_metadata=data.metadata,_queue=new QueueManager,principal.identity(!1,"mobile").then(function(identity){_identity=identity,_getWorkflowStatus(id).then(function(stat){_getDocumentById(id).then(function(res){_doc=angular.copy(res.plain().resource),_importDocsWorkflowDefinition(_doc.campaign.docs_workflow_definition),_pool.hasOwnProperty(docType)&&(_steps=angular.copy(_pool[docType].steps)),defer.resolve(_doc)})})}),defer.promise},checkIfDocIsSaved:function(){return angular.isObject(_doc)},finishCampaign:function(data){return _updateProgress(data)},checkIfStatusIsSaved:function(){return angular.isDefined(_workflowStatus)},createDocumentName:function(prefix){return prefix+"_"+_createDocumentName()},storeDocument:function(data){return _doc=data,_saveDoc(data)},updateDocumentData:function(data){return _updateDocumentData(_doc.id,data)},selectWorkflowStep:function(order){return _selectWorkflowStep(order),manager},selectCurrentWorkflowStep:function(){return _workflowStatus&&(_selectedStep=_searchStep(_workflowStatus.current_step_id)),manager},getCurrentStep:function(){return _selectedStep},findWorkflowStep:function(id){return _selectedStep=_searchStep(id),manager},executeAction:function(data,isDocAlreadyStored){var defer=$q.defer();return _selectedStep?_executeAction(data,isDocAlreadyStored).then(function(res){defer.resolve()},function(err){defer.reject(err)}):defer.reject("Can not find documents workflow for the campaign."),defer.promise},setCampaignStepStatus:function(){return _selectedStep?_setCampaignStepStatus():void defer.reject("Can not find documents workflow for the campaign.")},setCampaignStepStatusCompleted:function(){return _setCampaignStepStatusCompleted()},jumpToNextStep:function(){var defer=$q.defer();return _selectedStep?(_workflowStatus?_workflowStatus.current_step_id=_selectedStep.jump_to_step:_workflowStatus={document_id:_doc?_doc.id:0,document_type:_docType,status:"active",current_step_id:_selectedStep.jump_to_step},defer.resolve(_updateWorkflowStatus(_doc?_doc.id:0,_workflowStatus))):defer.reject("Can not find documents workflow for the campaign."),defer.promise},jumpToNextStepOnDecision:function(decision){var jumpTo,defer=$q.defer();if(_decision=decision,_selectedStep){switch(decision){case"accept":jumpTo=_selectedStep.on_confirm_jump_to_step;break;case"reject":jumpTo=_selectedStep.on_reject_jump_to_step}_workflowStatus?_workflowStatus.current_step_id=jumpTo:_workflowStatus={document_id:_doc?_doc.id:0,document_type:_docType,status:"active",current_step_id:jumpTo},_selectedStep=_searchStep(jumpTo),defer.resolve(_selectedStep)}else defer.reject("Can not find documents workflow for the campaign.");return defer.promise},updateDocument:function(instance,rksStatus,budget_item){return instance.update(_queue,{status:"accepted"==rksStatus?"pending":"rejected",rks_status:rksStatus,budget_item:budget_item})},updateInvoiceDefinition:function(services){return _updateInvoiceDefinition(services)},commit:function(){return _commit()},removeTodo:function(todoId){return _removeTodo(todoId)},updateMessage:function(decision,msg){return _updateMessage(decision,msg)},getNotificationEmailTemplate:function(){var docDefinition=_searchDoc(_docType);return docDefinition.notification_email_template},reloadDocument:function(){var defer=$q.defer();return _getDocument(_parentData.campaignId,_parentData.drugstoreId,_parentData.campaignProgressId).then(function(res){defer.resolve(res)}),defer.promise},sendReportToCompany:function(){var defer=$q.defer();return _sendReportToCompany(_parentData.campaignId,_parentData.drugstoreId,_parentData.campaignProgressId).then(function(res){defer.resolve(res)}),defer.promise},getQueueLength:function(){return _queue.getLength()}}}angular.module("app.core").factory("DocumentsWorkflowManager",DocumentsWorkflowManager),DocumentsWorkflowManager.$inject=["$q","dataservice","$sessionStorage","notifier","principal","PORTAL_SERVER_URI","stepsService","MessagesManager","EmailsManager","QueueManager","TodoManager"]}(),function(undefined){"use strict";function ProgressManager($q,dataservice,Progress){function _retrieveInstance(id,data){var instance=_pool[id];return instance?instance.setData(data):(instance=new Progress(data),_pool[id]=instance),instance}function _search(id){return _pool[id]}function _load(id,defer){dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("detailing-progress",id).then(function(res){var resource=_retrieveInstance(res.resource.id,res.resource);resource.stats=JSON.parse(resource.stats),defer.resolve(resource)},function(err){defer.reject(err)})}function _init(id,defer){dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.post("detailing-progress",{},id+"/initialize").then(function(res){var resource=_retrieveInstance(res.resource.id,res.resource);resource.stats=JSON.stringify(resource.stats),defer.resolve(resource)},function(err){defer.reject(err)})}var manager,_pool={};return manager={fetch:function(campaignId){var defer=$q.defer(),resource=_search(campaignId);return resource?defer.resolve(resource):_load(campaignId,defer),defer.promise},index:function(filter){var deferred=$q.defer();return dataservice.tenant.index("Progresss",filter).then(function(res){var resources=[];res.forEach(function(data){var resource=_retrieveInstance(data.id,data);resources.push(resource)}),deferred.resolve(resources)},function(err){deferred.reject(err)}),deferred.promise},setData:function(data){var stats,resource=_search(data.id);return resource?resource.setData(data):(angular.isString(data.stats)&&(stats=data.stats,data.stats=JSON.parse(stats)),resource=_retrieveInstance(data.id,data)),resource},initialize:function(campaignId){var defer=$q.defer();return _init(campaignId,defer),defer.promise}}}angular.module("app.detailing").factory("ProgressManager",ProgressManager),ProgressManager.$inject=["$q","dataservice","ProgressModel"]}(),function(undefined){"use strict";function DrugstoresManager($q,dataservice,Drugstore){function _retrieveInstance(id,data){var instance=_pool[id];return instance?instance.setData(data):(instance=new Drugstore(data),_pool[id]=instance),instance}function _search(id){return _pool[id]}function _load(id,defer){dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("drugstores",id).then(function(res){var resource=_retrieveInstance(res.resource.id,res.resource);defer.resolve(resource)},function(err){defer.reject(err)})}var manager,_pool={};return manager={fetch:function(id){var defer=$q.defer(),resource=_search(id);return resource?defer.resolve(resource):_load(id,defer),defer.promise},index:function(filter){var deferred=$q.defer();return dataservice.tenant.index("drugstores",filter).then(function(res){var resources=[];res.forEach(function(data){var resource=_retrieveInstance(data.id,data);resources.push(resource)}),deferred.resolve(resources)},function(err){deferred.reject(err)}),deferred.promise},setData:function(data){var resource=_search(data.id);return resource?resource.setData(data):resource=_retrieveInstance(data),resource}}}angular.module("app.detailing").factory("DrugstoresManager",DrugstoresManager),DrugstoresManager.$inject=["$q","dataservice","DrugstoreModel"]}(),function(undefined){"use strict";function GiftsManager($q,dataservice,Gift){function _retrieveInstance(id,data){var instance=_pool[id];return instance?instance.setData(data):(instance=new Gift(data),_pool[id]=instance),instance}function _search(id){return _pool[id]}function _load(id,defer){dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("Gifts",id).then(function(res){var resource=_retrieveInstance(res.resource.id,res.resource);defer.resolve(resource)},function(err){defer.reject(err)})}function getColor(idx){var giftsColors=["red","orange","yellow","green","teal","blue","purple","pink","grey"];return idx<giftsColors.length?giftsColors[idx]:(idx%=giftsColors.length,giftsColors[idx])}function fixTouch(touch){var winPageX=window.pageXOffset,winPageY=window.pageYOffset,x=touch.clientX,y=touch.clientY;return 0===touch.pageY&&Math.floor(y)>Math.floor(touch.pageY)||0===touch.pageX&&Math.floor(x)>Math.floor(touch.pageX)?(x-=winPageX,y-=winPageY):(y<touch.pageY-winPageY||x<touch.pageX-winPageX)&&(x=touch.pageX-winPageX,y=touch.pageY-winPageY),{clientX:x,clientY:y}}function hitTest(coord){var element=angular.element("[ng-drop]"),bounds=element[0].getBoundingClientRect();return coord.clientX>=bounds.left&&coord.clientX<=bounds.right&&coord.clientY<=bounds.bottom&&coord.clientY>=bounds.top}function getGiftsNumber(gift,giftsNumber,representantId){var retval=0;return giftsNumber.hasOwnProperty("gifts")&&giftsNumber.gifts.hasOwnProperty(gift.id)&&giftsNumber.gifts[gift.id].hasOwnProperty("reps")&&giftsNumber.gifts[gift.id].reps.hasOwnProperty(representantId)&&(retval=giftsNumber.gifts[gift.id].reps[representantId]),retval}function getStaffPoints(progress,staffId){var retval=0;return progress.drugstore_id&&(retval=progress.getStaffPoints(progress.drugstore_id,staffId)),retval}function getStaffSpentPoints(progress,staffId){var retval=0;return progress.drugstore_id&&(retval=progress.getStaffSpentPoints(progress.drugstore_id,staffId)),retval}function setStaffSpentPoints(points,progress,staffId){progress.setStaffSpentPoints(points,progress.drugstore_id,staffId)}var manager,_pool={};return manager={fetch:function(id){var defer=$q.defer(),resource=_search(id);return resource?defer.resolve(resource):_load(id,defer),defer.promise},find:function(id){return _search(id)},"import":function(gifts,giftsNumber,representantId,progress){gifts.forEach(function(gift,idx){gift.color=getColor(idx),gift.quantity=getGiftsNumber(gift,giftsNumber,representantId),_retrieveInstance(gift.id,gift)})},setData:function(data){var resource=_search(data.id);return resource?resource.setData(data):resource=_retrieveInstance(data.id,data),resource},setGiftsNumber:function(staffId,giftsNumber){giftsNumber.hasOwnProperty("gifts")&&giftsNumber.gifts.forEach(function(quantity){quantity.reps.hasOwnProperty(giftsNumber)})},setGiftsPoints:function(data){var chunk;for(var idx in _pool)_pool.hasOwnProperty(idx)&&(chunk=data.find(function(props){return props.property=="ds_campaign_gift_points_"+_pool[idx].id}),chunk&&(_pool[idx].points=chunk.points,_pool[idx].label=chunk.label,_pool[idx].visible=chunk.visible))},index:function(){return _pool},onDropComplete:function(data,event,progress,staffId){var idx,element=event.element,dataDropped=data,availablePoints=getStaffPoints(progress,staffId),spentPoints=getStaffSpentPoints(progress,staffId);if("true"==element.attr("starting-drag")){if(0===data.quantity)return!1;if(data.points){if(spentPoints+data.points>availablePoints)return!1;spentPoints+=data.points,setStaffSpentPoints(spentPoints,progress,staffId)}progress.dropped.hasOwnProperty(staffId)?idx=progress.dropped[staffId].indexOf(data):(progress.dropped[staffId]=[],idx=-1),idx<0?(dataDropped.amountDropped=1,data.points&&(dataDropped.pointsDropped=data.points?data.points:0),progress.dropped[staffId].push(data)):(data.amount>0&&dataDropped.amountDropped++,data.points&&(dataDropped.pointsDropped+=data.points)),data.quantity>0&&data.quantity--,progress.addGiftToGive(data),element.attr("starting-drag","false")}},onDroppedDragEnd:function(data,event,progress,staffId){var touching,coord,idx=progress.dropped[staffId].indexOf(data),spentPoints=getStaffSpentPoints(progress,staffId),hasTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;hasTouch&&event.originalEvent&&event.originalEvent.changedTouches.length?coord=fixTouch(event.originalEvent.changedTouches[0]):event.clientX&&(coord={clientX:event.clientX,clientY:event.clientY}),touching=hitTest(coord),touching||(data.amountDropped>1?data.amountDropped--:1==data.amountDropped&&progress.dropped[staffId].splice(idx,1),data.quantity++,data.points&&(data.pointsDropped-=data.points),spentPoints-=data.points,setStaffSpentPoints(spentPoints,progress,staffId),progress.removeGiftToGive(data))}}}angular.module("app.detailing").factory("GiftsManager",GiftsManager),GiftsManager.$inject=["$q","dataservice","GiftModel"]}(),function(undefined){"use strict";function PresentationsManager($q,dataservice,Presentation){function _retrieveInstance(id,data){var instance=_pool[id];return instance?instance.setData(data):(instance=new Presentation(data),_pool[id]=instance),instance}function _search(id){return _pool[id]}function _load(id,defer){dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("presentations",id).then(function(res){var resource=_retrieveInstance(res.resource.id,res.resource);defer.resolve(resource)},function(err){defer.reject(err)})}var manager,_pool={};return manager={fetch:function(id){var defer=$q.defer(),resource=_search(id);return resource?defer.resolve(resource):_load(id,defer),defer.promise},index:function(filter){var deferred=$q.defer();return dataservice.tenant.index("presentations",filter).then(function(res){var resources=[];res.forEach(function(data){var resource=_retrieveInstance(data.id,data);resources.push(resource)}),deferred.resolve(resources)},function(err){deferred.reject(err)}),deferred.promise},setData:function(data){var resource=_search(data.id);return resource?resource.setData(data):resource=_retrieveInstance(data),resource}}}angular.module("app.detailing").factory("PresentationsManager",PresentationsManager),PresentationsManager.$inject=["$q","dataservice","PresentationModel"]}(),function(undefined){"use strict";function CampaignsProposalContractsManager($q,dataservice,CampaignProposalContract){function _retrieveInstance(id,data){var instance=_pool[id];return instance?instance.setData(data):(instance=new CampaignProposalContract(data),_pool[id]=instance),instance}function _load(id,defer){dataservice.tenant.edit("campaigns-proposal-contracts",id).then(function(res){var resource=_retrieveInstance(res.resource.id,res.resource);defer.resolve(resource)},function(err){defer.reject(err)})}function _search(id){return _pool[id]}var manager,_pool={},_smartGridOptions={collection:"documents-workflow",toggle:"page",sort:!0,filter:!1,tickbox:!1,columns:[{name:"created_at",data:"created_at",title:"DATE_TIME",width:"15%"},{name:"campaign_id",data:"campaign.identifier",title:"CAMPAIGN_ID",width:"15%"},{name:"campaign_name",data:"campaign.name",title:"CAMPAIGN_NAME",width:"15%"},{name:"description",data:"description",title:"DESCRIPTION",width:"30%"},{name:"status",data:"status",title:"STATUS",width:"15%"},{name:"actions",template:'<a class="btn btn-primary btn-xs" ui-sref="campaignsProposalContracts.view({id: item.id})"style="margin-top: 3px;">{{"VIEW" | translate}}</a>',noPadding:!0,title:"ACTIONS",width:"10%"}]};return manager={retrieveInstance:function(id,data){var defer=$q.defer();return defer.resolve(_retrieveInstance(id,data)),defer.promise},fetch:function(id){var defer=$q.defer(),resource=_search(id);return resource?defer.resolve(resource):_load(id,defer),defer.promise},find:function(id){return _search(id)},getSmartGridOptions:function(){return _smartGridOptions}}}angular.module("app.core").factory("CampaignsProposalContractsManager",CampaignsProposalContractsManager),CampaignsProposalContractsManager.$inject=["$q","dataservice","CampaignProposalContractModel"]}(),function(undefined){"use strict";function FinalReportInvoicesManager($q,dataservice,FinalReportInvoice){function _retrieveInstance(id,data){var instance=_pool[id];return instance?instance.setData(data):(instance=new FinalReportInvoice(data),_pool[id]=instance),instance}function _load(id,defer){dataservice.tenant.edit("final-report-invoices",id).then(function(res){var resource=_retrieveInstance(res.resource.id,res.resource);defer.resolve(resource)},function(err){defer.reject(err)})}function _search(id){return _pool[id]}var manager,_pool={},_smartGridOptions={collection:"documents-workflow",toggle:"page",sort:!0,filter:!1,tickbox:!1,columns:[{name:"created_at",data:"created_at",title:"DATE_TIME",width:"15%"},{name:"campaign_id",data:"campaign.identifier",title:"CAMPAIGN_ID",width:"15%"},{name:"campaign_name",data:"campaign.name",title:"CAMPAIGN_NAME",width:"15%"},{name:"description",data:"description",title:"DESCRIPTION",width:"30%"},{name:"status",data:"status",title:"STATUS",width:"15%"},{name:"actions",template:'<a class="btn btn-primary btn-xs" ui-sref="finalReportsInvoices.view({id: item.id})"style="margin-top: 3px;">{{"VIEW" | translate}}</a>',noPadding:!0,title:"ACTIONS",width:"10%"}]};return manager={retrieveInstance:function(id,data){var defer=$q.defer();return defer.resolve(_retrieveInstance(id,data)),defer.promise},fetch:function(id){var defer=$q.defer(),resource=_search(id);return resource?defer.resolve(resource):_load(id,defer),defer.promise},find:function(id){return _search(id)},getSmartGridOptions:function(){return _smartGridOptions}}}angular.module("app.core").factory("FinalReportInvoicesManager",FinalReportInvoicesManager),FinalReportInvoicesManager.$inject=["$q","dataservice","FinalReportInvoiceModel"]}(),function(undefined){"use strict";function EmailsManager($q,dataservice){function _send(data){return dataservice.tenant.customOauth.post("mailer",data,"send")}var manager;return manager={send:function(to,name,subject,message,template){var defer=$q.defer();return _send({to:to,name:name,subject:subject,message:message,template:template}).then(function(res){defer.resolve(res)},function(err){console.log(err),defer.reject(res)}),defer.promise},enqueue:function(queue,to,name,subject,message,template){var defer=$q.defer();return queue.enqueue({action:"sendEmail",arguments:[],data:{to:to,name:name,subject:subject,message:message,template:template}}),defer.resolve({}),defer.promise}}}angular.module("app.core").factory("EmailsManager",EmailsManager),EmailsManager.$inject=["$q","dataservice"]}(),function(undefined){"use strict";function MessagesManager($q,dataservice,principal,Message,CampaignsDataservice){function _createId(){return"_"+Math.random().toString(36).substr(2,9)}function _retrieveInstance(id,data){var instance=_pool[id];return instance?instance.setData(data):(instance=new Message(data),_pool[id]=instance),instance}function _addressees(filter){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("messages","addressees",filter)}function _unread(filter){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("messages","unread",filter)}function _update(data){return dataservice.tenant.customOauth.post("messages",data,"update")}function _load(id,defer){}function _search(id){return _pool[id]}function _remove(id){delete _pool[id]}function _index(filter){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("messages","list",filter)}function _getRks(drugstoreId){var staffByDrugstore,jobDuties,rksId,defer=$q.defer();return CampaignsDataservice.getStaffJobs().then(function(staffJobs){staffByDrugstore=staffJobs.filter(function(el){return jobDuties=el.job_duties,el.drugstore_id==drugstoreId&&(jobDuties.indexOf("[2]")>-1||jobDuties.indexOf("[3]")>-1)}),staffByDrugstore.length&&(rksId=staffByDrugstore[0].staff_id),defer.resolve(rksId)}),defer.promise}var _userId,manager,_pool={};return manager={dropdownAttached:!1,init:function(){var defer=$q.defer();return principal.identity(!1,"mobile").then(function(identity){_userId=identity.id,defer.resolve(identity)}),defer.promise},getAdressees:function(){var defer=$q.defer();return _addressees().then(function(res){defer.resolve(res.plain().resources)},function(err){defer.reject(err)}),defer.promise},fetch:function(id){var defer=$q.defer(),resource=_search(id);return resource?defer.resolve(resource):_load(id,defer),defer.promise},find:function(id){return _search(id)},findRksId:function(drugstoreId){return _getRks(drugstoreId)},create:function(data){var defer=$q.defer();return data.unique_id=_createId(),defer.resolve(_retrieveInstance("new",data)),defer.promise},send:function(){var sent,defer=$q.defer(),msg=_search("new");return msg&&msg.send().then(function(res){sent=_retrieveInstance(res.data.last_insert_id,msg),_remove("new"),defer.resolve(sent)},function(err){defer.reject(err)}),defer.promise},inbox:function(addresseeCategories,senderCategories,categories,page){var defer=$q.defer(),filter={page:page,"message_categories[]":categories,to:_userId,"addressee_categories[]":addresseeCategories,"sender_categories[]":senderCategories,
is_sent:!0,deleted_from_inbox:!1};return _index(filter).then(function(res){var resources=[];res.forEach(function(data){var resource=_retrieveInstance(data.id,data);resources.push(resource)}),defer.resolve(resources)},function(err){defer.reject(err)}),defer.promise},outbox:function(addresseeCategories,senderCategories,categories,page){var defer=$q.defer(),filter={page:page,"message_categories[]":categories,from:_userId,"addressee_categories[]":addresseeCategories,"sender_categories[]":senderCategories,is_sent:!0,deleted_from_outbox:!1};return _index(filter).then(function(res){var resources=[];res.forEach(function(data){var resource=_retrieveInstance(data.id,data);resources.push(resource)}),defer.resolve(resources)},function(err){defer.reject(err)}),defer.promise},trash:function(addresseeCategories,senderCategories,categories,page){var defer=$q.defer(),filter={"message_categories[]":categories,"addressee_categories[]":addresseeCategories,"sender_categories[]":senderCategories,page:page,to:_userId,from:_userId,is_sent:!0,deleted_from_inbox:!0,deleted_from_outbox:!0};return _index(filter).then(function(res){var resources=[];res.forEach(function(data){var resource=_retrieveInstance(data.id,data);resources.push(resource)}),defer.resolve(resources)},function(err){defer.reject(err)}),defer.promise},notify:function(){},unread:function(messageCategory){var filter={message_category:messageCategory,to:_userId,addressee_category:"representant",deleted_from_inbox:!1,deleted_from_outbox:!1};return _unread(filter)},moveToTrash:function(box,data){var prop="inbox"==box?"deleted_from_inbox":"deleted_from_outbox";return data.to=_userId,data.toUpdate={},data.toUpdate[prop]=!0,_update(data)},markAsRead:function(id){return _update({ids:[id],toUpdate:{is_read:!0}})},update:function(id,data){return _update({ids:[id],toUpdate:data})}}}angular.module("app.core").factory("MessagesManager",MessagesManager),MessagesManager.$inject=["$q","dataservice","principal","MessageModel","campaignsDataservice"]}(),function(undefined){"use strict";function TodoManager($q,dataservice,Todo){function _retrieveInstance(id,data){var instance=_pool[id];return instance?instance.setData(data):(instance=new Todo(data),_pool[id]=instance),instance}function _load(id,defer){}function _search(id){return _pool[id]}function _createId(){return"_"+Math.random().toString(36).substr(2,9)}var manager,_pool={};return manager={fetch:function(id){var defer=$q.defer(),resource=_search(id);return resource?defer.resolve(resource):_load(id,defer),defer.promise},find:function(id){return _search(id)},create:function(data){return _retrieveInstance(_createId(),data)}}}angular.module("app.core").factory("TodoManager",TodoManager),TodoManager.$inject=["$q","dataservice","TodoModel"]}(),function(undefined){"use strict";function BudgetModel($q,ApiV2Dataservice){function Budget(data){data&&this.setData(data)}return Budget.prototype={setData:function(data){angular.merge(this,data)},store:function(data,rksId){var scope=this;return ApiV2Dataservice.tenant.custom.oauth.post("budgets",data,"store-representants-budgets/rks/"+rksId+"/budget/"+scope.id).then(function(res){return res.plain()},function(err){return err.data.message})}},Budget}angular.module("app.core").factory("BudgetModel",BudgetModel),BudgetModel.$inject=["$q","ApiV2Dataservice"]}(),function(undefined){"use strict";function DetailingModel($q,dataservice){function Detailing(data){data&&this.setData(data)}function decrunchDetailingDefinition(scope){try{scope.definition=JSON.parse(scope.definition)}catch(e){}}function getPage(scope,type,name){angular.isString(scope.definition)&&decrunchDetailingDefinition(scope);var step=scope.definition.steps[0];return step.pages.find(function(page){return name?type==page.type&&name==page.name:type==page.type})}function clone(obj){if(null===obj||"object"!=typeof obj)return obj;var copy=obj.constructor();for(var attr in obj)obj.hasOwnProperty(attr)&&(copy[attr]=clone(obj[attr]));return copy}return Detailing.prototype={setData:function(data){angular.extend(this,data)},getGifts:function(){return this.gifts||[]},getGiftsNumber:function(){var scope=this;return angular.isString(scope.definition)&&decrunchDetailingDefinition(scope),scope.definition.giftsNumber},getGiftsPoints:function(){var page,scope=this,retval=[];if(page=getPage(scope,"after_presentation"))for(var idx in page.properties)page.properties.hasOwnProperty(idx)&&idx.match(/ds_campaign_gift_points_/)&&retval.push({property:idx,points:page.properties[idx].points,label:page.properties[idx].label,visible:page.properties[idx].visible});return retval},filterDrugstores:function(repId){var drugstores,staff,scope=this;drugstores=scope.drugstores.filter(function(ds){return!ds.staff&&(staff=ds.staff.find(function(staff){return staff.id==repId}),!!staff)}),scope.drugstores=[],drugstores.forEach(function(ds){scope.drugstores.push(clone(ds))})},getTotalPresentationsPoints:function(){var scope=this,totalPoints=0;return scope.hasOwnProperty("presentations")&&scope.presentations.length&&scope.presentations.forEach(function(presentation){totalPoints+=presentation.points}),totalPoints}},Detailing}angular.module("app.detailing").factory("DetailingModel",DetailingModel),DetailingModel.$inject=["$q","dataservice"]}(),function(undefined){"use strict";function ProgressModel($q,dataservice,GiftsManager){function Progress(data){data&&this.setData(data)}function decrunchProgressStats(scope){try{scope.stats=JSON.parse(scope.stats)}catch(e){}}return Progress.prototype={drugstoreId:0,dropped:{},issued:{},giftsToGive:[],setData:function(data){angular.extend(this,data)},getDrugstoreProgress:function(drugstoreId){function cpIds(dp){return dp.id===drugstoreId}var retval,scope=this;angular.isString(scope.stats)&&decrunchProgressStats(scope),scope.stats.hasOwnProperty("drugstores")||(scope.stats.drugstores=[{id:drugstoreId,staff:[]}]);do retval=scope.stats.drugstores.find(cpIds),retval||scope.stats.drugstores.push({id:drugstoreId,staff:[]});while(!retval);return retval},getCurrentCycle:function(){var cycle,scope=this,month=(new Date).getMonth()+1;return scope.stats.hasOwnProperty("cycles")&&(cycle=scope.stats.cycles.find(function(cycle){return parseInt(cycle.month)==month})),cycle},toggleSeenPresentation:function(seen,drugstore,presentation,drugstoreStaffId){var cycle,drugstoreProgress,addPoints,addGainedPoints,drugstoreStaffProgress,drugstoreStaffPresentationProgress,scope=this;return drugstoreProgress=scope.getDrugstoreProgress(drugstore.id),addPoints=seen?presentation.points:-presentation.points,addGainedPoints=seen?presentation.points:-presentation.points,drugstoreStaffProgress=drugstoreProgress.staff.find(function(e){return e.id===drugstoreStaffId}),drugstoreStaffProgress?(drugstoreStaffProgress.points+=addPoints,drugstoreStaffProgress.gained_points+=addGainedPoints,drugstoreStaffPresentationProgress=drugstoreStaffProgress.presentations.find(function(e){return e.id===presentation.id}),drugstoreStaffPresentationProgress?drugstoreStaffPresentationProgress.seen=seen:drugstoreStaffProgress.presentations.push({id:presentation.id,seen:seen})):drugstoreProgress.staff.push({id:drugstoreStaffId,points:addPoints,gained_points:addGainedPoints,presentations:[{id:presentation.id,seen:seen}]}),scope.current_points+=seen?1:-1,cycle=scope.getCurrentCycle(),cycle&&(cycle.current_points+=seen?1:-1),addPoints},getStatsSeen:function(drugstore,presentation){var seen,scope=this,retval={},drugstoreProgress=scope.getDrugstoreProgress(drugstore.id);return drugstoreProgress&&drugstoreProgress.hasOwnProperty("staff")&&drugstoreProgress.staff.forEach(function(staff){seen=staff.presentations.find(function(el){return el.id===presentation.id}),retval[staff.id]=seen&&seen.seen}),retval},getStaffStats:function(drugstoreId,staffId){var scope=this,retval=0,drugstoreProgress=scope.getDrugstoreProgress(drugstoreId);return drugstoreProgress&&drugstoreProgress.hasOwnProperty("staff")&&(retval=drugstoreProgress.staff.find(function(item){return item.id==staffId})),retval},getStaffPoints:function(drugstoreId,staffId){var stats,scope=this,retval=0;return stats=scope.getStaffStats(drugstoreId,staffId),stats&&(retval=stats.points||0),retval},getStaffGifts:function(staff){var gift,stats,scope=this,retval={};return staff.forEach(function(st){stats=scope.getStaffStats(scope.drugstore_id,st.id),stats&&stats.gifts&&stats.gifts.forEach(function(giftStats){gift=GiftsManager.find(giftStats.gift_id),gift.amountDropped=giftStats.quantity,gift.quantity-=gift.amountDropped,retval.hasOwnProperty(st.id)||(retval[st.id]=[]),retval[st.id].push(gift),scope.addGiftToGive(gift)})}),retval},getStaffIssuedGifts:function(staff){var gift,stats,scope=this,retval={};return staff.forEach(function(st){stats=scope.getStaffStats(scope.drugstore_id,st.id),stats&&stats.issued_gifts&&stats.issued_gifts.forEach(function(giftStats){gift=GiftsManager.find(giftStats.id),gift.amountIssued=giftStats.amountIssued,gift.quantity-=gift.amountIssued,retval.hasOwnProperty(st.id)||(retval[st.id]=[]),retval[st.id].push(gift)})}),retval},getStaffSpentPoints:function(drugstoreId,staffId){var stats,scope=this,retval=0;return stats=scope.getStaffStats(drugstoreId,staffId),stats&&(retval=stats.spent_points||0),retval},getStaffGainedPoints:function(drugstoreId,staffId){var stats,scope=this,retval=0;return stats=scope.getStaffStats(drugstoreId,staffId),stats&&(retval=stats.gained_points||0),retval},setStaffSpentPoints:function(points,drugstoreId,staffId){var stats,scope=this;stats=scope.getStaffStats(drugstoreId,staffId),stats&&(stats.spent_points=points)},setStaffDroppedGifts:function(){function setStaffGifts(staffId){scope.dropped.hasOwnProperty(staffId)&&(stats=scope.getStaffStats(scope.drugstore_id,staffId),stats&&(stats.gifts=[],scope.dropped[staffId].forEach(function(gift){stats.gifts.push({gift_id:gift.id,quantity:gift.amountDropped})})))}var stats,scope=this;for(var staffId in scope.dropped)setStaffGifts(staffId)},addGiftToGive:function(gift){var giftToGive,scope=this;giftToGive=scope.giftsToGive.find(function(gtg){return gtg.id==gift.id}),giftToGive?giftToGive.amountDropped++:scope.giftsToGive.push({id:gift.id,amountDropped:gift.amountDropped,color:gift.color})},removeGiftToGive:function(gift){var giftToGive,scope=this;if(giftToGive=scope.giftsToGive.find(function(gtg){return gtg.id==gift.id}))if(giftToGive.amountDropped>1)giftToGive.amountDropped--;else for(var i=0;i<scope.giftsToGive.length;i++)if(scope.giftsToGive[i].id==gift.id){scope.giftsToGive.splice(i,1);break}},resetGiftsToGive:function(){var scope=this;scope.giftsToGive=[]},giftsGive:function(staff){var stats,issuedGift,scope=this;scope.stats.hasOwnProperty("issued_gifts")||(scope.stats.issued_gifts=[]),scope.giftsToGive.forEach(function(giftToGive){issuedGift=scope.stats.issued_gifts.find(function(gtg){return gtg.id==giftToGive.id}),issuedGift?issuedGift.amountIssued+=giftToGive.amountDropped:scope.stats.issued_gifts.push({id:giftToGive.id,amountIssued:giftToGive.amountDropped,color:giftToGive.color})}),staff.forEach(function(member){scope.dropped.hasOwnProperty(member.id)&&(stats=scope.getStaffStats(scope.drugstore_id,member.id),stats&&(stats.hasOwnProperty("issued_gifts")||(stats.issued_gifts=[]),scope.dropped[member.id].forEach(function(gift){issuedGift=stats.issued_gifts.find(function(ig){return gift.id==ig.id}),issuedGift?issuedGift.amountIssued+=gift.amountDropped:stats.issued_gifts.push({id:gift.id,amountIssued:gift.amountDropped,color:gift.color}),scope.issued.hasOwnProperty(member.id)||(scope.issued[member.id]=[]),issuedGift=scope.issued[member.id].find(function(ig){return gift.id==ig.id}),issuedGift?issuedGift.amountIssued+=gift.amountDropped:scope.issued[member.id].push({id:gift.id,amountIssued:gift.amountDropped,color:gift.color})}),stats.gifts=[],stats.points-=stats.spent_points,stats.spent_points=0),scope.dropped[member.id]=[])}),scope.resetGiftsToGive()},getIssuedGifts:function(){var scope=this,retval=[];return scope.stats.hasOwnProperty("issued_gifts")&&(retval=scope.stats.issued_gifts),retval},getPoints:function(drugstore){var scope=this,retval={},drugstoreProgress=scope.getDrugstoreProgress(drugstore.id);return drugstoreProgress&&drugstoreProgress.hasOwnProperty("staff")&&drugstoreProgress.staff.forEach(function(staff){retval[staff.id]=staff.points||0}),retval},getSpentPoints:function(drugstore){var scope=this,retval={},drugstoreProgress=scope.getDrugstoreProgress(drugstore.id);return drugstoreProgress&&drugstoreProgress.hasOwnProperty("staff")&&drugstoreProgress.staff.forEach(function(staff){retval[staff.id]=staff.spent_points||0}),retval},recalculateCurrentPoints:function(){var scope=this,retval=0;return scope.stats.drugstores.forEach(function(drugstore){drugstore.staff.forEach(function(staff){retval+=staff.points})}),retval},getProgressPercents:function(){var scope=this;return Math.round(scope.current_points/scope.total_points*100)},getCurrentCycleProgressPercents:function(){var scope=this;return Math.round(scope.getCurrentCyclePoints()/scope.getCurrentCycleTotalPoints()*100)},getCycleProgress:function(drugstore,cycle){var dsProgress,currentPoints,totalPoints;return dsProgress=cycle.drugstores.find(function(ds){return ds.drugstore_id==drugstore.id}),dsProgress?(currentPoints=dsProgress.current_points,totalPoints=dsProgress.total_points):currentPoints=totalPoints="0",currentPoints+"/"+totalPoints},getCycleColor:function(drugstore,cycle){var dsProgress;return dsProgress=cycle.drugstores.find(function(ds){return ds.drugstore_id==drugstore.id}),!dsProgress||0===parseInt(dsProgress.current_points)&&0===parseInt(dsProgress.total_points)?"gray":dsProgress.current_points==dsProgress.total_points?"green":0===parseInt(dsProgress.current_points)?"red":"yellow"},getTotalPoints:function(defer){var scope=this;return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("detailing-progress",scope.campaign_id+"/total-points").then(function(res){defer.resolve(res.resource.total_points)},function(err){defer.reject(err)}),defer.promise},store:function(){var scope=this,defer=$q.defer();scope.getTotalPoints(defer).then(function(totalPoints){scope.setStaffDroppedGifts(),scope.total_points=totalPoints,scope.stats=JSON.stringify(scope.stats),dataservice.tenant.store("detailing-progress",scope).then(function(res){scope.id=res.last_insert_id,angular.isString(scope.stats)&&decrunchProgressStats(scope)})})},update:function(){var scope=this,defer=$q.defer();scope.getTotalPoints(defer).then(function(totalPoints){scope.setStaffDroppedGifts(),scope.total_points=totalPoints,scope.stats=JSON.stringify(scope.stats),dataservice.tenant.update("detailing-progress",scope.id,scope).then(function(res){angular.isString(scope.stats)&&decrunchProgressStats(scope)})})},getCurrentCyclePoints:function(){var scope=this,cycle=scope.getCurrentCycle();return cycle?cycle.current_points:0},getCurrentCycleTotalPoints:function(){var scope=this,cycle=scope.getCurrentCycle();return cycle?cycle.total_points:0},exportDataToExcel:function(data){var scope=this,defer=$q.defer();return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.post("detailing-progress",data,scope.campaign_id+"/export-to-excel").then(function(res){defer.resolve(res.filename)},function(err){defer.reject(err)}),defer.promise}},Progress}angular.module("app.detailing").factory("ProgressModel",ProgressModel),ProgressModel.$inject=["$q","dataservice","GiftsManager"]}(),function(undefined){"use strict";function DrugstoreModel($q,dataservice){function Drugstore(data){data&&this.setData(data)}return Drugstore.prototype={setData:function(data){angular.extend(this,data)},getStaff:function(){return this.drugstores_staff||[]},store:function(data){},show:function(id){},edit:function(id){},update:function(id,data){}},Drugstore}angular.module("app.detailing").factory("DrugstoreModel",DrugstoreModel),DrugstoreModel.$inject=["$q","dataservice"]}(),function(undefined){"use strict";function GiftModel(){function Gift(data){data&&this.setData(data)}return Gift.prototype={setData:function(data){angular.extend(this,data)},onDragStart:function(data,evt){angular.element(evt.target).text(data.name).attr("starting-drag","true")},onDragEnd:function(data,evt){angular.element(evt.target).text("")}},Gift}angular.module("app.detailing").factory("GiftModel",GiftModel)}(),function(undefined){"use strict";function PresentationModel($q,dataservice){function Presentation(data){data&&this.setData(data)}return Presentation.prototype={setData:function(data){angular.extend(this,data)},create:function(){},store:function(data){},show:function(id){},edit:function(id){},update:function(id,data){}},Presentation}angular.module("app.detailing").factory("PresentationModel",PresentationModel),PresentationModel.$inject=["$q","dataservice"]}(),function(undefined){"use strict";function CampaignProposalContractModel($q,dataservice,logger){function CampaignProposalContract(data){data&&this.setData(data)}return CampaignProposalContract.prototype={documentType:"campaign_proposal_contract",setData:function(data){angular.extend(this,data)},update:function(queue,data){var defer=$q.defer(),scope=this;return scope.setData(data),queue.enqueue({action:"updateDocument",arguments:[scope.documentType,scope.id],data:data}),defer.resolve({}),defer.promise},download:function(){var defer=$q.defer();return dataservice.tenant.customOauth.get("campaigns-proposal-contracts","download-contract/"+this.id).then(function(res){defer.resolve(res)}),defer.promise},getContractLink:function(){var scope=this;scope.filename||scope.download().then(function(res){scope.setData({filename:res.filename,path:"/assets/documents/campaigns-proposal-contracts/print/"+res.filename})})},isContractExpired:function(){var scope=this,now=Date.now()/1e3,created_at=new Date(scope.created_at)/1e3;return now-604800>created_at},retrieveContract:function(){var defer=$q.defer();return dataservice.tenant.customOauth.post("campaigns-proposal-contracts",{},"retrieve-contract/"+this.id).then(function(res){defer.resolve(res)}),defer.promise}},CampaignProposalContract}angular.module("app.core").factory("CampaignProposalContractModel",CampaignProposalContractModel),CampaignProposalContractModel.$inject=["$q","dataservice","logger"]}(),function(undefined){"use strict";function FinalReportInvoiceModel($q,dataservice,logger){function FinalReportInvoice(data){data&&this.setData(data)}return FinalReportInvoice.prototype={documentType:"final_report",setData:function(data){angular.extend(this,data)},update:function(queue,data){var defer=$q.defer(),scope=this;return scope.setData(data),queue.enqueue({action:"updateDocument",arguments:[scope.documentType,scope.id],data:data}),defer.resolve({}),defer.promise},download:function(){var defer=$q.defer();return dataservice.tenant.customOauth.get("final-report-invoices","download-invoice/"+this.id).then(function(res){defer.resolve(res)}),defer.promise},getInvoiceLink:function(){var scope=this;scope.filename||scope.download().then(function(res){scope.setData({filename:res.filename,path:"/assets/documents/final-report-invoices/print/"+res.filename})})},isInvoiceExpired:function(){var scope=this,now=Date.now()/1e3,created_at=new Date(scope.created_at)/1e3;return now-604800>created_at},retrieveInvoice:function(){var defer=$q.defer();return dataservice.tenant.customOauth.post("final-report-invoices",{},"retrieve-invoice/"+this.id).then(function(res){defer.resolve(res)}),defer.promise}},FinalReportInvoice}angular.module("app.core").factory("FinalReportInvoiceModel",FinalReportInvoiceModel),FinalReportInvoiceModel.$inject=["$q","dataservice","logger"]}(),function(undefined){"use strict";function MessageModel($q,dataservice){function Message(data){data&&this.setData(data)}function _store(data){return dataservice.tenant.customOauth.post("messages",data,"send")}function _enqueue(queue,data){var defer=$q.defer();return queue.enqueue({action:"sendMessage",arguments:[],data:data}),defer.resolve({}),defer.promise}function _enqueueUpdate(scope,queue,id,data){var defer=$q.defer();return scope.setData(data),queue.enqueue({action:"updateMessage",arguments:[id],data:data}),defer.resolve({}),defer.promise}function _storeHelpdesk(data){return dataservice.custom.post("tenant/"+data.tenant+"/messages",data,"send-helpdesk-message")}return Message.prototype={setData:function(data){angular.merge(this,data)},send:function(){var scope=this;return _store(scope)},enqueue:function(queue){var scope=this;return _enqueue(queue,scope)},enqueueUpdate:function(queue,data){var scope=this;return _enqueueUpdate(scope,queue,scope.id,data)},sendHelpdesk:function(){var scope=this;return _storeHelpdesk(scope)},read:function(){},unread:function(){},"delete":function(){},restore:function(){},checkConditions:function(conditions){var scope=this,retval=!0;return conditions.forEach(function(condition){retval=retval&&scope[condition.field]===condition.value}),retval}},Message}angular.module("app.core").factory("MessageModel",MessageModel),MessageModel.$inject=["$q","dataservice"]}(),function(undefined){"use strict";function TodoModel($q,dataservice){function Todo(data){data&&this.setData(data)}function _store(data){}return Todo.prototype={setData:function(data){angular.extend(this,data)},store:function(){var scope=this;return _store(scope)}},Todo}angular.module("app.core").factory("TodoModel",TodoModel),TodoModel.$inject=["$q","dataservice"]}(),function(){"use strict";function BudgetsController($rootScope){function activate(){vm.subtitle=$rootScope.subtitle,$rootScope.assignModuleTranslations("__modules/budgeting")}var vm=this;$rootScope.breadcrumbTitle="Budgets",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="",vm.title="Budgets",activate()}angular.module("app.budgets").controller("BudgetsController",BudgetsController),BudgetsController.$inject=["$rootScope"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"budgets",config:{parent:"root",templateUrl:"app/__modules/budgeting/budgets/budgets.html",controller:"BudgetsController",controllerAs:"vm",settings:{header:"Budgeting"}}},{state:"budgets.main",config:{url:"^/budgets/main",templateUrl:"app/__modules/budgeting/budgets/main/budgets.main.html",controller:"BudgetsMainController",controllerAs:"vm",title:"Budgeting",data:{roles:[]},settings:{subheader:"Budgeting"}}},{state:"budgets.main-tab",config:{url:"/budgets/main/tab/:tab/page/:page",templateUrl:"app/__modules/budgeting/budgets/main/budgets.main.html",controller:"BudgetsMainController",controllerAs:"vm",title:"Budgeting",data:{roles:[]},settings:{subheader:"Budgeting"}}},{state:"budgets.edit",config:{url:"^/budgets/{id:[0-9]{1,8}}",templateUrl:"app/__modules/budgeting/budgets/edit/budgets.edit.html",controller:"BudgetsEditController",controllerAs:"vm",title:"Budget Edit Form",data:{roles:[]},settings:{subheader:"Budget Edit"}}}]}angular.module("app.budgets").run(appRun),appRun.$inject=["routerHelper"]}(),function(undefined){"use strict";function BudgetsEditController($rootScope,$scope,$state,principal,BudgetsManager){function activate(){$rootScope.breadcrumbTitle="Budżet",$rootScope.breadcrumbParentTitle="Budżety",$rootScope.breadcrumbParentState="budgets.main",vm.parent=$scope.$parent.vm,vm.id=$state.params.hasOwnProperty("id")?parseInt($state.params.id):undefined,vm.tabName=$state.params.hasOwnProperty("tab")?$state.params.tab:"budget_representants_list",principal.identity(!1,"mobile").then(function(identity){vm.principal=identity,BudgetsManager.reset(vm.id).get(identity.id,vm.id).then(function(instance){vm.budget=instance,vm.rksBudget=vm.budget.rks_budget,vm.isCommonBudgetModeAlreadyOn=vm.rksBudget.common_budget_mode,vm.recalculateBudgetTotal(),vm.selectTab(vm.tabName)})})}var vm=this;vm.templatesPath="app/__modules/budgeting/budgets/edit/partials-templates/",vm.tabs=[{name:"budget_representants_list",id:"budget-representants-list",title:"BUDGET_REPRESENTANTS_LIST",filename:"budget.representants-list.html"}],vm.selectTab=function(tabName){vm.tab=vm.tabs.find(function(tab){return tab.name==tabName})},vm.getTemplateSrc=function(){return vm.tab?vm.templatesPath+vm.tab.filename:undefined},vm.recalculateBudgetTotal=function(){var isActualGreaterThanBudget=!1;vm.budgetTotal=0,vm.actualTotal=0,vm.budget.representants.length>0&&vm.budget.representants.forEach(function(rep){rep.budget&&(vm.budgetTotal+=rep.budget,vm.actualTotal+=rep.actual,rep.actual>rep.budget&&(isActualGreaterThanBudget=!0))}),vm.isOverbudget=vm.budgetTotal>vm.rksBudget.budget,vm.isActualGreaterThanBudget=isActualGreaterThanBudget},activate()}angular.module("app.budgets").controller("BudgetsEditController",BudgetsEditController),BudgetsEditController.$inject=["$rootScope","$scope","$state","principal","BudgetsManager"]}(),function(undefined){"use strict";function BudgetRepresentantsListPartialController($scope,$state,notifier,TEXT_MESSAGE){function activate(){vm.parent=$scope.$parent.vm,vm.isOverbudget=!1}var vm=this;vm.onFormSubmit=function(){var data={common_budget_mode:vm.parent.rksBudget.common_budget_mode,budgets:[]};vm.parent.budget.representants.length>0&&(vm.parent.budget.representants.forEach(function(rep){rep.budget?data.budgets.push({rep_id:rep.id,budget:rep.budget}):data.budgets.push({rep_id:rep.id,budget:0})}),vm.lockForm=!0,vm.parent.budget.store(data,vm.parent.principal.id).then(function(res){vm.parent.isCommonBudgetModeAlreadyOn=vm.parent.rksBudget.common_budget_mode,notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),vm.lockForm=!1},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)}))},vm.backToList=function(){$state.go("budgets.main")},vm.getRepProgress=function(pm){var progress;return pm.actual>0&&pm.budget>0?(progress=vm.parent.isCommonBudgetModeAlreadyOn?pm.actual/vm.parent.rksBudget.budget*100:pm.actual/pm.budget*100,parseFloat(progress.toFixed(2))):(progress=0,progress.toFixed(2))},vm.getBudgetProgress=function(){var progress;return vm.parent.actualTotal>0&&vm.parent.rksBudget.budget>0?(progress=vm.parent.actualTotal/vm.parent.rksBudget.budget*100,parseFloat(progress.toFixed(2))):(progress=0,progress.toFixed(2))},vm.onCommonBudgetModeChange=function(){vm.parent.rksBudget.common_budget_mode&&(vm.parent.rksBudget.common_budget_mode=!1,angular.element("#confirm_enabling_common_budget_mode").modal("show"))},vm.commonBudgetModeEnable=function(){vm.parent.rksBudget.common_budget_mode=!0,vm.onFormSubmit()},activate()}angular.module("app.budgets").controller("BudgetRepresentantsListPartialController",BudgetRepresentantsListPartialController),BudgetRepresentantsListPartialController.$inject=["$scope","$state","notifier","TEXT_MESSAGE"]}(),function(undefined){"use strict";function BudgetsMainController($rootScope,$state,$scope,principal){function activate(){$rootScope.breadcrumbTitle="Budżet",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="",vm.parent=$scope.$parent.vm,vm.parent.subtitle="Main",vm.tabName=$state.params.hasOwnProperty("tab")?$state.params.tab:"budgets_list",vm.page=$state.params.hasOwnProperty("page")?parseInt($state.params.page):1,principal.identity(!1,"mobile").then(function(identity){vm.principal=identity,vm.selectTab(vm.tabName),vm.attachWatchers()})}var vm=this;vm.tabName="budgets_list",vm.page=1,vm.templatesPath="app/__modules/budgeting/budgets/main/partials-templates/",vm.tabs=[{name:"budgets_list",id:"budgets-list",title:"BUDGETS_LIST",filename:"budgets.list.html"}],vm.selectTab=function(tabName){vm.tab=vm.tabs.find(function(tab){return tab.name==tabName})},vm.getTemplateSrc=function(){return vm.tab?vm.templatesPath+vm.tab.filename:undefined},vm.attachWatchers=function(){$scope.$watch("vm.tab",function(val,old){val!==old&&(vm.page=1,vm.tab=val,$state.go("budgets.main-tab",{tab:val.name,page:vm.page},{notify:!1}))}),$scope.$watch("vm.page",function(val,old){val!==old&&(vm.page=val,$state.go("budgets.main-tab",{tab:vm.tab.name,page:val},{notify:!1}))})},activate()}angular.module("app.budgets").controller("BudgetsMainController",BudgetsMainController),BudgetsMainController.$inject=["$rootScope","$state","$scope","principal"]}(),function(undefined){"use strict";function BudgetsListPartialController($scope,$sessionStorage,BudgetsManager){function activate(){vm.parent=$scope.$parent.vm,vm.paginationOptions.pageNumber=vm.parent.page,vm.getPage()}var vm=this;vm.paginationOptions={pageNumber:1,pageSize:25,sort:[],filters:[]},vm.getPage=function(){var query,page=vm.paginationOptions.pageNumber;$sessionStorage.drugstoresListPage=page,query={page_size:vm.paginationOptions.pageSize,page_number:page},vm.paginationOptions.sort.length>0&&(query["sort[]"]=vm.paginationOptions.sort),vm.paginationOptions.filters.length>0&&(query["filters[]"]=vm.paginationOptions.filters),BudgetsManager.list(query,vm.parent.principal.id).then(function(res){vm.budgets=res.resources,vm.budgets.forEach(function(budget){budget.date_start=calcTime(budget.date_start,!0),budget.date_end=calcTime(budget.date_end,!0)}),vm.totalItems=res.total_items})},vm.getBudgetTotal=function(budget){var rksBudget=budget.budgets_rks.find(function(bg){return bg.rks_id==vm.parent.principal.id}),budgetTotal=parseFloat(rksBudget.budget);return parseFloat(budgetTotal.toFixed(2))},vm.getBudgetFulfillment=function(budget){var rksBudget=budget.budgets_rks.find(function(bg){return bg.rks_id==vm.parent.principal.id}),fulfillment=rksBudget?rksBudget.actual/rksBudget.budget*100:0;return parseFloat(fulfillment.toFixed(2))},activate()}angular.module("app.budgets").controller("BudgetsListPartialController",BudgetsListPartialController),BudgetsListPartialController.$inject=["$scope","$sessionStorage","BudgetsManager"]}(),function(){"use strict";function restangularConfig(RestangularProvider,$sessionStorage,SERVER_URI){RestangularProvider.setBaseUrl(SERVER_URI+"api/v1"),RestangularProvider.setDefaultHttpFields({cache:!0,origin:!0,withCredentials:!0}),RestangularProvider.addResponseInterceptor(function(data,operation,what,url,response,deferred){var extractedData;switch(operation){case"post":if(data.hasOwnProperty("access_token")){extractedData=data;break}if(!data.hasOwnProperty("data"))break;case"get":if(data.data&&data.data.hasOwnProperty("redirect")){extractedData=data.data.redirect.match(/[^=]*$/)[0];break}if(!data.hasOwnProperty("data"))break;case"getList":extractedData=data.data,extractedData.meta=data.meta;break;default:extractedData=data.data,data.hasOwnProperty("meta")&&(extractedData.meta=data.meta)}return extractedData}),RestangularProvider.setErrorInterceptor(function(response){return 403!==response.status||"Old version."!=response.data||(!(!location.hash||"#/login"!=location.hash||location.search)||(window.location="#/login?show=old_version_warning",!1))})}function configure($logProvider,routerHelperProvider,exceptionHandlerProvider){$logProvider.debugEnabled&&$logProvider.debugEnabled(!0),exceptionHandlerProvider.configure(config.appErrorPrefix),routerHelperProvider.configure({docTitle:config.appTitle+": "})}""!==location.hash&&"#"!=location.hash&&"#/"!=location.hash||"undefined"!=typeof vm||(window.location="#/login");var core=angular.module("app.core");core.config(restangularConfig),restangularConfig.$inject=["RestangularProvider","$sessionStorageProvider","SERVER_URI"];var config={appErrorPrefix:"[3angle Error] ",appTitle:"3angle"};core.value("config",config),core.config(configure),configure.$inject=["$logProvider","routerHelperProvider","exceptionHandlerProvider"]}(),function($){"use strict";function AuthController($state,$rootScope,dataservice,logger){function activate(){$("html").attr("id","extr-page"),$rootScope.assignModuleTranslations("auth")}var vm=this;vm.title="Authorization",vm.isLogin=function(){return"auth.login"==$state.current.name},vm.isRegister=function(){return"auth.register"==$state.current.name},activate()}angular.module("app.auth").controller("AuthController",AuthController),AuthController.$inject=["$state","$rootScope","dataservice","logger"];
}(jQuery),function(undefined){"use strict";function AuthLoginController(dataservice,$sessionStorage,authorization,$rootScope,$localStorage,notifier,clientName,MessagesManager,$location){function activate(){var showError=$location.search().show;showError?(vm.loginError=!0,vm.loginErrMsg="OLD_VERSION_ERROR",vm.lockForm=!1,location.hash="#/login"):(vm.lockForm=!1,$rootScope.$on("authError",function(){authorization.logout(),onAuthorizationFail()}))}function authorize(data){$sessionStorage.currentTenant=JSON.stringify({id:data.resource.id,name:data.resource.name,title:data.resource.title}),dataservice.tenant.custom.post("oauth2",{email:vm.email,password:vm.password,remember:vm.remember,client_name:clientName},"login").then(authorization.tenantAuthorize,onAuthorizationFail)}function onAuthorizationFail(error){403===error.status&&"Old version."==error.data?(notifier.error("Error!","Server error: Old version of application - login denied"),vm.loginError=!0,vm.loginErrMsg="OLD_VERSION_ERROR",vm.lockForm=!1):(notifier.error("Error!","Server error: Authorization Error"),vm.loginError=!0,vm.loginErrMsg="AUTHORIZATION_ERROR",vm.lockForm=!1)}var vm=this;vm.title="Authorization",vm.email=$localStorage.hasOwnProperty("lastLogin")?$localStorage.lastLogin:"",vm.password="",vm.remember=!0,vm.helpdeskMessage=undefined,vm.helpdeskFormSubmitted=!1,vm.sendError=!1,vm.login=function(){vm.lockForm=!0,dataservice.custom.get("oauth2","get-tenant",{email:encodeURIComponent(vm.email)}).then(authorize,onAuthorizationFail)},vm.tapped=function(event){console.log(event)},vm.showHelpdeskModal=function(){vm.helpdeskMessage=undefined,vm.helpdeskFormSubmitted=!1,vm.sendError=!1,$("#helpdesk").modal("show")},vm.hideHelpdeskModal=function(){$("#helpdesk").modal("hide")},vm.sendHelpdeskMessage=function(valid){var message;vm.helpdeskFormSubmitted=!0,vm.errMsg="",message='<dl class="dl-horizontal"><dt>USERNAME</dt><dd>'+vm.helpdeskMessage.username+"</dd><dt>EMAIL</dt><dd>"+vm.helpdeskMessage.email+"</dd><dt>PHONE</dt><dd>"+vm.helpdeskMessage.phone+"</dd><dt>COMPANY</dt><dd>"+vm.helpdeskMessage.company+"</dd><dt>MESSAGE</dt><dd>"+vm.helpdeskMessage.message+"</dd></dl>",valid&&dataservice.custom.get("oauth2","get-tenant",{email:encodeURIComponent(vm.helpdeskMessage.email)}).then(function(res){MessagesManager.create({tenant:res.resource.name,email:vm.helpdeskMessage.email,message_category:"support",from:res.resource.id,to:0,sender_category:"representant",addressee_category:"representant",subject:"Helpdesk Call",message:message,is_sent:!0}).then(function(msg){msg.sendHelpdesk().then(function(res){$("#helpdesk").modal("hide"),notifier.success("Sukces","Wiadomość została pomyślnie wysłana")},function(err){vm.sendError=!0,vm.errMsg=err.data.message})})},function(err){vm.sendError=!0,vm.errMsg=err.data.message,console.log(err)})},vm.hideLoginError=function(){vm.loginError=!1},vm.hidePasswordResetModal=function(){$("#password-reset").modal("hide")},vm.showPasswordResetModal=function(){vm.passwordResetMessage=undefined,vm.passwordResetFormSubmitted=!1,vm.sentPassword=!1,vm.resetPasswordError=!1,vm.sendError=!1,$("#password-reset").modal("show")},vm.sendPasswordResetMessage=function(valid){dataservice.custom.get("oauth2","get-tenant",{email:encodeURIComponent(vm.passwordResetMessage.email)}).then(function(res){$sessionStorage.currentTenant=JSON.stringify({id:res.resource.id,name:res.resource.name,title:res.resource.title}),dataservice.tenant.custom.post("staff",{email:vm.passwordResetMessage.email},"reset-password").then(function(data){vm.sentPassword=!0,vm.passwordResetFormSubmitted=!0,vm.resetPasswordError=!1})},function(err){console.log(err),vm.resetPasswordError=!0,vm.sentPassword=!1,vm.resetPasswordErrMsg=err.data.message})},activate()}angular.module("app.auth").controller("AuthLoginController",AuthLoginController),AuthLoginController.$inject=["dataservice","$sessionStorage","authorization","$rootScope","$localStorage","notifier","CLIENT_NAME","MessagesManager","$location"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"auth",config:{templateUrl:"app/auth/auth.html",controller:"AuthController",controllerAs:"vm",data:{roles:[]},settings:{}}},{state:"auth.login",config:{url:"/login",templateUrl:"app/auth/auth.login.html",controller:"AuthLoginController",controllerAs:"vm",title:"Login Page",data:{roles:[]},settings:{}}},{state:"auth.register",config:{url:"/register",templateUrl:"app/auth/auth.register.html",controller:"AuthRegisterController",controllerAs:"vm",title:"Register Page",data:{roles:[]},settings:{}}},{state:"auth.forgotpassword",config:{url:"/forgotpassword",templateUrl:"app/auth/auth.forgotpassword.html",controller:"AuthForgotPasswordController",controllerAs:"vm",title:"Password Reset Page",data:{roles:[]},settings:{}}}]}angular.module("app.auth").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function exceptionHandlerProvider(){this.config={appErrorPrefix:void 0},this.configure=function(appErrorPrefix){this.config.appErrorPrefix=appErrorPrefix},this.$get=function(){return{config:this.config}}}function config($provide){$provide.decorator("$exceptionHandler",extendExceptionHandler)}function extendExceptionHandler($delegate,exceptionHandler,logger,APP_ENVIRONMENT){return function(exception,cause){var appErrorPrefix=exceptionHandler.config.appErrorPrefix||"",errorData={exception:exception,cause:cause};$delegate(appErrorPrefix+exception.message,cause),exception.hide_warning||logger.error(exception.message,errorData)}}angular.module("blocks.exception").provider("exceptionHandler",exceptionHandlerProvider).config(config),config.$inject=["$provide"],extendExceptionHandler.$inject=["$delegate","exceptionHandler","logger","APP_ENVIRONMENT"]}(),function(){"use strict";function exception(logger){function catcher(message){return function(reason){logger.error(message,reason)}}var service={catcher:catcher};return service}angular.module("blocks.exception").factory("exception",exception),exception.$inject=["logger"]}(),function(){"use strict";function routerHelperProvider($locationProvider,$stateProvider,$urlRouterProvider){function RouterHelper($location,$rootScope,$state,logger,authorization,principal){function configureStates(states,otherwisePath){states.forEach(function(state){state.config.resolve=angular.extend(state.config.resolve||{},config.resolveAlways),$stateProvider.state(state.state,state.config)}),otherwisePath&&!hasOtherwise&&(hasOtherwise=!0,$urlRouterProvider.otherwise(otherwisePath))}function getStates(){return $state.get()}function init(){handleAuthorization(),handleRoutingErrors(),updateDocTitle()}function handleAuthorization(){$rootScope.$on("$stateChangeStart",function(event,toState,toStateParams){if($rootScope.toState=toState,$rootScope.toStateParams=toStateParams,principal.isIdentityResolved())return authorization.checkAuthorization()})}function handleRoutingErrors(){$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){if(!handlingStateChangeError){stateCounts.errors++,handlingStateChangeError=!0;var destination=toState&&(toState.title||toState.name||toState.loadedTemplateUrl)||"unknown target",msg="Error routing to "+destination+". "+(error.data||"")+". <br/>"+(error.statusText||"")+": "+(error.status||"");logger.warning(msg,[toState]),$location.path("/")}})}function updateDocTitle(){$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){stateCounts.changes++,handlingStateChangeError=!1;var title=config.docTitle+" "+(toState.title||"");$rootScope.title=title})}var handlingStateChangeError=!1,hasOtherwise=!1,stateCounts={errors:0,changes:0},service={configureStates:configureStates,getStates:getStates,stateCounts:stateCounts};return init(),service}var config={docTitle:void 0,resolveAlways:{}};$locationProvider.html5Mode(!1),this.configure=function(cfg){angular.extend(config,cfg)},this.$get=RouterHelper,RouterHelper.$inject=["$location","$rootScope","$state","logger","authorization","principal"]}angular.module("blocks.router").provider("routerHelper",routerHelperProvider),routerHelperProvider.$inject=["$locationProvider","$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function CampaignsController($rootScope,dataservice,logger){function activate(){$rootScope.breadcrumbTitle="Kampanie",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="",vm.subtitle=$rootScope.subtitle,$rootScope.assignModuleTranslations("campaigns")}var vm=this;vm.title="Kampanie",activate()}angular.module("app.campaigns").controller("CampaignsController",CampaignsController),CampaignsController.$inject=["$rootScope","dataservice","logger"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"campaigns",config:{parent:"root",templateUrl:"app/campaigns/campaigns.html",controller:"CampaignsController",controllerAs:"vm",settings:{}}},{state:"campaigns.list",config:{url:"/campaigns",templateUrl:"app/campaigns/list/campaigns.list.html",controller:"CampaignsListController",controllerAs:"vm",title:"Kampanie",data:{roles:[]},settings:{}}},{state:"campaigns.main",config:{url:"/campaigns/view/{id:[0-9]{1,8}}",templateUrl:"app/campaigns/main/campaigns.main.html",controller:"CampaignsMainController",controllerAs:"vm",title:"Kampania",data:{roles:[]},settings:{}}},{state:"campaigns.main_rights",config:{url:"/campaigns/view/{id:[0-9]{1,8}}/{rights:[a-z]{1,10}}",templateUrl:"app/campaigns/main/campaigns.main.html",controller:"CampaignsMainController",controllerAs:"vm",title:"Kampanie",data:{roles:[]},settings:{}}},{state:"campaigns.filter",config:{url:"/campaigns/filter/{id:[0-9]{1,10}}",templateUrl:"app/campaigns/list/campaigns.filter.html",controller:"CampaignsFilterController",controllerAs:"vm",title:"Kampania",data:{roles:[]},settings:{}}},{state:"campaigns.steps",config:{"abstract":!0,url:"/campaigns/{campaignId:[0-9]{1,8}}/drugstores/{drugstoreId:[0-9]{1,8}}",templateUrl:"app/campaigns/pages/campaigns.pages.html",resolve:{getDataCampaignPages:["$q","$stateParams","campaignsDataservice",function($q,$stateParams,campaignsDataservice){return campaignsDataservice.getDataCampaignPages($stateParams.drugstoreId,$stateParams.campaignId).then(function(data){return data},function(err){return $q.reject(err)})}]},controller:"CampaignsPagesController",controllerAs:"vm",title:"Kampania",data:{roles:[]},settings:{}}},{state:"campaigns.steps.pages",config:{url:"/steps/{stepIndex:[0-9]{1,8}}/pages/{pageIndex:[0-9]{1,8}}",data:{roles:[]},settings:{}}}]}angular.module("app.campaigns").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function CampaignsFilterController($rootScope,$state,campaignsDataservice,$sessionStorage,stepsService,notifier,TEXT_MESSAGE){function activate(){var userId=null,currentPage=1;showDimmer(),vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,$sessionStorage.stepFilter=null,vm.campaignId=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,vm.isManager=$sessionStorage.isManager||!1,vm.userData&&(userId=vm.userData.id),vm.isManager&&(vm.selectedStaff=null,vm.listStaff={},vm.listDrugstores={},$sessionStorage.listStaff&&$sessionStorage.listDrugstores?(vm.listStaff=$sessionStorage.listStaff,vm.listDrugstores=$sessionStorage.listDrugstores):setStaffForDrugstores(userId)),getCampaigns(currentPage,userId).then(function(resources){var activeCampaign;if(vm.campaigns=resources.campaigns,vm.budget=resources.budget,vm.activeColor=[],vm.activeColor[vm.campaignId]="",activeCampaign=vm.campaigns.find(function(el){return el.id==vm.campaignId}),vm.campaigns.sort(sortBy("id",!1)),vm.indexCampaign=vm.campaigns.findIndex(function(campaign){return campaign.icon=stepsService.getCampaignIcon(campaign.definition),campaign.id==vm.campaignId}),activeCampaign){vm.activeCampaign=activeCampaign,vm.activeCampaign.date_start=calcTime(activeCampaign.date_start,!0),vm.activeCampaign.date_end=calcTime(activeCampaign.date_end,!0),vm.activeColor[vm.campaignId]="orange",vm.activeCampaign.steps=stepsService.getSteps(vm.activeCampaign.definition),vm.activeCampaign.steps.forEach(function(step){step.date_start=new Date(step.date_start),step.date_end=new Date(step.date_end)}),$sessionStorage.progressCampaigns&&$sessionStorage.progressCampaigns[vm.campaignId]&&(vm.progressCampaign=$sessionStorage.progressCampaigns[vm.campaignId]);var count_progress=parseInt(vm.activeCampaign.count_progress)||0;vm.activeCampaign.count_progress1=parseInt(vm.activeCampaign.count_all)-count_progress,vm.activeCampaign.count_progress2=count_progress}hideDimmer(),$rootScope.$emit("receivedMainRequest",!0)},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function setStaffForDrugstores(userId){campaignsDataservice.getStaffJobsByDrugstores(userId).then(function(staffDrugstores){staffDrugstores.staff&&(vm.listStaff=staffDrugstores.staff,$sessionStorage.listStaff=vm.listStaff),staffDrugstores.drugstores&&(vm.listDrugstores=staffDrugstores.drugstores,$sessionStorage.listDrugstores=vm.listDrugstores)})}function getCopyCampaign(){return angular.copy(vm.activeCampaign)}function getCampaigns(currentPage,userDataId){return vm.isManager?campaignsDataservice.getCampaignsWithDrugstoresQuicklyFilteredByStaffAndPromoline(currentPage,userDataId):campaignsDataservice.getCampaignsQuicklyFilteredByStaffAndPromoline(currentPage,userDataId)}var vm=this;vm.filterByCampaign=function(campaignId){vm.activeColor[campaignId]?$state.go("campaigns.list"):$state.go("campaigns.filter",{id:campaignId})},vm.selectCampaign=function(campaignId){$state.go("campaigns.main",{id:campaignId})},vm.selectCampaignStep=function(campaignId,stepIndex){$sessionStorage.stepFilter=stepIndex,$state.go("campaigns.main",{id:campaignId})},vm.changeStaff=function(){var campaign=null,drugstores=[];vm.activeCampaignCopy||(vm.activeCampaignCopy=getCopyCampaign()),vm.selectedStaff?vm.activeCampaignCopy&&vm.activeCampaignCopy.drugstores&&(drugstores=vm.activeCampaignCopy.drugstores.filter(function(drugstore){return vm.listStaff[vm.selectedStaff].drugstoresIds.indexOf(drugstore.id)>-1}),drugstores.length&&(campaign=vm.activeCampaignCopy)):campaign=vm.activeCampaignCopy,vm.activeCampaign=campaign},vm.hideCounters=function(campaign){return campaignsDataservice.isCampaignWithoutCounters(campaign)},activate()}angular.module("app.campaigns").controller("CampaignsFilterController",CampaignsFilterController),CampaignsFilterController.$inject=["$rootScope","$state","campaignsDataservice","$sessionStorage","stepsService","notifier","TEXT_MESSAGE"]}(),function(){"use strict";function CampaignsListController($rootScope,$state,campaignsDataservice,principal,$sessionStorage,stepsService,notifier,TEXT_MESSAGE){function activate(){$rootScope.breadcrumbTitle="Kampanie",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="";var campaigns_ids=[],userId=null;showDimmer(),vm.isManager=$sessionStorage.isManager||!1,vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,$sessionStorage.stepFilter=null,$sessionStorage.progressCampaigns=null,vm.userData&&(userId=vm.userData.id),vm.currentPage=$state.params.hasOwnProperty("page")?parseInt($state.params.page):1,vm.selectedStaff=null,vm.campaigns=[],getCampaigns(vm.currentPage,userId).then(function(resources){var countDrugstores,countDrugstoresByCampaign={},campaignsDominant={};hideDimmer(),vm.campaigns=resources.campaigns,vm.budget=resources.budget,vm.campaigns.forEach(function(campaign){countDrugstores=0,campaign.date_start=calcTime(campaign.date_start,!0),campaign.date_end=calcTime(campaign.date_end,!0),campaign.count_drugs=Number(campaign.count_drugs),campaign.count_drugs&&campaigns_ids.push(campaign.id),campaign.steps=stepsService.getSteps(campaign.definition),campaign.icon=stepsService.getCampaignIcon(),campaign.steps.forEach(function(step){step.date_start=new Date(step.date_start),step.date_end=new Date(step.date_end)}),campaign.count_drugstores&&(countDrugstores=Number(campaign.count_drugstores)),campaign.staff_ids&&"string"==typeof campaign.staff_ids&&(campaign.staff_ids=campaign.staff_ids.split(/[\s,]+/).map(Number)),countDrugstoresByCampaign[campaign.id]=countDrugstores,campaignsDominant[campaign.id]=campaign.dominant;var count_progress=parseInt(campaign.count_progress)||0;campaign.count_progress1=parseInt(campaign.count_all)-count_progress,campaign.count_progress2=count_progress}),vm.campaignsCopy=getCopyCampaigns(),campaigns_ids.length&&campaignsDataservice.getCampaignsSelling(campaigns_ids,userId,countDrugstoresByCampaign,campaignsDominant).then(function(dataSelling){vm.progressCampaigns=dataSelling,$sessionStorage.progressCampaigns=vm.progressCampaigns}),vm.isManager?(vm.listStaff={},vm.listDrugstores={},$sessionStorage.listStaff&&$sessionStorage.listDrugstores?(vm.listStaff=$sessionStorage.listStaff,vm.listDrugstores=$sessionStorage.listDrugstores,$rootScope.$emit("receivedMainRequest",!0)):setStaffForDrugstores(userId)):$rootScope.$emit("receivedMainRequest",!0)},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function setStaffForDrugstores(userId){campaignsDataservice.getStaffJobsByDrugstores(userId).then(function(staffDrugstores){staffDrugstores.staff&&(vm.listStaff=staffDrugstores.staff,$sessionStorage.listStaff=vm.listStaff),staffDrugstores.drugstores&&(vm.listDrugstores=staffDrugstores.drugstores,$sessionStorage.listDrugstores=vm.listDrugstores),$rootScope.$emit("receivedMainRequest",!0)})}function getCopyCampaigns(){return cloneObj(vm.campaigns)}function getCampaigns(currentPage,userDataId){return vm.isManager?campaignsDataservice.getCampaignsWithDrugstoresQuicklyFilteredByStaffAndPromoline(currentPage,userDataId):campaignsDataservice.getCampaignsQuicklyFilteredByStaffAndPromoline(currentPage,userDataId)}var vm=this;vm.filterByCampaign=function(campaignId){$state.go("campaigns.filter",{id:campaignId})},vm.selectCampaign=function(campaignId){$state.go("campaigns.main",{id:campaignId})},vm.selectCampaignStep=function(campaignId,stepIndex){$sessionStorage.stepFilter=stepIndex,$state.go("campaigns.main",{id:campaignId})},vm.changeStaff=function(){var campaigns=[],selectedStaff=Number(vm.selectedStaff);vm.campaignsCopy||(vm.campaignsCopy=getCopyCampaigns()),campaigns=selectedStaff?vm.campaignsCopy.filter(function(campaign){return campaign.staff_ids.indexOf(selectedStaff)>-1}):vm.campaignsCopy,vm.campaigns=campaigns},vm.hideCounters=function(campaign){return campaignsDataservice.isCampaignWithoutCounters(campaign)},activate()}angular.module("app.campaigns").controller("CampaignsListController",CampaignsListController),CampaignsListController.$inject=["$rootScope","$state","campaignsDataservice","principal","$sessionStorage","stepsService","notifier","TEXT_MESSAGE"]}(),function(undefined){"use strict";function CampaignsMainController($rootScope,$state,campaignsDataservice,clientsDataservice,stepsService,$sessionStorage,principal,$filter,notifier,TEXT_MESSAGE,PAGING){function activate(){var stepFilter=$sessionStorage.stepFilter?parseInt($sessionStorage.stepFilter)-1:-1,isPaging=PAGING.APPLY;vm.colorStepCounter=[],vm.stepColorInfo=[],vm.isOldCampaign=!1,showDimmer(),vm.pagingLimit=PAGING.ITEMS_ON_PAGE,vm.listSlider={width:0,height:0},vm.campaignId=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,vm.rightsName=$state.params.hasOwnProperty("rights")?$state.params.rights:"",vm.colorRights={visit:"my"==vm.rightsName?"marine":"",management:"observed"==vm.rightsName?"marine":"",colleague:"colleague"==vm.rightsName?"marine":""},$rootScope.subtitle="Campaign #"+vm.campaignId,vm.stepColors=["marine","green","yellow","red","lightgreen","greenwarning","grey"],vm.stepColorLabels={green:"STEP_START",lightgreen:"STEP_TURN",marine:"STEP_OK",yellow:"STEP_WAIT",red:"STEP_ATTENTION"},vm.selectedColor="",vm.selectedStep="",vm.sellInProgress=0,vm.sellOutProgress=0,vm.sellInEarns=0,vm.sellOutEarns=0,vm.percentDays=0,vm.drugstores=[],vm.sort={column:["drugstores_network.name","drugstores_network.id","-negotiation_point"],descending:!1,"class":"ascending"},vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.isManager=$sessionStorage.isManager||!1,vm.selectedStaff=null,vm.listStaff={},vm.listDrugstores={},campaignsDataservice.getOptimizedCampaignDataset(vm.campaignId,vm.userData.id).then(function(res){campaignsDataservice.getCampaignFiltered(vm.campaignId,vm.userData.id,!0).then(function(campaignResource){var drugstores_ids,campaign,campaigns_selling,drugstores_first_step,drugstores_last_step,dataSelling,campaign_budget,count_progress,dynamic_steps;hideDimmer(),campaign=campaignResource.resource,campaigns_selling=campaignResource.campaigns_selling,drugstores_first_step=campaignResource.drugstores_first_step,drugstores_last_step=campaignResource.drugstores_last_step,campaign_budget=campaignResource.budget,service_control_statuses=campaignResource.service_control_statuses,dynamic_steps=campaignResource.dynamic_steps,campaign.counters=campaignResource.campaign_counters,$rootScope.breadcrumbTitle=campaign.identifier,$rootScope.breadcrumbParentTitle="Kampanie",$rootScope.breadcrumbParentState="campaigns.list",count_progress=parseInt(campaign.counters.count_progress)||0,campaign.count_progress1=parseInt(campaign.counters.count_all)-count_progress,campaign.count_progress2=count_progress,angular.isArray(campaign.drugstores)||(campaign.drugstores=Object.keys(campaign.drugstores).map(function(key){return campaign.drugstores[key]})),vm.campaign=campaign,vm.campaign.steps=stepsService.getSteps(campaign.definition),vm.campaign.icon=stepsService.getCampaignIcon(),vm.campaign.visibility=stepsService.getVisibility(),vm.drugsGroups=stepsService.getDrugsGroups(),vm.not_paid_campaign=vm.campaign.not_paid_campaign,vm.campaignDaysBeforeEnd=0,stepFilter!==-1&&vm.campaign.steps[stepFilter]&&(vm.selectedColor="white",vm.selectedStep=vm.campaign.steps[stepFilter].identifier),setCampaignKnob(),stepsService.loadStepsStatuses(vm.campaignId,!0).then(function(){vm.campaign.netWorkDrugstores.groupBy(function(o){return o.drugstores_network_id}).forEach(function(el,index){var networkId=el.key,networkDrugstores=order(el.group,"negotiation_point");setDrugstoreSteps({networkId:networkId,networkDrugstores:networkDrugstores,drugstores_first_step:drugstores_first_step,drugstores_last_step:drugstores_last_step,campaigns_selling:campaigns_selling,service_control_statuses:service_control_statuses,dynamic_steps:dynamic_steps})}),vm.drugstores.length&&(vm.searchArrFields=["identifier","name","drugstores_network.name","addressLine1","cityName"],vm.pagingLimit=isPaging&&PAGING.ITEMS_ON_PAGE<vm.drugstores.length?PAGING.ITEMS_ON_PAGE:vm.drugstores.length,drugstores_ids=vm.drugstores.filter(function(el){return el.negotiation_point&&el.selling_point||!el.negotiation_point}).map(function(el){return el.id}),campaigns_selling.length&&(campaigns_selling=campaigns_selling.filter(function(el){return null!==el.progress}),dataSelling=campaignsDataservice.getDataSelling(campaigns_selling,drugstores_ids.length,!0),vm.sellInProgress=dataSelling.sellIn||0,vm.sellInEarns=parseFloat(dataSelling.sellInEarns)||0,vm.sellOutProgress=dataSelling.sellOut||0,vm.sellOutEarns=parseFloat(dataSelling.sellOutEarns)||0),campaign_budget.length&&(vm.budget=campaign_budget)),$rootScope.$emit("receivedMainRequest",!0),vm.setColorStepCounter(),vm.setStepColorInfo(),vm.hideCounters=campaignsDataservice.isCampaignWithoutCounters(vm.campaign)},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)}),vm.isManager&&($sessionStorage.listStaff&&$sessionStorage.listDrugstores?(vm.listStaff=$sessionStorage.listStaff,vm.listDrugstores=$sessionStorage.listDrugstores):setStaffForDrugstores(vm.userData.id))},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})})}function setDrugstoreSteps(props){var stepStatuses=null,statuses="{}",campaignProgress=null;props.networkDrugstores.forEach(function(drugstore){var isFirstStepStart=props.drugstores_first_step.indexOf(drugstore.id)>-1,isLastStepStart=props.drugstores_last_step.indexOf(drugstore.id)>-1,userDrugstore=vm.campaign.drugstores.find(function(d){return drugstore.id==d.id}),in_filter=!0,arrRights=[];vm.rightsName&&userDrugstore&&(arrRights=userDrugstore.job_duties.split(","),"my"==vm.rightsName?in_filter=myDrugstore(arrRights):"observed"===vm.rightsName?in_filter=observedDrugstore(arrRights,userDrugstore.negotiation_point,userDrugstore.selling_point,userDrugstore.drugstores_network_id):"colleague"===vm.rightsName&&(in_filter=colleagueDrugstore(arrRights,userDrugstore.negotiation_point,userDrugstore.selling_point,userDrugstore.drugstores_network_id))),props.networkId&&(stepStatuses=stepsService.getStepsStatuses(drugstore.id,vm.campaignId),"{}"!=stepStatuses&&(statuses=stepStatuses),"{}"!=statuses&&stepsService.setStepsStatuses(drugstore.id,vm.campaignId,statuses)),in_filter&&userDrugstore&&(userDrugstore.isBlocked=!1,userDrugstore.netWorkIcon=getNetWorkIcon(userDrugstore),userDrugstore.addressLine1=userDrugstore.address?userDrugstore.address.address_line_1:"",userDrugstore.zip=userDrugstore.address?userDrugstore.address.zip:"",userDrugstore.cityName=userDrugstore.address&&userDrugstore.address.city&&userDrugstore.address.city.name?userDrugstore.address.city.name:"",(props.networkId&&userDrugstore.negotiation_point||!props.networkId)&&(campaignProgress=stepsService.getDrugstoresStepsStatuses(userDrugstore.id,vm.campaignId)),userDrugstore.isBlocked=stepsService.checkDrugstoreBlockProperty(userDrugstore.id,vm.campaignId,userDrugstore.metadata,props.campaigns_selling),userDrugstore.steps=stepsService.getDrugstoreSteps({drugstoreId:userDrugstore.id,campaignId:vm.campaignId,has_network:userDrugstore.drugstores_network_id,negotiation_point:userDrugstore.negotiation_point,selling_point:userDrugstore.selling_point,is_blocked:userDrugstore.isBlocked,is_first_step_start:isFirstStepStart,is_last_step_start:isLastStepStart,service_control_statuses:vm.not_paid_campaign?props.service_control_statuses:undefined,dynamic_steps:vm.not_paid_campaign?props.dynamic_steps:undefined}),userDrugstore.campaignDateEnd=campaignProgress&&campaignProgress.progress_info&&campaignProgress.progress_info.cycle_end?calcTime(campaignProgress.progress_info.cycle_end,!0):calcTime(vm.campaign.date_end,!0),vm.drugstores.push(userDrugstore))})}function order(arr,predicate){var orderBy=$filter("orderBy");return orderBy(arr,predicate,!0)}function setCampaignKnob(){var diffDaysFromStart,campaignDays,daysBeforeEnd,campaignDateStart=calcTime(vm.campaign.date_start,!0),campaignDateEnd=calcTime(vm.campaign.date_end,!0),now=new Date;now<campaignDateStart?diffDaysFromStart=0:now<=campaignDateEnd?(diffDaysFromStart=calculatePassedDays(campaignDateStart),daysBeforeEnd=calculatePassedDays(campaignDateEnd),vm.campaignDaysBeforeEnd=daysBeforeEnd,now<campaignDateEnd&&0===daysBeforeEnd&&(vm.campaignDaysBeforeEnd=1,diffDaysFromStart-=1)):diffDaysFromStart=calculatePassedDays(campaignDateStart,campaignDateEnd),campaignDays=calculatePassedDays(campaignDateStart,campaignDateEnd),campaignDays>=diffDaysFromStart&&campaignDays>0&&(vm.percentDays=parseFloat(diffDaysFromStart/campaignDays*100))}function getNetWorkIcon(drugstore){var isGlobal=drugstore.drugstores_network&&"central"==drugstore.drugstores_network.type,nameIcon="drugstore_";return drugstore.drugstores_network_id?(nameIcon+="network_",nameIcon+=isGlobal?"global_":"local_",drugstore.negotiation_point?nameIcon+=drugstore.selling_point?"negotiation_selling_point":"negotiation_point":drugstore.selling_point&&(nameIcon+="selling_point")):nameIcon+="individual",nameIcon+".png"}function setStaffForDrugstores(userId){campaignsDataservice.getStaffJobsByDrugstores(userId).then(function(staffDrugstores){staffDrugstores.staff&&(vm.listStaff=staffDrugstores.staff,$sessionStorage.listStaff=vm.listStaff),staffDrugstores.drugstores&&(vm.listDrugstores=staffDrugstores.drugstores,$sessionStorage.listDrugstores=vm.listDrugstores)})}function getCopyDrugstores(){return angular.copy(vm.drugstores)}function getDrugstoreNetworkNpRights(){var item,job_duties,drugstoresNetworkNpRights=[];for(var d in vm.campaign.drugstores)vm.campaign.drugstores.hasOwnProperty(d)&&(item=vm.campaign.drugstores[d],item.negotiation_point===!0&&item.drugstores_network_id>0&&(job_duties=item.job_duties.split(","),job_duties.indexOf("[4]")==-1&&job_duties.indexOf("[5]")==-1||(drugstoresNetworkNpRights[item.drugstores_network_id]=item.id)));return drugstoresNetworkNpRights}function myDrugstore(arrRights){return vm.isManager?arrRights.indexOf("[2]")!=-1:isCanVisit(arrRights)}function observedDrugstore(arrRights,negotiation_point,selling_point,drugstores_network_id){return arrRights.indexOf("[3]")!=-1&&negotiation_point===!1&&selling_point===!0&&drugstores_network_id>0}function colleagueDrugstore(arrRights,negotiation_point,selling_point,drugstores_network_id){var drugstoresNetworkNpRights;return drugstoresNetworkNpRights||(drugstoresNetworkNpRights=getDrugstoreNetworkNpRights()),vm.isManager?arrRights.indexOf("[2]")!=-1&&negotiation_point===!1&&selling_point===!0&&drugstores_network_id>0:isCanVisit(arrRights)&&negotiation_point===!1&&selling_point===!0&&drugstores_network_id>0&&!drugstoresNetworkNpRights[drugstores_network_id]}function isCanVisit(arrRights){return arrRights.indexOf("[4]")!=-1||arrRights.indexOf("[5]")!=-1}var service_control_statuses,vm=this;vm.selectDrugstore=function(drugstoreId,step,$event){var drugstore,stepIndex=null,stepIdentifier=step?step.identifier:null;return $event.stopPropagation(),(!step||!step.disabled)&&(drugstore=vm.drugstores.find(function(drugstore){return drugstore.id==drugstoreId}),$sessionStorage.drugstoreSteps=null,drugstore&&($sessionStorage.drugstoreSteps=drugstore.steps),stepIndex=stepIdentifier?vm.not_paid_campaign?drugstore.steps.findIndex(function(step){return step.identifier==stepIdentifier}):vm.campaign.steps.findIndex(function(step){return step.identifier==stepIdentifier}):vm.not_paid_campaign?drugstore.steps.findIndex(function(ds){return!ds.disabled}):vm.campaign.steps.findIndex(function(s,index){var drugstoreStep=drugstore.steps.find(function(ds){return ds.identifier==s.identifier});return drugstoreStep&&!drugstoreStep.disabled}),void(null!==stepIndex&&(showDimmer(),$state.go("campaigns.steps.pages",{campaignId:vm.campaignId,drugstoreId:drugstoreId,stepIndex:stepIndex?stepIndex+1:1,pageIndex:1}))))},vm.filterByRights=function(rightsName){vm.colorRights.visit&&"my"==rightsName||vm.colorRights.management&&"observed"==rightsName||vm.colorRights.colleague&&"colleague"==rightsName?$state.go("campaigns.main",{id:vm.campaignId}):$state.go("campaigns.main_rights",{id:vm.campaignId,rights:rightsName})},vm.selectColor=function(stepName,color){return vm.not_paid_campaign?stepsService.selectOnlyColor(color,function(){vm.selectedColor=color}):stepsService.selectStepColor(stepName,color,function(){vm.selectedColor=color,vm.selectedStep=stepName})},vm.setClassButton=function(stepName){var res="";return vm.selectedStep&&vm.selectedColor&&stepName==vm.selectedStep&&(res=vm.selectedColor),res},vm.changeSorting=function(column){var condition,sort=vm.sort;sort["class"]="",condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition?(sort.descending=!sort.descending,sort["class"]=sort.descending?"descending":"ascending"):(sort.column=column,sort.descending=!1,sort["class"]="")},vm.sortingClass=function(column){var condition,sort=vm.sort;return sort["class"]="",condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition&&(sort["class"]=sort.descending?"descending":"ascending"),sort["class"]},vm.changeStaff=function(){var drugstores=[];
vm.drugstoresCopy||(vm.drugstoresCopy=getCopyDrugstores()),drugstores=vm.selectedStaff?vm.drugstoresCopy.filter(function(drugstore){return vm.listStaff[vm.selectedStaff].drugstoresIds.indexOf(drugstore.id)>-1}):vm.drugstoresCopy,vm.drugstores=drugstores},vm.loadMore=function(){vm.pagingLimit+=PAGING.ITEMS_INCREMENT,vm.campaign&&vm.drugstores&&vm.pagingLimit>vm.drugstores.length&&(vm.pagingLimit=vm.drugstores.length)},vm.isJobDutiesSignatureVisit=function(staff){return clientsDataservice.isJobDutiesSignatureVisit(staff)},vm.setStepIdentifier=function(identifier){vm.selectedStep==identifier?vm.selectColor("",""):vm.selectColor(identifier,"white")},vm.hasWarningSign=function(drugstore){return clientsDataservice.hasWarningSign(drugstore)},vm.setColorStepCounter=function(){vm.colorStepCounter=stepsService.setColorStepCounter(vm.campaign.drugstores)},vm.setStepColorInfo=function(){vm.stepColorInfo=stepsService.setStepColorInfo(vm.campaign.drugstores)},vm.confirmCloneStep=function(drugstore){var isStepWarning,isClose,isNotInDate,last_step_date,lastStep=drugstore.steps.length?drugstore.steps[drugstore.steps.length-1]:null,job_duties=drugstore.job_duties.split(","),isCan=isCanVisit(job_duties),now=new Date,campaign_date_end=calcTime(vm.campaign.date_end,!0);lastStep&&(now.setHours(0,0,0,0),campaign_date_end.setHours(0,0,0,0),last_step_date=calcTime(lastStep.date_end,!0),isStepWarning=stepsService.isWarningStep(last_step_date),last_step_date.setHours(0,0,0,0),isNotInDate=!lastStep.inDate&&now>last_step_date,isClose="completed"==lastStep.status,isCan?isStepWarning||isClose||isNotInDate?now>campaign_date_end?angular.element("#banOnCloningByDate").modal("show"):(vm.cloneDrugstore=drugstore,angular.element("#confirmAddStep").modal("show")):angular.element("#banOnCloning").modal("show"):angular.element("#banOnCloningByRights").modal("show"))},vm.cloneStep=function(){var isClose,step,date_end,campaign_date_end,diffDays,lastStep=vm.campaign.steps.length?vm.campaign.steps[vm.campaign.steps.length-1]:null,drugstoreLastStep=vm.cloneDrugstore.steps.length?vm.cloneDrugstore.steps[vm.cloneDrugstore.steps.length-1]:null,now=new Date,data={};lastStep&&drugstoreLastStep&&vm.userData.id&&(step=cloneObj(lastStep),isClose="completed"==drugstoreLastStep.status,step.pages=[],step.unique_id=now.valueOf(),step.identifier=incrementLast(drugstoreLastStep.identifier),removeProperties(step,["allPages","isWarningStep","isStepStart","readOnly","color","status","disabled"]),diffDays=Number(calculatePassedDays(drugstoreLastStep.date_end,drugstoreLastStep.date_start)),isClose||!drugstoreLastStep.inDate?(now.setHours(0,0,0,0),step.date_start=now,date_end=new Date,date_end.setDate(date_end.getDate()+diffDays),date_end.setHours(0,0,0,0),campaign_date_end=calcTime(vm.campaign.date_end,!0),campaign_date_end.setHours(0,0,0,0),calcTime(date_end,!0)>campaign_date_end&&(date_end=campaign_date_end),step.date_end=new Date(date_end)):drugstoreLastStep.inDate&&(date_end=new Date(drugstoreLastStep.date_end),step.date_start=drugstoreLastStep.date_end,date_end.setDate(date_end.getDate()+diffDays),step.date_end=new Date(date_end)),drugstoreLastStep.pages.forEach(function(page){"services_control"==page.type&&step.pages.push(page)}),data={campaign_id:vm.campaignId,drugstore_id:vm.cloneDrugstore.id,step_id:step.unique_id,step_definition:JSON.stringify(step),staff_id:vm.userData.id},showDimmer(),campaignsDataservice.saveCloneStep(data).then(function(res){var newStep=stepsService.addOneStepNotPaidCampaign(step,{drugstoreId:vm.cloneDrugstore.id,campaignId:vm.campaignId,has_network:vm.cloneDrugstore.drugstores_network_id,negotiation_point:vm.cloneDrugstore.negotiation_point,selling_point:vm.cloneDrugstore.selling_point,is_blocked:vm.cloneDrugstore.isBlocked,service_control_statuses:service_control_statuses});notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),hideDimmer(),vm.cloneDrugstore.steps.push(newStep),$rootScope.$broadcast("addElement",{targetId:vm.cloneDrugstore.id}),vm.setColorStepCounter()},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)}))},vm.hideModal=function(id){angular.element("#"+id).modal("hide")},activate()}angular.module("app.campaigns").controller("CampaignsMainController",CampaignsMainController).filter("selectedStepColor",[function(){return function(drugstores,stepName,stepColor){var tempDrugstores=[];return!!drugstores&&(stepName&&stepColor?(angular.forEach(drugstores,function(drugstore){angular.forEach(drugstore.steps,function(step){step.identifier==stepName&&(step.color==stepColor||"white"==stepColor||step.specColor.length&&step.specColor.indexOf(stepColor)>-1)&&tempDrugstores.push(drugstore)})}),tempDrugstores):stepColor?(angular.forEach(drugstores,function(drugstore){angular.forEach(drugstore.steps,function(step){(step.color==stepColor||"white"==stepColor||step.specColor.length&&step.specColor.indexOf(stepColor)>-1)&&tempDrugstores.push(drugstore)})}),tempDrugstores):drugstores)}}]),CampaignsMainController.$inject=["$rootScope","$state","campaignsDataservice","clientsDataservice","stepsService","$sessionStorage","principal","$filter","notifier","TEXT_MESSAGE","PAGING"]}(),function(undefined){"use strict";function CampaignsPagesController($rootScope,$scope,$state,campaignsDataservice,localDBService,stepsService,$sessionStorage,notifier,$timeout,MessagesManager,getDataCampaignPages,TEXT_MESSAGE,OFFLINE_MODE,clientsDataservice){function activate(){$rootScope.subtitle="Step Pages",vm.numberColumns="",vm.drugstoreId=$state.params.hasOwnProperty("drugstoreId")?parseInt($state.params.drugstoreId):-1,vm.campaignId=$state.params.hasOwnProperty("campaignId")?parseInt($state.params.campaignId):-1,vm.stepIndex=$state.params.hasOwnProperty("stepIndex")?parseInt($state.params.stepIndex)-1:-1,vm.templateIndex=$state.params.hasOwnProperty("pageIndex")?parseInt($state.params.pageIndex)-1:0,vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.blockingServiceControl=null,vm.templates=[],vm.template={},vm.steps=[],vm.step=null,vm.page=null,vm.isVisit=!1,vm.isManager=!1,vm.rksId=0,vm.mainDrugstoreId=0,vm.servicesMultiplier=1,vm.multiplier=1,vm.cycleValue=1,vm.listDrugstores=[],vm.campaignProgress=null,vm.campaignProgressActiveId=null,vm.campaignProposal=[],vm.isPageChange=!1,vm.superAdmins=["admin@3dom.com"],vm.isSuperAdmin=vm.userData&&vm.superAdmins.indexOf(vm.userData.email)!=-1,vm.isSetOfflineMode=OFFLINE_MODE,vm.offlineMode=campaignsDataservice.isSetOfflineMode(vm.drugstoreId,vm.campaignId),vm.offlineMode?(localDBService.setOfflineMode(!0),localDBService.setSSN(vm.campaignId,vm.drugstoreId)):localDBService.setOfflineMode(!1);try{vm.blockingServiceControl=JSON.parse(vm.userData.service_control_photo_blocking)}catch(e){}setData()}function setData(){var pages=[],dataProgress=[],services=[],now=new Date;vm.campaign=getDataCampaignPages.campaign,vm.dominant=vm.campaign.dominant,vm.not_paid_campaign=vm.campaign.not_paid_campaign,vm.drugstore=getDataCampaignPages.drugstore,vm.countMainOffices=getDataCampaignPages.countMainOffices,dataProgress=getDataCampaignPages.dataProgress,vm.mainDrugstoreId=Number(getDataCampaignPages.mainDrugstoreId),vm.is_proposal_saved=getDataCampaignPages.is_proposal_saved,vm.budget=getDataCampaignPages.budget,vm.hasWarningSign=clientsDataservice.hasWarningSign(vm.drugstore),vm.staffForDrugstore=getDataCampaignPages.staffForDrugstore.drugstores[vm.drugstoreId].staff,setInfoForStaff(getDataCampaignPages.staffForDrugstore.staff),vm.managers=setManagersForDrugstore(),vm.isRegisteredAtPortal(),vm.steps=stepsService.getSteps(vm.campaign.definition,{has_network:vm.drugstore.drugstores_network_id,negotiation_point:vm.drugstore.negotiation_point,selling_point:vm.drugstore.selling_point,id:vm.drugstore.identifier}),services=stepsService.getServices(),vm.services=services.services_list,vm.servicesGroups=stepsService.getServicesGroups(),vm.needPercentInNetWork=services.services_percent_todo_network,vm.giftsNumber=vm.campaign.gifts_number,vm.drugs=vm.campaign.drugs,vm.gifts=vm.campaign.gifts,vm.drugsGroups=stepsService.getDrugsGroups(),vm.drugstoresGroups=stepsService.getDrugStoresGroups(),vm.icon=stepsService.getCampaignIcon(),vm.isLimitByCurrentMonth=stepsService.getLimitCycleByCurrentMonth(),vm.potentialInputHand=vm.campaign.drugs_potential_input_by_hand,vm.drugs_potential_edit=vm.campaign.drugs_potential_edit,vm.potentialInputVisibility=vm.potentialInputHand?vm.drugs_potential_edit:null,hideDimmer(),vm.rights=getRights(vm.drugstore.job_duties),vm.isVisit=vm.rights.visit,vm.isSignature=vm.rights.signature,vm.networkHelper=stepsService.getNetworkHelper(),vm.netWorkIcon=getNetWorkIcon(),vm.listDrugstores=vm.drugstore.drugstores_network_id?vm.getNetworkDrugstores():[vm.drugstore],vm.period={start:calcTime(vm.campaign.date_start,!0),end:calcTime(new Date,!0)>calcTime(vm.campaign.date_end,!0)?calcTime(vm.campaign.date_end,!0):calcTime(new Date,!0),campaign_start:calcTime(vm.campaign.date_start,!0),campaign_end:calcTime(vm.campaign.date_end,!0),now:calcTime(now,!0)},dataProgress.progress&&dataProgress.progress.length&&(vm.campaignProgress=dataProgress.progress[0],vm.cycleValue=vm.campaignProgress.cycle_number,"active"==vm.campaignProgress.campaign_status&&(vm.campaignProgressActiveId=vm.campaignProgress.id),vm.period.start=calcTime(vm.campaignProgress.real_date_start,!0),vm.period.end="multi"==vm.campaignProgress.multi?calcTime(vm.campaignProgress.cycle_date_end,!0):calcTime(vm.campaign.date_end,!0)),dataProgress.proposal&&dataProgress.proposal.length&&(vm.campaignProposal=dataProgress.proposal),vm.drugstore.negotiation_point&&vm.listDrugstores.length>1&&(vm.multiplier=vm.listDrugstores.filter(function(pharmacy){return pharmacy.selling_point}).length,vm.servicesMultiplier=vm.multiplier),vm.setServicesMultipliers(vm.listDrugstores),stepsService.init(vm.drugstoreId,vm.campaignId,vm.campaignProgress),vm.drugstore.isBlocked=stepsService.checkDrugstoreBlockProperty(vm.drugstoreId,vm.campaignId,vm.drugstore.metadata,getDataCampaignPages.campaigns_selling),vm.steps=stepsService.getDrugstoreSteps({drugstoreId:vm.drugstoreId,campaignId:vm.campaignId,has_network:vm.drugstore.drugstores_network_id,negotiation_point:vm.drugstore.negotiation_point,selling_point:vm.drugstore.selling_point,is_blocked:vm.drugstore.isBlocked,is_first_step_start:getDataCampaignPages.first_step_start,is_set_step_status:!1,is_show_disable_step:!0,service_control_statuses:vm.not_paid_campaign?getDataCampaignPages.service_control_statuses:undefined,dynamic_steps:vm.not_paid_campaign?getDataCampaignPages.dynamic_steps:undefined}),pages=stepsService.getPages(vm.stepIndex,{has_network:vm.drugstore.drugstores_network_id,negotiation_point:vm.drugstore.negotiation_point,selling_point:vm.drugstore.selling_point},vm.steps),vm.steps.length&&vm.steps[vm.stepIndex]&&(vm.step=vm.steps[vm.stepIndex],pages.length&&(vm.step.pages=pages,vm.templates=setTemplates(),vm.template=vm.templates[vm.templateIndex],vm.page=vm.step.pages[0],vm.templateName=vm.template.name))}function setStepServiceControl(dataServiceControl,sendData,countServiceControl){var serviceWarning,step_status,countServicesIncluded=0,dataProposal=vm.campaignProposal&&vm.campaignProposal.length?vm.campaignProposal[0].definition:null,services=angular.copy(vm.services),serviceRed=[];if(!dataServiceControl.length||!dataProposal)return console.log("no Data for service control! Step status will be rejected!"),sendData.step_status="rejected",sendData;dataServiceControl.forEach(function(el){try{el.definition=JSON.parse(el.definition),el.definition.length&&(el.definition=el.definition[0])}catch(e){}});try{dataProposal=JSON.parse(dataProposal).services}catch(e){}return services.forEach(function(service,index){var dataService=dataServiceControl.filter(function(el){return el.service_id==service.unique_id}),initProposal=dataProposal?dataProposal.filter(function(el){return el.unique_id==service.unique_id}):[],serviceIncluded=!1,serviceControl=service.control_type,notAgreedRep=[],notShelfPhotos=[],notShelfAccept=[],notEnvPhotos=[],notEnvAccept=[];initProposal.length&&angular.isDefined(initProposal[0].include)&&(serviceIncluded=initProposal[0].include),serviceIncluded&&(countServicesIncluded++,dataService.length?(notAgreedRep=dataService.filter(function(el){return!el.yes_no&&el.definition.visible}),notAgreedRep.length&&(service.red=!0),serviceControl&&!service.red&&(serviceControl.photo_shelf&&(notShelfPhotos=dataService.filter(function(el){return!el.shelf_image_id&&el.definition.visible}),notShelfPhotos.length?service.red=!0:serviceControl.photo_shelf_controlled_by_manager&&(notShelfPhotos=dataService.filter(function(el){return el.shelf_image_id&&el.definition.visible&&!el.definition.shelf_agreed}),notShelfAccept=dataService.filter(function(el){return el.shelf_image_id&&el.definition.visible&&el.definition.shelf_agreed==-1}),notShelfPhotos.length&&(service.red=!0),notShelfAccept.length&&(service.warning=!0))),serviceControl.photo_environment&&(notEnvPhotos=dataService.filter(function(el){return!el.env_image_id&&el.definition.visible}),notEnvPhotos.length?service.red=!0:serviceControl.photo_env_controlled_by_manager&&(notEnvPhotos=dataService.filter(function(el){return el.env_image_id&&el.definition.visible&&!el.definition.env_agreed}),notEnvAccept=dataService.filter(function(el){return el.env_image_id&&el.definition.visible&&el.definition.env_agreed==-1}),notEnvPhotos.length&&(service.red=!0),notEnvAccept.length&&(service.warning=!0))))):service.red=!0)}),serviceRed=services.filter(function(service){return service.red}),serviceWarning=services.filter(function(service){return service.warning}),step_status=serviceRed.length||countServiceControl*countServicesIncluded!=dataServiceControl.length?"rejected":serviceWarning.length?"in_progress":"completed",sendData.step_status=step_status,sendData}function getNetWorkIcon(){var isGlobal=vm.drugstore.drugstores_network&&"central"==vm.drugstore.drugstores_network.type,nameIcon="drugstore_";return vm.drugstore.drugstores_network_id?(nameIcon+="network_",nameIcon+=isGlobal?"global_":"local_",vm.drugstore.negotiation_point?nameIcon+=vm.drugstore.selling_point?"negotiation_selling_point":"negotiation_point":vm.drugstore.selling_point&&(nameIcon+="selling_point")):nameIcon+="individual",nameIcon+".png"}function getTranslateColumns(){return["one","two","three","four","five","six","seven","eight","nine","ten"]}function setTemplates(){var templates=[];return vm.step.pages.forEach(function(page){var needPage;needPage=vm.filterByType(page.type)||{},templates.push({title:needPage.title,name:needPage.name,url:"app/campaigns/pages/templates/campaigns."+needPage.name+".html",realName:page.name})}),templates.length&&(vm.numberColumns=getTranslateColumns()[templates.length-1]),templates}function setManagersForDrugstore(){var managers=[],parent_id=null,rks=null;return vm.staffForDrugstore&&(managers=vm.staffForDrugstore.filter(function(staff){var isNeedJobDuties=staff.job_duties.indexOf("[2]")>-1;return vm.userData&&staff.staff_id==vm.userData.id&&(isNeedJobDuties?vm.isManager=!0:staff.staff_info&&staff.staff_info.parent_id&&(parent_id=staff.staff_info.parent_id)),isNeedJobDuties}),vm.rksId=managers.length?managers[0].staff_id:0,parent_id&&(rks=managers.find(function(staff){return staff.staff_id==parent_id}),rks&&(vm.rksId=parent_id))),managers}function setInfoForStaff(staffDrugstores){angular.forEach(vm.staffForDrugstore,function(el){el.iSManager=el.job_duties.indexOf("[2]")>-1,el.job=staffDrugstores[el.staff_id].job,el.staff_info=staffDrugstores[el.staff_id].staff_info})}function calculateMkSh(market_share_reports,sell_out_reports){var result={},group={},data={},drugs_sum={},sum_drugs={};return market_share_reports.groupBy(function(o){return o.drugstore_id}).forEach(function(el){var drugstore_id=el.key,data_mk_sh=el.group;data[drugstore_id]||(data[drugstore_id]={}),data_mk_sh.length&&data_mk_sh.groupBy(function(o){return o.group_name}).forEach(function(g){var g_name=g.key,g_group=g.group;g_group.forEach(function(group){var need_group=vm.drugsGroups.find(function(dg){return dg.name==g_name});need_group&&(data[drugstore_id][need_group.id]||(data[drugstore_id][need_group.id]={}),data[drugstore_id][need_group.id].mk_sh=group.market_share_percent_quantity,sum_drugs[need_group.id]||(sum_drugs[need_group.id]={}),drugs_sum=calculateSumDrugs(sell_out_reports,need_group,drugstore_id,sum_drugs[need_group.id]),sum_drugs[need_group.id]=drugs_sum.sum_drugs,data[drugstore_id][need_group.id].sell_out_sum=drugs_sum.sum,data[drugstore_id][need_group.id].total=parseFloat(drugs_sum.sum/data[drugstore_id][need_group.id].mk_sh*100))})})}),calculateGroupMkSh(data,group),result={group:group,sumByDrug:sum_drugs}}function calculateGroupMkSh(data,group){var group_result={};angular.forEach(data,function(val,key){angular.forEach(val,function(v,k){group_result[k]||(group_result[k]={}),group_result[k].sTotal||(group_result[k].sTotal=0),group_result[k].mnTotal||(group_result[k].mnTotal=0),group_result[k].sTotal+=parseFloat(v.sell_out_sum),group_result[k].mnTotal+=parseFloat(v.total)})}),angular.forEach(group_result,function(v,k){group[k]||(group[k]={}),group[k].mk_sh=Number(parseFloat(group_result[k].sTotal/group_result[k].mnTotal*100).toFixed(2)),group[k].totalSales=Number(group_result[k].mnTotal.toFixed(2))})}function calculateSumDrugs(sell_out_reports,group,drugstore_id,sum_drugs){var sum_sell_out=0,result={sum_drugs:{},sum:0};return group.drugs.forEach(function(d){var count_sell_out,count_sell_in,need_drug=sell_out_reports.find(function(s_o){return s_o.drugstore_id==drugstore_id&&s_o.drug_id==d});need_drug&&(sum_drugs[need_drug.drug_id]||(sum_drugs[need_drug.drug_id]={}),sum_drugs[need_drug.drug_id].sellIn||(sum_drugs[need_drug.drug_id].sellIn=0),sum_drugs[need_drug.drug_id].sellOut||(sum_drugs[need_drug.drug_id].sellOut=0),need_drug.sell_out_sum&&(count_sell_out=Number(parseFloat(need_drug.sell_out_sum).toFixed(1)),sum_sell_out+=count_sell_out,sum_drugs[need_drug.drug_id].sellOut+=count_sell_out),need_drug.sell_in_sum&&(count_sell_in=Number(parseFloat(need_drug.sell_in_sum).toFixed(1)),sum_drugs[need_drug.drug_id].sellIn+=count_sell_in))}),result.sum=sum_sell_out,result.sum_drugs=sum_drugs,result}function checkProblemsMkShResult(market_share_reports,sell_reports,network_drugstores_ids,is_make_new_reports,drug_id){var whatDifference,need_group,new_market_share_reports,new_sell_reports,wordDifference="",group_mk_sh={},group_sell={},drugstores_diff={},drugstores_ids_mk_sh=market_share_reports.map(function(el){return group_mk_sh[el.group_name]||(group_mk_sh[el.group_name]=[]),group_mk_sh[el.group_name].indexOf(el.drugstore_id)==-1&&group_mk_sh[el.group_name].push(el.drugstore_id),el.drugstore_id}).unique(),drugstores_ids_sell=sell_reports.map(function(el){return el.drug_id==drug_id&&need_group||(need_group=vm.drugsGroups.find(function(group){return group.drugs.indexOf(el.drug_id)>-1})),need_group&&(group_sell[need_group.name]||(group_sell[need_group.name]=[]),group_sell[need_group.name].indexOf(el.drugstore_id)==-1&&group_sell[need_group.name].push(el.drugstore_id)),el.drugstore_id}).unique(),result={isProblem:!1,data:{word:"",drugstores_diff:[]}};return vm.missDrugstores=[],vm.counterKamsoftDrugstores=0,vm.new_market_share_reports=null,vm.new_sell_reports=null,drugstores_ids_mk_sh.length||drugstores_ids_sell.length||(result.isProblem=!0,result.data.word="no_data"),drugstores_ids_mk_sh.length!=vm.listDrugstores.length||drugstores_ids_sell.length!=vm.listDrugstores.length?(vm.counterKamsoftDrugstores=drugstores_ids_mk_sh.intersection(drugstores_ids_sell).length,new_market_share_reports=market_share_reports,new_sell_reports=sell_reports,drugstores_ids_mk_sh.length!=vm.listDrugstores.length&&(wordDifference="no_mk_sh",whatDifference=network_drugstores_ids.diff(drugstores_ids_mk_sh)),drugstores_ids_sell.length!=vm.listDrugstores.length&&(wordDifference||(wordDifference="no_sell",whatDifference=network_drugstores_ids.diff(drugstores_ids_sell))),vm.drugsGroups.forEach(function(group){var miss_ids_mk_sh_for_group,miss_ids_sell_for_group,miss_drugstore_ids,average_data,drug;group_mk_sh[group.name]||(group_mk_sh[group.name]=[]),group_sell[group.name]||(group_sell[group.name]=[]),miss_ids_mk_sh_for_group=network_drugstores_ids.diff(group_mk_sh[group.name]),miss_ids_sell_for_group=network_drugstores_ids.diff(group_sell[group.name]),miss_drugstore_ids=miss_ids_mk_sh_for_group.concat(miss_ids_sell_for_group).unique(),group.average_market_share||(average_data="no",is_make_new_reports=!1),miss_drugstore_ids.length&&miss_drugstore_ids.forEach(function(miss_drugstore_id){var data={group_name:group.name,definition:{what:[]}};miss_ids_mk_sh_for_group.length&&miss_ids_mk_sh_for_group.indexOf(miss_drugstore_id)>-1&&(data.definition.what.push("mk_sh"),is_make_new_reports&&new_market_share_reports.push({group_name:group.name,drugstore_id:miss_drugstore_id,market_share_percent_quantity:group.average_market_share})),miss_ids_sell_for_group.length&&miss_ids_sell_for_group.indexOf(miss_drugstore_id)>-1&&(data.definition.what.push("sell"),drug=vm.drugs.find(function(d){return d.id==drug_id}),is_make_new_reports&&drug_id&&drug&&new_sell_reports.push({drugstore_id:miss_drugstore_id,drug_id:drug_id,sell_out_sum:Number(parseFloat(group.average_sell_out/drug.price).toFixed(1))||0})),"no"==average_data&&(data.definition.average_data="no"),data.drugstore_id=miss_drugstore_id,data.group_name=group.name,data.definition=JSON.stringify(data.definition),vm.missDrugstores.push(data)})}),drugstores_ids_mk_sh=new_market_share_reports.map(function(el){return el.drugstore_id}).unique(),drugstores_ids_sell=new_sell_reports.map(function(el){return el.drugstore_id}).unique(),drugstores_ids_mk_sh.length==vm.listDrugstores.length&&drugstores_ids_sell.length==vm.listDrugstores.length&&(vm.new_market_share_reports=new_market_share_reports,vm.new_sell_reports=new_sell_reports),drugstores_diff=vm.listDrugstores.filter(function(el){return whatDifference.indexOf(el.id)>-1}).map(function(el){return{id:el.id,identifier:el.identifier,NIP:el.NIP,name:el.name}}),result.isProblem=!0,result.data.word=wordDifference,result.data.drugstores_diff=drugstores_diff):vm.counterKamsoftDrugstores=vm.listDrugstores.length,result}var vm=this;vm.actionsAfterOffline=function(){var actionAfterOffline=localDBService.getActions(vm.campaignId,vm.drugstoreId);vm.offlineMode&&actionAfterOffline.length&&(vm.actionAfterOffline||(vm.actionAfterOffline={}),vm.actionAfterOffline[vm.drugstoreId]||(vm.actionAfterOffline[vm.drugstoreId]={}),vm.actionAfterOffline[vm.drugstoreId][vm.campaignId]=actionAfterOffline,localDBService.setSSN(vm.campaignId,vm.drugstoreId),vm.showActionMode())},vm.showActionMode=function(){angular.element("#actionsAfterOffline").modal("show")},vm.executeOfflineAction=function(){return vm.isCloseStep=!1,!vm.lockForm&&(vm.lockForm=!0,void angular.forEach(vm.actionAfterOffline[vm.drugstoreId][vm.campaignId],function(act){act.isCloseStep&&(vm.isCloseStep=!0),act.func&&vm.todoAction(act)}))},vm.todoAction=function(act){return act.func(act.sendData,act.isUpdate,act).then(function(data){vm.removeOfflineAction(act.actionType)},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})},vm.removeOfflineAction=function(actionType){var countActions=localDBService.removeAction(actionType);countActions||(angular.element("#actionsAfterOffline").modal("hide"),vm.actionAfterOffline[vm.drugstoreId][vm.campaignId]=null,vm.lockForm=!1,localDBService.clear(vm.campaignId,vm.drugstoreId),vm.offlineMode=!1,vm.isCloseStep&&vm.refresh())},vm.refresh=function(){$state.go($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})},vm.filterByType=function(type){return stepsService.pageFilterByType(type)},vm.hideModal=function(id){angular.element("#"+id).modal("hide")},$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){var arrTemplates=["sellingInfo","merchandising","lastSellingInfo"],selectStepPage=function(){toParams.stepIndex!=fromParams.stepIndex?vm.selectStep(toParams.stepIndex-1):vm.selectPage(toParams.pageIndex-1)};vm.isPageChange&&(vm.isPageChange=!1,arrTemplates.indexOf(vm.templateName)>-1&&angular.element("#confirmSaved").length?angular.element("#confirmSaved").modal({onDeny:function(){return vm.refresh(),!0},onApprove:function(){return vm.goNextPage=!0,selectStepPage(),!0}}).modal("show"):selectStepPage())}),vm.selectStep=function(stepIndex){function endBuildStep(){var step=vm.steps[stepIndex];step.pages=pages,vm.stepIndex=stepIndex,vm.step=step,vm.templates=setTemplates(),vm.templateIndex=0,vm.template=vm.templates[vm.templateIndex],vm.templateName=vm.template.name,vm.page=pages[0]}var pages=stepsService.getPages(stepIndex,{has_network:vm.drugstore.drugstores_network_id,negotiation_point:vm.drugstore.negotiation_point,selling_point:vm.drugstore.selling_point},vm.steps);vm.templateName=vm.template.name,vm.isPageChange||vm.steps[stepIndex]&&vm.steps[stepIndex].pages.length&&(vm.template=null,$timeout(function(){endBuildStep()},100))},vm.selectPage=function(index){vm.isPageChange||(vm.templateIndex=index,vm.template=vm.templates[index],vm.templateName=vm.template.name)},vm.selectCampaign=function(campaignId){$state.go("campaigns.main",{id:campaignId})},vm.selectDrugstore=function(drugstoreId){$state.go("clients.card",{id:drugstoreId})},vm.getDrugstoresGroup=function(id){return vm.drugstoresGroups.filter(function(group){return group.drugstores.indexOf(id)>-1})},vm.getNetworkDrugstores=function(){var networkDrugstores=[];return vm.campaign.drugstores.forEach(function(drugstore){drugstore.steps=[],vm.drugstore.negotiation_point&&(drugstore.steps=stepsService.getDrugstoreStepsForFinRep({has_network:drugstore.drugstores_network_id,negotiation_point:drugstore.negotiation_point,selling_point:drugstore.selling_point})),networkDrugstores.push(drugstore)}),networkDrugstores},vm.showDrugstoresList=function(){vm.netDrugstores=angular.copy(vm.listDrugstores),angular.element("#networkDrugstoresList").modal("show")},vm.showStaffList=function(){angular.element("#staffForDrugstore").modal("show")},vm.sendMessageToManager=function(subject,text){vm.rksId&&MessagesManager.create({message_category:"internal",from:vm.userData.id,to:vm.rksId,sender_category:"representant",addressee_category:"representant",subject:subject,message:text,is_sent:!0,metadata:JSON.stringify({originator:{id:vm.userData.id,category:"representant",first_name:vm.userData.firstName,last_name:vm.userData.lastName}})}).then(function(msg){msg.send().then(function(res){notifier.success("Sukces","Wiadomość została pomyślnie wysłana")},function(err){notifier.error("Error","Unable to send the message!")})})},vm.sendMessageToAdmin=function(subject,text){MessagesManager.create({message_category:"internal",from:vm.userData.id,to:0,sender_category:"representant",addressee_category:"administrator",subject:subject,message:text,is_sent:!0,metadata:JSON.stringify({originator:{id:vm.userData.id,category:"representant",first_name:vm.userData.firstName,last_name:vm.userData.lastName}})}).then(function(msg){msg.send().then(function(res){notifier.success("Sukces","Wiadomość została pomyślnie wysłana")},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SEND_MESSAGE_ERROR)})})},vm.setServicesMultipliers=function(drugstores){function countDrugstoresForService(service_id,use_drugstores_number_in_multiplier){vm.serviceDrugstores[service_id]||(vm.serviceDrugstores[service_id]={});var foundServicePages=drugstores.filter(function(pharmacy){var controlPages=[],drugstoreId=pharmacy.id,steps=pharmacy.steps?pharmacy.steps:vm.steps;return steps&&steps.length&&(controlPages=steps.filter(function(el){var serviceControlPages=el.pages.filter(function(page){var propertiesService=page.properties["ds_merch_services_table_row_"+service_id],serviceVisible=!0;return propertiesService&&(serviceVisible=stringToBoolean(propertiesService.visible)),"services_control"==page.type&&serviceVisible});return serviceControlPages.length&&!vm.serviceDrugstores[service_id][drugstoreId]&&(vm.serviceDrugstores[service_id][drugstoreId]=0),vm.serviceDrugstores[service_id][drugstoreId]+=serviceControlPages.length,serviceControlPages.length>0})),controlPages.length>0});return use_drugstores_number_in_multiplier?foundServicePages.length:1}vm.serviceDrugstores={},vm.serviceCount={},vm.services.forEach(function(service){angular.isDefined(service.use_drugstores_number_in_multiplier)||(service.use_drugstores_number_in_multiplier=!0),vm.serviceCount[service.unique_id]=countDrugstoresForService(service.unique_id,service.use_drugstores_number_in_multiplier)})},vm.isServiceBlockPayment=function(service,page){var isBlockPayment=service.service_blocks_all_payments;return isBlockPayment&&service.service_blocks_all_payments_for&&"all"!=service.service_blocks_all_payments_for&&service.service_blocks_all_payments_for!=page&&(isBlockPayment=!1),isBlockPayment},vm.setPageReadOnly=function(isDisabled){stepsService.setPageReadOnly(isDisabled)},vm.closeStep=function(step,dataServiceControl,stepStatus){var sendData,serviceControl;return sendData={step_unique_id:stepsService.getStepId(vm.drugstoreId,step.unique_id),step_status:stepStatus?stepStatus:"completed"},stepStatus||(serviceControl=step.pages.filter(function(page){return"services_control"==page.type}),dataServiceControl.length?sendData=setStepServiceControl(dataServiceControl,sendData,serviceControl.length):sendData.step_status="rejected"),sendData.campaignId=vm.campaignId,sendData.drugstoreId=vm.mainDrugstoreId,sendData},vm.setStepStatus=function(step,status){stepsService.setStepStatus(vm.drugstoreId,vm.campaignId,step.unique_id,status),stepsService.setStepProperties(status,step)},vm.findNotRegisteredPortalAccount=function(){var drugstoresStaff;return drugstoresStaff=vm.drugstore.drugstores_staff.find(function(dss){return dss.is_drugstore===!0&&dss.registered_at_portal===!1&&dss.email==vm.drugstore.email})},vm.isRegisteredAtPortal=function(){var isExistsNotRegistered=!1,isRegistered=vm.drugstore.parent_drugstore?vm.drugstore.parent_drugstore.registered_at_portal:vm.drugstore.registered_at_portal;isRegistered||(isExistsNotRegistered=vm.findNotRegisteredPortalAccount()),vm.portalRegistered=isRegistered,vm.isExistsNotRegistered=isExistsNotRegistered},vm.getKamSoftData=function(){if(vm.lockForm)return!1;var data={UserLogin:"3mind",CustomerNWBR:"250131",CompanyNWBR:"894455",VerificationCode:"{D086173B-E9E3-4556-9822-7432A01A265E}",campaign_id:vm.campaignId,campaign_progress_id:777,step_id:vm.step.unique_id};vm.sendRequestToKamsoft(data)},vm.sendRequestToKamsoft=function(data){var report;vm.lockForm=!0,campaignsDataservice.getKamsoftReport(vm.drugstoreId,data).then(function(res){report=res.plain().resources,vm.lockForm=!1,notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_GET_DATA),report.positions&&$rootScope.$broadcast("getKamSoft",report.positions)},function(err){var textError=err.data&&err.data.message?err.data.message:TEXT_MESSAGE.ERROR.SERVER_ERROR;vm.lockForm=!1,notifier.error("Error",textError),console.log(err)})},vm.showBarCodeScanner=function(){return!vm.lockForm&&void document.addEventListener("deviceready",function(){console.log("BarCode Scanner starting..."),cordova.plugins.barcodeScanner.scan(vm.onScanSuccess,vm.onScanError,vm.barcodeScannerOptions)},!1)},vm.onScanSuccess=function(result){if(result.cancelled)console.log("Scan cancelled");else if("QR_CODE"==result.format){var data={UserLogin:"3mind",CustomerNWBR:vm.drugstore.identifier,CompanyNWBR:vm.userData.company_identifier,VerificationCode:result.text,campaign_id:vm.campaignId,campaign_progress_id:vm.campaignProgress?vm.campaignProgress.id:0,step_id:vm.step.unique_id};vm.sendRequestToKamsoft(data)}else console.log("Wrong barcode format")},vm.onScanError=function(error){notifier.error("Error",error),console.log(error)},vm.isJobDutiesSignatureVisit=function(staff){return clientsDataservice.isJobDutiesSignatureVisit(staff);
},vm.isNegotiationPoint=function(drugstore){return clientsDataservice.isNegotiationPoint(drugstore)},vm.getKamSoftDataDailyMarketShareReports=function(period){var data={},drugs_groups_names=vm.drugsGroups.map(function(el){return el.name}),drugs_ids=vm.drugs.map(function(el){return el.id}),drugstores_ids=vm.listDrugstores.map(function(el){return el.id});vm.lockForm=!0,data.drugstores_ids=drugstores_ids,data.drugs_groups_names=drugs_groups_names,data.drugs_ids=drugs_ids,data.period_start_date=moment(period[0]).format("YYYY-MM-DD"),data.period_end_date=moment(period[1]).format("YYYY-MM-DD"),campaignsDataservice.getKamsoftDailyMarketShareReports(data).then(function(reports){var mk_sh_result,checkProblem,result={},market_share_reports=reports.market_share_reports,sell_out_daily_reports=reports.sell_out_daily_reports,sell_in_out_reports=reports.sell_in_out_reports;vm.lockForm=!1,checkProblem=checkProblemsMkShResult(market_share_reports,sell_in_out_reports,drugstores_ids),checkProblem.isProblem?$rootScope.$broadcast("getKamSoftMkShError",checkProblem.data):(mk_sh_result=calculateMkSh(market_share_reports,sell_in_out_reports),result.sell_in_out_reports=mk_sh_result,result.sell_out_daily_reports=sell_out_daily_reports,$rootScope.$broadcast("getKamSoftMkSh",result))},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.getKamSoftDataMkSh=function(period){var data={},drugs_groups_names=vm.drugsGroups.map(function(el){return el.name}),drugs_ids=vm.drugs.map(function(el){return el.id}),drugstores_ids=vm.listDrugstores.map(function(el){return el.id});vm.lockForm=!0,vm.missingDataMkSh=!1,data.drugstores_ids=drugstores_ids,data.drugs_groups_names=drugs_groups_names,data.drugs_ids=drugs_ids,data.period_start_date=moment(period[0]).format("YYYY-MM-DD"),data.period_end_date=moment(period[1]).format("YYYY-MM-DD"),campaignsDataservice.getKamsoftMarketShareReports(data).then(function(reports){var checkProblem,result={},market_share_reports=reports.market_share_reports,sell_out_reports=reports.sell_out_reports,drug_id=drugs_ids.length?drugs_ids[0]:null;vm.lockForm=!1,checkProblem=checkProblemsMkShResult(market_share_reports,sell_out_reports,drugstores_ids,!0,drug_id),checkProblem.isProblem?(vm.missDrugstores&&vm.missDrugstores.length&&vm.new_market_share_reports&&vm.new_sell_reports&&(vm.missingDataMkSh=!0,notifier.animateSemantic(".mk_sh_add_data","jiggle",function(){})),$rootScope.$broadcast("getKamSoftMkShError",checkProblem.data)):(result=calculateMkSh(market_share_reports,sell_out_reports),$rootScope.$broadcast("getKamSoftMkSh",result))},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.storeKamsoftMissingData=function(period){var result;vm.applyAverageData=!1,vm.missDrugstores&&vm.missDrugstores.length&&(vm.missDrugstores.forEach(function(obj){obj.campaign_id=vm.campaignId,obj.staff_id=vm.userData.id,obj.date_start=moment(period[0]).format("YYYY-MM-DD"),obj.date_end=moment(period[1]).format("YYYY-MM-DD")}),vm.lockForm=!0,campaignsDataservice.storeKamsoftMissingData(vm.missDrugstores).then(function(res){vm.lockForm=!1,vm.new_market_share_reports&&vm.new_sell_reports&&(result=calculateMkSh(vm.new_market_share_reports,vm.new_sell_reports),vm.applyAverageData=vm.missDrugstores.length,$rootScope.$broadcast("getKamSoftMkSh",result),vm.missingDataMkSh=!1,vm.missDrugstores=[],vm.new_market_share_reports=null)},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)}))},activate(),$scope.loadPhoto=function(elem,obj){var file=elem.files[0],reader=(angular.element(elem),new FileReader);obj||(obj={}),reader.onload=function(e){var tempImg=new Image;tempImg.src=reader.result,obj.src="",tempImg.onload=function(){var canvas,ctx,maxWidth=800,maxHeight=800,tempWidth=tempImg.width,tempHeight=tempImg.height;tempWidth>tempHeight?tempWidth>maxWidth&&(tempHeight*=maxWidth/tempWidth,tempWidth=maxWidth):tempHeight>maxHeight&&(tempWidth*=maxHeight/tempHeight,tempHeight=maxHeight),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),canvas.width=tempWidth,canvas.height=tempHeight,ctx.drawImage(this,0,0,tempWidth,tempHeight),$timeout(function(){obj.value=canvas.toDataURL("image/jpeg"),obj.src=canvas.toDataURL("image/jpeg"),obj.name=file.name},0)}},file&&reader.readAsDataURL(file)}}angular.module("app.campaigns").controller("CampaignsPagesController",CampaignsPagesController),CampaignsPagesController.$inject=["$rootScope","$scope","$state","campaignsDataservice","localDBService","stepsService","$sessionStorage","notifier","$timeout","MessagesManager","getDataCampaignPages","TEXT_MESSAGE","OFFLINE_MODE","clientsDataservice"]}(),function(){"use strict";function CampaignsArgsForClientController($scope,campaignsDataservice,GIFT_IMAGES_PATH,notifier,TEXT_MESSAGE){function checkProblems(){var isCan=!0;return vm.messageSelling=null,vm.parent.countMainOffices>1?(isCan=!1,vm.messageSelling="This NetWork has "+vm.parent.countMainOffices+" Drugstores with negotiation_point"):vm.parent.campaignProgressActiveId||(vm.messageSelling=!vm.parent.campaignProgress||"completed"!=vm.parent.campaignProgress.campaign_status&&"completed_cycle"!=vm.parent.campaignProgress.campaign_status?"Kampania nie jest aktywna":vm.messageSelling="Gratulujemy - kampania"+("completed_cycle"==vm.parent.campaignProgress.campaign_status?" (cykl)":"")+" została zakończona!"),vm.messageSelling&&(vm.messageSellingClass="negative-text",vm.pageReadOnly=!0),isCan}function getProposalSelling(callback,drugsIds){var campaignProgress=vm.parent.campaignProgress&&"pending"!=vm.parent.campaignProgress.campaign_status?vm.parent.campaignProgress.id:null,requestData={},dataProposal=campaignProgress?vm.parent.campaignProposal:[],data=[],definition=null;campaignProgress?(requestData={campaign_id:vm.campaignId,campaignProgressId:campaignProgress,step_id:vm.uid,drugstore_id:vm.drugstoreId,count_drugs:vm.parent.drugs.length,is_prev_step:!1,is_final:!1},campaignsDataservice.getSellingInfo(requestData).then(function(result){if(data=result.data?result.data:[],vm.dataSellingInfo=data,dataProposal.length){definition=dataProposal[0].definition;try{definition=JSON.parse(definition)}catch(e){}}callback(data,definition)},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})):callback(data,definition)}function setArgsForClient(){var drugs=angular.copy(vm.parent.drugs),isCan=checkProblems();vm.percentDays=0,vm.campaignDaysBeforeEnd=0,vm.loading=!1,vm.cyclePercentDays=0,vm.cycleDaysBeforeEnd=0,vm.properties={},vm.percentPoints=0,vm.dominant="sell_in"==vm.parent.dominant?"sellIn":"sellOut",vm.useMatrix=!0,setCampaignKnob(),vm.pageSellingInfo&&vm.pageSellingInfo.ds_drugstore_use_matrix&&(vm.useMatrix=stringToBoolean(vm.pageSellingInfo.ds_drugstore_use_matrix.use_matrix)),vm.groupBy||(vm.groupBy=angular.copy(vm.parent.drugsGroups),vm.groupBy.forEach(function(group){var drugstoreMatrix;vm.properties[group.id]||(vm.properties[group.id]={sellIn:"",sellOut:"",gain_percent_done:[]}),vm.pageSellingInfo&&(vm.properties[group.id]={sellIn:vm.pageSellingInfo["ds_drugs_group_slider_sell_in_"+group.id]?vm.pageSellingInfo["ds_drugs_group_slider_sell_in_"+group.id]:{number_values:[]},sellOut:vm.pageSellingInfo["ds_drugs_group_slider_sell_out_"+group.id]?vm.pageSellingInfo["ds_drugs_group_slider_sell_out_"+group.id]:{number_values:[]},gain_percent_done:vm.pageSellingInfo["ds_gain_percent_done_"+group.id]?vm.pageSellingInfo["ds_gain_percent_done_"+group.id]:[]},vm.pageSellingInfo["ds_drugs_group_gain_percent_matrix_"+group.id]&&vm.pageSellingInfo["ds_drugs_group_gain_percent_matrix_"+group.id].drugstores&&(drugstoreMatrix=vm.pageSellingInfo["ds_drugs_group_gain_percent_matrix_"+group.id].drugstores.filter(function(elMatrix){return elMatrix.drugstores.indexOf(vm.drugstoreId)>-1}),drugstoreMatrix.length&&(drugstoreMatrix=drugstoreMatrix[0],vm.properties[group.id].gain_percent_done=drugstoreMatrix.matrix))),group.groups=[],group.drugs.forEach(function(drugId){var drug=drugs.filter(function(drug){return drug.id==drugId});drug.length&&group.groups.push(drug[0])})})),isCan&&getProposalSelling(initArgsInfo)}function initArgsInfo(data,dataProposal){var groupsProperties=vm.step.pages[vm.templateIndex].properties||null;vm.loading=!0,vm.totalSellIn=0,vm.totalSellOut=0,vm.totalSellInPoints=0,vm.totalSellOutPoints=0,vm.totalSellArgs=0,vm.totalSellArgsPoints=0,vm.groupBy.forEach(function(group,index){var initDrugPotential=[];vm.properties[group.id];group.amountDrugs={sellIn:0,sellOut:0},group.sellIn={label:groupsProperties["ds_drugs_group_slider_sell_in_"+group.id]?groupsProperties["ds_drugs_group_slider_sell_in_"+group.id]:"Sell In",visible:!groupsProperties["ds_drugs_group_slider_sell_in_"+group.id]||stringToBoolean(groupsProperties["ds_drugs_group_slider_sell_in_"+group.id].visible),type:"single",values:{vals:"",earns:[],valsMultiple:[]},number_values:[],startValue:0,endValue:100,from:0,money:0,sign:"Zł",name:"sellIn"},group.sellOut={label:groupsProperties["ds_drugs_group_slider_sell_out_"+group.id]?groupsProperties["ds_drugs_group_slider_sell_out_"+group.id]:"Sell Out",visible:!groupsProperties["ds_drugs_group_slider_sell_out_"+group.id]||stringToBoolean(groupsProperties["ds_drugs_group_slider_sell_out_"+group.id].visible),type:"single",values:{vals:"",earns:[],valsMultiple:[]},number_values:[],startValue:0,endValue:100,from:0,money:0,sign:"Zł",name:"sellOut"},group.groups.forEach(function(drug){var initDrug;drug.sellIn=0,drug.sellOut=0,data&&(initDrug=data.filter(function(el){return el.drug_id==drug.id}),initDrug.length&&(drug.sellIn=initDrug[0].sell_in/vm.multiplier,drug.sellOut=initDrug[0].sell_out/vm.multiplier,group.sellIn.visible&&(group.amountDrugs.sellIn+=calculateDrug(drug,"sellIn")),group.sellOut.visible&&(group.amountDrugs.sellOut+=calculateDrug(drug,"sellOut"))))}),dataProposal&&dataProposal.groups&&(initDrugPotential=dataProposal.groups.filter(function(el){return el.group_id==group.id})),setGroupProperties(group,initDrugPotential),group[vm.dominant].values.earns.length&&(group[vm.dominant].default_earns=angular.copy(group[vm.dominant].values.earns)),calculateGroup(group),group.sellIn.visible&&group.sellOut.visible&&("sellIn"==vm.dominant?("P"!=group.sellIn.sign?vm.totalSellIn+=parseFloat(group.sellIn.money):vm.totalSellInPoints+=parseInt(group.sellIn.money),group.sellOut.money=0):("P"!=group.sellOut.sign?vm.totalSellOut+=parseFloat(group.sellOut.money):vm.totalSellOutPoints+=parseInt(group.sellOut.money),group.sellIn.money=0))}),vm.totalSellArgs=parseFloat(vm.totalSellIn)+parseFloat(vm.totalSellOut),vm.totalSellArgsPoints=vm.totalSellInPoints+vm.totalSellOutPoints,setArgsGifts(dataProposal)}function setGroupProperties(group,initPotential){var propSellIn=vm.pageProposal?vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id]:{},propSellOut=vm.pageProposal?vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id]:{};setProposalProperties(group,"sellIn",initPotential,propSellIn),setProposalProperties(group,"sellOut",initPotential,propSellOut),!group.sellOut.agreedPotential&&group.sellIn.agreedPotential&&(group.sellOut.agreedPotential=group.sellIn.agreedPotential),!group.sellIn.agreedPotential&&group.sellOut.agreedPotential&&(group.sellIn.agreedPotential=group.sellOut.agreedPotential),group.sellIn.visible&&setSellingProperties(group,"sellIn",propSellIn),group.sellOut.visible&&setSellingProperties(group,"sellOut",propSellOut)}function setProposalProperties(group,fieldName,initPotential,proposalProperties){var sing="sellIn"==fieldName?"signIn":"signOut";capitalizeFirstLetter(fieldName);group[fieldName].stableEarns=!1,proposalProperties&&(group[fieldName].sign="points"==proposalProperties.earned?"P":group.currency?group.currency:"Zł",group[fieldName].declarated_in=proposalProperties.declarated_in,group[fieldName].showPercent="percent"==group[fieldName].declarated_in,group[fieldName].gain_percent_agreed=proposalProperties.gain_percent_agreed,proposalProperties.number_values&&proposalProperties.number_values.length&&(group[fieldName].number_values=proposalProperties.number_values.map(function(prop){return prop.declaratedValue}),(proposalProperties.earn_stable_quota||"points"==proposalProperties.earned)&&(group[fieldName].stableEarns=!0,group[fieldName].values.earns=proposalProperties.number_values.filter(function(prop){return prop.declaratedEarnings||!1}).map(function(prop){return prop.declaratedEarnings})))),initPotential.length&&(initPotential=initPotential[0],group[fieldName].sign=initPotential[sing]||"Zł",group[fieldName].newPotential=initPotential[fieldName]||0,group[fieldName].earns=initPotential[fieldName+"Earns"]||0,group[fieldName].agreedPotential=initPotential[fieldName+"AgreedPotential"]||0,group[fieldName].percent=initPotential[fieldName+"Percent"]||100,group[fieldName].earnsVals=initPotential[fieldName+"EarnsVals"]||[],group[fieldName].from=initPotential[fieldName+"From"]||0)}function setSellingProperties(group,fieldName,proposalProperties){var redefineDrugstore,drugstoresProperties,number_values=[],sellingProperties=vm.properties[group.id];group[fieldName].stableEarns=sellingProperties[fieldName].earn_stable_quota||"points"==sellingProperties[fieldName].earned,sellingProperties[fieldName]&&sellingProperties[fieldName].number_values&&(number_values=sellingProperties[fieldName].number_values.map(function(prop){return prop.declaratedValue}),redefineDrugstore=vm.parent.getDrugstoresGroup(vm.drugstoreId),redefineDrugstore.length&&sellingProperties[fieldName].drugstores&&(redefineDrugstore=redefineDrugstore[0],drugstoresProperties=sellingProperties[fieldName].drugstores.filter(function(el){return el.group_id==redefineDrugstore.id}),drugstoresProperties.length&&(drugstoresProperties=drugstoresProperties[0],drugstoresProperties.number_values&&drugstoresProperties.number_values.length&&(number_values=drugstoresProperties.number_values.map(function(prop,index){var elGroup=sellingProperties[fieldName].number_values[index]||null;return prop.declaratedEarnings=0,elGroup&&elGroup.declaratedEarnings&&(prop.declaratedEarnings=elGroup.declaratedEarnings),prop.declaratedValue}),sellingProperties[fieldName].number_values=drugstoresProperties.number_values)))),number_values.length&&(group[fieldName].number_values=number_values,group[fieldName].default_values=number_values,group[fieldName].startValue=number_values[0],number_values.length>=2&&(group[fieldName].endValue=number_values[number_values.length-1],group[fieldName].values.vals=number_values.join(","))),group[fieldName].values.valsMultiple=group[fieldName].values.vals,group[fieldName].startMultiple=group[fieldName].startValue,group[fieldName].endMultiple=group[fieldName].endValue}function calculateGroup(group){var amountDrugs=group.amountDrugs,gained_percent=0,calculateFieldGroup=function(fieldName){var compareNumber,min,addMinElement;capitalizeFirstLetter(fieldName);angular.isDefined(group[fieldName].realProgress)||(group[fieldName].realProgress=0),group[fieldName].agreedPotential&&(group[fieldName].realProgress=parseInt(campaignsDataservice.calcSelling(amountDrugs[fieldName],group[fieldName].agreedPotential))),group[fieldName].number_values&&group[fieldName].number_values.length&&(compareNumber=group[fieldName].realProgress,min=findMinRang(compareNumber,group[fieldName].number_values),group[fieldName].minValue=min.min,group[fieldName].from=0,group[fieldName].minValue?(group[fieldName].from=group[fieldName].number_values.indexOf(group[fieldName].minValue),group[fieldName].from==-1&&(group[fieldName].from=0),amountDrugs[fieldName]=parseFloat(group[fieldName].agreedPotential*group[fieldName].minValue/100)):(addMinElement=group[fieldName].realProgress,group[fieldName].number_values.unshift(addMinElement),group[fieldName].from=0,group[fieldName].values.vals=group[fieldName].number_values.join(","),group[fieldName].values.valsMultiple=group[fieldName].values.vals,group[fieldName].startValue=group[fieldName].number_values[0],group[fieldName].length>=2&&(group[fieldName].endValue=group[fieldName][group[fieldName].number_values.length-1]),amountDrugs[fieldName]=0))};group.sellIn.visible&&calculateFieldGroup("sellIn"),group.sellOut.visible&&calculateFieldGroup("sellOut"),gained_percent=getPercent(group),calculateGroupMoney(group,amountDrugs[vm.dominant],gained_percent,vm.dominant)}function getPercent(group){var min,gained_percent=0,groupProperties=vm.properties[group.id];return group[vm.dominant].number_values.length&&(min=findMinRang(group[vm.dominant].realProgress,group[vm.dominant].number_values),group[vm.dominant].minValue=min.min,vm.useMatrix?gained_percent=getMatrix(group):group[vm.dominant].minValue&&(gained_percent=group[vm.dominant].stableEarns?group[vm.dominant].realProgress:groupProperties[vm.dominant].gain_percent_agreed||0)),gained_percent}function calculateGroupMoney(group,amountDrugs,gained_percent,fieldName){isNaN(amountDrugs)&&(amountDrugs=0),group[fieldName]&&(group[fieldName].stableEarns?group[fieldName].earns&&(group[fieldName].money=parseFloat(campaignsDataservice.calcEarns(group[fieldName].earns,gained_percent))):group[fieldName].money=parseFloat(campaignsDataservice.calcEarns(amountDrugs,gained_percent)))}function calculateDrug(drug,fieldName){var numSell=drug[fieldName];return numSell||(numSell=0),parseFloat(campaignsDataservice.calcAmountForDrug(numSell,drug.price))}function getMatrixField(group,fieldName,realProgress){var compareNumber,idField,findMatrixValue,groupProperties=vm.properties[group.id],fieldNameInMatrix="sellIn"==fieldName?"sell_in":"sell_out",gained_percent=0;return compareNumber=realProgress,group[fieldName+"MinValue"]=findMinRang(compareNumber,groupProperties[fieldName].number_values,"declaratedValue").min,idField=group[fieldName+"MinValue"].id||0,findMatrixValue=groupProperties.gain_percent_done.filter(function(el){return el[fieldNameInMatrix+"_id"]==idField}),findMatrixValue.length&&1==findMatrixValue.length&&(gained_percent=parseInt(findMatrixValue[0].gained_percent),console.log("only "+fieldName+" in matrix gained_percent=",gained_percent)),{id:idField,gained_percent:gained_percent}}function getMatrix(group){var groupProperties=vm.properties[group.id],findMatrixValue=[],gained_percent=0,def_percent=group[vm.dominant].gain_percent_agreed||group[vm.dominant].percent||0,realProgress={sellIn:group.sellIn.realProgress,sellOut:group.sellOut.realProgress},result={sellIn:{},sellOut:{}};return group.sellInMinValue=-1,group.sellOutMinValue=-1,group.sellIn.visible&&group.sellIn.number_values&&group.sellIn.number_values.length&&(result.sellIn=getMatrixField(group,"sellIn",realProgress.sellIn),!group.sellOut.visible)?result.sellIn.gained_percent:group.sellOut.visible&&group.sellOut.number_values&&group.sellOut.number_values.length&&(result.sellOut=getMatrixField(group,"sellOut",realProgress.sellOut),!group.sellIn.visible)?result.sellOut.gained_percent:(group.sellIn.visible&&group.sellOut.visible&&result.sellIn.id&&result.sellOut.id&&(findMatrixValue=groupProperties.gain_percent_done.filter(function(el){return el.sell_in_id==result.sellIn.id&&el.sell_out_id==result.sellOut.id}),findMatrixValue.length&&(gained_percent=parseInt(findMatrixValue[0].gained_percent),isNaN(gained_percent)&&(gained_percent=def_percent),console.log(group.name," sellIn minValue in matrix = ",group.sellInMinValue.declaratedValue," sellOut minValue in matrix = ",group.sellOutMinValue.declaratedValue," gained_percent=",gained_percent))),gained_percent)}function getMaxPossiblePoints(group){var maxPercent,maxEarned=0;return vm.maxEarnedPoints||(vm.maxEarnedPoints=0),group.sellIn.number_values&&group.sellIn.number_values.length&&(group.sellIn.from=group.sellIn.number_values.length-1,group.sellIn.realProgress=group.sellIn.number_values[group.sellIn.from]),group.sellOut.number_values&&group.sellOut.number_values.length&&(group.sellOut.from=group.sellOut.number_values.length-1,group.sellOut.realProgress=group.sellOut.number_values[group.sellOut.from]),maxPercent=getPercent(group),calculateGroupMoney(group,0,maxPercent,vm.dominant),maxEarned=parseInt(group[vm.dominant].money*vm.multiplier),vm.maxEarnedPoints+=maxEarned,maxEarned}function maxArgsGiftsPoints(){var total=0;return vm.groupBy&&vm.groupBy.forEach(function(group){var maxEarned;"P"==group[vm.dominant].sign&&(maxEarned=getMaxPossiblePoints(angular.copy(group)),total+=parseInt(group[vm.dominant].money*vm.multiplier))}),total}function setArgsGifts(dataProposal){var elDropped={},colors=["green","yellow","red","purple","orange"],amounts=[10,2,3,8,100],indexColor=0;vm.reservePoints=0,vm.giftsArgs||(vm.giftsArgs=[],vm.giftsDropped=[],vm.campaign.gifts.forEach(function(gift,index){var initGift=[],initGiftReserved=[],arrName=[];dataProposal&&(dataProposal.gifts&&(initGift=dataProposal.gifts.filter(function(el){return el.id==gift.id})),dataProposal.giftsReserved&&(initGiftReserved=dataProposal.giftsReserved.filter(function(el){return el.id==gift.id}))),gift.image="",gift.title=gift.name,arrName=gift.name.split(" "),gift.name=arrName.length>1?arrName[0]:gift.name,(index-1)%5==4||0===index?indexColor=0:indexColor++,gift.color=colors[indexColor],gift.amount=amounts[indexColor],initGift.length&&(initGift[0].filename&&(gift.image=GIFT_IMAGES_PATH+initGift[0].filename),initGift[0].amount&&(gift.amount=initGift[0].amount),initGift[0].points&&(gift.points=initGift[0].points)),initGiftReserved.length&&(elDropped=gift,elDropped.amountDropped=initGiftReserved[0].amountDropped,elDropped.pointsDropped=initGiftReserved[0].pointsDropped,vm.giftsDropped.push(elDropped),vm.reservePoints+=elDropped.pointsDropped,gift.amount-elDropped.amountDropped>=0&&(gift.amount-=elDropped.amountDropped)),vm.giftsArgs.push(gift)}),vm.earnedPoints=maxArgsGiftsPoints(),setGiftsKnob())}function setCampaignKnob(){var diffDaysFromStart,campaignDays;calcTime()>=calcTime(vm.campaign.date_end)?diffDaysFromStart=calculatePassedDays(vm.campaign.date_start,vm.campaign.date_end):(diffDaysFromStart=calculatePassedDays(vm.campaign.date_start),vm.campaignDaysBeforeEnd=calculatePassedDays(vm.campaign.date_end)),campaignDays=calculatePassedDays(vm.campaign.date_start,vm.campaign.date_end),campaignDays>=diffDaysFromStart&&campaignDays>0&&(vm.percentDays=parseInt(diffDaysFromStart/campaignDays*100))}function setGiftsKnob(){vm.maxEarnedPoints&&(vm.percentPoints=parseInt(vm.earnedPoints/vm.maxEarnedPoints*100))}function activate(){var foundPageSelling,pageProposal=[];vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.campaignId=vm.parent.campaignId,vm.campaign=vm.parent.campaign,vm.drugstore=vm.parent.drugstore,vm.step=vm.parent.step,vm.page=vm.step.pages[vm.templateIndex],vm.uid=vm.step.unique_id,vm.multiplier=vm.parent.multiplier||1,foundPageSelling=vm.step.pages.find(function(page){return"selling_info"==page.type}),foundPageSelling?vm.pageSellingInfo=foundPageSelling.properties:(foundPageSelling=getObjectByKey(vm.parent.steps,"type","selling_info"),foundPageSelling.length&&(vm.pageSellingInfo=foundPageSelling[0].properties)),pageProposal=getObjectByKey(vm.parent.steps,"type","proposal"),pageProposal.length&&(vm.pageProposal=pageProposal[0].properties),setArgsForClient()}var vm=this;vm.changeArgsSlider=function(data,index,group,name){var otherName="sellIn"==name?"sellOut":"sellIn",gain_percent=null,field=group&&name&&group[name]?group[name]:{},otherField=group[otherName]?group[otherName]:{},totalPoints=0;field.number_values[data]&&(field.realProgress=field.number_values[data],group.amountDrugs[name]=parseFloat(field.agreedPotential*field.realProgress/100)),otherField.number_values[otherField.from]&&(otherField.realProgress=otherField.number_values[otherField.from],group.amountDrugs[otherName]=parseFloat(otherField.agreedPotential*otherField.realProgress/100)),$scope.$apply(function(){field&&(field.from=data,gain_percent=getPercent(group),calculateGroupMoney(group,group.amountDrugs[vm.dominant],gain_percent,vm.dominant),vm.maxEarnedPoints&&(totalPoints=vm.getArgsVariesAmount().totalPoints,vm.percentPoints=parseInt(totalPoints*vm.multiplier/vm.maxEarnedPoints*100)))})},vm.getArgsVariesAmount=function(){var total=0,result={total:0,totalPoints:0};return vm.totalSellInVaries=0,vm.totalSellOutVaries=0,vm.totalSellInVariesPoints=0,vm.totalSellOutVariesPoints=0,vm.groupBy&&(vm.groupBy.forEach(function(el){el.sellIn||(el.sellIn={money:0}),el.sellOut||(el.sellOut={money:0}),"P"!=el.sellIn.sign?vm.totalSellInVaries+=parseFloat(el.sellIn.money):vm.totalSellInVariesPoints+=parseFloat(el.sellIn.money),"P"!=el.sellOut.sign?vm.totalSellOutVaries+=parseFloat(el.sellOut.money):vm.totalSellOutVariesPoints+=parseFloat(el.sellOut.money)}),total=parseFloat(vm.totalSellInVaries)+parseFloat(vm.totalSellOutVaries)),result.total=total,result.totalPoints=vm.totalSellInVariesPoints+vm.totalSellOutVariesPoints,result},vm.showGiftInfo=function(obj){vm.showGift=obj,angular.element("#showGift").modal("show")},activate()}angular.module("app.campaigns").controller("CampaignsArgsForClientController",CampaignsArgsForClientController),CampaignsArgsForClientController.$inject=["$scope","campaignsDataservice","GIFT_IMAGES_PATH","notifier","TEXT_MESSAGE"]}(),function(){"use strict";function CampaignsConferenceInvitationController($scope,$state,campaignsDataservice,notifier,principal){function setInvitation(){var ids=[];vm.cities||vm.page.properties.ds_invitations_assigned_cities&&vm.page.properties.ds_invitations_assigned_cities.cities.length&&(ids=vm.page.properties.ds_invitations_assigned_cities.cities,campaignsDataservice.getCities(ids).then(function(cities){vm.cities=cities}))}function activate(){vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.drugstore=vm.parent.drugstore,vm.step=vm.parent.step,vm.page=vm.step.pages[vm.templateIndex],vm.uid=vm.step.unique_id,setInvitation()}var vm=this;activate()}angular.module("app.campaigns").controller("CampaignsConferenceInvitationController",CampaignsConferenceInvitationController),CampaignsConferenceInvitationController.$inject=["$scope","$state","campaignsDataservice","notifier","principal"]}(),function(){"use strict";function CampaignsDrugstoresListController($scope,$state,campaignsDataservice,clientsDataservice,notifier,TEXT_MESSAGE){function setDrugstoresList(){vm.unassignDrugstores=[],vm.drugstores=[],vm.drugstore.drugstores_network_id?vm.campaign.drugstores.forEach(function(drugstore){vm.drugstore.drugstores_network_id==drugstore.drugstores_network_id&&(drugstore.checked=!0,drugstore.disabled=!1,drugstore.address&&(drugstore.addressLine1=drugstore.address.address_line_1,drugstore.zip=drugstore.address.zip,drugstore.cityName=drugstore.address.city?drugstore.address.city.name:""),vm.drugstores.push(drugstore))}):(vm.drugstores.push(vm.drugstore),vm.drugstore.address&&vm.drugstore.address.city&&(vm.drugstores[0].cityName=vm.drugstore.address.city.name,vm.drugstores[0].zip=vm.drugstore.address.city.zip,vm.drugstores[0].addressLine1=vm.drugstore.address.city.addressLine1),vm.drugstores[0].disabled=!0,vm.drugstores[0].checked=!0)}function activate(){vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.campaignId=vm.parent.campaignId,vm.step=vm.parent.step,vm.page=vm.step.pages[vm.templateIndex],vm.uid=vm.step.unique_id,vm.drugstore=vm.parent.drugstore,vm.campaign=vm.parent.campaign,vm.lockForm=!1,setDrugstoresList()}var vm=this;vm.selectedDrugstoresList=function(){vm.drugstores.forEach(function(el){var index=vm.unassignDrugstores.indexOf(el.id);el.checked!==!0?index==-1&&vm.unassignDrugstores.push(el.id):index!==-1&&vm.unassignDrugstores.splice(index,1)})},vm.detachDrugstoresConfirm=function(){vm.unassignDrugstores.length?angular.element("#detachDrugstoresList").modal("show"):notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED)},vm.saveSelectedDrugstores=function(){vm.unassignDrugstores.length&&(vm.lockForm=!0,campaignsDataservice.saveDrugstoresList(vm.campaignId,vm.unassignDrugstores).then(function(data){var networkDrugStores;vm.lockForm=!1,notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),vm.campaign.drugstores=vm.campaign.drugstores.filter(function(obj){return vm.unassignDrugstores.indexOf(obj.id)===-1}),vm.unassignDrugstores=[],vm.parent.listDrugstores=[],vm.parent.listDrugstores.push(vm.parent.drugstore),vm.parent.drugstore.drugstores_network_id&&(networkDrugStores=vm.parent.getNetworkDrugstores(),vm.parent.drugstore.negotiation_point&&(vm.parent.listDrugstores=networkDrugStores)),vm.refresh()},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)}))},vm.refresh=function(){$state.go($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})},vm.isNegotiationPoint=function(drugstore){return clientsDataservice.isNegotiationPoint(drugstore)},activate()}angular.module("app.campaigns").controller("CampaignsDrugstoresListController",CampaignsDrugstoresListController),CampaignsDrugstoresListController.$inject=["$scope","$state","campaignsDataservice","clientsDataservice","notifier","TEXT_MESSAGE"]}(),function(undefined){"use strict";function CampaignsFinalReportController($q,$rootScope,$scope,campaignsDataservice,localDBService,notifier,$sessionStorage,GIFT_IMAGES_PATH,stepsService,DocumentsWorkflowManager,TEXT_MESSAGE,EmailsManager,MERCH_IMAGES_PATH){function checkProblems(){var isCan=!0;return vm.parent.campaignProgressActiveId?vm.parent.isSignature?vm.parent.countMainOffices>1&&(vm.messageSelling="CAMPAIGN_MANY_MAIN_OFFICE",isCan=!1):vm.messageSelling="NOT_RIGHTS_FOR_EDIT":vm.messageSelling=!vm.parent.campaignProgress||"completed"!=vm.parent.campaignProgress.campaign_status&&"completed_cycle"!=vm.parent.campaignProgress.campaign_status?"CAMPAIGN_NOT_ACTIVE":vm.messageSelling="CAMPAIGN_FINISHED",vm.messageSelling&&setMessageProps(!0),isCan}function setMessageProps(isPageReadOnly){vm.messageSellingClass="negative-text",vm.pageReadOnly=isPageReadOnly}function isExistsPrevSellingInfo(){var prevStepsWithSelling,isPrevStep=!1,stepIndex=vm.parent.steps.findIndex(function(step){return step.unique_id==vm.uid});return stepIndex&&(prevStepsWithSelling=vm.parent.steps.filter(function(step,index){var sellingInfoPages=[];return index<stepIndex&&(sellingInfoPages=step.pages.filter(function(page){return"selling_info"==page.type})),sellingInfoPages.length}),isPrevStep=prevStepsWithSelling.length>0),isPrevStep}function getOfflineData(){var prevData,step_ids,data=localDBService.getPageData("selling_info_"+vm.uid)||[],dataInvoice=localDBService.getPageData("invoice")||[],dataServiceControl=localDBService.getPageData("final_report_services")||[],fromPrevStep=!1,stepIndex=-1;if(!data.length&&(stepIndex=vm.parent.steps.findIndex(function(step){return step.unique_id==vm.uid}),step_ids=vm.parent.steps.map(function(el){return el.unique_id}),stepIndex!=-1&&step_ids.length>1))for(var i=0,len=step_ids.length;i<len;i++)if(i<stepIndex&&(prevData=localDBService.getPageData("selling_info_"+step_ids[i]),prevData.length)){data=prevData,localDBService.setPageData("selling_info_"+vm.uid,data),fromPrevStep=!0;break}setFinRepData(data,fromPrevStep,dataInvoice,dataServiceControl)}function getNecessaryData(){var campaignProgress=vm.parent.campaignProgress&&"pending"!=vm.parent.campaignProgress.campaign_status?vm.parent.campaignProgress.id:null,isPrevStep=!1,requestData={};campaignProgress?(vm.cycleStart=vm.parent.campaignProgress.cycle_date_start,vm.cycleEnd=vm.parent.campaignProgress.cycle_date_end,isPrevStep=isExistsPrevSellingInfo(),requestData={campaign_id:vm.campaignId,campaignProgressId:campaignProgress,step_id:vm.uid,drugstore_id:vm.drugstoreId,count_drugs:vm.parent.drugs?vm.parent.drugs.length:0,is_prev_step:isPrevStep,is_final:!0},vm.dataFromKamSoft=vm.parent.campaign.kamsoft_qr_code_is_on,vm.canEditData=!vm.dataFromKamSoft,vm.kamSoftPicture={},campaignsDataservice.getSellingInfo(requestData).then(function(result){var drugstoresIds,kam_soft_data,fromPrevStep=!!result.from_prev_step&&result.from_prev_step,dataInvoice=result.invoice?result.invoice:[],kam_soft=result.kam_soft,kamSoftMkSh=result.kam_soft_mk_sh,dataProposalContract=result.proposal_contract?result.proposal_contract:{};
dataProposalContract&&dataProposalContract.cp_id&&(vm.proposalContractName=dataProposalContract.cp_id),result.drugstores&&result.drugstores.length&&(vm.drugstores=result.drugstores,vm.drugstores.length!=vm.parent.listDrugstores.length&&vm.parent.setServicesMultipliers(vm.drugstores)),drugstoresIds=vm.drugstores.length>1?vm.drugstores.map(function(el){return el.id}):[vm.drugstoreId],kam_soft&&kam_soft.length&&(kam_soft_data=kam_soft.find(function(el){return"finrep"==el.page}),vm.kamSoftPicture={},kam_soft_data&&(vm.kamSoftPicture.src=MERCH_IMAGES_PATH+kam_soft_data.kamsoft_img_file,vm.kamSoftPicture.id=kam_soft_data.kamsoft_img_id)),kamSoftMkSh&&setKamSoftMkSh(kamSoftMkSh),campaignsDataservice.getServicesByDrugstores(drugstoresIds,vm.campaignId,campaignProgress).then(function(dataServiceControl){setFinRepData(result.data,fromPrevStep,dataInvoice,dataServiceControl)},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})):(hideDimmer(),vm.parent.services.length&&setServices(vm.parent.services,[]))}function setFinRepData(sellingData,fromPrevStep,dataInvoice,dataServiceControl){var definition,dataProposal=vm.parent.campaignProposal;if(vm.dataSellingInfo=[],fromPrevStep?(vm.selling_style={},vm.selling_style.color="#0000FF"):vm.dataSellingInfo=sellingData,vm.dataForFinRep={},dataInvoice.length)try{vm.dataForFinRep=JSON.parse(dataInvoice[0].definition),vm.dataForFinRep.payment_data&&"within_dates_and_unblocked"==vm.step.status&&(vm.step.isStepStart=!0)}catch(e){}if(dataProposal.length){definition=dataProposal[0].definition;try{definition=JSON.parse(definition)}catch(e){}}dataServiceControl.length&&dataServiceControl.forEach(function(el){try{el.definition=JSON.parse(el.definition),el.definition.length&&(el.definition=el.definition[0])}catch(e){}}),setFinRepDefinitions(sellingData,definition,dataServiceControl),vm.waiting=!1,vm.isGenerated=DocumentsWorkflowManager.checkIfDocIsSaved(),vm.isSendToCompany=vm.isGenerated&&"rejected"!=vm.step.status}function setFinalReport(){var drugsProperties=vm.page.properties||{},drugs=cloneObj(vm.parent.drugs),isCan=checkProblems();vm.column={sellIn:{label:drugsProperties.ds_drug_sell_in_column?drugsProperties.ds_drug_sell_in_column.label:"Sell In",visibility:!drugsProperties.ds_drug_sell_in_column||stringToBoolean(drugsProperties.ds_drug_sell_in_column.visible)},sellOut:{label:drugsProperties.ds_drug_sell_out_column?drugsProperties.ds_drug_sell_out_column.label:"Sell Out",visibility:!drugsProperties.ds_drug_sell_out_column||stringToBoolean(drugsProperties.ds_drug_sell_out_column.visible)},stock:{label:drugsProperties.ds_drug_stock_column?drugsProperties.ds_drug_stock_column.label:"Stock",visibility:!drugsProperties.ds_drug_stock_column||stringToBoolean(drugsProperties.ds_drug_stock_column.visible)},btn_photo:{label:drugsProperties.ds_final_report_photo_button?drugsProperties.ds_final_report_photo_button.label:"Photo",visible:!drugsProperties.ds_final_report_photo_button||stringToBoolean(drugsProperties.ds_final_report_photo_button.visible)}},vm.finalReportPeriod={start:vm.parent.campaignProgress&&"multi"==vm.parent.campaignProgress.multi?vm.parent.period.end:calcTime(new Date(vm.step.date_start),!0),end:vm.parent.campaignProgress&&"multi"==vm.parent.campaignProgress.multi?new Date(new Date(vm.parent.period.end).setMonth(vm.parent.period.end.getMonth()+1)):calcTime(new Date(vm.step.date_end),!0)},vm.selling_style={},vm.allVisible=!0,vm.useMatrix=vm.pageSellingInfo&&vm.pageSellingInfo.ds_drugstore_use_matrix&&stringToBoolean(vm.pageSellingInfo.ds_drugstore_use_matrix.use_matrix),"undefined"==typeof vm.useMatrix&&(vm.useMatrix=!0),vm.dominant="sell_in"==vm.parent.dominant?"sellIn":"sellOut",vm.properties={},vm.sellInTotal=0,vm.sellOutTotal=0,vm.stockTotal=0,vm.sellInEarnsTotal=0,vm.sellOutEarnsTotal=0,vm.fixedAmountFinRep=0,vm.earnedInFixedAmount="money",vm.labelFixedAmount="Bonus",vm.pageProposal&&vm.pageProposal.ds_drugstore_bonus&&(vm.fixedAmountFinRep=vm.pageProposal.ds_drugstore_bonus.earnings,vm.earnedInFixedAmount=vm.pageProposal.ds_drugstore_bonus.earnedIn,vm.labelFixedAmount=vm.pageProposal.ds_drugstore_bonus.label,vm.visibleFixedAmount=stringToBoolean(vm.pageProposal.ds_drugstore_bonus.visible)),vm.sellInEarnsTotalPoints=0,vm.sellOutEarnsTotalPoints=0,vm.variesAmount=0,vm.variesAmountPoints=0,vm.totalAmount=0,vm.totalAmountPoints=0,vm.totalServices=0,vm.groupBy=cloneObj(vm.parent.drugsGroups),vm.groupBy.forEach(function(group,index){var drugstoreMatrix;vm.properties[group.id]||(vm.properties[group.id]=[]),vm.properties[group.id]={sellIn:vm.pageSellingInfo&&vm.pageSellingInfo["ds_drugs_group_slider_sell_in_"+group.id]?vm.pageSellingInfo["ds_drugs_group_slider_sell_in_"+group.id]:vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id]?vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id]:{},sellOut:vm.pageSellingInfo&&vm.pageSellingInfo["ds_drugs_group_slider_sell_out_"+group.id]?vm.pageSellingInfo["ds_drugs_group_slider_sell_out_"+group.id]:vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id]?vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id]:{},gain_percent_done:vm.pageSellingInfo&&vm.pageSellingInfo["ds_gain_percent_done_"+group.id]?vm.pageSellingInfo["ds_gain_percent_done_"+group.id]:[],earned_visibility:{sellIn:!0,sellOut:!0}},vm.properties[group.id].sellIn.visible&&(vm.properties[group.id].sellIn.visible=stringToBoolean(vm.properties[group.id].sellIn.visible),vm.properties[group.id].sellIn.earn_stable_quota||(vm.properties[group.id].sellIn.earn_stable_quota=!1)),vm.properties[group.id].sellOut.visible&&(vm.properties[group.id].sellOut.visible=stringToBoolean(vm.properties[group.id].sellOut.visible),vm.properties[group.id].sellOut.earn_stable_quota||(vm.properties[group.id].sellOut.earn_stable_quota=!1)),vm.pageSellingInfo["ds_drugs_group_gain_percent_matrix_"+group.id]&&vm.pageSellingInfo["ds_drugs_group_gain_percent_matrix_"+group.id].drugstores&&(drugstoreMatrix=vm.pageSellingInfo["ds_drugs_group_gain_percent_matrix_"+group.id].drugstores.filter(function(elMatrix){return elMatrix.drugstores.indexOf(vm.drugstoreId)>-1}),drugstoreMatrix.length&&(drugstoreMatrix=drugstoreMatrix[0],vm.properties[group.id].gain_percent_done=drugstoreMatrix.matrix)),vm.pageProposal&&(vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id]&&(vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].earned_visibility&&(vm.properties[group.id].earned_visibility.sellIn=stringToBoolean(vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].earned_visibility)),(vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].earn_stable_quota||"points"==vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].earned)&&(vm.properties[group.id].sellIn.earn_stable_quota=!0),vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].number_values&&(vm.properties[group.id].sellIn.number_values&&vm.properties[group.id].sellIn.number_values.length||(vm.properties[group.id].sellIn.number_values=vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].number_values),vm.properties[group.id].sellIn.earn_stable_quota&&vm.properties[group.id].sellIn.number_values.length&&!vm.properties[group.id].sellIn.number_values[0].declaratedEarnings&&vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].number_values.forEach(function(elProposal,index){var elGroupValue=vm.properties[group.id].sellIn.number_values[index]||null;elProposal.declaratedEarnings&&elGroupValue&&!elGroupValue.declaratedEarnings&&(elGroupValue.declaratedEarnings=elProposal.declaratedEarnings)}))),vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id]&&(vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].earned_visibility&&(vm.properties[group.id].earned_visibility.sellOut=stringToBoolean(vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].earned_visibility)),(vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].earn_stable_quota||"points"==vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].earned)&&(vm.properties[group.id].sellOut.earn_stable_quota=!0),vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].number_values&&(vm.properties[group.id].sellOut.number_values&&vm.properties[group.id].sellOut.number_values.length||(vm.properties[group.id].sellOut.number_values=vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].number_values),vm.properties[group.id].sellOut.earn_stable_quota&&vm.properties[group.id].sellOut.number_values.length&&!vm.properties[group.id].sellOut.number_values[0].declaratedEarnings&&vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].number_values.forEach(function(elProposal,index){var elGroupValue=vm.properties[group.id].sellOut.number_values[index]||null;elProposal.declaratedEarnings&&elGroupValue&&!elGroupValue.declaratedEarnings&&(elGroupValue.declaratedEarnings=elProposal.declaratedEarnings)})))),group.groups=[],group.drugs.forEach(function(drugId){var drug=drugs.filter(function(drug){return drug.id==drugId});drug.length&&group.groups.push(drug[0])})}),vm.parent.offlineMode?getOfflineData():isCan?getNecessaryData():hideDimmer()}function setFinRepDefinitions(data,dataProposal,dataServiceControl){var variesAmount;calculateSellingInfo(data,dataProposal),vm.parent.services.length&&setServices(vm.parent.services,dataServiceControl,dataProposal),variesAmount=vm.variesAmount?parseFloat(vm.variesAmount*vm.multiplier):0,vm.page.properties.ds_btn_who_fills_the_report&&vm.page.properties.ds_btn_who_fills_the_report.who_fills_the_report&&(vm.fillsByRep="representant"==vm.page.properties.ds_btn_who_fills_the_report.who_fills_the_report,vm.fillsByDruggist="druggist"==vm.page.properties.ds_btn_who_fills_the_report.who_fills_the_report),vm.dataForFinRep&&vm.dataForFinRep.payment_data&&angular.isDefined(vm.dataForFinRep.payment_data.by_network)&&null===vm.totalAmountCopy&&(vm.totalAmountCopy=vm.dataForFinRep.payment_data.by_network,vm.blockAllPaymentByDrugstore||(vm.totalAmountCopy+=variesAmount),vm.totalAmountCopy=Number(parseFloat(vm.totalAmountCopy).toFixed(2))),vm.parent.gifts&&setGifts(dataProposal),hideDimmer()}function calculateSellingInfo(data,dataProposal){vm.groupBy.forEach(function(group,index){var initDrugPotential,groupProperties=vm.properties[group.id];group.sellInTotal=0,group.sellOutTotal=0,group.sellInHundredsNumber=0,group.sellOutHundredsNumber=0,group.stockTotal=0,group.sellInPointsProgress=0,group.sellOutPointsProgress=0,group.sellInRealPointsProgress=0,group.sellOutRealPointsProgress=0,group.sellInMoney=0,group.sellInSign="",group.sellOutMoney=0,group.sellOutSign="",group.amountDrugs={sellIn:0,sellOut:0},group.numberDrugs={sellIn:0,sellOut:0},vm.dataFromKamSoftMkSh&&(group.mkShPointsProgress=0,group.mkShRealPointsProgress=0),dataProposal&&dataProposal.groups&&(initDrugPotential=dataProposal.groups.filter(function(el){return el.group_id==group.id}),initDrugPotential.length&&(group.sellInSign=initDrugPotential[0].signIn||"Zł",group.sellInNewPotential=initDrugPotential[0].sellIn||0,group.sellInEarns=initDrugPotential[0].sellInEarns||0,group.sellInAgreedPotential=initDrugPotential[0].sellInAgreedPotential||0,group.sellInPercent=initDrugPotential[0].sellInPercent||100,group.sellInFrom=initDrugPotential[0].sellInFrom||0,group.sellOutSign=initDrugPotential[0].signOut||"Zł",group.sellOutNewPotential=initDrugPotential[0].sellOut||0,group.sellOutEarns=initDrugPotential[0].sellOutEarns,group.sellOutAgreedPotential=initDrugPotential[0].sellOutAgreedPotential||0,group.sellOutPercent=initDrugPotential[0].sellOutPercent||100,group.sellOutFrom=initDrugPotential[0].sellInFrom||0,group.sellOutMkSh=initDrugPotential[0].mk_sh||undefined,!group.sellOutAgreedPotential&&group.sellInAgreedPotential&&(group.sellOutAgreedPotential=group.sellInAgreedPotential),!group.sellInAgreedPotential&&group.sellOutAgreedPotential&&(group.sellInAgreedPotential=group.sellOutAgreedPotential))),vm.column.sellIn.visibility&&redefineForDrugstore(group,"sellIn",groupProperties),vm.column.sellOut.visibility&&redefineForDrugstore(group,"sellOut",groupProperties),group.groups.forEach(function(drug){var initDrug=0;drug.amountDrugs={sellIn:0,sellOut:0},drug.sellIn=0,drug.sellOut=0,drug.stock=0,data&&(initDrug=data.filter(function(el){return el.drug_id==drug.id}),initDrug.length&&(drug.sellIn=initDrug[0].sell_in,drug.sellOut=initDrug[0].sell_out,drug.stock=initDrug[0].stock,drug.sellInSave=initDrug[0].sell_in,drug.sellOutSave=initDrug[0].sell_out)),vm.column.sellIn.visibility&&(group.sellInTotal+=groupAmount(drug,group,"sellIn")),vm.column.sellOut.visibility&&(group.sellOutTotal+=groupAmount(drug,group,"sellOut")),vm.column.stock.visibility&&(group.stockTotal+=groupAmount(drug,group,"stock"))}),calculateGroup(group),vm.column.sellIn.visibility&&(vm.sellInTotal+=parseFloat(group.sellInTotal),"P"!=group.sellInSign?vm.sellInEarnsTotal+=parseFloat(group.sellInMoney):vm.sellInEarnsTotalPoints+=parseInt(group.sellInMoney)),vm.column.sellOut.visibility&&(vm.sellOutTotal+=parseFloat(group.sellOutTotal),"P"!=group.sellOutSign?vm.sellOutEarnsTotal+=parseFloat(group.sellOutMoney):vm.sellOutEarnsTotalPoints+=parseInt(group.sellOutMoney)),vm.column.stock.visibility&&(vm.stockTotal+=parseFloat(group.stockTotal))}),vm.variesAmount=vm.sellInEarnsTotal+vm.sellOutEarnsTotal,vm.variesAmountPoints=vm.sellInEarnsTotalPoints+vm.sellOutEarnsTotalPoints}function redefineForDrugstore(group,fieldName,groupProperties){var redefineDrugstore,drugstoresProperties;groupProperties[fieldName]&&groupProperties[fieldName].drugstores&&groupProperties[fieldName].drugstores.length&&(redefineDrugstore=vm.parent.getDrugstoresGroup(vm.drugstoreId),redefineDrugstore.length&&(redefineDrugstore=redefineDrugstore[0],drugstoresProperties=groupProperties[fieldName].drugstores.filter(function(el){return el.group_id==redefineDrugstore.id}),drugstoresProperties.length&&(drugstoresProperties=drugstoresProperties[0],drugstoresProperties.number_values&&drugstoresProperties.number_values.length&&(drugstoresProperties.number_values.forEach(function(elDrugstore,index){var elGroup=groupProperties[fieldName].number_values[index]||null;elGroup&&elGroup.declaratedEarnings&&(elDrugstore.declaratedEarnings=elGroup.declaratedEarnings)}),groupProperties[fieldName].number_values=drugstoresProperties.number_values))))}function calculateDrug(drug,fieldName){var numSell=drug[fieldName],divider=vm.multiplier;return""===numSell&&(numSell=0),numSell/=divider,parseFloat(campaignsDataservice.calcAmountForDrug(numSell,drug.price))}function groupAmount(drug,group,fieldName){var total=0,num=drug[fieldName],amountDrugs=0;return num||(num=0),amountDrugs=calculateDrug(drug,fieldName),group.amountDrugs[fieldName]+=amountDrugs,group.numberDrugs[fieldName]+=num,total+=parseFloat(num*drug.price)}function calculateGroup(group,fieldChange){var groupProperties=vm.properties[group.id],amountDrugs=cloneObj(group.amountDrugs),numberDrugsSellOut=cloneObj(group.numberDrugs.sellOut),gained_percent=0,calculateMinMax=function(fieldName){var maxPercent,minPercent;maxPercent=groupProperties[fieldName].number_values.map(function(el){return el.declaratedValue}).max(),minPercent=group[fieldName+"MinPercent"],group[fieldName+"AgreedPotential"]&&(group[fieldName+"MaxAmountDrugs"]=parseFloat(group[fieldName+"AgreedPotential"]*maxPercent/100),group[fieldName+"MinAmountDrugs"]=parseFloat(group[fieldName+"AgreedPotential"]*minPercent/100))},calculateMkShProgress=function(fieldName){group.nowTotalDrugstoreSales&&(group[fieldName+"PointsProgress"]=+parseFloat(campaignsDataservice.calcSelling(numberDrugsSellOut,Number(group.nowTotalDrugstoreSales))).toFixed(2)),group[fieldName+"RealPointsProgress"]=group[fieldName+"PointsProgress"],group[fieldName+"PointsProgress"]>100&&(group[fieldName+"PointsProgress"]=100)},calculateFieldGroup=function(fieldName){group[fieldName+"AgreedPotential"]&&(group[fieldName+"PointsProgress"]=+parseFloat(campaignsDataservice.calcSelling(amountDrugs[fieldName],group[fieldName+"AgreedPotential"])).toFixed(2)),group[fieldName+"RealPointsProgress"]=group[fieldName+"PointsProgress"],group[fieldName+"PointsProgress"]>100&&(group[fieldName+"PointsProgress"]=100),group[fieldName+"HundredsNumber"]=parseInt(group[fieldName+"RealPointsProgress"]/100),group[fieldName+"MinPercent"]=groupProperties[fieldName].number_values.map(function(el){return el.declaratedValue}).min(),fieldName==vm.dominant&&calculateMinMax(fieldName)};fieldChange?calculateFieldGroup(fieldChange):(vm.column.sellIn.visibility&&calculateFieldGroup("sellIn"),vm.column.sellOut.visibility&&calculateFieldGroup("sellOut")),vm.dataFromKamSoftMkSh&&calculateMkShProgress("mkSh"),gained_percent=getPercent(group,vm.dominant),group[vm.dominant+"MinAmountDrugs"]&&amountDrugs[vm.dominant]<group[vm.dominant+"MinAmountDrugs"]&&(gained_percent=0),group[vm.dominant+"MaxAmountDrugs"]&&amountDrugs[vm.dominant]>group[vm.dominant+"MaxAmountDrugs"]&&(amountDrugs[vm.dominant]=group[vm.dominant+"MaxAmountDrugs"]),calculateGroupMoney(group,amountDrugs[vm.dominant],gained_percent,vm.dominant)}function getPercent(group,dominant){var gained_percent,groupProperties=vm.properties[group.id];return gained_percent=vm.useMatrix?getMatrix(group):groupProperties[dominant].earn_stable_quota?group[dominant+"RealPointsProgress"]>group[dominant+"maxPercent"]?group[dominant+"maxPercent"]:group[dominant+"RealPointsProgress"]:groupProperties[dominant].gain_percent_agreed}function calculateGroupMoney(group,amountDrugs,gained_percent,fieldName){var groupProperties=vm.properties[group.id];group[fieldName+"Money"]=0,groupProperties[fieldName].earn_stable_quota?group[fieldName+"Earns"]&&(group[fieldName+"Money"]=parseFloat(campaignsDataservice.calcEarns(group[fieldName+"Earns"],gained_percent)),"P"==group[fieldName+"Sign"]&&(group[fieldName+"Money"]=parseInt(group[fieldName+"Money"]))):group[fieldName+"Money"]=parseFloat(campaignsDataservice.calcEarns(amountDrugs,gained_percent))}function getCompareNumberForMatrix(group,fieldName){var fieldOrMkSh=vm.dataFromKamSoftMkSh&&"sellOut"==fieldName?"mkSh":fieldName;return"mkSh"==fieldOrMkSh?(100*group[fieldOrMkSh+"RealPointsProgress"]/group.sellOutMkSh).toFixed(2):group[fieldOrMkSh+"RealPointsProgress"]}function getMatrixField(group,fieldName){var compareNumber,idField,findMatrixValue,groupProperties=vm.properties[group.id],fieldNameInMatrix="sellIn"==fieldName?"sell_in":"sell_out",gained_percent=0;return compareNumber=getCompareNumberForMatrix(group,fieldName),group[fieldName+"MinValue"]=findMinRang(compareNumber,groupProperties[fieldName].number_values,"declaratedValue").min,idField=group[fieldName+"MinValue"].id||0,idField&&group[fieldName+"MinValue"].declaratedEarnings&&(group[fieldName+"Earns"]=group[fieldName+"MinValue"].declaratedEarnings),findMatrixValue=groupProperties.gain_percent_done.filter(function(el){return el[fieldNameInMatrix+"_id"]==idField}),findMatrixValue.length&&1==findMatrixValue.length&&(gained_percent=parseInt(findMatrixValue[0].gained_percent),console.log("only "+fieldName+" in matrix gained_percent=",gained_percent)),{id:idField,gained_percent:gained_percent}}function getMatrix(group){var groupProperties=vm.properties[group.id],findMatrixValue=[],gained_percent=0,def_percent=groupProperties[vm.dominant].earn_stable_quota?0:groupProperties[vm.dominant].gain_percent_agreed||0,result={sellIn:{},sellOut:{}};return group.sellInMinValue=-1,group.sellOutMinValue=-1,groupProperties.sellIn.number_values&&groupProperties.sellIn.number_values.length&&vm.column.sellIn.visibility&&(result.sellIn=getMatrixField(group,"sellIn"),!vm.column.sellOut.visibility)?result.sellIn.gained_percent:groupProperties.sellOut.number_values&&groupProperties.sellOut.number_values.length&&vm.column.sellOut.visibility&&(result.sellOut=getMatrixField(group,"sellOut"),!vm.column.sellIn.visibility)?result.sellOut.gained_percent:(group.sellInMinValue&&group.sellOutMinValue&&vm.column.sellIn.visibility&&vm.column.sellOut.visibility&&(findMatrixValue=groupProperties.gain_percent_done.filter(function(el){return el.sell_in_id==result.sellIn.id&&el.sell_out_id==result.sellOut.id}),findMatrixValue.length&&(gained_percent=parseInt(findMatrixValue[0].gained_percent),isNaN(gained_percent)&&(gained_percent=def_percent),console.log(" sellIn minValue in matrix = ",group.sellInMinValue.declaratedValue," sellOut minValue in matrix = ",group.sellOutMinValue.declaratedValue," gained_percent=",gained_percent))),gained_percent)}function manageService(dataForService,service,servicePagesLength){var notAgreedAdminOrRep=[],notShelfPhotos=[],notEnvPhotos=[],numberPhotos={};return service.blockPayment=!1,service.warning=!1,dataForService.length&&dataForService.length>=servicePagesLength?(notAgreedAdminOrRep=dataForService.filter(function(el){return(!el.agreed||!el.yes_no)&&el.definition.visible}),notAgreedAdminOrRep.length&&(service.blockPayment=!0),service.control_type&&(service.control_type.photo_shelf&&(service.blockPayment||(notShelfPhotos=dataForService.filter(function(el){return!el.shelf_image_id&&el.definition.visible}),notShelfPhotos.length&&(service.control_type.photo_shelf_blocks_this_service_payments?service.blockPayment=!0:service.warning=!0)),service.control_type.photo_shelf_included_in_services_photos_percent&&(numberPhotos.shelf=dataForService.filter(function(el){return el.shelf_image_id}).length,numberPhotos.number_shelf_photo=dataForService.length)),service.control_type.photo_environment&&(service.blockPayment||(notEnvPhotos=dataForService.filter(function(el){return!el.env_image_id&&el.definition.visible}),notEnvPhotos.length&&(service.control_type.photo_env_blocks_this_service_payments?service.blockPayment=!0:service.warning=!0)),service.control_type.photo_env_included_in_services_photos_percent&&(numberPhotos.env=dataForService.filter(function(el){return el.env_image_id}).length,numberPhotos.number_env_photo=dataForService.length)))):service.blockPayment=!0,{numberPhotos:numberPhotos,blockPayment:service.blockPayment,warning:service.warning}}function countNumberPhotos(service,needPercentPhotos){var serviceDrugstores=service.drugstores,number_shelf_photo=0,real_number_shelf_photo=0,number_env_photo=0,real_number_env_photo=0,total_photo=0,real_total_photo=0,real_percent_photo=0;serviceDrugstores.forEach(function(drugstore){var numberPhotos=drugstore.numberPhotos;numberPhotos.number_shelf_photo&&(number_shelf_photo+=numberPhotos.number_shelf_photo,real_number_shelf_photo+=numberPhotos.shelf),numberPhotos.number_env_photo&&(number_env_photo+=numberPhotos.number_env_photo,real_number_env_photo+=numberPhotos.env)}),service.blockPayment||(total_photo=number_shelf_photo+number_env_photo,real_total_photo=real_number_shelf_photo+real_number_env_photo,real_percent_photo=Math.round(real_total_photo/total_photo*100),total_photo>real_total_photo&&(needPercentPhotos<=real_percent_photo?service.warning=!0:service.blockPayment=!0))}function countNumberInNetWork(service,needPercentInNetWork){var number_true_drugstore,percent_true_drugstore,serviceDrugstores=service.drugstores;service.included_in_services_network_percent&&(number_true_drugstore=serviceDrugstores.filter(function(drugstore){return!!drugstore.service&&!drugstore.service.blockPayment}).length,percent_true_drugstore=Math.round(number_true_drugstore/serviceDrugstores.length*100),percent_true_drugstore>=needPercentInNetWork&&(service.blockPayment=!1))}function setServiceForDrugstores(service,dataServiceControl,initProposal){var parentService=cloneObj(service);service.drugstores=vm.drugstores.filter(function(drugstore){var needDrugstore=vm.parent.serviceDrugstores&&vm.parent.serviceDrugstores[service.unique_id]&&vm.parent.serviceDrugstores[service.unique_id][drugstore.id]?vm.parent.serviceDrugstores[service.unique_id][drugstore.id]:null;return needDrugstore&&(drugstore.countServicePages=needDrugstore),needDrugstore}),vm.drugstoresService[service.unique_id]||(vm.drugstoresService[service.unique_id]=[]),service.drugstores=service.drugstores.map(function(drugstore){var earns,countServicePages,dataForServices,fromManageService,numberPhotos;return earns=0,countServicePages=drugstore.countServicePages,dataForServices=dataServiceControl.filter(function(el){return el.service_id==service.unique_id&&el.drugstore_id==drugstore.id}),fromManageService=manageService(dataForServices,parentService,countServicePages),numberPhotos=fromManageService.numberPhotos,fromManageService.blockPayment?service.blockPayment=!0:fromManageService.warning&&(service.warning=!0),initProposal.length&&(earns=setServiceValues(parentService,{from:initProposal[0].from,earned:initProposal[0].include?initProposal[0].earned:0}),service.multiplier>1?service.earns+=parseFloat(earns):service.earns=parseFloat(earns)),vm.drugstoresService[service.unique_id].push({drugstore_id:drugstore.id,totalEarns:earns*service.cycleValue}),{drugstore_id:drugstore.id,drugstoreName:drugstore.name,address:drugstore.address.address_line_1+", "+drugstore.address.city.name,service:countServicePages?{unique_id:service.unique_id,blockPayment:fromManageService.blockPayment,warning:!fromManageService.blockPayment&&fromManageService.warning,earns:earns}:undefined,numberPhotos:numberPhotos}})}function setServices(services,dataServiceControl,dataProposal){var needPercentPhotos=parseInt(vm.parent.needPercentPhotos)||0,needPercentInNetWork=parseInt(vm.parent.needPercentInNetWork)||0;vm.services=[],vm.drugstoresService={},dataProposal&&(services.forEach(function(service){var initFinRep=vm.dataForFinRep.services?vm.dataForFinRep.services.find(function(el){return el.service_id==service.unique_id}):null,service_blocks_all_payments=vm.parent.isServiceBlockPayment(service,"report"),initProposal=dataProposal.services?dataProposal.services.filter(function(el){return el.unique_id==service.unique_id}):[];service.repDoServicePaid=!1,service.is_requirements_met=-1,service.proposal_earns=0,angular.isDefined(service.use_drugstores_number_in_multiplier)||(service.use_drugstores_number_in_multiplier=!0),angular.isDefined(service.use_cycle_duration_in_multiplier)||(service.use_cycle_duration_in_multiplier=!0),initFinRep&&(service.repDoServicePaid=initFinRep.makeServicePaid,service.is_requirements_met=initFinRep.is_requirements_met,service.portal_data=initFinRep.portal_data),initProposal.length&&(service.include=!angular.isDefined(initProposal[0].include)||initProposal[0].include,service.multiplier=angular.isDefined(initProposal[0].multiplier)?initProposal[0].multiplier:null,service.cycleValue=angular.isDefined(initProposal[0].cycleValue)?initProposal[0].cycleValue:null,service.proposal_earns=initProposal[0].earned,service.multiplier||(service.multiplier=service.use_drugstores_number_in_multiplier?vm.parent.servicesMultiplier:1),service.cycleValue||(service.cycleValue=service.use_cycle_duration_in_multiplier?vm.cycleValue:1)),service.include&&(service.blockPayment=!1,service.earns=0,service.drugstores=[],vm.drugstores.length>=1&&(setServiceForDrugstores(service,dataServiceControl,initProposal),needPercentPhotos&&countNumberPhotos(service,needPercentPhotos),needPercentInNetWork&&countNumberInNetWork(service,needPercentInNetWork)),service.earns=service.earns*service.cycleValue,service.saveEarns=angular.copy(service.earns),0===service.proposal_earns&&(service.is_requirements_met=!0),service.blockPayment?(service.warning=!1,service.repDoServicePaid||(service.earns=0,service_blocks_all_payments&&(vm.blockAllPayment=!0))):service.repDoServicePaid=!0,angular.isDefined(service.is_requirements_met)&&!service.is_requirements_met&&(vm.blockAllPaymentByDrugstore=!0,service.repDoServicePaid||(service.earns=0,service_blocks_all_payments&&(vm.blockAllPayment=!0))),vm.services.push(service))}),vm.addServices.length&&vm.addServices.forEach(function(addService){var initFinRepAddServices=vm.dataForFinRep.additional_services?vm.dataForFinRep.additional_services.find(function(el){return el.unique_id==addService.unique_id}):null;addService.is_requirements_met=-1,addService.saveEarns=angular.copy(addService.price),initFinRepAddServices&&(addService.repDoServicePaid=initFinRepAddServices.makeServicePaid||!1,addService.is_requirements_met=initFinRepAddServices.is_requirements_met,addService.portal_data=initFinRepAddServices.portal_data,addService.is_requirements_met||addService.repDoServicePaid||(vm.blockAllPaymentByDrugstore=!0,addService.is_visible_in_mobile&&(addService.blockPayment=!0,vm.blockAllPayment=!0,addService.price=0)))}),vm.allAddServicesVisible=vm.addServices.length&&vm.addServicesVisibility(),dataProposal.totalIsZero&&(vm.totalIsZero=!0,vm.blockAllPayment=!0))}function setServiceValues(service,initService){var values,earns;return service.earns=0,service.check_buttons=[0,1],service.yes_no=service.check_buttons[0],service.map={startValue:0,endValue:100,values:"",yes_no:0,earns:[]},service.from=0,initService&&angular.isDefined(initService.from)&&(service.from=initService.from,service.value=initService.earned||null),service.variants_list.length&&(values=service.variants_list.map(function(el){return el.label}),earns=service.variants_list.map(function(el,index){return index==service.from&&service.value?service.value:el.min_earned}),"slider"==service.type?(service.map.startValue=service.variants_list[0].label,service.variants_list.length>=2&&(service.map.endValue=service.variants_list[service.variants_list.length-1].label),service.map.values=values.join(","),service.map.earns=earns,service.earns=service.map.earns[service.from]||0):"radio"==service.type&&(service.map.values=service.variants_list,service.earns=earns[service.from]||0)),service.earns}function getServiceAmount(){var servicesAmount=0;return angular.forEach(vm.services,function(service){servicesAmount+=service.earns}),servicesAmount}function getAddServiceAmount(){var servicesAmount=0;return angular.forEach(vm.addServices,function(service){servicesAmount+=service.price}),servicesAmount}function setGifts(dataProposal){var elDropped={},colors=["green","yellow","red","purple","orange"],amounts=[10,2,3,8,100],indexColor=0;vm.giftsForDrugstores=!1,vm.reservePoints=0,vm.bagVisibility=!0,vm.pageProposal&&vm.pageProposal.ds_campaign_gift_bag_visibility&&(vm.bagVisibility=stringToBoolean(vm.pageProposal.ds_campaign_gift_bag_visibility.visible)),vm.gifts||(vm.gifts=[],vm.giftsDropped=[],vm.parent.campaign.gifts.forEach(function(gift,index){var initGift=[],initGiftReserved=[],arrName=[];dataProposal&&(dataProposal.gifts&&(initGift=dataProposal.gifts.filter(function(el){return el.id==gift.id})),vm.dataForFinRep.giftsReserved&&vm.dataForFinRep.giftsReserved.length?initGiftReserved=vm.dataForFinRep.giftsReserved.filter(function(el){return el.id==gift.id}):dataProposal.giftsReserved&&(initGiftReserved=dataProposal.giftsReserved.filter(function(el){return el.id==gift.id}))),gift.image="",gift.title=gift.name,arrName=gift.name.split(" "),gift.name=arrName.length>1?arrName[0]:gift.name,(index-1)%5==4||0===index?indexColor=0:indexColor++,gift.color=colors[indexColor],gift.amount=amounts[indexColor],initGift.length&&(initGift[0].filename&&(gift.image=GIFT_IMAGES_PATH+initGift[0].filename),initGift[0].amount&&(gift.amount=initGift[0].amount),initGift[0].points&&(gift.points=initGift[0].points)),gift.amountDropped=0,initGiftReserved.length&&(initGiftReserved[0].dominant&&initGiftReserved[0].dominant==vm.dominant||"sellIn"==vm.dominant)&&(elDropped=gift,elDropped.amountDropped=initGiftReserved[0].amountDropped,elDropped.pointsDropped=initGiftReserved[0].pointsDropped,vm.giftsDropped.push(elDropped),vm.reservePoints+=elDropped.pointsDropped,gift.amount-elDropped.amountDropped>=0&&(gift.amount-=elDropped.amountDropped)),gift.remains=angular.copy(gift.amountDropped),vm.gifts.push(gift)}))}function maxGiftsPoints(){var total=0;return vm.groupBy&&vm.groupBy.forEach(function(el){"P"==el[vm.dominant+"Sign"]&&(total+=parseInt(el[vm.dominant+"Money"]*vm.multiplier))}),total}function fixTouch(touch){var winPageX=window.pageXOffset,winPageY=window.pageYOffset,x=touch.clientX,y=touch.clientY;
return 0===touch.pageY&&Math.floor(y)>Math.floor(touch.pageY)||0===touch.pageX&&Math.floor(x)>Math.floor(touch.pageX)?(x-=winPageX,y-=winPageY):(y<touch.pageY-winPageY||x<touch.pageX-winPageX)&&(x=touch.pageX-winPageX,y=touch.pageY-winPageY),{clientX:x,clientY:y}}function hitTest(coord){var element=angular.element("[ng-drop]"),bounds=element[0].getBoundingClientRect();return coord.clientX>=bounds.left&&coord.clientX<=bounds.right&&coord.clientY<=bounds.bottom&&coord.clientY>=bounds.top}function clearGiftsForNetWork(id){angular.forEach(vm.drugstores,function(entity,i){entity.gifts&&entity.gifts[id]&&entity.gifts[id].number&&(entity.gifts[id].number=0)})}function fillDrugsWithKamSoftMkSh(data){data.group&&angular.forEach(data.group,function(groupData,group_id){var group=vm.groupBy.find(function(g){return g.id==group_id});group&&(group.nowSellOutMkSh=groupData.mk_sh||undefined,group.nowTotalDrugstoreSales=groupData.totalSales||0,angular.forEach(data.sumByDrug[group_id],function(drugData,drug_id){var findDrug=group.groups.find(function(d){return d.id==Number(drug_id)});findDrug&&(drugData.sellIn&&vm.column.sellIn.visibility&&(findDrug.sellIn=parseInt(drugData.sellIn)),drugData.sellOut&&vm.column.sellOut.visibility&&(findDrug.sellOut=parseInt(drugData.sellOut)))}))}),recalculateGroup()}function fillDrugsWithKamSoft(data){data.forEach(function(el,index){var group;"not_found"!=el.drug_id&&(group=vm.groupBy.find(function(group){return group.drugs.indexOf(el.drug_id)>-1}),group&&setDrugDataInGroup(group,el))}),recalculateGroup()}function recalculateGroup(){vm.sellInTotal=0,vm.sellOutTotal=0,vm.stockTotal=0,vm.sellInEarnsTotal=0,vm.sellOutEarnsTotal=0,vm.variesAmount=0,vm.selling_style={},vm.groupBy.forEach(function(group){group.amountDrugs={sellIn:0,sellOut:0},group.numberDrugs={sellIn:0,sellOut:0},group.sellInTotal=0,group.sellOutTotal=0,group.stockTotal=0,group.sellInMoney=0,group.sellOutMoney=0,group.groups.forEach(function(drug){vm.column.sellIn.visibility&&(group.sellInTotal+=groupAmount(drug,group,"sellIn")),vm.column.sellOut.visibility&&(group.sellOutTotal+=groupAmount(drug,group,"sellOut")),vm.column.stock.visibility&&(group.stockTotal+=groupAmount(drug,group,"stock"))}),calculateGroup(group),vm.column.sellIn.visibility&&(vm.sellInTotal+=parseFloat(group.sellInTotal),"P"!=group.sellInSign&&(vm.sellInEarnsTotal+=parseFloat(group.sellInMoney))),vm.column.sellOut.visibility&&(vm.sellOutTotal+=parseFloat(group.sellOutTotal),"P"!=group.sellOutSign&&(vm.sellOutEarnsTotal+=parseFloat(group.sellOutMoney))),vm.column.stock.visibility&&(vm.stockTotal+=parseFloat(group.stockTotal))}),vm.variesAmount=vm.sellInEarnsTotal+vm.sellOutEarnsTotal}function setDrugDataInGroup(group,drugData){var findDrug=group.groups.find(function(d){return d.id==drugData.drug_id});findDrug&&(drugData.sell_in&&vm.column.sellIn.visibility&&(findDrug.sellIn=parseInt(drugData.sell_in)),drugData.sell_out&&vm.column.sellOut.visibility&&(findDrug.sellOut=parseInt(drugData.sell_out)),drugData.stock&&vm.column.stock.visibility&&(findDrug.stock=parseInt(drugData.stock)))}function activate(){var pageSellingInfo=[],pageProposal=[];showDimmer(),vm.waiting=!0,vm.showDebugMessage=!1,vm.isGenerated=!1,vm.isSendToCompany=!1,vm.lockForm=!1,vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.campaignId=vm.parent.campaignId,vm.step=vm.parent.step,vm.uid=vm.step.unique_id,vm.page=vm.step.pages[vm.templateIndex],vm.blockAllPayment=!1,vm.multiplier=vm.parent.multiplier||1,vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.cycleValue=vm.parent.cycleValue||1,vm.colors=["ab4473","1fbbda","ab4473","1fbbda","ab4473","1fbbda"],vm.totalAmountCopy=null,vm.drugstores=vm.parent.listDrugstores,vm.addServices=vm.page.properties.ds_final_report_additional_services?vm.page.properties.ds_final_report_additional_services:[],pageSellingInfo=getObjectByKey(vm.parent.steps,"type","selling_info"),pageSellingInfo.length&&(vm.pageSellingInfo=pageSellingInfo[0].properties),pageProposal=getObjectByKey(vm.parent.steps,"type","proposal"),pageProposal.length&&(vm.pageProposal=pageProposal[0].properties),vm.dataFromKamSoftMkSh=vm.parent.campaign.kamsoft_market_share_is_on,vm.dataFromKamSoftMkSh&&(vm.parent.counterKamsoftDrugstores=0),vm.parent.offlineMode?setFinalReport():DocumentsWorkflowManager.init("final_report",{drugstoreName:vm.parent.drugstore.name,drugstoreId:vm.parent.drugstoreId,campaignProgressId:vm.parent.campaignProgress?vm.parent.campaignProgress.id:undefined,drugstoreFrameContractSignDate:vm.parent.drugstore.frame_contract_sign_date,campaignIdentifier:vm.parent.campaign.identifier,campaignName:vm.parent.campaign.name,promolineName:vm.parent.campaign.promoline.name,campaignId:vm.parent.campaignId,drugstoreNIP:vm.parent.drugstore.NIP,rksId:vm.parent.rksId,drugsGroups:cloneObj(vm.parent.drugsGroups),campaignStep:cloneObj(vm.parent.step),campaignProgress:cloneObj(vm.parent.campaignProgress)},vm.parent.campaign.docs_workflow_definition).then(function(res){setFinalReport()},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)})}function applyAction(res,isDocAlreadyStored){var defer=$q.defer();return DocumentsWorkflowManager.executeAction(undefined,isDocAlreadyStored).then(function(res){DocumentsWorkflowManager.setCampaignStepStatus().then(function(res){var stepStatus=stepsService.getStepStatus(vm.parent.step.unique_id,vm.parent.drugstoreId,vm.parent.campaignId);stepsService.setStepProperties(stepStatus,vm.parent.step),vm.lockForm=!1,DocumentsWorkflowManager.jumpToNextStep().then(function(res){DocumentsWorkflowManager.commit().then(function(res){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),defer.resolve(res)},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){console.log(err),notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)})},function(err){vm.lockForm=!1,console.log(err),notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)})},function(err){vm.lockForm=!1,console.log(err),notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)}),defer.promise}function prepareFoSave(){var sendData,invoice,sellings=[],groups=[],sell={},chartData={},initDrug=[],invoiceServices=[],additionalServices=[];return vm.chartDataValues&&(chartData={campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,campaign_progress_id:vm.parent.campaignProgressActiveId,step_id:vm.uid,staff_id:vm.parent.userData.id,date_start:vm.parent.period.start,date_end:vm.parent.period.now,kamsoft_data:{}},chartData.kamsoft_data.groups=[]),vm.totalAmount=vm.blockAllPayment?0:vm.totalAmount,invoice={campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,step_id:vm.uid,campaign_progress_id:vm.parent.campaignProgressActiveId,rks_id:vm.parent.rksId,staff_id:vm.parent.userData.id,definition:{date:new Date,fixedAmount:vm.fixedAmountFinRep,variesAmount:vm.variesAmount,totalAmount:vm.totalAmount,services:[],additional_services:[],giftsReserved:[],payment_data:vm.dataForFinRep&&vm.dataForFinRep.payment_data?vm.dataForFinRep.payment_data:undefined}},vm.services&&(angular.forEach(vm.services,function(service){invoiceServices.push({service_id:service.unique_id,title:service.title,description:service.description||"",earns:service.blockPayment&&!service.repDoServicePaid?0:service.earns,proposal_earns:service.proposal_earns,makeServicePaid:service.repDoServicePaid,is_requirements_met:service.is_requirements_met!=-1?service.is_requirements_met:undefined,drugs_number:service.variants_list[service.from]?service.variants_list[service.from].drugs_number:0,price:service.variants_list[service.from]?service.variants_list[service.from].price:0,value:service.variants_list[service.from]?service.variants_list[service.from].label:0,portal_data:service.portal_data})}),invoice.definition.services=invoiceServices),vm.addServices&&(angular.forEach(vm.addServices,function(addService){addService.is_requirements_met==-1&&(addService.is_requirements_met=!1),additionalServices.push({unique_id:addService.unique_id,is_requirements_met:addService.is_requirements_met,makeServicePaid:addService.repDoServicePaid,portal_data:addService.portal_data})}),invoice.definition.additional_services=additionalServices),vm.giftsDropped&&(invoice.definition.giftsReserved=vm.giftsDropped.map(function(el){return{id:el.id,amountDropped:el.amountDropped,pointsDropped:el.pointsDropped,dominant:vm.dominant}})),vm.groupBy.forEach(function(group,index){vm.dataFromKamSoftMkSh&&(vm.chartDataValues&&(chartData.kamsoft_data.groups[index]={group_id:group.id,totalSales:group.nowTotalDrugstoreSales}),invoice.definition.agreed_mk_sh=group.sellOutMkSh||undefined,invoice.definition.real_mk_sh=group.mkShPointsProgress||undefined),groups[index]={campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,campaign_progress_id:vm.parent.campaignProgressActiveId,step_id:vm.uid,group_id:group.id,progress:JSON.stringify({sellIn:group.sellInRealPointsProgress,sellInEarns:group.sellInMoney||0,sellInVisible:vm.column.sellIn.visibility,sellOut:group.sellOutRealPointsProgress,sellOutEarns:group.sellOutMoney||0,sellOutVisible:vm.column.sellOut.visibility})},vm.kamSoftPicture&&vm.kamSoftPicture.name&&(groups[index].selling_img={name:vm.kamSoftPicture.name,value:vm.kamSoftPicture.value||"",id:vm.kamSoftPicture.id||undefined}),group.groups.forEach(function(drug){vm.dataSellingInfo.length&&(initDrug=vm.dataSellingInfo.filter(function(el){return el.drug_id==drug.id})),(vm.column.sellIn.visibility||vm.column.sellOut.visibility)&&(sell={id:initDrug.length?initDrug[0].id:undefined,campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,campaign_progress_id:vm.parent.campaignProgressActiveId,step_id:vm.uid,drug_id:drug.id,sell_in:drug.sellIn||0,sell_out:drug.sellOut||0,stock:drug.stock||0},sellings.push(sell))})}),invoice.definition=JSON.stringify(invoice.definition),sendData={data:sellings,invoice:invoice,groups:groups},vm.chartDataValues&&(chartData.kamsoft_data.dates=vm.chartDates,chartData.kamsoft_data.averagePercent=vm.averagePercent,chartData.kamsoft_data.chart_values=vm.chartDataValues,chartData.kamsoft_data.counterKamsoftDrugstores=vm.parent.counterKamsoftDrugstores,chartData.kamsoft_data=JSON.stringify(chartData.kamsoft_data),sendData.kamsoft_daily_chart=chartData),sendData}function getServices(){var retval=[];return vm.services.forEach(function(service){retval.push({unique_id:service.unique_id,title:service.title,description:service.description||"",earns:service.earns,proposal_earns:service.proposal_earns||0,saveEarns:service.saveEarns,multiplier:service.multiplier,cycleValue:service.cycleValue,include:service.include,is_requirements_met:service.is_requirements_met||!1,repDoServicePaid:service.repDoServicePaid,drugstores:vm.drugstoresService[service.unique_id]})}),retval}function getDrugsGroups(){var retval=[];return vm.groupBy.forEach(function(group){retval.push({group_id:group.id,group_name:group.name,sell_in:group.sellInRealPointsProgress,sell_in_agreed_potential:group.sellInAgreedPotential,sell_in_total:group.sellInTotal,sell_in_percent:getMatrix(group),sell_in_earns:group.sellInMoney||0,sell_in_visible:vm.column.sellIn.visibility,sell_out:group.sellOutRealPointsProgress,sell_out_total:group.sellOutTotal,sell_out_agreed_potential:group.sellOutAgreedPotential,sell_out_percent:getMatrix(group),sell_out_earns:group.sellOutMoney||0,sell_out_visible:vm.column.sellOut.visibility})}),retval}function checkProblemFinishCampaign(){return!(!vm.parent.campaignProgressActiveId||null===vm.totalAmountCopy)&&(null!==vm.totalAmountCopy&&parseInt(vm.totalAmountCopy)!=parseInt(vm.totalAmount)?(angular.element("#showAttentionNotEqualSum").modal("show"),!1):(angular.element("#showAttentionPaid").modal("show"),!1))}function setKamSoftMkSh(data){var kamsoftMkSh;try{kamsoftMkSh=JSON.parse(data),kamsoftMkSh.counterKamsoftDrugstores&&(vm.parent.counterKamsoftDrugstores=kamsoftMkSh.counterKamsoftDrugstores),kamsoftMkSh.groups&&kamsoftMkSh.groups.forEach(function(g){var group=vm.groupBy.find(function(gr){return gr.id==g.group_id});group&&(group.nowTotalDrugstoreSales=g.totalSales)}),kamsoftMkSh.chart_values&&kamsoftMkSh.dates&&($scope.dates=kamsoftMkSh.dates,$scope.chartData=[{key:"Sprzedaż",values:kamsoftMkSh.chart_values,mean:kamsoftMkSh.averagePercent}],setChartOptions())}catch(e){}}function setChartData(data){var values=[],dates=[],total=0,total_percent=0;data.forEach(function(dataDrug,index){var value={},drugIds=dataDrug.drug_ids.split(/[\s,]+/).map(Number),group=vm.groupBy.find(function(group){return containsInArray(drugIds,group.drugs)});group&&(dates.push(moment(dataDrug.report_date).format("DD.MM.YY").toString()),value.x=index+1,total+=parseFloat(dataDrug.sell_out_sum),value.y=Number(parseFloat(dataDrug.mk_sh_percent).toFixed(2)),total_percent+=value.y,values.push(value))}),$scope.dates=dates,vm.chartDates=dates,total_percent=Number(parseFloat(total_percent/data.length).toFixed(0)),vm.chartDataValues=cloneObj(values),vm.averagePercent=total_percent,$scope.chartData=[{key:"Sprzedaż",values:values,mean:total_percent}]}function setChartOptions(){$scope.options={chart:{type:"lineChart",height:350,margin:{top:20,right:20,bottom:60,left:50},x:function(d){return d.x},y:function(d){return d.y/100},average:function(d){return d3.format(",.2")(d.mean/100)},color:d3.scale.category10().range(),duration:300,useInteractiveGuideline:!0,clipVoronoi:!1,xAxis:{axisLabel:"daty",showMaxMin:!1,tickFormat:function(d){return $scope.dates[d]},staggerLabels:!0},yAxis:{axisLabel:"",tickFormat:function(d){return d3.format(",.1%")(d)},axisLabelDistance:-10}}}}function setChart(data){setChartData(data),setChartOptions()}var vm=this;vm.changeSellField=function(groupChange,drugChange,fieldName){var total=0;groupChange[fieldName+"Total"]||(groupChange[fieldName+"Total"]=0),vm[fieldName+"Total"]=0,groupChange.amountDrugs||(groupChange.amountDrugs={sellIn:0,sellOut:0}),groupChange.amountDrugs[fieldName]=0,groupChange.numberDrugs[fieldName]=0,groupChange.groups.forEach(function(drug){total+=groupAmount(drug,groupChange,fieldName)}),groupChange[fieldName+"Total"]=total,drugChange[fieldName+"Style"]={},drugChange[fieldName+"Save"]&&drugChange[fieldName]<drugChange[fieldName+"Save"]&&(drugChange[fieldName+"Style"].color="red"),calculateGroup(groupChange,fieldName),vm.sellInEarnsTotal=0,vm.sellOutEarnsTotal=0,vm.sellInEarnsTotalPoints=0,vm.sellOutEarnsTotalPoints=0,vm.groupBy.forEach(function(group){vm[fieldName+"Total"]+=group[fieldName+"Total"],"P"!=group.sellInSign?vm.sellInEarnsTotal+=parseFloat(group.sellInMoney):vm.sellInEarnsTotalPoints+=parseInt(group.sellInMoney),"P"!=group.sellOutSign?vm.sellOutEarnsTotal+=parseFloat(group.sellOutMoney):vm.sellOutEarnsTotalPoints+=parseInt(group.sellOutMoney)}),vm.variesAmount=parseFloat(vm.sellInEarnsTotal+vm.sellOutEarnsTotal),vm.variesAmountPoints=vm.sellInEarnsTotalPoints+vm.sellOutEarnsTotalPoints},vm.totalAmountFinRep=function(obj){var result={total:0,totalPoints:0},variesAmount=vm.variesAmount?parseFloat(vm.variesAmount*vm.multiplier):0;return vm.blockAllPayment?(vm.totalAmount=0,vm.totalAmountPoints=0,vm.totalServices=0,result):(vm.totalAmount=variesAmount,vm.totalAmountPoints=parseInt(vm.variesAmountPoints*vm.multiplier),vm.waiting||(vm.services&&(vm.totalServices=getServiceAmount(),vm.totalAmount+=vm.totalServices),vm.addServices&&(vm.totalAmount+=getAddServiceAmount()),"money"==vm.earnedInFixedAmount?vm.totalAmount+=parseFloat(vm.fixedAmountFinRep*vm.multiplier):(vm.fixedAmountFinRep=parseInt(vm.fixedAmountFinRep*vm.multiplier),vm.totalAmountPoints+=vm.fixedAmountFinRep),vm.totalAmount&&(vm.totalAmount=Number(parseFloat(vm.totalAmount).toFixed(2))),result.total=vm.totalAmount||0,result.totalPoints=vm.totalAmountPoints||0),result)},vm.makeServicePaid=function(service,isAddService){var findRepDoServicePaid,findRepDoServicePaidAddServices,moneyField=angular.isDefined(service.earns)?"earns":angular.isDefined(service.price)?"price":"";vm.totalIsZero||(moneyField&&(service.repDoServicePaid?service[moneyField]=service.saveEarns:(isAddService&&service.variant||service.blockPayment||service.is_requirements_met===!1)&&(service[moneyField]=0)),findRepDoServicePaid=vm.services.filter(function(el){return!el.repDoServicePaid&&vm.parent.isServiceBlockPayment(el,"report")&&el.blockPayment&&0===el.earns}),isAddService?(findRepDoServicePaidAddServices=vm.addServices.filter(function(el){return!el.repDoServicePaid&&0===el.price}),vm.blockAllPayment=findRepDoServicePaidAddServices.length>0||findRepDoServicePaid.length>0):vm.blockAllPayment=findRepDoServicePaid.length>0,vm.changeServicePaid=!0)},vm.giftsDistribution=function(){vm.giftsForDrugstores=!vm.giftsForDrugstores},vm.changeAmountGiftsForDrugstore=function(gift,drugstore){var sum=0;gift.remains||(gift.remains=angular.copy(gift.amountDropped)),angular.forEach(vm.drugstores,function(entity,i){sum+=entity.gifts[gift.id].number}),gift.amountDropped-sum>=0&&(gift.remains=gift.amountDropped-sum)},vm.onDragStart=function(data,evt){angular.element(evt.target).text(data.name).attr("starting-drag","true")},vm.onDragEnd=function(data,evt){angular.element(evt.target).text("")},vm.onDropComplete=function(data,evt){var el=evt.element,index=vm.giftsDropped.indexOf(data),dataDropped=data;if(vm.maxPoints=maxGiftsPoints(),"true"==el.attr("starting-drag")){if(0===data.amount)return!1;if(data.points){if(vm.reservePoints+data.points>vm.maxPoints)return!1;vm.reservePoints+=data.points}index==-1?(dataDropped.amountDropped=1,data.points&&(dataDropped.pointsDropped=data.points?data.points:0),vm.giftsDropped.push(data)):(data.amount>0&&dataDropped.amountDropped++,data.points&&(dataDropped.pointsDropped+=data.points)),data.amount>0&&data.amount--,vm.drugstores.length>1&&(dataDropped.remains=angular.copy(dataDropped.amountDropped),clearGiftsForNetWork(dataDropped.id)),el.attr("starting-drag","false")}},vm.onDroppedDragEnd=function(data,evt){var touching,coord,index=vm.giftsDropped.indexOf(data),hasTouch=(angular.element(evt.target).parents("[ng-drag]"),"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch);hasTouch&&evt.originalEvent&&evt.originalEvent.changedTouches.length?coord=fixTouch(evt.originalEvent.changedTouches[0]):evt.clientX&&(coord={clientX:evt.clientX,clientY:evt.clientY}),touching=hitTest(coord),touching||(data.amountDropped>1?data.amountDropped--:1==data.amountDropped&&vm.giftsDropped.splice(index,1),data.amount++,data.points&&(data.pointsDropped-=data.points,vm.reservePoints-=data.points),vm.drugstores.length>1&&(data.remains=angular.copy(data.amountDropped),clearGiftsForNetWork(data.id)))},vm.showGiftInfo=function(obj){vm.showGift=obj,angular.element("#showGift").modal("show")},vm.saveSelling=function(){var sendData,isUpdate=!(!vm.dataSellingInfo||!vm.dataSellingInfo.length),props={};return!vm.lockForm&&(vm.lockForm=!0,!!vm.parent.campaignProgressActiveId&&(sendData=prepareFoSave(),props={step:vm.step,sendData:sendData,isUpdate:isUpdate},void localDBService.saveSelling(props).then(function(data){vm.sendFinalReport().then(function(){vm.lockForm=!1,data&&data.length&&(vm.dataSellingInfo=data),vm.selling_style={}})},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})))},vm.finishCampaign=function(isConfirm){var data,isCanFinish,sendData,props={},isUpdate=!(!vm.dataSellingInfo||!vm.dataSellingInfo.length);return!(!isConfirm&&!(isCanFinish=checkProblemFinishCampaign()))&&(!vm.lockForm&&(vm.lockForm=!0,data={id:vm.parent.campaignProgressActiveId,campaign_status:"multi"==vm.parent.campaign.campaign_scale?"completed_cycle":"completed"},sendData=prepareFoSave(),props={step:vm.step,sendData:sendData,isUpdate:isUpdate},void DocumentsWorkflowManager.setCampaignStepStatusCompleted().then(function(){DocumentsWorkflowManager.finishCampaign(data).then(function(){localDBService.saveSelling(props).then(function(data){DocumentsWorkflowManager.sendReportToCompany().then(function(){var stepStatus=stepsService.getStepStatus(vm.parent.step.unique_id,vm.parent.drugstoreId,vm.parent.campaignId);stepsService.setStepProperties(stepStatus,vm.parent.step),notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),vm.parent.campaignProgressActiveId=null,vm.parent.campaignProgress&&(vm.parent.campaignProgress.campaign_status=data.campaign_status),vm.messageSelling="CAMPAIGN_FINISHED",setMessageProps(!0),vm.lockForm=!1},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})))},vm.finishCycleCampaign=function(){var isUpdate=vm.parent.campaignProgress||!1,sendData={id:vm.parent.campaignProgress?vm.parent.campaignProgress.id:undefined,campaign_id:vm.parent.campaignId,drugstore_id:vm.parent.drugstoreId,multi:"multi",campaign_status:"completed_cycle"};isUpdate?campaignsDataservice.saveCampaignProgress(sendData,isUpdate).then(function(data){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),vm.parent.campaignProgressActiveId=null,vm.parent.campaignProgress&&(vm.parent.campaignProgress.campaign_status="completed_cycle"),vm.messageSelling="CAMPAIGN_FINISHED",setMessageProps(!0)}):console.log("You have not yet started this campaign!")},$rootScope.$on("getKamSoftMkShError",function(event,data){var del="";vm.addMessageSelling="",data&&(data.drugstores_diff.length?(vm.messageSelling="no_mk_sh"==data.word?"MK_SH_ERROR_NO_MK_SH":"MK_SH_ERROR_NO_SELL",data.drugstores_diff.forEach(function(el){vm.addMessageSelling+=del+el.identifier+" ("+el.id+")",del=", "})):"no_data"==data.word&&(vm.messageSelling="MK_SH_ERROR_NO_DATA"),vm.specialDisable=!0),setMessageProps(!1)}),$rootScope.$on("getKamSoftMkSh",function(event,data){vm.specialDisable=!1,data.sell_in_out_reports&&fillDrugsWithKamSoftMkSh(data.sell_in_out_reports),data.sell_out_daily_reports&&setChart(data.sell_out_daily_reports)}),$rootScope.$on("getKamSoft",function(event,data){fillDrugsWithKamSoft(data)}),vm.editKamSoftData=function(){vm.canEditData=!0,vm.kamSoftPicture&&vm.kamSoftPicture.src&&(vm.kamSoftPicture.src="",vm.kamSoftPicture.name=""),vm.showImg=null},vm.showKamSoftPicture=function(){vm.kamSoftPicture&&vm.kamSoftPicture.src&&(vm.showImg=vm.kamSoftPicture.src,angular.element("#showKamSoftPicture").modal("show"))},activate(),vm.sendFinalReport=function(){var data;return vm.lockForm=!0,data={drugstore_id:vm.parent.drugstoreId,final_step_unique_id:vm.parent.step.unique_id,campaign_id:vm.parent.campaignId,campaign_progress_id:vm.parent.campaignProgress.id,sell_in_total:vm.sellInTotal,sell_out_total:vm.sellOutTotal,sell_in_earns_total:vm.sellInEarnsTotal,sell_out_earns_total:vm.sellOutEarnsTotal,stock_total:vm.stockTotal,drugs_groups:getDrugsGroups(),services:getServices(),multiplier:vm.multiplier,cycle_start:vm.cycleStart,cycle_end:vm.cycleEnd,total:vm.totalAmount,total_points:vm.totalAmountPoints},DocumentsWorkflowManager.reloadDocument().then(function(d){return DocumentsWorkflowManager.checkIfDocIsSaved()?DocumentsWorkflowManager.selectWorkflowStep(0).updateDocumentData(data).then(function(res){return applyAction(res,!0)},function(err){vm.lockForm=!1,console.log(err),notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)}):DocumentsWorkflowManager.selectWorkflowStep(0).storeDocument(data).then(function(res){return applyAction(res)},function(err){vm.lockForm=!1,console.log(err),notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)})},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)})},vm.addServicesVisibility=function(){var retval=!1;return vm.addServices.length>0&&vm.addServices.forEach(function(addService){addService.is_visible_in_mobile&&(retval=!0)}),retval}}angular.module("app.campaigns").controller("CampaignsFinalReportController",CampaignsFinalReportController),CampaignsFinalReportController.$inject=["$q","$rootScope","$scope","campaignsDataservice","localDBService","notifier","$sessionStorage","GIFT_IMAGES_PATH","stepsService","DocumentsWorkflowManager","TEXT_MESSAGE","EmailsManager","MERCH_IMAGES_PATH"]}(),function(){"use strict";function CampaignsGeneralInfoController($scope,$state,campaignsDataservice,notifier,principal){function setStaffJobTitle(staffJobTitles){vm.drugstore.drugstores_staff&&vm.drugstore.drugstores_staff.forEach(function(person,index){vm.drugstore.drugstores_staff[index].jobTitleName=staffJobTitles[person.job_title_id]})}function setGeneralInfo(){vm.jobTitles?setStaffJobTitle(vm.jobTitles):campaignsDataservice.getStaffJobTitles(!0).then(function(staffJobTitles){var jobTitles={};staffJobTitles.forEach(function(jobTitle){jobTitles[jobTitle.id]=jobTitle.title}),vm.jobTitles=jobTitles,vm.drugstore.staffJobTitles=staffJobTitles,vm.drugstore.jobTitles=vm.jobTitles,setStaffJobTitle(jobTitles)})}function toggleTemplates(isEditGeneralInfo){var templates=vm.parent.templates,pageIndex=vm.templateIndex;templates.length&&(isEditGeneralInfo===!0?templates[pageIndex]=vm.parent.filterByType("general_information_edit"):templates[pageIndex]=vm.parent.filterByType("general_information"),templates[pageIndex].url="app/campaigns/pages/templates/campaigns."+templates[pageIndex].name+".html",vm.parent.template=templates[pageIndex])}function activate(){vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.step=vm.parent.step,vm.page=vm.step.pages[vm.templateIndex],vm.uid=vm.step.unique_id,vm.drugstore=vm.parent.drugstore,setGeneralInfo()}var vm=this;vm.editGeneralInfo=function(){vm.parent.isVisit&&toggleTemplates(!0)},vm.isStaff=function(staff){return!staff.is_drugstore},activate()}angular.module("app.campaigns").controller("CampaignsGeneralInfoController",CampaignsGeneralInfoController),CampaignsGeneralInfoController.$inject=["$scope","$state","campaignsDataservice","notifier","principal"]}(),function(undefined){"use strict";function CampaignsGeneralInfoEditController($rootScope,$scope,$state,clientsDataservice,campaignsDataservice,localDBService,notifier,TEXT_MESSAGE){function setJobTitle(){vm.drugstore.drugstores_staff.forEach(function(person,index){vm.drugstore.drugstores_staff[index].jobTitleName=vm.jobTitles[person.job_title_id]})}function toggleTemplates(isEditGeneralInfo){var templates=vm.parent.templates,pageIndex=vm.templateIndex;templates.length&&(isEditGeneralInfo===!0?templates[pageIndex]=vm.parent.filterByType("general_information_edit"):templates[pageIndex]=vm.parent.filterByType("general_information"),templates[pageIndex].url="app/campaigns/pages/templates/campaigns."+templates[pageIndex].name+".html",vm.parent.template=templates[pageIndex])}function activate(){vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.step=vm.parent.step,vm.uid=vm.step.unique_id,vm.types=[{val:"local",name:"LOCAL"},{val:"central",name:"CENTRAL"}],vm.drugstore=vm.parent.drugstore,vm.drugstore.step_uid=vm.uid,vm.staffJobTitles=vm.drugstore.staffJobTitles||[],vm.jobTitles=vm.drugstore.jobTitles||[],vm.registeredAtPortal=vm.isRegisteredAtPortal(),vm.oldEmail=angular.copy(vm.drugstore.email),vm.lockRegisterAtPortal=!1,vm.lockForm=!1}var vm=this;vm.registeredAtPortal=!1,vm.changedFields=[],vm.editDrugstore=!0,vm.existentAccount=undefined,vm.refresh=function(){vm.parent.offlineMode?toggleTemplates(!1):$state.go($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})},vm.changeNetWork=function(){var selected=vm.networks.filter(function(el){return el.id==vm.selected_network.id});selected.length&&(vm.selected_network.type=selected[0].type)},vm.showEditPersonModal=function(person){var country=vm.drugstore.address.country&&vm.drugstore.address.country.id?vm.drugstore.address.country.id:1,region=vm.drugstore.address.region&&vm.drugstore.address.region.id?vm.drugstore.address.region.id:1,city=vm.drugstore.address.city&&vm.drugstore.address.city.id?vm.drugstore.address.city.id:1;vm.personId=null,vm.personTemp={},person&&(vm.personId=person.id,vm.personTemp=person),vm.personTemp.address||(vm.personTemp.address={country:country,region:region,city:city,city_id:city,address_line_1:"",address_line_2:"",phone:"",zip:""}),angular.element("#editPersonModal").modal("show")},vm.showRemovePersonModal=function(person){person&&(vm.personId=person.id),angular.element("#removePersonModal").modal("show")},vm.savePerson=function(){var person=vm.personTemp,address=vm.personTemp.address;person.id=vm.personId,person.drugstore_id=vm.drugstoreId,person.address.drugstore_id=person.drugstore_id,localDBService.savePerson(person).then(function(data){person.id?(vm.personTemp.address=address,vm.drugstore.drugstores_staff.forEach(function(staff,index){staff.id==vm.personId&&(vm.drugstore.drugstores_staff[index]=person)})):(data&&data.last_insert_id&&(person.id=data.last_insert_id),vm.drugstore.drugstores_staff.push(person)),setJobTitle()},function(res){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.removePerson=function(){campaignsDataservice.removePerson(vm.personId).then(function(data){vm.drugstore.drugstores_staff=vm.drugstore.drugstores_staff.filter(function(staff){return staff.id!=vm.personId})},function(res){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.showRegisterAtPortalWindow=function(){clientsDataservice.checkPortalEmail(vm.drugstore.email).then(function(res){return res&&(vm.existentAccount=res.plain().resource),vm.onChangeField("email"),vm.existentAccount&&vm.existentAccount.drugstore&&!vm.existentAccount.drugstore.registered_at_portal?void angular.element("#email_used_in_unregistered_drugstore_modal").modal("show"):(vm.changeAccountEmail=!1,void(vm.drugstore.parent_drugstore||vm.drugstore.registered_at_portal||!vm.existentAccount?vm.drugstore.registered_at_portal&&vm.changedFields.indexOf("email")>-1?(vm.changeAccountEmail=!0,angular.element("#confirm_email_change_modal_main").modal("show")):vm.drugstore.parent_drugstore&&!vm.drugstore.registered_at_portal&&vm.changedFields.indexOf("email")>-1?(vm.drugstore.email=vm.oldEmail,angular.element("#confirm_email_change_modal").modal("show")):angular.element("#confirm_register_drugstore_at_portal_modal").modal("show"):angular.element("#confirm_attach_to_group_modal").modal("show")))})},vm.showUnregisterAtPortalWindow=function(){vm.drugstore.stored_docs?angular.element("#unable_to_unregister_drugstore_at_portal_warning_modal").modal("show"):angular.element("#confirm_unregister_drugstore_at_portal_modal").modal("show")},vm.registerAtPortal=function(){function send(){var email;clientsDataservice.registerAtPortal(vm.drugstore).then(function(res){email=vm.drugstore.parent_drugstore?vm.drugstore.parent_drugstore.email:vm.drugstore.email,clientsDataservice.addDrugstoresStaff(vm.drugstore.email).then(function(){vm.lockRegisterAtPortal=!1,notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.REGISTER_LINK_SENT),vm.refresh()},function(res){vm.lockRegisterAtPortal=!1,notifier.warning("Ostrzeżenie",res.data.message)})},function(res){vm.lockRegisterAtPortal=!1,notifier.warning("Ostrzeżenie",res.data.message)})}vm.drugstore.parent_drugstore||vm.drugstore.registered_at_portal||(vm.changedFields.indexOf("email")>-1?vm.saveDrugstore(send):(vm.lockRegisterAtPortal=!0,send()))},vm.unregisterAtPortal=function(){clientsDataservice.unregisterAtPortal(vm.drugstore).then(function(res){clientsDataservice.removeDrugstoresStaff(vm.drugstore.email).then(function(){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.REGISTER_LINK_CANCELED),vm.refresh()},function(res){notifier.warning("Ostrzeżenie",res.data.message),vm.refresh()})})},vm.isRegisteredAtPortal=function(){return vm.drugstore.parent_drugstore?vm.drugstore.parent_drugstore.registered_at_portal:vm.drugstore.registered_at_portal;
},vm.isButtonVisible=function(){return(vm.isRegisterButtonVisible()||vm.isUnRegisterButtonVisible())&&vm.parent.mainDrugstoreId==vm.drugstore.id},vm.isRegisterButtonVisible=function(){return!vm.findNotRegisteredPortalAccount()&&!vm.isRegisteredAtPortal()},vm.isUnRegisterButtonVisible=function(){return vm.findNotRegisteredPortalAccount()},vm.isEmailReadonly=function(){return vm.findNotRegisteredPortalAccount()?"readonly":undefined},vm.findNotRegisteredPortalAccount=function(){var drugstoresStaff;return drugstoresStaff=vm.drugstore.drugstores_staff.find(function(dss){return dss.is_drugstore===!0&&dss.registered_at_portal===!1&&dss.email==vm.drugstore.email})},vm.onChangeEmail=function(valid){valid&&vm.drugstore.email?clientsDataservice.checkPortalEmail(vm.drugstore.email).then(function(res){res&&(vm.existentAccount=res.plain().resource),vm.onChangeField("email")}):vm.onChangeField("email")},vm.onFormSubmit=function(){clientsDataservice.checkPortalEmail(vm.drugstore.email).then(function(res){return res&&(vm.existentAccount=res.plain().resource),vm.existentAccount&&vm.existentAccount.drugstore&&!vm.existentAccount.drugstore.registered_at_portal?void angular.element("#email_used_in_unregistered_drugstore_modal").modal("show"):(vm.changeAccountEmail=!1,void(vm.drugstore.parent_drugstore||vm.drugstore.registered_at_portal||!vm.existentAccount?vm.drugstore.registered_at_portal&&vm.changedFields.indexOf("email")>-1?(vm.changeAccountEmail=!0,angular.element("#confirm_email_change_modal_main").modal("show")):vm.drugstore.parent_drugstore&&!vm.drugstore.registered_at_portal&&vm.changedFields.indexOf("email")>-1?(vm.drugstore.email=vm.oldEmail,angular.element("#confirm_email_change_modal").modal("show")):vm.saveDrugstore():angular.element("#confirm_attach_to_group_modal").modal("show")))})},vm.saveDrugstore=function(cb){var drugstore=angular.copy(vm.drugstore);drugstore.address&&"object"==typeof drugstore.address.city&&drugstore.address.city_id&&drugstore.address.city.id!=drugstore.address.city_id&&(drugstore.address.city_id=drugstore.address.city.id),vm.parent.offlineMode&&(vm.parent.drugstore=angular.copy(drugstore)),delete drugstore.step_uid,delete drugstore.staffJobTitles,delete drugstore.jobTitles,delete drugstore.drugstores_staff,delete drugstore.drugstores_network,delete drugstore.category,delete drugstore.metadata,vm.lockForm=!0,localDBService.saveDrugstore(drugstore).then(function(data){vm.lockForm=!1,vm.changedFields.indexOf("email")>-1&&(vm.changeAccountEmail||!drugstore.parent_drugstore&&drugstore.registered_at_portal)?clientsDataservice.changePortalEmail(drugstore).then(function(res){var oldEmail;res&&(oldEmail=res.plain().old_email,clientsDataservice.changePortalTenantEmail(drugstore.email,oldEmail).then(function(){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.LOGIN_FOR_PORTAL_CHANGE),vm.changedFields=[],cb?cb():vm.refresh()},function(res){vm.lockForm=!1,notifier.warning("Ostrzeżenie",res.data.message)}))},function(res){vm.lockForm=!1,notifier.warning("Ostrzeżenie",res.data.message)}):(vm.changedFields=[],cb?cb():vm.refresh())},function(res){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.cancelEditDrugstore=function(){toggleTemplates(!1)},vm.isStaff=function(staff){return!staff.is_drugstore},vm.getEmailColspan=function(){return vm.isButtonVisible()?undefined:2},vm.onChangeField=function(field){vm.changedFields.indexOf(field)==-1&&vm.changedFields.push(field)},activate()}angular.module("app.campaigns").controller("CampaignsGeneralInfoEditController",CampaignsGeneralInfoEditController),CampaignsGeneralInfoEditController.$inject=["$rootScope","$scope","$state","clientsDataservice","campaignsDataservice","localDBService","notifier","TEXT_MESSAGE"]}(),function(){"use strict";function CampaignsInvoiceController($scope,campaignsDataservice,notifier,principal,$sessionStorage){function getNecessaryData(callback,drugsIds){var campaignProgress=vm.parent.campaignProgress?vm.parent.campaignProgress.id:null;campaignsDataservice.getInvoice(vm.campaignId,campaignProgress,vm.drugstoreId).then(function(data){console.log(data);var definition=null;if(vm.dataInvoice=data,data.length){definition=data[0].definition;try{definition=JSON.parse(definition)}catch(e){}}callback(definition)})}function setInvoice(){vm.campaignInvoice||(vm.campaignInvoice={},getNecessaryData(setInvoiceDefinitions))}function setInvoiceDefinitions(dataInvoice){var data=dataInvoice?dataInvoice:{};vm.drugstore=vm.parent.drugstore,vm.campaignInvoice=data,vm.campaignInvoice.date=new Date(vm.campaignInvoice.date)||new Date,vm.campaignInvoice.original=vm.campaignInvoice.original||0,vm.campaignInvoice.invoiceNr=vm.campaignInvoice.invoiceNr||"",vm.campaignInvoice.waysToPay=vm.campaignInvoice.waysToPay||"",vm.campaignInvoice.termNumber=vm.campaignInvoice.termNumber||"",vm.campaignInvoice.totalAmount=vm.campaignInvoice.totalAmount||0,vm.campaignInvoice.seller=vm.campaignInvoice.seller||{accountNumber:""},vm.campaignInvoice.client=vm.campaignInvoice.client||{name:"",address:"",NIP:"",accountNumber:""}}function activate(){vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.campaignId=vm.parent.campaignId,vm.step=vm.parent.step,vm.uid=vm.step.unique_id,vm.page=vm.step.pages[vm.templateIndex],setInvoice()}var vm=this;vm.saveInvoice=function(){var sendData,isUpdate=!(!vm.dataInvoice||!vm.dataInvoice.length),invoice={campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,step_id:vm.uid,definition:{date:vm.campaignInvoice.date,original:vm.campaignInvoice.original,invoiceNr:vm.campaignInvoice.invoiceNr,waysToPay:vm.campaignInvoice.waysToPay,termNumber:vm.campaignInvoice.termNumber,fixedAmount:vm.campaignInvoice.fixedAmount||0,variesAmount:vm.campaignInvoice.variesAmount||0,totalAmount:vm.campaignInvoice.totalAmount||0,services:vm.campaignInvoice.services,giftsReserved:vm.campaignInvoice.giftsReserved,seller:vm.campaignInvoice.seller,client:vm.campaignInvoice.client}};invoice.definition=JSON.stringify(invoice.definition),sendData=isUpdate?[{id:vm.dataInvoice[0].id,data:invoice}]:invoice,campaignsDataservice.saveInvoice(sendData,isUpdate).then(function(data){data&&data.length&&(vm.dataInvoice={id:data[0]}),notifier.success("Sukces","Data for selling saved successfully!")})},activate()}angular.module("app.campaigns").controller("CampaignsInvoiceController",CampaignsInvoiceController),CampaignsInvoiceController.$inject=["$scope","campaignsDataservice","notifier","principal","$sessionStorage"]}(),function(undefined){"use strict";function CampaignsLastSellingController($rootScope,$scope,$translate,$timeout,campaignsDataservice,stepsService,localDBService,notifier,TEXT_MESSAGE,MERCH_IMAGES_PATH){function checkProblems(){var isCan=!0,campaignProgress=vm.parent.campaignProgress&&"pending"!=vm.parent.campaignProgress.campaign_status?vm.parent.campaignProgress.id:null;return!campaignProgress||"completed"!=vm.parent.campaignProgress.campaign_status&&"completed_cycle"!=vm.parent.campaignProgress.campaign_status?vm.parent.isVisit||vm.step.readOnly?"neutral"==vm.parent.dominant?(isCan=!1,vm.messageSelling="CAMPAIGN_NOT_DOMINANT"):vm.parent.countMainOffices>1&&"completed"!=vm.step.status&&(isCan=!1,vm.messageSelling="CAMPAIGN_MANY_MAIN_OFFICE"):vm.messageSelling="NOT_RIGHTS_FOR_EDIT":vm.messageSelling="CAMPAIGN_FINISHED",vm.messageSelling&&setMessageProps(!0),isCan}function setMessageProps(isPageReadOnly){vm.messageSellingClass="negative-text",vm.pageReadOnly=isPageReadOnly}function getLastSellingPotential(drugsIds){var campaignProgress=vm.parent.campaignProgress&&"pending"!=vm.parent.campaignProgress.campaign_status?vm.parent.campaignProgress.id:null;return campaignsDataservice.getSellingPotential(vm.campaignId,campaignProgress,vm.drugstoreId,drugsIds).then(function(data){return data},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function setLastSellingInfo(){var drugsIds,localData,isCanView=checkProblems();return initDrugs(),!!isCanView&&(drugsIds=vm.parent.drugs.map(function(el){return el.id}),void(vm.parent.offlineMode?(localData=localDBService.getPageData("potential"),setLastSellingData(localData)):getLastSellingPotential(drugsIds).then(function(data){setLastSellingData(data)})))}function setLastSellingData(data){vm.needRecalculate=!1,vm.drugsIds={},vm.kamSoftPicture={},data.forEach(function(group,index){var group_id=group.group_id,dbPotential="",groupBy=vm.groupBy.filter(function(el){return el.id==group_id});if(groupBy.length){0===index&&(vm.amountDrugstores=group.amount_drugstores,vm.step.readOnly||vm.pageReadOnly||vm.amountDrugstores==vm.multiplier||(vm.messageSelling="CAMPAIGN_NEED_RECALCULATE",setMessageProps(!1),vm.needRecalculate=!0),group.kam_soft&&"potential"==group.kam_soft.page&&(vm.kamSoftPicture={},vm.kamSoftPicture.src=MERCH_IMAGES_PATH+group.kam_soft.kamsoft_img_file,vm.kamSoftPicture.id=group.kam_soft.kamsoft_img_id)),groupBy=groupBy[0],groupBy.groups.forEach(function(drug){var drugData=group.groups.filter(function(el){return el.drug_id==drug.id});drugData.length&&(vm.drugsIds[group_id]||(vm.drugsIds[group_id]=[]),drugData=drugData[0],drug.sellIn=drugData.sell_in,drug.sellOut=drugData.sell_out,vm.drugsIds[group_id].push({id:drugData.id,drug_id:drug.id}))});try{dbPotential=JSON.parse(group.potential),dbPotential.old_mksh&&(groupBy.oldMkSh=dbPotential.old_mksh),dbPotential.new_mksh&&(groupBy.newMkSh=dbPotential.new_mksh),dbPotential.counterKamsoftDrugstores&&(vm.parent.counterKamsoftDrugstores=dbPotential.counterKamsoftDrugstores),dbPotential.applyAverageData&&(vm.messageSelling="APPLY_AVERAGE_DATA",setMessageProps(!1)),dbPotential.sellIn&&(groupBy.newPotential.sellIn.value=dbPotential.sellIn),dbPotential.sellOut&&(groupBy.newPotential.sellOut.value=dbPotential.sellOut),dbPotential.sellInRealPotential&&(groupBy.realPotential={},groupBy.realPotential.sellIn=dbPotential.sellInRealPotential),dbPotential.sellOutRealPotential&&(groupBy.realPotential={},groupBy.realPotential.sellOut=dbPotential.sellOutRealPotential)}catch(e){}parseFloat(group.help_coefficient)&&(groupBy.help_coefficient=group.help_coefficient,groupBy.applyHelpCircle=!0),calculateData(groupBy,!1,vm.fieldCalculate),groupBy.redefinePotential&&!dbPotential.compliant&&"red"==vm.totalNewPotential.color&&(vm.redefinePotential=!0,calculateData(groupBy,!0,vm.fieldCalculate))}}),vm.waiting=!1,vm.redefinePotential&&"red"!=vm.totalNewPotential.color&&(notifier.success("Success","Potencjał zostal obniżony!"),vm.saveSellingPotential()),vm.originalData=JSON.stringify(vm.groupBy),vm.parent.is_proposal_saved&&"rejected"!=vm.step.status&&(vm.pageReadOnly=!vm.needRecalculate),$scope.$watch(function(){return JSON.stringify(vm.groupBy)},function(newValue){vm.parent.isPageChange=!1,newValue===vm.originalData||vm.parent.offlineMode||(vm.parent.isPageChange=!0)})}function initDrugs(){var drugsProperties=vm.page.properties||{},defaultHelpProperties={visible:"true",label:"",helpCircleCoefficient:.8},helpProperties=drugsProperties.ds_potential_limit||defaultHelpProperties,drugs=angular.copy(vm.parent.drugs);if(vm.canEditData=!vm.dataFromKamSoft,vm.dataFromKamSoftMkSh){vm.marketShareMinimum=vm.parent.campaign.market_share_minimum;try{vm.marketSharePercents=JSON.parse(vm.parent.campaign.market_share_in_percentage)}catch(e){}}vm.visibility={sellIn:!angular.isDefined(drugsProperties.ds_drug_sell_in_column)||stringToBoolean(drugsProperties.ds_drug_sell_in_column.visible),sellOut:!angular.isDefined(drugsProperties.ds_drug_sell_out_column)||stringToBoolean(drugsProperties.ds_drug_sell_out_column.visible),btn_photo:{label:drugsProperties.ds_btn_photo?drugsProperties.ds_btn_photo.label:"Photo",visible:!angular.isDefined(drugsProperties.ds_btn_photo)||drugsProperties.ds_btn_photo.visible},totalNewPotential:{visible:!angular.isDefined(drugsProperties.ds_total_new_potential_well)||stringToBoolean(drugsProperties.ds_total_new_potential_well.visible)}},vm.lastSellingPeriod={start:drugsProperties.ds_last_sell_info_period?calcTime(new Date(drugsProperties.ds_last_sell_info_period.periodFrom),!0):vm.parent.period.start,end:drugsProperties.ds_last_sell_info_period?calcTime(new Date(drugsProperties.ds_last_sell_info_period.periodTo),!0):vm.parent.period.end},vm.letterDisabled=!0,vm.helpDisabled=!0,vm.currency="",vm.totalNewPotential={value:0,color:"red"},vm.showSellingNews={type:"",show:!1},vm.helpCircle={visible:stringToBoolean(helpProperties.visible),label:helpProperties.label,helpCircleCoefficient:helpProperties.helpCircleCoefficient||.8},vm.reducePercent=Math.round(100*(1-helpProperties.helpCircleCoefficient)),"sell_in"==vm.parent.dominant?(vm.fieldCalculate="sellIn",vm.fieldNotFromCalculate="sellOut"):(vm.fieldCalculate="sellOut",vm.fieldNotFromCalculate="sellIn"),vm.groupBy=angular.copy(vm.parent.drugsGroups),vm.groupBy.forEach(function(group,index){var minimumPotential,properties=drugsProperties?drugsProperties["ds_drugs_group_new_potential_"+group.id]:null;group.oldPotential={sellIn:{value:0},sellOut:{value:0}},group.newPotential={visible:!0,color:"red",label:"New Potential"},group.minimalNewPotential=0,group.groups=[],properties&&(group.currency=properties.currency,group.newPotential.visible=stringToBoolean(properties.visible),group.newPotential.label=properties.label,group.minimalNewPotential=properties.minimalNewPotential,minimumPotential=group.minimalNewPotential,vm.parent.listDrugstores.length>1&&vm.parent.networkHelper&&(group.minimalNewPotential=parseFloat(group.minimalNewPotential*vm.parent.networkHelper)),group.improvingCoefficient=properties.improvingCoefficient,properties.drugstores&&properties.drugstores.length&&redefineForDrugstore(group,properties.drugstores)),group.newPotential[vm.fieldCalculate]={value:0},group.newPotential[vm.fieldNotFromCalculate]={value:0},group.drugs.forEach(function(drugId){var drug=drugs.filter(function(drug){return drug.id==drugId});drug.length&&group.groups.push(drug[0])})})}function redefineForDrugstore(group,drugstoresProperties){var redefineDrugstore=vm.parent.getDrugstoresGroup(vm.drugstoreId);redefineDrugstore.length&&(redefineDrugstore=redefineDrugstore[0],drugstoresProperties=drugstoresProperties.filter(function(el){return el.group_id==redefineDrugstore.id}),drugstoresProperties.length&&(drugstoresProperties=drugstoresProperties[0],drugstoresProperties.minimal_new_potential&&(group.minimalNewPotential=drugstoresProperties.minimal_new_potential),drugstoresProperties.improving_coefficient&&(group.improvingCoefficient=drugstoresProperties.improving_coefficient),group.redefinePotential=!0))}function calculateData(group,calculateNewPotential,field){var ImprovingCoefficient,MinimalNewPotential,calculateNotFrom=!0,divider=vm.amountDrugstores||1;("sellIn"==vm.fieldNotFromCalculate&&!vm.visibility.sellIn||"sellOut"==vm.fieldNotFromCalculate&&!vm.visibility.sellOut)&&(calculateNotFrom=!1),vm.letterDisabled=!0,vm.helpDisabled=!0,group&&(ImprovingCoefficient=group.improvingCoefficient||0,MinimalNewPotential=group.minimalNewPotential||0,group.oldPotential.sellIn.value=0,group.oldPotential.sellOut.value=0,group.groups.forEach(function(drug){var oldPotential,count=drug[vm.fieldCalculate]||0;count=parseFloat(count/divider),oldPotential=parseFloat(count*drug.price),group.oldPotential[vm.fieldCalculate].value+=oldPotential,calculateNotFrom&&(count=drug[vm.fieldNotFromCalculate]||0,count=parseFloat(count/divider),oldPotential=parseFloat(count*drug.price),group.oldPotential[vm.fieldNotFromCalculate].value+=oldPotential)}),group.oldPotential[vm.fieldCalculate].value=parseFloat(group.oldPotential[vm.fieldCalculate].value),calculateNotFrom&&(group.oldPotential[vm.fieldNotFromCalculate].value=parseFloat(group.oldPotential[vm.fieldNotFromCalculate].value)),calculateNewPotential&&field&&(group.newPotential[field].value=parseFloat(group.oldPotential[field].value*ImprovingCoefficient)),group.newPotential.color=parseFloat(group.newPotential[vm.fieldCalculate].value)>=parseFloat(MinimalNewPotential)&&0!==parseFloat(MinimalNewPotential)?"navy":"red"),calculateTotal(),"navy"==vm.totalNewPotential.color?(vm.showSellingNews.type="blue",vm.showSellingNews.show=!0):(vm.showSellingNews.type="red",vm.showSellingNews.show=!0,vm.letterDisabled=!1,vm.helpDisabled=!1)}function calculateTotal(){var totalNewPotential=0,tempTotalColor="navy";vm.groupBy.forEach(function(group){totalNewPotential+=parseFloat(group.newPotential[vm.fieldCalculate].value),"red"==group.newPotential.color&&(tempTotalColor="red")}),vm.totalNewPotential.value=parseFloat(totalNewPotential),vm.totalNewPotential.color=tempTotalColor}function helpCircle(){var groupsName="",drugsWithRedNewPotential=vm.groupBy.filter(function(group){return"red"==group.newPotential.color});return vm.helpCircle.helpCircleCoefficient?(drugsWithRedNewPotential.forEach(function(group){var helpCoefficient,newMinimalNewPotential,dl="";return helpCoefficient=group.help_coefficient?group.help_coefficient:vm.helpCircle.helpCircleCoefficient,newMinimalNewPotential=parseFloat(helpCoefficient*group.minimalNewPotential),groupsName+=dl+group.name,dl=", ",parseFloat(group.newPotential[vm.fieldCalculate].value)<parseFloat(newMinimalNewPotential)?(notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.NOT_ENOUGH_POTENTIAL),!1):(notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_HELP_CYCLE),group.newPotential.color=parseFloat(group.newPotential[vm.fieldCalculate].value)>=parseFloat(newMinimalNewPotential)?"navy":"red","red"!=group.newPotential.color&&(group.realPotential={},group.realPotential[vm.fieldCalculate]=group.newPotential[vm.fieldCalculate].value,group.newPotential[vm.fieldCalculate].value=group.minimalNewPotential),group.applyHelpCircle=!0,void(group.help_coefficient=helpCoefficient))}),calculateTotal(),"navy"==vm.totalNewPotential.color?(vm.letterDisabled=!0,vm.helpDisabled=!0,vm.showSellingNews.type="blue",vm.showSellingNews.show=!0,vm.saveSellingPotential()):(vm.letterDisabled=!1,vm.helpDisabled=!1,vm.showSellingNews.type="red",vm.showSellingNews.show=!0),groupsName):(notifier.error("Error","The administrator has not set help coefficient!"),!1)}function fillDrugsWithKamSoftMkSh(data){vm.groupBy.forEach(function(group){var findMinPercentValue;data.group[group.id]&&(group.oldMkSh=data.group[group.id].mk_sh,vm.marketShareMinimum&&group.oldMkSh<vm.marketShareMinimum?group.newMkSh=Number(parseFloat(vm.marketShareMinimum).toFixed(2)):vm.marketSharePercents&&(findMinPercentValue=findMinRang(group.oldMkSh,vm.marketSharePercents,"market_share_value").min,findMinPercentValue.market_share_increase?group.newMkSh=Number(parseFloat(group.oldMkSh+findMinPercentValue.market_share_increase).toFixed(2)):group.newMkSh=Number(parseFloat(group.oldMkSh).toFixed(2))),group.totalDrugstoreSales=data.group[group.id].totalSales),angular.forEach(data.sumByDrug[group.id],function(val,key){var findDrug=group.groups.find(function(d){return d.id==key});findDrug&&(val.sellIn&&vm.visibility.sellIn&&(findDrug.sellIn=parseInt(val.sellIn)),val.sellOut&&vm.visibility.sellOut&&(findDrug.sellOut=Number(val.sellOut.toFixed(0))))})}),recalculateGroup()}function fillDrugsWithKamSoft(data){data.forEach(function(el,index){var group;"not_found"!=el.drug_id&&(group=vm.groupBy.find(function(group){return group.drugs.indexOf(el.drug_id)>-1}),group&&setDrugDataInGroup(group,el))}),recalculateGroup()}function recalculateGroup(){vm.groupBy.forEach(function(group){calculateData(group,!0,vm.fieldCalculate),calculateData(group,!0,vm.fieldNotFromCalculate),group.help_coefficient=0,group.applyHelpCircle=!1})}function setDrugDataInGroup(group,drugData){var findDrug=group.groups.find(function(d){return d.id==drugData.drug_id});findDrug&&(drugData.sell_in&&vm.visibility.sellIn&&(findDrug.sellIn=parseInt(drugData.sell_in)),drugData.sell_out&&vm.visibility.sellOut&&(findDrug.sellOut=parseInt(drugData.sell_out)))}function activate(){vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.campaignId=vm.parent.campaignId,vm.drugstore=vm.parent.drugstore,vm.step=vm.parent.step,vm.page=vm.step.pages[vm.templateIndex],vm.uid=vm.step.unique_id,vm.multiplier=vm.parent.multiplier||1,vm.amountDrugstores=angular.copy(vm.multiplier),vm.lockForm=!1,vm.dataFromKamSoftMkSh=vm.parent.campaign.kamsoft_market_share_is_on,vm.dataFromKamSoft=vm.parent.campaign.kamsoft_qr_code_is_on,vm.waiting=!0,vm.campaignProgressActiveId=vm.parent.campaignProgressActiveId,vm.parent.campaign.kamsoft_market_share_is_on&&(vm.parent.counterKamsoftDrugstores=0),setLastSellingInfo()}var vm=this;vm.saveSellingPotential=function(){var sendData,sell,groups=[],isUpdate=vm.drugsIds&&Object.keys(vm.drugsIds).length||!1;return!vm.lockForm&&(vm.lockForm=!0,vm.groupBy.forEach(function(group,index){groups[index]={campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,group_id:group.id,amount_drugstores:vm.multiplier||1,potential:{sellIn:parseFloat(group.newPotential.sellIn.value),sellOut:parseFloat(group.newPotential.sellOut.value),compliant:"red"!=group.newPotential.color,old_mksh:group.oldMkSh||undefined,new_mksh:group.newMkSh||undefined,counterKamsoftDrugstores:vm.parent.counterKamsoftDrugstores||undefined,applyAverageData:vm.parent.applyAverageData||undefined,totalSales:group.totalDrugstoreSales||undefined},help_coefficient:group.help_coefficient?parseFloat(group.help_coefficient):0,kamsoft_data_edited:vm.dataFromKamSoft},vm.kamSoftPicture&&vm.kamSoftPicture.name&&0===index&&(groups[index].potential_img={name:vm.kamSoftPicture.name,value:vm.kamSoftPicture.value||"",id:vm.kamSoftPicture.id||undefined}),group.realPotential&&group.realPotential[vm.fieldCalculate]&&(groups[index].potential[vm.fieldCalculate+"RealPotential"]=parseFloat(group.realPotential[vm.fieldCalculate])),groups[index].potential=JSON.stringify(groups[index].potential),vm.campaignProgressActiveId&&(groups[index].campaign_progress_id=vm.campaignProgressActiveId),group.groups.forEach(function(drug,indexDrug){var drugFromDb;groups[index].groups||(groups[index].groups=[]),(angular.isDefined(drug.sellIn)||angular.isDefined(drug.sellOut))&&(vm.drugsIds&&vm.drugsIds[group.id]&&vm.drugsIds[group.id].length&&(drugFromDb=vm.drugsIds[group.id].find(function(el){return el.drug_id==drug.id})),sell={id:drugFromDb?drugFromDb.id:undefined,campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,step_id:vm.uid,group_id:drug.group_id||0,drug_id:drug.id,sell_in:drug.sellIn||0,sell_out:drug.sellOut||0,groupId:group.id},groups[index].groups.push(sell))})}),void(groups.length&&(sendData=groups,localDBService.saveSellingPotential(sendData,isUpdate).then(function(data){var isInDates;vm.lockForm=!1,vm.parent.isPageChange=!1,vm.canEditData=!vm.dataFromKamSoft,"red"==vm.totalNewPotential.color?stepsService.setStepProperties("drugstore_not_compliant",vm.parent.step):(isInDates=stepsService.isWithinDates(calcTime(new Date(vm.parent.step.date_start),!0),calcTime(new Date(vm.parent.step.date_end),!0)),isInDates&&(stepsService.setStepProperties("within_dates_and_unblocked",vm.parent.step),vm.parent.step.isStepStart=!0)),vm.needRecalculate&&vm.parent.refresh(),data&&data.groups&&(vm.drugsIds=data.groups)},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)}))))},vm.barcodeScannerOptions={preferFrontCamera:!1,showFlipCameraButton:!1,prompt:"Place a barcode inside the scan area",formats:"QR_CODE",orientation:"landscape"},vm.sellChange=function(group,field){group.applyHelpCircle&&field==vm.fieldCalculate&&(group.applyHelpCircle=!1,group.help_coefficient=!1),calculateData(group,!0,field)},vm.showHelpModal=function(){angular.element("#confirmHelpSelling").modal("show")},vm.showModalLetter=function(){angular.element("#sendMessageToRKS").modal("show")},vm.confirmHelpSelling=function(){var groupsName=helpCircle();return!!groupsName},vm.sendMessageToRks=function(){var message,subject,text;text=angular.element("#templateMessageToRKS").html().replace(/<div [^>]*>/gi,"<div>"),subject="Please Confirm, Drugstore #"+vm.drugstoreId,message='<div class="quoteMsg">'+text+'</div><div class="ui column"><a class="large ui positive button sendAdminMessage"ng-click="vm.confirmRepresentantMessage()"><i class="icon checkmark"></i>I agree</a></div>',vm.parent.sendMessageToAdmin(subject,message)},vm.saveSelling=function(){vm.needRecalculate&&vm.groupBy.forEach(function(group,index){vm.amountDrugstores=vm.multiplier,calculateData(group,!0,vm.fieldCalculate),calculateData(group,!0,vm.fieldNotFromCalculate),group.help_coefficient=0,group.applyHelpCircle=!1}),"red"==vm.totalNewPotential.color?angular.element("#drugstoreNotCompliant").modal("show"):vm.saveSellingPotential()},vm.makeMinimumPotential=function(){var sendData,groups=[],isUpdate=vm.drugsIds&&Object.keys(vm.drugsIds).length||!1;return!vm.lockForm&&(vm.lockForm=!0,vm.groupBy.forEach(function(group,index){groups[index]={campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,group_id:group.id,amount_drugstores:vm.multiplier||1,potential:{sellIn:"sellIn"==vm.fieldCalculate?group.minimalNewPotential:0,sellOut:"sellOut"==vm.fieldCalculate?group.minimalNewPotential:0,compliant:!0},help_coefficient:0},groups[index].potential=JSON.stringify(groups[index].potential),vm.campaignProgressActiveId&&(groups[index].campaign_progress_id=vm.campaignProgressActiveId)}),void(groups.length&&(sendData=groups,localDBService.saveSellingPotential(sendData,isUpdate).then(function(data){vm.parent.refresh()},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)}))))},$rootScope.$on("getKamSoft",function(event,data){fillDrugsWithKamSoft(data)}),$rootScope.$on("getKamSoftMkShError",function(event,data){var del="";vm.addMessageSelling="",data&&(data.drugstores_diff.length?(vm.messageSelling="no_mk_sh"==data.word?"MK_SH_ERROR_NO_MK_SH":"MK_SH_ERROR_NO_SELL",data.drugstores_diff.forEach(function(el){vm.addMessageSelling+=del+el.identifier+" ("+el.id+")",del=", "})):"no_data"==data.word?vm.messageSelling="MK_SH_ERROR_NO_DATA":vm.messageSelling="no_mk_sh"==data.word?"MK_SH_ERROR_NO_MK_SH":"MK_SH_ERROR_NO_SELL",vm.specialDisable=!0),setMessageProps(!1)}),$rootScope.$on("getKamSoftMkSh",function(event,data){vm.specialDisable=!1,vm.messageSelling&&(vm.messageSelling="",vm.addMessageSelling=""),vm.parent.applyAverageData&&(vm.messageSelling="APPLY_AVERAGE_DATA",setMessageProps(!1)),data.group&&data.sumByDrug&&fillDrugsWithKamSoftMkSh(data)}),vm.editKamSoftData=function(){vm.canEditData=!0,vm.kamSoftPicture&&vm.kamSoftPicture.src&&(vm.kamSoftPicture.src="",vm.kamSoftPicture.name=""),vm.showImg=null},vm.showKamSoftPicture=function(){vm.kamSoftPicture&&vm.kamSoftPicture.src&&(vm.showImg=vm.kamSoftPicture.src,angular.element("#showKamSoftPicture").modal("show"))},activate()}angular.module("app.campaigns").controller("CampaignsLastSellingController",CampaignsLastSellingController),CampaignsLastSellingController.$inject=["$rootScope","$scope","$translate","$timeout","campaignsDataservice","stepsService","localDBService","notifier","TEXT_MESSAGE","MERCH_IMAGES_PATH"]}(),function(){"use strict";function CampaignsLocalInfoController($scope,campaignsDataservice,localDBService,notifier,TEXT_MESSAGE){function setLocalInfo(){vm.properties?setMetaData():campaignsDataservice.getProperties(vm.drugstoreId).then(function(properties){vm.properties=properties,setMetaData()},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function setMetaData(){vm.drugstore.metadata&&!Object.keys(vm.drugstoreMetadata).length&&vm.properties.forEach(function(property){var meta_data=vm.drugstore.metadata.filter(function(p){return property.id==p.key});meta_data.length?(meta_data=meta_data[0],"boolean"==property.type?vm.drugstoreMetadata[meta_data.key]="1"==meta_data.value||0:"number"==property.type?vm.drugstoreMetadata[meta_data.key]=parseInt(meta_data.value):vm.drugstoreMetadata[meta_data.key]=meta_data.value):"boolean"==property.type||"number"==property.type?vm.drugstoreMetadata[property.id]=0:"string"==property.type&&(vm.drugstoreMetadata[property.id]="")})}function activate(){vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.step=vm.parent.step,vm.page=vm.step.pages[vm.templateIndex],vm.uid=vm.step.unique_id,vm.drugstore=vm.parent.drugstore,vm.drugstore.step_uid=vm.uid,vm.drugstoreMetadata={},vm.lockForm=!1,setLocalInfo()}var vm=this;vm.saveLocalInfo=function(){var drugstore_metadata=angular.copy(vm.drugstore.metadata);for(var key in vm.drugstoreMetadata)vm.drugstoreMetadata.hasOwnProperty(key)&&vm.drugstoreMetadata[key]===!1&&(vm.drugstoreMetadata[key]="0");vm.drugstore.metadata=vm.drugstoreMetadata,vm.lockForm=!0,localDBService.saveDrugstore(vm.drugstore).then(function(data){vm.lockForm=!1,vm.drugstore.metadata=drugstore_metadata,vm.parent.refresh()},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})},vm.showWarning=function(evt,confirm){!confirm&&evt.target?(vm.clickedElement=evt.target,$("#warningLocalInfoModal").modal("show"),vm.clickedElement.checked=!1):vm.clickedElement&&(vm.clickedElement.checked=!0,vm.clickedElement=null)},activate()}angular.module("app.campaigns").controller("CampaignsLocalInfoController",CampaignsLocalInfoController),CampaignsLocalInfoController.$inject=["$scope","campaignsDataservice","localDBService","notifier","TEXT_MESSAGE"]}(),function(undefined){"use strict";function CampaignsMerchandisingController($rootScope,$scope,$state,$timeout,campaignsDataservice,localDBService,notifier,MERCH_IMAGES_PATH,TEXT_MESSAGE,exifService,principal,geolocation){function setIdsToData(data){data.ids&&(vm.merchIds=data.ids),vm.merch.forEach(function(service,index){var service_update;service.include&&(service_update=data.ids&&data.ids.length?data.ids.find(function(el){return el.service_id==service.unique_id}):null,service_update?(service.id=service_update.id,service.img&&(service.img.shelf&&(service.img.shelf.value&&(service.img.shelf.value=""),service.img.shelf.diffMn&&(service.img.shelf.diffMn=undefined),service.shelf_image_id=service_update.shelf_id),service.img.env&&(service.img.env.value&&(service.img.env.value=""),service.img.env.diffMn&&(service.img.env.diffMn=undefined),service.env_image_id=service_update.env_id))):service.img&&(service.img.shelf&&(service.img.shelf.value="",service.shelf_image_id=null,service.img.shelf.diffMn=undefined),service.img.env&&(service.img.env.value="",service.env_image_id=null,service.img.env.diffMn=undefined)))})}function clearServicesWithWrongDate(servicesWrongDate){vm.lockForm=!0,$timeout(function(){servicesWrongDate.forEach(function(service){vm.lockForm=!1,service.wrongDate=!1,service.can_edit=!0,service.img&&(service.img.shelf&&(service.img.shelf.value="",service.img.shelf.name="",service.img.shelf.agreed=undefined,service.img.shelf.src="",service.shelf_image_id=null,service.img.shelf.diffMn=undefined,angular.element("#takePictureShelf_"+service.unique_id).val("")),service.img.env&&(service.img.env.value="",service.img.env.name="",service.img.env.agreed=undefined,service.img.env.src="",service.env_image_id=null,service.img.env.diffMn=undefined,angular.element("#takePictureEnv_"+service.unique_id).val("")))})},5e3)}function getDataProposalDefinition(){var proposalServicesIds,definition=null,dataProposal=vm.parent.campaignProgress&&vm.parent.campaignProposal?vm.parent.campaignProposal:[];if(dataProposal.length){definition=dataProposal[0].definition;try{definition=JSON.parse(definition)}catch(e){}definition&&vm.merch.length>definition.services.length&&(proposalServicesIds=definition.services.map(function(s){return s.unique_id}),vm.merch=vm.merch.filter(function(s){return proposalServicesIds.indexOf(s.unique_id)>-1}))}return definition}function setMerchandising(){var dataOffLineMode,dataProposal,campaignProgressId=vm.parent.campaignProgress&&"pending"!=vm.parent.campaignProgress.campaign_status?vm.parent.campaignProgress.id:0;vm.parent.services.length&&(vm.merch=cloneObj(vm.parent.services),
dataProposal=getDataProposalDefinition(),vm.parent.offlineMode?(dataOffLineMode=localDBService.getPageData("service_control_"+vm.uid)||[],dataOffLineMode.length&&(vm.dataServiceControl=dataOffLineMode),setServiceControlProperties(dataProposal)):campaignsDataservice.getServiceControl(vm.campaignId,campaignProgressId,vm.uid,vm.drugstoreId,vm.parent.userData.id).then(function(result){result.data&&result.data.length&&(vm.dataServiceControl=result.data),vm.parent.campaign.hide_drugstore_photo||(vm.imageProps={drugstore_image_id:0,img:{drugstore:{name:"",src:"",value:"",date:""}}},result.drugstorePicture&&result.drugstorePicture.id&&setDrugstorePhotoProperties(result.drugstorePicture)),setServiceControlProperties(dataProposal)},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)}))}function setDrugstorePhotoProperties(drugstorePicture){var isDrugstorePhotoRejected=function(){var res=!1;return null===drugstorePicture.accepted||stringToBoolean(drugstorePicture.accepted)||(res=!0),res},isDrugstorePhotoDateInvalid=function(){var realPhotoDate,photoNeedDate,differenceDates,res=!1;return vm.parent.drugstore.is_old_photos_invalid&&(realPhotoDate=calcTime(moment(vm.imageProps.img.drugstore.date,"DD.MM.YYYY HH:mm:ss")),photoNeedDate=calcTime(vm.parent.drugstore.photos_invalid_from,!0),differenceDates=compareDates(realPhotoDate,photoNeedDate),null!==differenceDates&&differenceDates<0&&(res=!0)),res};vm.imageProps.drugstore_image_id=drugstorePicture.id,vm.imageProps.img.drugstore.name=drugstorePicture.name,vm.imageProps.img.drugstore.date=drugstorePicture.date,vm.imageProps.img.drugstore.src=MERCH_IMAGES_PATH+drugstorePicture.name,vm.imageProps.img.drugstore.old_date=isDrugstorePhotoRejected()||isDrugstorePhotoDateInvalid()}function setServiceControlProperties(dataProposal){vm.merchIds=[],vm.merch.forEach(function(service,index){var dataServices,initProposal,definition,dataServicesDefinition,initService={},index_check=0;if(service.img||(service.img={shelf:{},env:{}}),vm.dataServiceControl&&(dataServices=vm.dataServiceControl.find(function(el){return el.service_id==service.unique_id})),dataServices)try{definition=JSON.parse(dataServices.definition),definition.length&&(dataServicesDefinition=definition[0])}catch(e){}dataProposal&&dataProposal.services&&(initProposal=dataProposal.services.find(function(el){return el.unique_id==service.unique_id})),initService.include=!0,initService.can_edit=!0,initProposal&&(angular.isDefined(initProposal.include)&&(initService.include=initProposal.include),initService.from=initProposal.from,initService.earned=initProposal.earned),dataServicesDefinition&&(initService.from=dataServicesDefinition.from,initService.earned=dataServicesDefinition.earned||0,initService.date_rep=dataServicesDefinition.date_rep||"",initService.date_rks=dataServicesDefinition.date_rks||"",initService.can_edit=!angular.isDefined(dataServicesDefinition.can_edit)||dataServicesDefinition.can_edit),setServiceValues(service,initService),dataServices&&(service.id=dataServices.id,vm.merchIds.push(service.id),dataServices.rks_id&&(service.rks_id=dataServices.rks_id),service.manager_agreed=dataServices.agreed,index_check=dataServices.yes_no,service.yes_no=service.check_buttons[index_check],dataServices.shelf_image&&dataServices.shelf_image.name&&setServiceImg(dataServices,dataServicesDefinition,service,"shelf"),dataServices.env_image&&dataServices.env_image.name&&setServiceImg(dataServices,dataServicesDefinition,service,"env"))})}function setServiceValues(service,initService){var values,earns,drugs_num,standart_img,earns_range=[],propertiesService=vm.page.properties["ds_merch_services_table_row_"+service.unique_id];hideDimmer(),service.visible=!0,service.include=!0,angular.isDefined(service.use_cycle_duration_in_multiplier)||(service.use_cycle_duration_in_multiplier=!0),angular.isDefined(service.cycleValue)||(service.cycleValue=service.use_cycle_duration_in_multiplier?vm.cycleValue:1),propertiesService&&(service.visible=stringToBoolean(propertiesService.visible)),service.earns=0,service.check_buttons=[0,1],service.yes_no=service.check_buttons[1],service.manager_agreed=0,service.drugsNumber=[],service.map={startValue:0,endValue:100,values:"",yes_no:0,earns:[]},service.manager_agreed=0,service.from=0,initService&&(service.from=initService.from||0,service.value=initService.earned||null,service.include=initService.include,service.date_rep=initService.date_rep||"",service.date_rks=initService.date_rks||"",service.can_edit=initService.can_edit),service.include&&(service.control_type&&(angular.isDefined(vm.acceptEnable)||(vm.acceptEnable=!1),(service.control_type.photo_shelf&&service.control_type.photo_shelf_controlled_by_manager||service.control_type.photo_environment&&service.control_type.photo_env_controlled_by_manager)&&(!vm.isManager||"in_progress"!=vm.step.status&&"rejected"!=vm.step.status||(vm.acceptEnable=!0),vm.isSendMessage=!0)),values=service.variants_list.map(function(el){return el.label}),earns=service.variants_list.map(function(el,index){var realValue=index==service.from&&service.value?service.value:el.min_earned;return earns_range.push({min:el.min_earned,max:el.max_earned,real:realValue}),realValue}),drugs_num=service.variants_list.map(function(el){return el.drugs_number}),standart_img=service.variants_list.map(function(el){return el.files?el.files:{}}),service.standart_img=standart_img,service.standart_img.forEach(function(el){el.filename&&(el.src=MERCH_IMAGES_PATH+el.filename)}),"slider"==service.type?(service.map.startValue=service.variants_list[0].label,service.variants_list.length>=2&&(service.map.endValue=service.variants_list[service.variants_list.length-1].label),service.map.values=values.join(","),service.map.earns=earns,service.earns=service.map.earns[service.from]||0):"radio"==service.type&&(service.variants_list.forEach(function(el,index){el.earned=earns[index]}),service.map.values=service.variants_list,service.earns=service.variants_list.length&&service.variants_list[service.from]?service.variants_list[service.from].earned:0),service.drugsNumber=drugs_num,service.drugs_number=service.drugsNumber[service.from]?service.drugsNumber[service.from]:0)}function setServiceImg(dataServices,dataServicesDefinition,service,imgName){service[imgName+"_image_id"]=dataServices[imgName+"_image_id"],service.img[imgName].color="",service.img[imgName].name=dataServices[imgName+"_image"].name,service.img[imgName].agreed=dataServicesDefinition?dataServicesDefinition[imgName+"_agreed"]:-1,service.img[imgName].agreedSaved=cloneObj(service.img[imgName].agreed),service.img[imgName].originalDate=dataServicesDefinition&&dataServicesDefinition[imgName+"_originalDate"]?dataServicesDefinition[imgName+"_originalDate"]:"",vm.parent.offlineMode&&dataServices[imgName+"_image"].value?service.img[imgName].src=dataServices[imgName+"_image"].value:service.img[imgName].src=MERCH_IMAGES_PATH+service.img[imgName].name,(!service.img[imgName].agreed||vm.parent.not_paid_campaign&&service.img[imgName].agreed&&service.img[imgName].agreed!=-1)&&(service.can_edit=!0)}function getOriginalDateTime(file,obj,nameImg){campaignsDataservice.getOriginalPhotoDate(file,function(response){var realPhotoDate,photoNeedDate,differenceDates;obj.img[nameImg].originalDate=response.originalDate,obj.img[nameImg].diffMn=response.diffMn,"drugstore"==nameImg&&vm.parent.drugstore.is_old_photos_invalid&&(realPhotoDate=calcTime(moment(response.originalDate,"DD.MM.YYYY HH:mm:ss")),photoNeedDate=calcTime(vm.parent.drugstore.photos_invalid_from,!0),differenceDates=compareDates(realPhotoDate,photoNeedDate),null!==differenceDates&&(obj.img[nameImg].old_date=differenceDates<0))})}function setStatusService(service){var statusStep,isAddService=!0,agreed=!0;return service.control_type&&service.visible&&(service.control_type.photo_shelf&&service.control_type.photo_environment&&service.control_type.photo_shelf_controlled_by_manager&&service.control_type.photo_env_controlled_by_manager?(service.img.shelf.name&&service.img.env.name&&service.img.shelf.agreed&&service.img.env.agreed||(statusStep="rejected",isAddService=!1),agreed=1==service.img.shelf.agreed&&1==service.img.env.agreed,vm.parent.not_paid_campaign&&(service.img.shelf.agreed!=-1&&angular.isDefined(service.img.shelf.agreed)||service.img.env.agreed!=-1&&angular.isDefined(service.img.env.agreed)||(statusStep="in_progress"))):service.control_type.photo_shelf&&service.control_type.photo_shelf_controlled_by_manager?(service.img.shelf.name&&service.img.shelf.agreed||(statusStep="rejected",isAddService=!1),agreed=1==service.img.shelf.agreed,vm.parent.not_paid_campaign&&(service.img.shelf.agreed!=-1&&angular.isDefined(service.img.shelf.agreed)||(statusStep="in_progress"))):service.control_type.photo_environment&&service.control_type.photo_env_controlled_by_manager?(service.img.env.name&&service.img.env.agreed||(statusStep="rejected",isAddService=!1),agreed=1==service.img.env.agreed,vm.parent.not_paid_campaign&&(service.img.env.agreed!=-1&&angular.isDefined(service.img.env.agreed)||(statusStep="in_progress"))):(service.control_type.photo_shelf&&!service.control_type.photo_environment&&!service.img.shelf.name||service.control_type.photo_environment&&!service.control_type.photo_env_controlled_by_manager&&!service.img.env.value)&&(isAddService=!1)),{isAddService:isAddService,statusStep:statusStep,agreed:agreed}}function checkProblems(){var isCan=!0;return vm.messageSelling=null,vm.parent.campaignProgressActiveId||vm.parent.not_paid_campaign?!vm.parent.not_paid_campaign&&vm.parent.countMainOffices>1&&!vm.isManager&&"completed"!=vm.step.status?(isCan=!1,vm.messageSelling="CAMPAIGN_MANY_MAIN_OFFICE"):vm.parent.isVisit||vm.isManager||(vm.messageSelling="NOT_RIGHTS_FOR_EDIT"):vm.messageSelling=!vm.parent.campaignProgress||"completed"!=vm.parent.campaignProgress.campaign_status&&"completed_cycle"!=vm.parent.campaignProgress.campaign_status?"CAMPAIGN_NOT_ACTIVE":vm.messageSelling="CAMPAIGN_FINISHED",vm.messageSelling&&(vm.messageSellingClass="negative-text",vm.pageReadOnly=!0),isCan}function activate(){showDimmer(),vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.campaignId=vm.parent.campaignId,vm.step=vm.parent.step,vm.page=vm.step.pages[vm.templateIndex],vm.uid=vm.step.unique_id,vm.isManager=vm.parent.isManager,vm.isSendMessage=!1,vm.lockForm=!1,vm.isZoom=!1,vm.cycleValue=vm.parent.cycleValue,vm.dataServiceControl=null,$rootScope.serviceControl=!0,checkProblems(),vm.debug="",setMerchandising()}var vm=this;vm.saveServiceControl=function(isCloseStep){var countNoPhotos,sendDataCloseStep,setDrugstoreImage,location,arrSave=[],props={},sendData={},isUpdate=!!vm.merchIds,isSendMessage=!1,needCloseStep=!0,newStepStatus=null,oldStatusStep=vm.parent.step.status,statusStep="",servicesStepStatuses=[],date_now=new Date,isBlockedDate=!1,servicesWrongDate=[],drugstoreDefinition={};if(vm.lockForm)return!1;if(vm.parent.isPageChange=!1,showDimmer(),vm.isManager?(angular.element("#confirmRksAgreed").modal("hide"),angular.element("#showAcceptPhotos").modal("hide")):(isSendMessage=isCloseStep&&vm.isSendMessage,needCloseStep=isCloseStep&&vm.page.needCloseStep&&!vm.parent.not_paid_campaign),countNoPhotos=vm.merch.filter(function(service){return!service.img.shelf.name&&!service.img.env.name}),!(countNoPhotos.length!=vm.merch.length||vm.imageProps&&vm.imageProps.img.drugstore.value))return hideDimmer(),!1;if(vm.merch.forEach(function(service,index){var value,shelfMnPass,envMnPass,shelfOriginalDate="",envOriginalDate="",isAddService=!0,definition=[],merch={},statusService={};service.include&&service.visible&&(merch={id:service.id?service.id:undefined,campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,campaign_progress_id:vm.parent.not_paid_campaign?0:vm.parent.campaignProgressActiveId,step_id:vm.uid,service_id:service.unique_id,type:service.type,definition:[],yes_no:service.yes_no,agreed:!1},vm.isManager||(merch.shelf_image_id=service.shelf_image_id?service.shelf_image_id:undefined,merch.env_image_id=service.env_image_id?service.env_image_id:undefined,merch.rks_id=vm.parent.rksId,merch.staff_id=vm.parent.userData.id,service.img.shelf&&service.img.shelf.name&&(merch.shelf_image={name:service.img.shelf.name,value:service.img.shelf.value||""},service.img.shelf.originalDate||(service.img.shelf.originalDate=""),shelfOriginalDate=service.img.shelf.originalDate,shelfMnPass=service.img.shelf.diffMn),service.img.env&&service.img.env.name&&(merch.env_image={name:service.img.env.name,value:service.img.env.value||""},service.img.env.originalDate||(service.img.env.originalDate=""),envOriginalDate=service.img.env.originalDate,envMnPass=service.img.env.diffMn)),statusService=setStatusService(service),isAddService=statusService.isAddService,statusStep=statusService.statusStep,merch.agreed=statusService.agreed,statusStep&&servicesStepStatuses.push(statusStep),statusStep||merch.agreed||(statusStep="in_progress"),vm.parent.blockingServiceControl&&vm.parent.blockingServiceControl.apply&&(shelfMnPass&&Number(shelfMnPass)>vm.parent.blockingServiceControl.time&&(isBlockedDate=!0,service.wrongDate=!0,servicesWrongDate.push(service)),envMnPass&&Number(envMnPass)>vm.parent.blockingServiceControl.time&&(isBlockedDate=!0,service.wrongDate=!0,servicesWrongDate.push(service))),isAddService&&("slider"==service.type?value=service.map.values?service.map.values.split(",")[service.from]:0:"radio"==service.type&&(value=service.map.values.length&&service.map.values[service.from]?service.map.values[service.from].label:0),merch.agreed=Number(merch.agreed),service.can_edit=!isSendMessage,definition.push({title:service.title,from:service.from,value:value,earned:service.earns,visible:service.visible&&service.include,date_rep:vm.isManager||1===merch.agreed?service.date_rep?service.date_rep:"":moment(date_now).format("YYYY-MM-DD HH:mm:ss"),date_rks:vm.isManager?moment(date_now).format("YYYY-MM-DD HH:mm:ss"):service.date_rks?service.date_rks:"",shelf_originalDate:shelfOriginalDate,env_originalDate:envOriginalDate,shelf_agreed:service.img.shelf?service.img.shelf.agreed:-1,env_agreed:service.img.env?service.img.env.agreed:-1,shelf_control:service.control_type&&service.control_type.photo_shelf&&service.control_type.photo_shelf_controlled_by_manager,env_control:service.control_type&&service.control_type.photo_environment&&service.control_type.photo_env_controlled_by_manager,can_edit:service.can_edit,not_paid_campaign_step_status:vm.parent.not_paid_campaign&&isCloseStep&&"in_progress"==statusStep?statusStep:undefined}),merch.definition=JSON.stringify(definition),arrSave.push(merch)))}),isBlockedDate)return notifier.error("Ostrzeżenie",vm.parent.blockingServiceControl.warning),clearServicesWithWrongDate(servicesWrongDate),hideDimmer(),!1;if(isCloseStep)for(var i=0,len=servicesStepStatuses.length;i<len;i++){if("rejected"==servicesStepStatuses[i]){statusStep="rejected";break}"in_progress"==servicesStepStatuses[i]&&(statusStep="in_progress")}if(vm.parent.not_paid_campaign&&(isCloseStep||(statusStep=oldStatusStep,vm.step.isStepStart=!0)),vm.imageProps&&vm.imageProps.img.drugstore.value&&(drugstoreDefinition.originalDate=vm.imageProps.img.drugstore.originalDate||"",principal.getGeolocationIsOn()&&(location=geolocation.getLastLocation(),location&&(drugstoreDefinition.geolocation=location)),setDrugstoreImage={staff_id:vm.parent.userData.id,drugstore_id:vm.drugstoreId,name:vm.imageProps.img.drugstore.name,value:vm.imageProps.img.drugstore.value||"",newName:"drugstoreCard_"+vm.drugstoreId,definition:JSON.stringify(drugstoreDefinition)}),isCloseStep&&"rejected"==statusStep)return notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.NOT_ENOUGH_PHOTOS),hideDimmer(),!1;if(needCloseStep&&(newStepStatus=statusStep?statusStep:isSendMessage?"in_progress":"completed",sendDataCloseStep=vm.parent.closeStep(vm.step,[],newStepStatus)),sendData={setStepStatus:sendDataCloseStep,isSetProgressStepStatus:vm.parent.not_paid_campaign?undefined:1,data:arrSave,setDrugstoreImage:setDrugstoreImage||undefined},isSendMessage){if(!vm.parent.rksId)return notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.NOT_RKS),hideDimmer(),!1;sendData.todo={campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,definition:{},rks_id:vm.parent.rksId,rep_id:vm.parent.userData.id||null,action_type:"service_control",action_done:"no"},vm.drugstoreId!=vm.parent.mainDrugstoreId&&(sendData.todo.definition.mainDrugstoreId=vm.parent.mainDrugstoreId),sendData.todo.definition.step_id=vm.uid,sendData.todo.definition=JSON.stringify(sendData.todo.definition)}else vm.isManager&&(sendData.removeTodo={campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,rks_id:vm.parent.rksId});return props={step:vm.parent.step,isCloseStep:needCloseStep,funcCloseStep:needCloseStep?vm.parent.setStepStatus:null,sendData:sendData,isUpdate:isUpdate},vm.lockForm=!0,localDBService.saveServiceControl(props).then(function(data){vm.lockForm=!1,hideDimmer(),vm.parent.not_paid_campaign&&vm.parent.setStepStatus(vm.step,statusStep),vm.parent.offlineMode||(data&&data.ids&&setIdsToData(data),vm.isManager&&("in_progress"==vm.step.status||"rejected"==vm.step.status?vm.acceptEnable=!0:"completed"==vm.step.status&&(vm.acceptEnable=!1),data&&angular.isDefined(data.todo_count)&&$rootScope.$emit("changeTodo",data.todo_count)))},function(err){vm.lockForm=!1,hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),err.data&&err.data.inserted_ids&&setIdsToData(err.data.inserted_ids)}),!0},vm.showPicture=function(index,pict){var service=vm.merch[index];service.img[pict]&&service.img[pict].src&&(vm.showImg=service.img[pict].src,vm.showRksButtons="shelf"==pict?service.control_type.photo_shelf_controlled_by_manager:service.control_type.photo_env_controlled_by_manager,vm.showRksButtons&&vm.isManager&&(vm.servicePhoto={index:index,pict:pict}),angular.element("#showPicture").modal("show"))},vm.setRksAgreed=function(value){var service;vm.servicePhoto&&(service=vm.merch[vm.servicePhoto.index],service.img[vm.servicePhoto.pict].agreed=value,angular.element("#showPicture").modal("hide"))},vm.showAllPhotos=function(){angular.element("#showAcceptPhotos").modal("show")},vm.showConfirmAgreed=function(){angular.element("#confirmRksAgreed").modal("show")},vm.setRksAllAgreed=function(){vm.merch.forEach(function(service,index){service.img.shelf&&(service.img.shelf.selectedToAccept?(service.img.shelf.agreed=!0,service.img.shelf.selected=!0):(service.img.shelf.agreed=!1,service.img.shelf.selected=!1)),service.img.env&&(service.img.env.selectedToAccept?(service.img.env.agreed=!0,service.img.env.selected=!0):(service.img.env.agreed=!1,service.img.env.selected=!1))})},vm.showStandartPicture=function(src){src&&(vm.showImg=src,angular.element("#showPicture").modal("show"))},vm.hideZoom=function(event){return event.preventDefault(),vm.isZoom=!vm.isZoom,!1},vm.sendMessageToManager=function(){angular.element("#confirmCloseStep").modal("show")},$scope.loadPhoto=function(elem){var obj,file=elem.files[0],el=angular.element(elem),forObj=el.attr("for"),index=-1,reader=new FileReader;return forObj=forObj.split("_"),2===forObj.length&&file?(index=forObj[1],forObj=forObj[0],obj="drugstore"==forObj?vm.imageProps:vm.merch[index],getOriginalDateTime(file,obj,forObj),reader.onload=function(e){var tempImg=new Image;tempImg.src=reader.result,obj.img[forObj].src="",tempImg.onload=function(){var canvas,ctx,maxWidth=400,maxHeight=400,tempWidth=tempImg.width,tempHeight=tempImg.height;tempWidth>tempHeight?tempWidth>maxWidth&&(tempHeight*=maxWidth/tempWidth,tempWidth=maxWidth):tempHeight>maxHeight&&(tempWidth*=maxHeight/tempHeight,tempHeight=maxHeight),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),canvas.width=tempWidth,canvas.height=tempHeight,ctx.drawImage(this,0,0,tempWidth,tempHeight),$timeout(function(){obj.img[forObj].value=canvas.toDataURL("image/jpeg"),obj.img[forObj].src=canvas.toDataURL("image/jpeg"),obj.img[forObj].name=file.name,obj.img[forObj].agreed=-1,vm.parent.isPageChange=!0},0)}},void(file&&reader.readAsDataURL(file))):void console.log("Something wrong when load picture")},$scope.$on("$destroy",function(){$rootScope.serviceControl=!1}),activate()}angular.module("app.campaigns").controller("CampaignsMerchandisingController",CampaignsMerchandisingController),CampaignsMerchandisingController.$inject=["$rootScope","$scope","$state","$timeout","campaignsDataservice","localDBService","notifier","MERCH_IMAGES_PATH","TEXT_MESSAGE","exifService","principal","geolocation"]}(),function(undefined){"use strict";function CampaignsProposalController($scope,$state,campaignsDataservice,localDBService,notifier,GIFT_IMAGES_PATH,MERCH_IMAGES_PATH,TEXT_MESSAGE){function checkProblems(){var isCan=!0;return!vm.parent.campaignProgress||"completed"!=vm.parent.campaignProgress.campaign_status&&"completed_cycle"!=vm.parent.campaignProgress.campaign_status?vm.parent.isVisit||vm.step.readOnly?vm.parent.countMainOffices>1&&"completed"!=vm.step.status&&(isCan=!1,vm.messageSelling="CAMPAIGN_MANY_MAIN_OFFICE"):vm.messageSelling="NOT_RIGHTS_FOR_EDIT":vm.messageSelling="CAMPAIGN_FINISHED",vm.messageSelling&&setMessageProps(!0),isCan}function getProposal(callback){var campaignProgress=vm.parent.campaignProgress&&"pending"!=vm.parent.campaignProgress.campaign_status?vm.parent.campaignProgress.id:null,isCan=checkProblems();isCan?campaignsDataservice.getProposal(vm.campaignId,campaignProgress,vm.drugstoreId).then(function(result){var data=result.data?result.data:[],dataPotential=result.dataPotential?result.dataPotential:[];vm.proposal=null,data.length&&(vm.proposal=data[0]),vm.dataPotential=dataPotential,callback()},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)}):callback([],[])}function setProposal(){var potentialData,proposalData;vm.parent.offlineMode?(vm.proposal=null,potentialData=localDBService.getPageData("potential")||[],proposalData=localDBService.getPageData("proposal")||[],proposalData.length&&(vm.proposal=proposalData[0]),vm.dataPotential=potentialData,setProposalDefinitions()):getProposal(setProposalDefinitions)}function resetProposal(){vm.amountDrugstores=vm.multiplier,vm.groupBy.forEach(function(group,index){group.sellIn&&group.sellIn.visible&&setNewAgreedPotential(group,"sellIn"),group.sellOut&&group.sellOut.visibl&&setNewAgreedPotential(group,"sellOut")}),vm.groupsServices.forEach(function(o){o.services.forEach(function(service){service.multiplier=service.use_drugstores_number_in_multiplier&&vm.parent.serviceCount&&vm.parent.serviceCount[service.unique_id]?vm.parent.serviceCount[service.unique_id]:1,service.cycleValue=service.use_cycle_duration_in_multiplier?vm.cycleValue:1,service.earnsMultiple=serviceEarnsMultiplied(service,service.earns)})})}function setProposalDefinitions(){var definition=null,dominantFieldName="sell_in"==vm.parent.dominant?"sellIn":"sell_out"==vm.parent.dominant?"sellOut":"";if(vm.needRecalculate=!1,vm.bagVisibility=!0,vm.fixedAmount=0,vm.visibleFixedAmount=!0,vm.visibleVariesAmount=!0,vm.labelFixedAmount="Fixed Amount",vm.page.properties.ds_drugstore_bonus&&(vm.earnedInFixedAmount=vm.page.properties.ds_drugstore_bonus.earnedIn,vm.fixedAmount=vm.page.properties.ds_drugstore_bonus.earnings,vm.labelFixedAmount=vm.page.properties.ds_drugstore_bonus.label,vm.visibleFixedAmount=stringToBoolean(vm.page.properties.ds_drugstore_bonus.visible)),vm.page.properties.ds_campaign_gift_bag_visibility&&(vm.bagVisibility=stringToBoolean(vm.page.properties.ds_campaign_gift_bag_visibility.visible)),vm.groupBy||(vm.groupBy=cloneObj(vm.parent.drugsGroups)),vm.proposal){definition=vm.proposal.definition;try{definition=JSON.parse(definition)}catch(e){}}vm.groupBy.forEach(function(group,index){var potential,propSellIn=vm.page.properties["ds_drugs_group_slider_sell_in_"+group.id],propSellOut=vm.page.properties["ds_drugs_group_slider_sell_out_"+group.id],sellInDrugstores=propSellIn&&propSellIn.drugstores||null,sellOutDrugstores=propSellOut&&propSellOut.drugstores||null,initGroups=null,lastPotential={},props={};if(0===index&&vm.pageLastSelling&&vm.pageLastSelling["ds_drugs_group_new_potential_"+group.id]&&"sell_out"==vm.parent.dominant&&(vm.bagVisibility=!1),definition&&(vm.amountDrugstores=definition.amountNetWorkDrugstores,0!==index||vm.step.readOnly||vm.amountDrugstores==vm.multiplier||setNeedRecalculate(),initGroups=definition.groups.find(function(el){return el.group_id==group.id})),vm.pageLastSelling&&vm.dataPotential.length){if(potential=vm.dataPotential.filter(function(el){return el.group_id==group.id}),potential.length){potential[0].amount_drugstores!=vm.multiplier&&(setNeedRecalculate(TEXT_MESSAGE.WARNING.NEED_RECALCULATE_LAST_SELLING),vm.needRecalculatePotential=!0);try{lastPotential=JSON.parse(potential[0].potential)}catch(e){}}lastPotential.compliant||(vm.drugstoreCompliant=!1)}else dominantFieldName&&vm.parent.campaign.fixed_new_potential&&(lastPotential[dominantFieldName]=vm.parent.campaign.fixed_new_potential);props={group:group,initGroups:initGroups,lastPotential:lastPotential},propSellIn&&("undefined"==typeof propSellIn.visible||null===propSellIn.visible||stringToBoolean(propSellIn.visible))&&(props.fieldName="sellIn",props.propsField=propSellIn,props.propsDrugstores=sellInDrugstores,setFieldData(props)),propSellOut&&("undefined"==typeof propSellOut.visible||null===propSellOut.visible||stringToBoolean(propSellOut.visible))&&(props.fieldName="sellOut",props.propsField=propSellOut,props.propsDrugstores=sellOutDrugstores,setFieldData(props))}),vm.parent.services&&(vm.servicesProperties=cloneObj(vm.parent.services),setServices(definition)),setGifts(),hideDimmer(),vm.dependentServices.length&&setDependentServicesValues(),vm.waiting=!1}function setFieldData(props){var group=props.group,fieldName=props.fieldName,initGroups=props.initGroups,lastPotential=props.lastPotential,propsField=props.propsField,propsDrugstores=props.propsDrugstores;initGroup(group,fieldName,initGroups,lastPotential),setProposalProperties(group,fieldName,propsField,propsDrugstores),setEarnsCopy(group,fieldName),setNewAgreedPotential(group,fieldName,initGroups),setEarns(group,fieldName,initGroups)}function initGroup(group,fieldName,initGroups,lastPotential){var dominant="sellIn"==fieldName?"sell_in":"sell_out";group[fieldName]={label:"Sell In:",visible:!0,type:"single",dominant:vm.parent.dominant==dominant,startValue:0,endValue:100,startMultiple:0,endMultiple:100,values:{vals:"",earns:[],valsMultiple:[]},earns:0,from:initGroups&&initGroups[fieldName+"From"]?initGroups[fieldName+"From"]:0,sign:"",newAgreedPotential:0,lastPotential:lastPotential[fieldName]||0,mk_sh:lastPotential.new_mksh||undefined},lastPotential.totalSales&&(group.totalDrugstoreSales=lastPotential.totalSales)}function setProposalProperties(group,fieldName,properties,propertiesDrugstores){var gain_percent,field=group[fieldName],props={},earns_values=[],number_values=[],redefined={};field.label=properties.label,field.showPercent="percent"==properties.declarated_in,field.earned=properties.earned,field.earned_visibility=!properties.earned_visibility||"visible"==properties.earned_visibility,field.sign="points"==properties.earned?"P":group.currency?group.currency:"Zł",field.stableEarns=!1,properties.number_values&&properties.number_values.length&&((properties.earn_stable_quota||"points"==properties.earned)&&(field.stableEarns=!0,earns_values=properties.number_values.filter(function(prop){return prop.declaratedEarnings||!1}).map(function(prop){return prop.declaratedEarnings})),number_values=properties.number_values.map(function(prop){return prop.declaratedValue}),gain_percent=properties.gain_percent_agreed),propertiesDrugstores&&(redefined=redefineForDrugstore(propertiesDrugstores),angular.isDefined(redefined.gain_percent)&&(gain_percent=redefined.gain_percent),redefined.number_values&&(number_values=redefined.number_values),redefined.earns_values&&(earns_values=redefined.earns_values,field.stableEarns=!0)),number_values.length&&(field.number_values=number_values,field.startValue=number_values[0],number_values.length>=2&&(field.endValue=number_values[number_values.length-1],field.values.vals=number_values.join(","))),field.gain_percent=angular.isDefined(gain_percent)?gain_percent:100,earns_values.length?field.values.earns=earns_values:(props={newPotential:0,declaredEarnings:[],gainPercent:gain_percent},props.declaredEarnings=number_values,"money"==properties.earned&&("percent"==properties.declarated_in?(field.dominant&&!field.lastPotential&&(vm.drugstoreCompliant=!1),props.newPotential=field.lastPotential,calculateEarnings(1,field,props)):"number"==properties.declarated_in&&calculateEarnings(2,field,props))),field.values.earns.length&&(parseInt(field.from)>field.values.earns.length-1&&(field.from=field.values.earns.length-1),field.earns=field.values.earns[field.from]),"percent"!=properties.declarated_in?setMultipleValuesForNumberMoney(field):(field.values.valsMultiple=field.values.vals,field.startMultiple=field.startValue,field.endMultiple=field.endValue)}function setEarnsCopy(group,fieldName){group[fieldName].values.earnsCopy=cloneObj(group[fieldName].values.earns)}function setNewAgreedPotential(group,fieldName,initGroups){var multiple,field=group[fieldName];field.number_values&&field.number_values[field.from]&&(field.showPercent?field.newAgreedPotential=parseFloat(field.lastPotential)*parseFloat(field.number_values[field.from])/100:field.newAgreedPotential=field.number_values[field.from],multiple=Number(parseFloat(field.newAgreedPotential*vm.amountDrugstores).toFixed(2))),vm.virtual_sell_in_colors&&(vm.initVirtualPotential=cloneObj(multiple),vm.virtualPotential||(vm.virtualPotential=vm.initVirtualPotential)),vm.parent.potentialInputVisibility&&(initGroups&&!vm.needRecalculate?(field.newAgreedPotential=Number(parseFloat(initGroups[fieldName+"AgreedPotential"]).toFixed(2)),field.dynamicChangeValues=!0,field.dynamicValue=initGroups[fieldName]):field.newAgreedPotential=Number(parseFloat(field.newAgreedPotential).toFixed(2)),field.showPercent?(field.minAgreedPotential=parseFloat(field.lastPotential)*parseFloat(field.number_values[0])/100,field.maxAgreedPotential=parseFloat(field.lastPotential)*parseFloat(field.number_values[field.number_values.length-1])/100):(field.minAgreedPotential=field.number_values[0],field.maxAgreedPotential=field.number_values[field.number_values.length-1]),field.minAgreedPotential=parseInt(field.minAgreedPotential),field.maxAgreedPotential=parseInt(field.maxAgreedPotential+1),field.newAgreedPotentialMultiple=multiple)}function setEarns(group,fieldName,initGroups){group[fieldName];initGroups&&setRealData(group,fieldName,initGroups)}function setRealData(group,fieldName,initGroups){var field=group[fieldName];field.earns=Number(parseFloat(initGroups[fieldName+"Earns"]).toFixed(2))}function calculateEarnsPercent(props,val){return angular.isDefined(props.gainPercent)||(props.gainPercent=100),parseFloat(props.newPotential*val/100*props.gainPercent/100)}function calculateEarnsNumber(props,val){return angular.isDefined(props.gainPercent)||(props.gainPercent=100),parseFloat(val*props.gainPercent/100)}function calculateEarnings(occurrence,field,props){switch(occurrence){case 1:props.newPotential&&props.declaredEarnings&&props.declaredEarnings.forEach(function(val,index){var number=calculateEarnsPercent(props,val);field.values.earns.push(number)});break;case 2:props.declaredEarnings&&props.declaredEarnings.forEach(function(val,index){var number=calculateEarnsNumber(props,val);field.values.earns.push(number)})}}function setMultipleValuesForNumberMoney(field,array_init){array_init||(array_init=field.number_values),field.values.valsMultiple=array_init.map(function(val){return val*vm.multiplier}),field.startMultiple=field.values.valsMultiple[0],field.values.valsMultiple.length>=2&&(field.endMultiple=field.values.valsMultiple[array_init.length-1],field.values.valsMultiple=field.values.valsMultiple.join(","))}function redefineForDrugstore(drugstoresProperties){
var drugstoreProp,gain_percent,redefineDrugstore=vm.parent.getDrugstoresGroup(vm.drugstoreId),number_values=[],earns_values=[],result={};return redefineDrugstore.length&&(redefineDrugstore=redefineDrugstore[0],drugstoreProp=drugstoresProperties.filter(function(el){return el.group_id==redefineDrugstore.id}),drugstoreProp.length&&(drugstoreProp=drugstoreProp[0],drugstoreProp.gain_percent_agreed&&(gain_percent=drugstoreProp.gain_percent_agreed),drugstoreProp.number_values&&drugstoreProp.number_values.length&&(number_values=drugstoreProp.number_values.map(function(prop){return prop.declaratedValue}),earns_values=drugstoreProp.number_values.filter(function(prop){return prop.declaratedEarnings||!1}).map(function(prop){return prop.declaratedEarnings})))),angular.isDefined(gain_percent)&&(result.gain_percent=gain_percent),number_values.length&&(result.number_values=number_values),earns_values.length&&(result.earns_values=earns_values),result}function calculateEarnsMultiple(field){field.earnsMultiple=Number(parseFloat(field.earns*vm.amountDrugstores).toFixed(2))}function calculateNewAgreedPotential(field,numberValue){numberValue&&!isNaN(numberValue)||(numberValue=0),field.showPercent?field.newAgreedPotential=parseFloat(field.lastPotential*numberValue)/100:field.newAgreedPotential=numberValue,"one_drugstore"==vm.parent.potentialInputVisibility&&(field.newAgreedPotential=Number(parseFloat(field.newAgreedPotential).toFixed(2))),field.newAgreedPotentialMultiple=Number(parseFloat(field.newAgreedPotential*vm.amountDrugstores).toFixed(2))}function getServicesAmount(){var servicesBudgetAmount,servicesBudgetCurrentAmount,servicesDrugsBunchAmount,errorBudget,earnsMultiple,servicesAmount=0,isBlockTotal=!1;return servicesBudgetAmount||(servicesBudgetAmount={}),servicesBudgetCurrentAmount||(servicesBudgetCurrentAmount={}),servicesDrugsBunchAmount||(servicesDrugsBunchAmount={}),vm.groupsServices.forEach(function(group){var serviceGroup=group.group,groupId=group.groupId;groupId&&vm.includeServicesByGroup[groupId]!=serviceGroup.mandatory_services_number&&(isBlockTotal=!0),group.services.forEach(function(service){service.isBlocksPayment&&!service.include&&(isBlockTotal=!0),service.isInBudget&&vm.service_budget&&(angular.isDefined(servicesBudgetAmount[service.budget_id])||(servicesBudgetAmount[service.budget_id]=parseFloat(vm.service_budget[service.budget_id].initPlanned)),angular.isDefined(servicesBudgetCurrentAmount[service.budget_id])||(servicesBudgetCurrentAmount[service.budget_id]=0),angular.isDefined(servicesDrugsBunchAmount[service.drugs_bunch_id])||(servicesDrugsBunchAmount[service.drugs_bunch_id]=parseFloat(vm.service_budget[service.budget_id].actual_bunch[service.drugs_bunch_id].initPlanned))),service.include&&!isBlockTotal&&(earnsMultiple=parseFloat(service.earnsMultiple),servicesAmount+=earnsMultiple,service.isInBudget&&(servicesBudgetAmount[service.budget_id]+=earnsMultiple,servicesDrugsBunchAmount[service.drugs_bunch_id]+=earnsMultiple,servicesBudgetCurrentAmount[service.budget_id]+=earnsMultiple))}),errorBudget=setBudgets(servicesBudgetAmount,servicesDrugsBunchAmount,servicesBudgetCurrentAmount),vm.errorNotSetBudget||checkOverrunBudget(errorBudget)}),{servicesAmount:servicesAmount,isBlockTotal:isBlockTotal}}function checkOverrunBudget(errorBudget){errorBudget.length?(vm.errorBudget=!0,vm.messageSelling="MESSAGE_PLANNED_BUDGET_OVERRUN",setMessageProps(!1)):vm.errorBudget&&(vm.errorBudget=!1,vm.messageSelling="")}function setBudgets(servicesBudgetAmount,servicesDrugsBunchAmount,servicesBudgetCurrentAmount){var errorBudget,pos;return errorBudget||(errorBudget=[]),vm.service_budget&&angular.forEach(vm.service_budget,function(service_budget,budget_id){var actualNumber,actualCurrentNumber;angular.isDefined(servicesBudgetAmount[budget_id])&&(actualNumber=Number(servicesBudgetAmount[budget_id].toFixed(2)),actualCurrentNumber=Number(servicesBudgetCurrentAmount[budget_id].toFixed(2)),service_budget.current_planned=service_budget.initPlanned-service_budget.actual+actualCurrentNumber,service_budget.planned=actualNumber,service_budget.plannedRestBudget=service_budget.budget-service_budget.planned,service_budget.plannedRestBudget<0?(service_budget.planned=cloneObj(service_budget.budget),service_budget.plannedOverrunBudget=Math.abs(cloneObj(service_budget.plannedRestBudget)),service_budget.plannedRestBudget=0,errorBudget.push(budget_id)):(pos=errorBudget.indexOf(budget_id),pos>-1&&errorBudget.splice(pos,1),service_budget.plannedOverrunBudget=0),angular.forEach(servicesDrugsBunchAmount,function(el,drugs_bunch_id){service_budget.actual_bunch[drugs_bunch_id]&&(service_budget.actual_bunch[drugs_bunch_id].planned=el)}))}),errorBudget}function setGifts(){var colors=["green","yellow","red","purple","orange"],indexColor=0,definition=null,elDropped={};if(!vm.gifts&&vm.parentGifts){if(vm.gifts=[],vm.giftsDropped=[],vm.reservePoints=0,vm.proposal){definition=vm.proposal.definition;try{definition=JSON.parse(definition),definition=definition.giftsReserved||[]}catch(e){}}vm.parentGifts.forEach(function(gift,index){var initGift=[],arrName=[];definition&&(initGift=definition.filter(function(el){return el.id==gift.id})),gift.image="",campaignsDataservice.getGift(gift.id).then(function(data){data.resource&&data.resource.image&&data.resource.image.filename&&(gift.filename=data.resource.image.filename,gift.image=GIFT_IMAGES_PATH+data.resource.image.filename)}),(index-1)%5==4||0===index?indexColor=0:indexColor++,arrName=gift.name.split(" "),gift.title=gift.name,gift.name=arrName.length>1?arrName[0]:gift.name,gift.color=colors[indexColor],gift.amount=vm.parentGiftsNumber[gift.id]?vm.parentGiftsNumber[gift.id]:0,gift.amountGift=gift.amount,gift.points=vm.page.properties["ds_campaign_gift_points_"+gift.id]?vm.page.properties["ds_campaign_gift_points_"+gift.id].points:"",vm.gifts.push(gift),initGift.length&&(elDropped=gift,elDropped.amountDropped=initGift[0].amountDropped,elDropped.pointsDropped=initGift[0].pointsDropped,vm.giftsDropped.push(elDropped),gift.amount-initGift[0].amountDropped>=0&&(gift.amount-=initGift[0].amountDropped),vm.reservePoints+=initGift[0].pointsDropped)})}}function fixTouch(touch){var winPageX=window.pageXOffset,winPageY=window.pageYOffset,x=touch.clientX,y=touch.clientY;return 0===touch.pageY&&Math.floor(y)>Math.floor(touch.pageY)||0===touch.pageX&&Math.floor(x)>Math.floor(touch.pageX)?(x-=winPageX,y-=winPageY):(y<touch.pageY-winPageY||x<touch.pageX-winPageX)&&(x=touch.pageX-winPageX,y=touch.pageY-winPageY),{clientX:x,clientY:y}}function hitTest(coord){var element=angular.element("[ng-drop]"),bounds=element[0].getBoundingClientRect();return coord.clientX>=bounds.left&&coord.clientX<=bounds.right&&coord.clientY<=bounds.bottom&&coord.clientY>=bounds.top}function maxGiftsPoints(){var total=0;return vm.groupBy.forEach(function(el){el.sellIn&&"points"==el.sellIn.earned&&(total+=parseInt(el.sellIn.earns*vm.multiplier))}),total}function applyServiceChange(service,indexVariant){service.earns=service.map.earns[indexVariant],service.earns_range=service.map.earns_range[indexVariant],service.earnsMultiple=serviceEarnsMultiplied(service,service.earns),service.from=indexVariant}function setDependentServicesValues(){var varies=vm.getVariesAmount(),totalNewAgreedPotential=varies.totalNewAgreedPotential;vm.dependentServices.forEach(function(service,indexService){service.variants_list.forEach(function(el,indexVariant){service.include&&(totalNewAgreedPotential>=el.min_depending_potential&&totalNewAgreedPotential<=el.max_depending_potential||indexVariant+1==service.variants_list.length&&totalNewAgreedPotential>el.max_depending_potential)&&applyServiceChange(service,indexVariant)})})}function serviceEarnsMultiplied(service,earns){var result=Number(earns);return result*=service.multiplier,result*=service.cycleValue}function setServices(definition,reset){var servicesGroups=[],groupIndex=0;vm.isEnoughIncludesServices=!!vm.parent.servicesGroups.length,vm.includeServicesByGroup={},vm.servicesProperties.groupBy(function(o){return o.group||(o.group=null),o.group}).forEach(function(el,index){var serviceGroup,groupId=el.key,services=el.group,serviceGroupObj={groupId:0,groupIndex:0,group:null,services:[]};groupId&&(serviceGroup=vm.parent.servicesGroups.find(function(gr){return gr.id==groupId}),serviceGroup&&(groupIndex++,serviceGroupObj.group=serviceGroup,serviceGroupObj.groupId=serviceGroupObj.group.id,serviceGroupObj.group.nowIncludeServices=0,serviceGroupObj.groupIndex=groupIndex,vm.includeServicesByGroup[serviceGroupObj.group.id]=0)),services.forEach(function(service,index){var serviceData,initService=null;definition&&definition.services&&(serviceData=definition.services.find(function(s){return s.unique_id==service.unique_id}),serviceData&&(initService={from:serviceData.from,earned:Number(serviceData.earned),include:serviceData.include,multiplier:reset?null:serviceData.multiplier||definition.servicesMultiplier,cycleValue:reset?null:serviceData.cycleValue,budget_id:serviceData.budget_id?serviceData.budget_id:null})),setServiceValues(service,initService),service.include&&serviceGroupObj.group&&vm.includeServicesByGroup[serviceGroupObj.group.id]++,serviceGroupObj.services.push(service)}),servicesGroups.push(serviceGroupObj)}),vm.groupsServices=servicesGroups}function setServiceValues(service,initService){var values,earns,standart_img,earns_range=[];service.earns=0,service.check_buttons=[0,1],service.yes_no=service.check_buttons[0],service.readOnly=service.service_depends_on_potential||!1,service.map={startValue:0,endValue:100,values:"",yes_no:0,earns:[],earns_range:[]},service.from=0,service.include="multi"!=vm.parent.campaign.campaign_scale,angular.isDefined(service.use_drugstores_number_in_multiplier)||(service.use_drugstores_number_in_multiplier=!0),angular.isDefined(service.use_cycle_duration_in_multiplier)||(service.use_cycle_duration_in_multiplier=!0),service.isBlocksPayment=vm.parent.isServiceBlockPayment(service,"proposal"),initService&&(service.from=initService.from||0,service.value=initService.earned||null,service.multiplier=initService.multiplier||null,service.cycleValue=initService.cycleValue||null,"undefined"!=typeof initService.include&&(service.include=initService.include),vm.step.readOnly||vm.needRecalculate||(vm.parent.serviceCount&&vm.parent.serviceCount[service.unique_id]&&service.multiplier!=vm.parent.serviceCount[service.unique_id]&&setNeedRecalculate(),service.use_cycle_duration_in_multiplier?service.cycleValue!=vm.cycleValue&&setNeedRecalculate(TEXT_MESSAGE.WARNING.CYCLE_NUMBER_CHANGED):service.cycleValue>1&&setNeedRecalculate(TEXT_MESSAGE.WARNING.CYCLE_NUMBER_CHANGED))),service.multiplier||(service.multiplier=service.use_drugstores_number_in_multiplier&&vm.parent.serviceCount&&vm.parent.serviceCount[service.unique_id]?vm.parent.serviceCount[service.unique_id]:1),service.cycleValue||(service.cycleValue=service.use_cycle_duration_in_multiplier?vm.cycleValue:1),service.variants_list.length&&(values=service.variants_list.map(function(el){return el.label}),earns=service.variants_list.map(function(el,index){var realValue=index==service.from&&service.value?service.value:el.min_earned;return earns_range.push({min:el.min_earned,max:el.max_earned,real:realValue}),realValue}),standart_img=service.variants_list.map(function(el){return el.files?el.files:{}}),service.standart_img=standart_img,service.standart_img.forEach(function(el){el.filename&&(el.src=MERCH_IMAGES_PATH+el.filename)}),service.map.earns=earns,service.map.earns_range=earns_range,service.earns_range=earns_range[service.from]||0,"slider"==service.type?(service.map.startValue=service.variants_list[0].label,service.variants_list.length>=2&&(service.map.endValue=service.variants_list[service.variants_list.length-1].label),service.map.values=values.join(","),service.earns=service.map.earns[service.from]||0):"radio"==service.type&&(service.variants_list.forEach(function(el,index){el.earned=earns[index]}),service.map.values=service.variants_list,service.earns=service.variants_list.length?service.variants_list[service.from].earned:0),service.earnsInit=cloneObj(service.earns),service.earnsCopy=service.earns_range.min,service.earnsMultiple=serviceEarnsMultiplied(service,service.earns),service.service_depends_on_potential&&vm.dependentServices.push(service)),vm.parent.campaign.budget_item&&service.drugs_bunch_id&&setServiceBudget(service,initService)}function setServiceBudget(service,initService){var objServiceBudget,service_budget=vm.parent.budget.find(function(el){return el.drugs_bunch_id==service.drugs_bunch_id});if(service_budget){if(initService&&!initService.budget_id&&"completed"==vm.step.status)return void(service.isInBudget=!1);service.isInBudget=!0,service.budget_id=service_budget.budget_id,vm.service_budget||(vm.service_budget={}),vm.service_budget[service_budget.budget_id]||(vm.service_budget[service_budget.budget_id]={},vm.service_budget[service_budget.budget_id].rks_id=service_budget.rks_id,vm.service_budget[service_budget.budget_id].budget=Number(service_budget.budget),vm.service_budget[service_budget.budget_id].actual=Number(service_budget.actual),vm.service_budget[service_budget.budget_id].planned=Number(service_budget.planned),vm.service_budget[service_budget.budget_id].current_planned=0,vm.service_budget[service_budget.budget_id].overrunBudget=0,vm.service_budget[service_budget.budget_id].plannedOverrunBudget=0,vm.service_budget[service_budget.budget_id].actual_bunch||(vm.service_budget[service_budget.budget_id].actual_bunch={}),vm.service_budget[service_budget.budget_id].common_budget_mode=service_budget.common_budget_mode),objServiceBudget=vm.service_budget[service_budget.budget_id],objServiceBudget.actual_bunch[service.drugs_bunch_id]||(objServiceBudget.actual_bunch[service.drugs_bunch_id]={},objServiceBudget.actual_bunch[service.drugs_bunch_id].actual=Number(service_budget.actual_bunch),objServiceBudget.actual_bunch[service.drugs_bunch_id].planned=Number(service_budget.planned_bunch),objServiceBudget.actual_bunch[service.drugs_bunch_id].name=service_budget.name),service.include&&initService&&initService.budget_id==service_budget.budget_id&&service_budget.planned_bunch>=service.earnsMultiple&&(objServiceBudget.actual_bunch[service.drugs_bunch_id].planned-=service.earnsMultiple,objServiceBudget.actual_bunch[service.drugs_bunch_id].planned=Number(objServiceBudget.actual_bunch[service.drugs_bunch_id].planned.toFixed(2))),objServiceBudget.actual_bunch[service.drugs_bunch_id].initPlanned=cloneObj(objServiceBudget.actual_bunch[service.drugs_bunch_id].planned),service.include&&initService&&initService.budget_id==service_budget.budget_id&&objServiceBudget.planned>=service.earnsMultiple&&(objServiceBudget.planned-=service.earnsMultiple,objServiceBudget.planned=Number(objServiceBudget.planned.toFixed(2)),objServiceBudget.current_planned+=service.earnsMultiple,objServiceBudget.current_planned=Number(objServiceBudget.current_planned.toFixed(2))),objServiceBudget.initPlanned=cloneObj(objServiceBudget.planned),objServiceBudget.restBudget=service_budget.budget-objServiceBudget.actual,objServiceBudget.plannedRestBudget=service_budget.budget-objServiceBudget.planned,objServiceBudget.percent=Number(parseFloat(objServiceBudget.restBudget/objServiceBudget.budget*100).toFixed(2))}else vm.errorBudget=!0,vm.errorNotSetBudget=!0,vm.parent.isManager||vm.messageSelling||(vm.messageSelling="MESSAGE_NOT_SET_BUDGET",setMessageProps(!1))}function setMulti(){var indexCycleNumber,indexCampaignStatus,multiData=null,now=new Date,cycleDateMinLimit=vm.parent.campaign.cycle_start_date_limit?vm.parent.campaign.cycle_start_date_limit:2,isWithinMonth=vm.parent.isLimitByCurrentMonth,cycleDateMin=now.getDate()-7*cycleDateMinLimit;vm.parent.campaignProgress&&"multi"==vm.parent.campaignProgress.multi&&(multiData=vm.parent.campaignProgress,vm.multiDataId=multiData.id),vm.cycleValues=[],vm.cycleValue=1,vm.campaignDateStart=calcTime(vm.parent.campaign.date_start,!0),vm.campaignDateEnd=calcTime(vm.parent.campaign.date_end,!0),vm.cycleDateStart=now,vm.cycleDateMin=(new Date).setDate(cycleDateMin),vm.cycleDateMax=(new Date).setDate(vm.cycleDateStart.getDate()+14),vm.cycleDateEnd=new Date,vm.campaignStatuses=["pending","active","completed_cycle","completed"],vm.campaignStatus=vm.campaignStatuses[0],isWithinMonth&&new Date(vm.cycleDateMin).getMonth()<now.getMonth()&&(vm.cycleDateMin=new Date(now.getFullYear(),now.getMonth(),1,now.getHours(),now.getMinutes(),0)),vm.parent.campaign.campaign_cycle_values&&(vm.cycleValues=vm.parent.campaign.campaign_cycle_values.split(/[\s,]+/).map(Number),vm.cycleValues.length&&(vm.cycleValue=vm.cycleValues[0],vm.changeCycleDuration())),multiData&&(vm.campaignDateStart=calcTime(vm.parent.campaign.date_start,!0),vm.campaignDateEnd=calcTime(vm.parent.campaign.date_end,!0),vm.cycleDateStart=calcTime(multiData.cycle_date_start,!0),vm.cycleDateEnd=calcTime(multiData.cycle_date_end,!0),indexCycleNumber=vm.cycleValues.indexOf(parseInt(multiData.cycle_number)),indexCycleNumber!=-1&&(vm.cycleValue=vm.cycleValues[indexCycleNumber]),indexCampaignStatus=vm.campaignStatuses.indexOf(multiData.campaign_status),indexCampaignStatus!=-1&&(vm.campaignStatus=vm.campaignStatuses[indexCampaignStatus]))}function refresh(){$state.go($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})}function initProgress(status){var sendData,addCountDays,cycle_number=vm.parent.campaignProgress?vm.parent.campaignProgress.cycle_number:1,cycleDateStart=new Date,cycleDateEnd=new Date;addCountDays=parseInt(cycle_number),addCountDays*="weekly"==vm.parent.campaign.campaign_cycle_type?7:30,cycleDateEnd.setDate(cycleDateEnd.getDate()+addCountDays),cycleDateEnd=new Date(cycleDateEnd),sendData={id:vm.parent.campaignProgress?vm.parent.campaignProgress.id:undefined,campaign_id:vm.parent.campaignId,drugstore_id:vm.parent.drugstoreId,multi:"multi"==vm.parent.campaign.campaign_scale?"multi":"single",cycle_number:cycle_number,cycle_date_start:cycleDateStart,cycle_date_end:cycleDateEnd,real_date_start:new Date,date_start:vm.parent.campaign.date_start,date_end:vm.parent.campaign.date_end},saveProgress(status,sendData,function(data){data&&data.id&&(sendData.id=data.id,vm.parent.campaignProgress=sendData,refresh())})}function saveProgress(status,sendData,cb){var isUpdate;isUpdate=!1,sendData?sendData.campaign_status=status:sendData={campaign_status:status},localDBService.saveCampaignProgress(sendData,isUpdate).then(function(data){vm.lockForm=!1,cb&&cb(data),notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_PROGRESS_SAVED)},function(res){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function setMessageProps(isPageReadOnly){vm.messageSellingClass="negative-text",vm.pageReadOnly=isPageReadOnly}function setNeedRecalculate(msg){vm.pageReadOnly||(vm.messageSelling=msg?msg:"CAMPAIGN_NEED_RECALCULATE",vm.needRecalculate=!0,setMessageProps(!1))}function activate(){var pageLastSelling=[];showDimmer(),vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.campaignId=vm.parent.campaignId,vm.step=vm.parent.step,vm.page=vm.step.pages[vm.templateIndex],vm.parentGifts=vm.parent.gifts,vm.parentGiftsNumber=vm.parent.giftsNumber,vm.saveDisabled=!1,vm.pageLastSelling=null,vm.multiplier=vm.parent.multiplier||1,vm.amountDrugstores=cloneObj(vm.multiplier),vm.cycleValue=vm.parent.cycleValue||1,vm.lockForm=!1,vm.totalIsZero=!1,vm.dependentServices=[],vm.drugstoreCompliant=!0,vm.dataPotential=[],vm.dataFromKamSoftMkSh=vm.parent.campaign.kamsoft_market_share_is_on,vm.waiting=!0,pageLastSelling=getObjectByKey(vm.parent.steps,"type","last_selling_info"),vm.parent.campaign.display_campaign_cycle_type="weekly"==vm.parent.campaign.campaign_cycle_type?"tygodniowy":"miesięczny",pageLastSelling.length&&(vm.pageLastSelling=pageLastSelling[0].properties),setProposal(),vm.page.properties.virtual_sell_in_values&&vm.page.properties.virtual_sell_in_values.length&&(vm.virtual_sell_in_colors=generateColor("#20bbda","#ffffff",vm.page.properties.virtual_sell_in_values.length))}var vm=this;vm.saveProposal=function(form){var proposal,drugstoresIds,sellings,isUpdate,budgets=[],noPotential=null,varies=vm.getVariesAmount();return drugstoresIds=vm.parent.listDrugstores.length>1?vm.parent.listDrugstores.map(function(el){return el.id}):[vm.drugstoreId],vm.drugstoreCompliant?(noPotential=vm.groupBy.find(function(group){return group.sellIn&&group.sellIn.visible&&!group.sellIn.newAgreedPotential||group.sellOut&&group.sellOut.visible&&!group.sellOut.newAgreedPotential}))?void angular.element("#drugstoreNotHasPotential").modal("show"):(isUpdate=!!vm.proposal,sellings={id:vm.proposal?vm.proposal.id:undefined,campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,campaign_progress_id:vm.parent.campaignProgressActiveId,rks_id:vm.parent.rksId,staff_id:vm.parent.userData.id,definition:{drugstoresIds:drugstoresIds,groups:[],services:[],servicesMultiplier:vm.parent.servicesMultiplier||1,cycleValue:vm.cycleValue||1,gifts:[],giftsReserved:[],fixedAmount:vm.fixedAmount,variesAmount:varies.total,variesAmountPoints:varies.totalPoints,totalIsZero:vm.totalIsZero,amountNetWorkDrugstores:vm.multiplier}},vm.lockForm=!0,vm.groupBy.forEach(function(group,index){var arrVals=[],sellIn=0,sellInEarns=0,sellInAgreedPotential=0,sellInFrom=0,sellOut=0,sellInGainPercent=1,sellOutEarns=0,sellOutAgreedPotential=0,sellOutFrom=0,sellOutGainPercent=1;group.sellIn&&group.sellIn.visible&&(arrVals=group.sellIn.number_values,sellInFrom=group.sellIn.from,sellInEarns=group.sellIn.earns,sellIn=arrVals[sellInFrom],angular.isDefined(group.sellIn.gain_percent)&&(sellInGainPercent=group.sellIn.gain_percent),sellInAgreedPotential=group.sellIn.newAgreedPotential),group.sellOut&&group.sellOut.visible&&(arrVals=group.sellOut.number_values,sellOutFrom=group.sellOut.from,sellOutEarns=group.sellOut.earns,sellOut=arrVals[sellOutFrom],angular.isDefined(group.sellOut.gain_percent)&&(sellOutGainPercent=group.sellOut.gain_percent),sellOutAgreedPotential=group.sellOut.newAgreedPotential),sellings.definition.groups.push({group_id:group.id,sellIn:sellIn,sellInFrom:sellInFrom,sellInEarns:sellInEarns,sellInAgreedPotential:sellInAgreedPotential,sellInPercent:sellInGainPercent,signIn:group.sellIn.sign,sellOut:sellOut,sellOutFrom:sellOutFrom,sellOutAgreedPotential:sellOutAgreedPotential,sellOutEarns:sellOutEarns,sellOutPercent:sellOutGainPercent,signOut:group.sellOut.sign,mk_sh:group.sellOut.mk_sh||undefined,totalSales:group.totalDrugstoreSales||undefined})}),vm.groupsServices&&vm.groupsServices.forEach(function(o){o.services.forEach(function(service){var value,budget,budget_rks_id,earned=service.earns;"slider"==service.type&&(value=service.map.values?service.map.values.split(",")[service.from]:0),"radio"==service.type&&(value=service.map.values.length&&service.map.values[service.from]?service.map.values[service.from].label:0),vm.parent.campaign.budget_item&&vm.service_budget&&vm.service_budget[service.budget_id]&&(budget_rks_id=vm.service_budget[service.budget_id].rks_id,budget=service.earnsMultiple),0!==value&&sellings.definition.services.push({group_id:o.groupId,unique_id:service.unique_id,type:service.type,title:service.title,description:service.description||"",from:service.from,value:value,earned:Number(earned),include:service.include,multiplier:service.multiplier,cycleValue:service.cycleValue,budget_id:service.budget_id||undefined,drugs_bunch_id:service.drugs_bunch_id||undefined,budget_planned:budget||undefined,budget_rks_id:budget_rks_id||undefined})})}),vm.parent.campaign.budget_item&&vm.service_budget&&angular.forEach(vm.service_budget,function(s_b,budget_id){var actual_bunch=[],parent_budget=vm.parent.budget.find(function(el){return el.budget_id==budget_id});parent_budget&&!s_b.overrunBudget&&(parent_budget.actual=s_b.actual,parent_budget.planned=s_b.planned,angular.forEach(s_b.actual_bunch,function(s_d_b,drugs_bunch_id){actual_bunch.push({actual:s_d_b.actual,planned:s_d_b.planned,drugs_bunches_id:drugs_bunch_id})}),parent_budget.actual_bunch=actual_bunch,budgets.push(parent_budget))}),vm.gifts&&(sellings.definition.gifts=vm.gifts.map(function(el){return{id:el.id,points:el.points,amount:el.amountGift,filename:el.filename}})),vm.giftsDropped&&(sellings.definition.giftsReserved=vm.giftsDropped.map(function(el){return{id:el.id,amountDropped:el.amountDropped,pointsDropped:el.pointsDropped}})),sellings.definition=JSON.stringify(sellings.definition),proposal=cloneObj(sellings),vm.parent.campaign.budget_item&&(sellings.budgets=budgets),void localDBService.saveProposal(sellings,isUpdate).then(function(data){vm.lockForm=!1,vm.parent.step.isStepStart=!0,vm.parent.is_proposal_saved=!0,vm.needRecalculate&&(vm.needRecalculate=!1,vm.messageSelling=""),data&&data.length&&(vm.proposal={id:data[0]},proposal.id=vm.proposal.id,vm.parent.campaignProposal=[proposal])},function(err){vm.lockForm=!1,err.data.overbudget?notifier.error("Error",TEXT_MESSAGE.ERROR.BUDGET_EXCEEDED):notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})):void angular.element("#drugstoreNotCompliant").modal("show")},vm.changeSlider=function(data,index,field){field&&$scope.$apply(function(){field.earns=field.values.earns[data]?field.values.earns[data]:0,field.from=data,calculateNewAgreedPotential(field,field.number_values[field.from]),vm.dependentServices.length&&field.dominant&&setDependentServicesValues(),vm.parent.potentialInputHand&&calculateEarnsMultiple(field)})},vm.changeEarnsMultiple=function(group,fieldName){var val,intVal,valForNewAgreedPotential,originalValues,field=group[fieldName],startValue=field.startValue,endValue=field.endValue;field.earns=Number(parseFloat(field.earnsMultiple/vm.amountDrugstores).toFixed(3)),val=field.showPercent?parseFloat(100*field.earns*100/(field.lastPotential*field.gain_percent)):parseFloat(100*field.earns/field.gain_percent),intVal=Number(val.toFixed(2)),intVal>startValue&&intVal<endValue?(field.dynamicChangeValues=!0,field.dynamicValue=intVal,valForNewAgreedPotential=intVal):(originalValues=field.values.vals.split(","),field.dynamicChangeValues=!1,intVal<=startValue?(field.dynamicValue=originalValues[0],valForNewAgreedPotential=startValue):intVal>=endValue&&(field.dynamicValue=originalValues[originalValues.length-1],valForNewAgreedPotential=endValue)),calculateNewAgreedPotential(field,valForNewAgreedPotential)},vm.changeNewAgreedPotential=function(group,fieldName){var lastPotential,props,originalValues,intVal,earns,field=group[fieldName],startValue=field.startValue,endValue=field.endValue;originalValues=field.number_values,"one_drugstore"!=vm.parent.potentialInputVisibility&&(field.newAgreedPotential=Number(parseFloat(field.newAgreedPotentialMultiple/vm.amountDrugstores).toFixed(2))),lastPotential=parseFloat(100*field.newAgreedPotential/field.number_values[field.from]),props={newPotential:lastPotential,declaredEarnings:[],gainPercent:field.gain_percent||0},earns=calculateEarnsPercent(props,field.number_values[field.from]),intVal=Number(parseFloat(100*earns*100/(field.lastPotential*field.gain_percent)).toFixed(2)),intVal>=startValue&&intVal<=endValue?(field.dynamicChangeValues=!0,field.dynamicValue=intVal,field.earns=earns,vm.dependentServices.length&&field.dominant&&setDependentServicesValues()):(field.dynamicChangeValues=!1,intVal<startValue?field.dynamicValue=originalValues[0]:intVal>endValue&&(field.dynamicValue=originalValues[originalValues.length-1]))},vm.calculateVirtualPotential=function(val){vm.virtualPotential=Number(parseFloat(vm.initVirtualPotential*val/100).toFixed(2))},vm.changeValues=function(field,newArrVals,newVal,ind){var newArray,updateArray,originalValues=field.values.vals.split(",");return field.values.earns=cloneObj(field.values.earnsCopy),JSON.stringify(newArrVals)!=JSON.stringify(originalValues)?(field.number_values=newArrVals,updateArray=field.number_values,field.from=ind,field.values.earns.splice(ind,0,field.earns)):(updateArray=originalValues,field.values.earns=field.values.earnsCopy,field.from=updateArray.indexOf(newVal)),field.showPercent?newArray=updateArray:(setMultipleValuesForNumberMoney(field,updateArray),newArray=field.values.valsMultiple.split(",")),newArray},vm.getVariesAmount=function(){var total=0,totalPoints=0,result={total:0,totalPoints:0},totalNewAgreedPotential=0;return vm.groupBy&&vm.groupBy.forEach(function(el){el.sellIn||(el.sellIn={earns:0}),el.sellOut||(el.sellOut={earns:0}),"P"!=el.sellIn.sign&&"P"!=el.sellOut.sign?total+=parseFloat(el.sellIn.earns)+parseFloat(el.sellOut.earns):totalPoints+=parseInt(el.sellIn.earns)+parseInt(el.sellOut.earns),el.sellIn.dominant&&(totalNewAgreedPotential+=parseFloat(el.sellIn.newAgreedPotential)),el.sellOut.dominant&&(totalNewAgreedPotential+=parseFloat(el.sellOut.newAgreedPotential))}),total||totalPoints||(vm.visibleVariesAmount=!1),result.totalNewAgreedPotential=totalNewAgreedPotential*vm.multiplier,result.total=total,result.totalPoints=totalPoints,result},vm.getProposalTotalAmount=function(){var total=0,totalPoints=0,servicesAmount=0,isBlockTotal=!1,resultServices={},variesAmount=vm.getVariesAmount(),result={total:0,totalPoints:0,totalServices:0,variesAmount:0};return vm.waiting||(totalPoints=parseInt(variesAmount.totalPoints*vm.multiplier),total=parseFloat(variesAmount.total*vm.multiplier),result.variesAmount=variesAmount,vm.servicesProperties&&vm.servicesProperties.length&&(resultServices=getServicesAmount(),servicesAmount=resultServices.servicesAmount,isBlockTotal=resultServices.isBlockTotal,total+=servicesAmount),"money"==vm.earnedInFixedAmount?total+=parseFloat(vm.fixedAmount):(vm.fixedAmount=parseInt(vm.fixedAmount),totalPoints+=vm.fixedAmount),isBlockTotal?(result.total=0,result.totalPoints=0,result.totalServices=0,vm.totalIsZero=!0):(result.total=total,result.totalPoints=totalPoints,result.totalServices=servicesAmount,vm.totalIsZero=!1)),vm.totalAmount=result,result},vm.showStandartPicture=function(src){src&&(vm.showServiceImg=src,angular.element("#showServicePicture").modal("show"))},vm.toggleServiceInclude=function(service){service.earns=service.map.earns[service.from],service.earns_range=service.map.earns_range[service.from],service.earnsMultiple=serviceEarnsMultiplied(service,service.earns),service.group&&(service.include?vm.includeServicesByGroup[service.group]++:vm.includeServicesByGroup[service.group]&&vm.includeServicesByGroup[service.group]--)},vm.changeServiceSlider=function(data,index,obj){obj.include&&$scope.$apply(function(){"undefined"!=typeof obj.map.earns[data]&&null!==obj.map.earns[data]&&(obj.earns=obj.map.earns[data],obj.earns_range=obj.map.earns_range[data],obj.earnsMultiple=serviceEarnsMultiplied(obj,obj.earns),obj.from=data)})},vm.radioChange=function(service,index){service.earns=service.map.earns[service.from],service.earns_range=service.map.earns_range[index],service.earnsMultiple=serviceEarnsMultiplied(service,service.earns)},vm.changeEarnsNumber=function(service){var earns=service.earns;service.earns||(earns=service.earnsCopy),service.earnsMultiple=serviceEarnsMultiplied(service,earns)},vm.prevServiceEarns=function(service){var min=service.earns_range.min||0,step=10;service.include&&service.earns-step>=min&&(service.earns-=step,service.earnsMultiple=serviceEarnsMultiplied(service,service.earns))},vm.nextServiceEarns=function(service){var max=service.earns_range.max||0,step=10;service.include&&service.earns+step<=max&&(service.earns+=step,service.earnsMultiple=serviceEarnsMultiplied(service,service.earns))},vm.startMulti=function(){setMulti(),angular.element("#showMulti").modal("show")},vm.changeCycleDuration=function(){var addCountDays,cycleDateEnd=new Date;vm.cycleDateStart&&(cycleDateEnd=new Date(vm.cycleDateStart),addCountDays=parseInt(vm.cycleValue),addCountDays*="weekly"==vm.parent.campaign.campaign_cycle_type?7:30,cycleDateEnd.setDate(cycleDateEnd.getDate()+addCountDays),vm.cycleDateEnd=new Date(cycleDateEnd))},vm.saveMulti=function(){var isUpdate=vm.multiDataId&&"completed"!=vm.parent.campaignProgress.campaign_status||!1,sendData={
id:isUpdate?vm.multiDataId:undefined,campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,multi:"multi",campaign_status:vm.campaignStatus,cycle_number:vm.cycleValue,cycle_date_start:vm.cycleDateStart,cycle_date_end:vm.cycleDateEnd,real_date_start:vm.cycleDateStart,date_start:vm.campaignDateStart,date_end:vm.campaignDateEnd};vm.lockForm=!0,localDBService.saveCampaignProgress(sendData,isUpdate).then(function(data){if(vm.lockForm=!1,vm.proposal){if(vm.parent.cycleValue!=vm.cycleValue)return void refresh()}else vm.parent.cycleValue=vm.cycleValue,vm.servicesProperties.forEach(function(service){service.cycleValue=service.use_cycle_duration_in_multiplier?vm.cycleValue:1,service.earnsMultiple=serviceEarnsMultiplied(service,service.earns)});data&&data.id&&(vm.parent.campaignProgress=sendData,vm.parent.campaignProgress.id=data.id,vm.parent.campaignProgress.cycle_date_start=moment.utc(vm.cycleDateStart).format("YYYY-MM-DD HH:mm"),vm.parent.campaignProgress.cycle_date_end=moment.utc(vm.cycleDateEnd).format("YYYY-MM-DD HH:mm"),vm.parent.period.start=calcTime(vm.parent.campaignProgress.cycle_date_start,!0),vm.parent.period.end=calcTime(vm.parent.campaignProgress.cycle_date_end,!0))})},vm.startCampaign=function(){return!vm.lockForm&&(vm.lockForm=!0,void initProgress("pending"))},vm.resetProposal=function(){resetProposal(),vm.saveProposal()},vm.showGiftInfo=function(obj){vm.showGift=obj,angular.element("#showGift").modal("show")},vm.onDragStart=function(data,evt){angular.element(evt.target).text(data.name).attr("starting-drag","true")},vm.onDragEnd=function(data,evt){angular.element(evt.target).text("")},vm.onDropComplete=function(data,evt){var el=evt.element,index=vm.giftsDropped.indexOf(data),dataDropped=data;if(vm.maxPoints=maxGiftsPoints(),"true"==el.attr("starting-drag")){if(0===data.amount)return!1;if(data.points){if(vm.reservePoints+data.points>vm.maxPoints)return!1;vm.reservePoints+=data.points}index==-1?(dataDropped.amountDropped=1,data.points&&(dataDropped.pointsDropped=data.points?data.points:0),vm.giftsDropped.push(data)):(data.amount>0&&dataDropped.amountDropped++,data.points&&(dataDropped.pointsDropped+=data.points)),data.amount>0&&data.amount--,el.attr("starting-drag","false")}},vm.onDroppedDragEnd=function(data,evt){var touching,coord,index=vm.giftsDropped.indexOf(data),hasTouch=(angular.element(evt.target).parents("[ng-drag]"),"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch);hasTouch&&evt.originalEvent&&evt.originalEvent.changedTouches.length?coord=fixTouch(evt.originalEvent.changedTouches[0]):evt.clientX&&(coord={clientX:evt.clientX,clientY:evt.clientY}),touching=hitTest(coord),touching||(data.amountDropped>1?data.amountDropped--:1==data.amountDropped&&vm.giftsDropped.splice(index,1),data.amount++,data.points&&(data.pointsDropped-=data.points,vm.reservePoints-=data.points))},activate()}angular.module("app.campaigns").controller("CampaignsProposalController",CampaignsProposalController),CampaignsProposalController.$inject=["$scope","$state","campaignsDataservice","localDBService","notifier","GIFT_IMAGES_PATH","MERCH_IMAGES_PATH","TEXT_MESSAGE"]}(),function(undefined){"use strict";function CampaignsProposalTotalController($scope,stepsService,campaignsDataservice,localDBService,notifier,$q,DocumentsWorkflowManager,TEXT_MESSAGE){function applyStepProposalTotal(data){vm.parent.campaignProgress?_applyStep(data):initProgress().then(function(progress){DocumentsWorkflowManager.setProgressId(progress.id),_applyStep(data)})}function _applyStep(data){data.campaign_progress_id=vm.parent.campaignProgress.id,DocumentsWorkflowManager.selectWorkflowStep(0).storeDocument(data).then(function(){DocumentsWorkflowManager.executeAction().then(function(){DocumentsWorkflowManager.setCampaignStepStatus().then(function(){var stepStatus=stepsService.getStepStatus(vm.parent.step.unique_id,vm.parent.drugstoreId,vm.parent.campaignId);stepsService.setStepProperties(stepStatus,vm.parent.step),DocumentsWorkflowManager.jumpToNextStep().then(function(){DocumentsWorkflowManager.commit().then(function(res){vm.lockForm=!1,notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),vm.parent.refresh()},function(err){var arr_err=[];err.data&&err.data.message&&(arr_err=err.data.message.split(",")),arr_err.length&&arr_err[1]&&"Overbudget"==arr_err[1].trim()?notifier.error("Error",TEXT_MESSAGE.ERROR.BUDGET_EXCEEDED):notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),vm.parent.refresh()})},function(err){vm.lockForm=!1,console.log(err),notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)})},function(err){vm.lockForm=!1,console.log(err),notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)})},function(err){vm.lockForm=!1,console.log(err),notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)})},function(err){vm.lockForm=!1,console.log(err),notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)})}function activate(){var offlineData,now=new Date;showDimmer(),vm.parent=$scope.$parent.vm,vm.step=vm.parent.step,vm.pageReadOnly=!1,vm.fixedAmount=0,vm.variesAmount=0,vm.variesAmountPoints=0,vm.total=0,vm.isCampaignStart=!0,vm.multiplier=vm.parent.multiplier||1,vm.cycleValue=vm.parent.cycleValue||1,vm.lockForm=!1,vm.generateDisabled=!0,vm.isRegistered=vm.isRegisteredAtPortal(),vm.cycleStart="multi"==vm.parent.campaign.campaign_scale?now:vm.parent.campaign.date_start,vm.cycleEnd=calculateCycleEnd(),vm.cycleStartDisplay=vm.cycleStart,vm.cycleEndDisplay=vm.cycleEnd,vm.budget=[],vm.waiting=!0,vm.parent.campaignProgress&&(vm.cycleStart=vm.parent.campaignProgress.cycle_date_start,vm.cycleEnd=vm.parent.campaignProgress.cycle_date_end,vm.cycleStartDisplay=calcTime(vm.parent.campaignProgress.cycle_date_start,!0),vm.cycleEndDisplay=calcTime(vm.parent.campaignProgress.cycle_date_end,!0)),vm.drugstores=vm.parent.listDrugstores,vm.parent.offlineMode?(offlineData=localDBService.getPageData("proposal")||[],setProposalTotalDefinitions(offlineData)):DocumentsWorkflowManager.init("campaign_proposal_contract",{drugstoreName:vm.parent.drugstore.name,drugstoreNIP:vm.parent.drugstore.NIP,drugstoreFrameContractSignDate:vm.parent.drugstore.frame_contract_sign_date,drugstoreId:vm.parent.drugstoreId,campaignId:vm.parent.campaignId,campaignProgressId:vm.parent.campaignProgress?vm.parent.campaignProgress.id:undefined,campaignName:vm.parent.campaign.name,rksId:vm.parent.rksId,campaignIdentifier:vm.parent.campaign.identifier,promolineName:vm.parent.campaign.promoline.name,drugsGroups:cloneObj(vm.parent.drugsGroups),campaignStep:cloneObj(vm.parent.step),campaignProgress:cloneObj(vm.parent.campaignProgress)},vm.parent.campaign.docs_workflow_definition).then(function(res){setProposalTotal()})}function checkProblems(){var isCan=!0;return!vm.parent.campaignProgress||"completed"!=vm.parent.campaignProgress.campaign_status&&"completed_cycle"!=vm.parent.campaignProgress.campaign_status?vm.parent.isSignature||vm.step.readOnly?vm.isRegistered?vm.parent.countMainOffices>1&&"completed"!=vm.step.status?(isCan=!1,vm.messageSelling="CAMPAIGN_MANY_MAIN_OFFICE"):"drugstore_not_compliant"==vm.step.status?(isCan=!1,vm.messageSelling="DRUGSTORE_NOT_COMPLIANT"):vm.parent.campaign.budget_item&&(isCan=checkOverrunBudget(),isCan||(vm.messageSelling="MESSAGE_BUDGET_OVERRUN")):vm.messageSelling="NOT_REGISTERED":vm.messageSelling="NOT_RIGHTS_FOR_EDIT":vm.messageSelling="CAMPAIGN_FINISHED",vm.messageSelling&&setMessageProps(!0),isCan}function checkOverrunBudget(){var overrunBudget,isCan=!0;return vm.parent.budget&&(overrunBudget=vm.parent.budget.find(function(el){return Number(el.actual)>Number(el.budget)}),overrunBudget&&(isCan=!1)),isCan}function setMessageProps(isPageReadOnly){vm.messageSellingClass="negative-text",vm.pageReadOnly=isPageReadOnly}function setNeedRecalculate(msg){vm.pageReadOnly||(vm.messageSelling=msg?msg:"CAMPAIGN_NEED_RECALCULATE",vm.needRecalculate=!0,setMessageProps(!0))}function getProposal(callback){var campaignProgress=vm.parent.campaignProgress&&"pending"!=vm.parent.campaignProgress.campaign_status?vm.parent.campaignProgress.id:null;campaignsDataservice.getProposal(vm.parent.campaignId,campaignProgress,vm.parent.drugstoreId).then(function(result){var data=result.data?result.data:[];vm.parent.campaignProposal=data,result.drugstores&&result.drugstores.length&&(vm.drugstores=result.drugstores),callback(data)},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function setProposalTotal(){var isCan=checkProblems();isCan?getProposal(setProposalTotalDefinitions):hideDimmer()}function setProposalTotalDefinitions(dataProposal){var definition,servicesEarned=0,budget={};if(hideDimmer(),dataProposal.length)try{definition=JSON.parse(dataProposal[0].definition)}catch(e){}else vm.messageSelling="NO_PROPOSAL_DATA",setMessageProps(!0);vm.newAgreedPotential={sellIn:0,sellOut:0},definition&&(vm.step.readOnly||definition.amountNetWorkDrugstores==vm.parent.multiplier||setNeedRecalculate(),setTotalAgreedPotential(definition.groups),vm.multiplier=definition.amountNetWorkDrugstores||vm.parent.multiplier,vm.fixedAmount=definition.fixedAmount||0,vm.variesAmount=parseFloat(definition.variesAmount*vm.multiplier)||0,vm.variesAmountPoints=parseInt(definition.variesAmountPoints*vm.multiplier)||0,vm.services=definition.services,vm.drugstoresIds=definition.drugstoresIds||[],vm.services.forEach(function(service){var serviceProperties=vm.parent.services.find(function(originalService){return originalService.unique_id==service.unique_id});service.include&&(angular.isDefined(serviceProperties.use_drugstores_number_in_multiplier)||(serviceProperties.use_drugstores_number_in_multiplier=!0),angular.isDefined(serviceProperties.use_cycle_duration_in_multiplier)||(serviceProperties.use_cycle_duration_in_multiplier=!0),angular.isDefined(service.multiplier)||(service.multiplier=serviceProperties.use_drugstores_number_in_multiplier?definition.servicesMultiplier:1),angular.isDefined(service.cycleValue)||(service.cycleValue=serviceProperties.use_cycle_duration_in_multiplier?vm.cycleValue:1),vm.step.readOnly||(vm.parent.serviceCount&&vm.parent.serviceCount[service.unique_id]&&service.multiplier!=vm.parent.serviceCount[service.unique_id]&&setNeedRecalculate(),service.cycleValue!=vm.cycleValue&&serviceProperties.use_cycle_duration_in_multiplier&&setNeedRecalculate(TEXT_MESSAGE.WARNING.CYCLE_NUMBER_CHANGED)),vm.parent.campaign.budget_item&&service.budget_id&&service.budget_planned&&(budget[service.budget_id]||(budget[service.budget_id]={}),budget[service.budget_id][service.drugs_bunch_id]||(budget[service.budget_id][service.drugs_bunch_id]={},budget[service.budget_id][service.drugs_bunch_id].planned=0,budget[service.budget_id][service.drugs_bunch_id].rks_id=service.budget_rks_id),budget[service.budget_id][service.drugs_bunch_id].planned+=service.budget_planned),service.earnsMultiple=service.earned*service.multiplier*service.cycleValue)}),servicesEarned=getServicesEarned(),vm.servicesEarned=servicesEarned,vm.total=definition.totalIsZero?0:parseFloat(vm.fixedAmount)+vm.variesAmount+servicesEarned,vm.parent.campaign.budget_item&&angular.forEach(budget,function(s_b,budget_id){angular.forEach(s_b,function(s_d_b,drugs_bunch_id){vm.budget.push({budget_id:budget_id,drugs_bunch_id:drugs_bunch_id,planned:s_d_b.planned,rks_id:s_d_b.rks_id})})})),0!==vm.total||vm.pageReadOnly||(vm.messageSelling="TOTAL_IS_ZERO",setMessageProps(!1)),vm.waiting=!1,vm.generateDisabled=!vm.isRegistered||vm.parent.step.readOnly||vm.pageReadOnly||vm.parent.offlineMode||!dataProposal.length}function setTotalAgreedPotential(groups){groups.forEach(function(group){var need_group;vm.newAgreedPotential.sellIn+=parseFloat(group.sellInAgreedPotential),vm.newAgreedPotential.sellOut+=parseFloat(group.sellOutAgreedPotential),vm.dataKamSoftMkSh=null,vm.parent.campaign.kamsoft_market_share_is_on&&(vm.dataKamSoftMkSh=[],need_group=vm.parent.drugsGroups.find(function(dg){return dg.id==group.group_id}),need_group&&vm.dataKamSoftMkSh.push({group_name:need_group.name,mk_sh:group.mk_sh}))})}function getServicesEarned(){var totalServices=0;return vm.services.forEach(function(service){service.include&&(totalServices+=parseFloat(service.earned*service.multiplier*service.cycleValue))}),totalServices}function getServicesEarnings(){var retval=[];return vm.services.forEach(function(service){service.include&&retval.push({unique_id:service.unique_id,title:service.title,description:service.description||"",earned:service.earned,from:service.from,type:service.type,value:service.value,multiplier:service.multiplier,cycleValue:service.cycleValue,budget_id:service.budget_id||undefined,drugs_bunch_id:service.drugs_bunch_id||undefined,budget_planned:service.budget_planned||undefined})}),retval}function calculateCycleEnd(){var cycleDateEnd,addCountDays,cycleDateStart=vm.cycleStart;return"multi"==vm.parent.campaign.campaign_scale?(cycleDateEnd=new Date(cycleDateStart),addCountDays="weekly"==vm.parent.campaign.campaign_cycle_type?7:30,cycleDateEnd.setDate(cycleDateEnd.getDate()+addCountDays),cycleDateEnd=new Date(cycleDateEnd),cycleDateEnd=calcTime(cycleDateEnd),isNaN(cycleDateEnd.getTime())&&(cycleDateEnd=vm.parent.campaign.date_end)):cycleDateEnd=vm.parent.campaign.date_end,cycleDateEnd}function initProgress(){var sendData,realDateStart;return realDateStart="multi"==vm.parent.campaign.campaign_scale?vm.parent.campaignProgress?vm.parent.campaignProgress.cycle_date_start:new Date:"predefined_date"==vm.parent.campaign.start_campaign_date?vm.parent.campaign.date_start:new Date,sendData={id:vm.parent.campaignProgress?vm.parent.campaignProgress.id:undefined,campaign_id:vm.parent.campaignId,drugstore_id:vm.parent.drugstoreId,multi:"multi"==vm.parent.campaign.campaign_scale?"multi":"single",campaign_steps_status:stepsService.getStepsStatuses(vm.parent.drugstoreId,vm.parent.campaignId),cycle_number:vm.cycleValue,cycle_date_start:vm.cycleStart,cycle_date_end:vm.cycleEnd,real_date_start:realDateStart,date_start:vm.parent.campaign.date_start,date_end:vm.parent.campaign.date_end},saveProgress("pending",sendData,function(data){data&&data.id&&(sendData.id=data.id,vm.parent.campaignProgress=sendData)})}function saveProgress(status,sendData,cb){var isUpdate,defer=$q.defer();return isUpdate=vm.parent.campaignProgress&&"completed"!=vm.parent.campaignProgress.campaign_status&&"completed_cycle"!=vm.parent.campaignProgress.campaign_status||!1,sendData?sendData.campaign_status=status:sendData={campaign_status:status},campaignsDataservice.saveCampaignProgress(sendData,isUpdate).then(function(data){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_PROGRESS_SAVED),cb&&cb(data),defer.resolve(data)},function(res){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),defer.reject()}),defer.promise}var vm=this;vm.isRegisteredAtPortal=function(){return vm.parent.drugstore.parent_drugstore?vm.parent.drugstore.parent_drugstore.registered_at_portal:vm.parent.drugstore.registered_at_portal},vm.generateProposal=function(){return vm.parent.drugstore.address_id&&vm.parent.drugstore.juridical_address_id&&vm.parent.drugstore.frame_contract_sign_date?0===vm.total?void angular.element("#proposalTotalZero").modal("show"):void("multi"==vm.parent.campaign.campaign_scale?angular.element("#confirmSetMulti").modal("show"):vm.sendProposalTotal()):void angular.element("#drugstoreWithoutAddress").modal("show")},vm.sendProposalTotal=function(){var data;return!vm.lockForm&&(vm.parent.rksId?(vm.lockForm=!0,data={drugstore_id:vm.parent.drugstoreId,drugstoresIds:vm.drugstoresIds,start_step_unique_id:vm.parent.step.unique_id,campaign_id:vm.parent.campaignId,cycle_start:vm.cycleStart,cycle_end:vm.cycleEnd,multiplier:vm.multiplier,fixed_amount:vm.fixedAmount,variable_amount:vm.variesAmount,variable_amount_points:vm.variesAmountPoints,new_agreed_potential:"sell_in"==vm.parent.dominant?vm.newAgreedPotential.sellIn:vm.newAgreedPotential.sellOut,services:getServicesEarnings(),services_earned:getServicesEarned(),total:vm.total,budget:vm.budget},void(vm.parent.drugstore.negotiation_point&&vm.parent.drugstore.drugstores_network_id?campaignsDataservice.getCountCampaignDrugstoreNetwork(vm.parent.campaignId,vm.parent.drugstoreId,vm.parent.userData.id).then(function(countNetworkDrugstores){countNetworkDrugstores!=vm.drugstores.length?(notifier.warning("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION),vm.parent.refresh()):applyStepProposalTotal(data)},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION)}):applyStepProposalTotal(data))):(notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.NOT_RKS),!1))},activate()}angular.module("app.campaigns").controller("CampaignsProposalTotalController",CampaignsProposalTotalController),CampaignsProposalTotalController.$inject=["$scope","stepsService","campaignsDataservice","localDBService","notifier","$q","DocumentsWorkflowManager","TEXT_MESSAGE"]}(),function(undefined){"use strict";function CampaignsSellingInfoController($rootScope,$scope,campaignsDataservice,localDBService,stepsService,notifier,TEXT_MESSAGE,MERCH_IMAGES_PATH){function checkProblems(){var isCan=!0;return vm.messageSelling=null,vm.parent.campaignProgressActiveId?vm.parent.isVisit||vm.step.readOnly?"neutral"==vm.parent.dominant?(isCan=!1,vm.messageSelling="CAMPAIGN_NOT_DOMINANT"):vm.parent.countMainOffices>1&&"completed"!=vm.step.status&&(isCan=!1,vm.messageSelling="CAMPAIGN_MANY_MAIN_OFFICE"):vm.messageSelling="NOT_RIGHTS_FOR_EDIT":vm.messageSelling=!vm.parent.campaignProgress||"completed"!=vm.parent.campaignProgress.campaign_status&&"completed_cycle"!=vm.parent.campaignProgress.campaign_status?"CAMPAIGN_NOT_ACTIVE":vm.messageSelling="CAMPAIGN_FINISHED",vm.messageSelling&&setMessageProps(!0),isCan}function isExistsPrevSellingInfo(){var sellingInfoPrev=[],stepIndex=vm.parent.steps.findIndex(function(step){return step.unique_id==vm.uid});return stepIndex&&(sellingInfoPrev=vm.parent.steps.filter(function(step,index){var sellingInfoPrevPage;return index<stepIndex&&(sellingInfoPrevPage=step.pages.find(function(page){return"selling_info"==page.type})),sellingInfoPrevPage})),sellingInfoPrev}function getServiceControl(campaignProgress){campaignsDataservice.getServiceControl(vm.campaignId,campaignProgress,vm.uid,vm.drugstoreId).then(function(result){result.length&&(vm.dataServiceControl=result)},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function getSelling(callback){var campaignProgress=vm.parent.campaignProgress&&"pending"!=vm.parent.campaignProgress.campaign_status?vm.parent.campaignProgress.id:null,isPrevStep=!1,requestData={};campaignProgress&&(isPrevStep=isExistsPrevSellingInfo().length>0,requestData={campaign_id:vm.campaignId,campaignProgressId:campaignProgress,step_id:vm.uid,drugstore_id:vm.drugstoreId,count_drugs:vm.parent.drugs.length,is_prev_step:isPrevStep,is_final:!1},campaignsDataservice.getSellingInfo(requestData).then(function(result){var kam_soft_data,data=result.data?result.data:[],kam_soft=result.kam_soft,kamSoftMkSh=result.kam_soft_mk_sh,fromPrevStep=!!result.from_prev_step&&result.from_prev_step;fromPrevStep&&(vm.cycleCounter=1,vm.selling_style.color="#0000FF",vm.fromPrevStep=!0),kam_soft&&kam_soft.length&&(kam_soft_data=kam_soft.find(function(el){return"selling"==el.page}),vm.kamSoftPicture={},kam_soft_data&&(vm.kamSoftPicture.src=MERCH_IMAGES_PATH+kam_soft_data.kamsoft_img_file,vm.kamSoftPicture.id=kam_soft_data.kamsoft_img_id)),kamSoftMkSh&&setKamSoftMkSh(kamSoftMkSh),callback(data),vm.page.needCloseStep&&setCloseStepStatus()},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)}))}function setSellingInfo(){var isCan=checkProblems();setCampaignKnob(),initPageProperties(),vm.canEditData=!vm.dataFromKamSoft,vm.kamSoftPicture={},isCan&&(vm.parent.offlineMode?setSellingDefinitions([]):getSelling(setSellingDefinitions),vm.parent.campaignProgress&&"multi"==vm.parent.campaignProgress.multi&&setMultiKnob())}function setSellingDefinitions(data){var definition,dataProposal=vm.parent.campaignProposal;if(dataProposal.length){definition=dataProposal[0].definition;try{definition=JSON.parse(definition)}catch(e){}}vm.parent.offlineMode&&(data=localDBService.getPageData("selling_info_"+vm.uid)||[],vm.dataServiceControl=localDBService.getPageData("service_control_"+vm.uid)||[]),vm.dataSellingInfo=data,calculateSellingInfo(data,definition)}function calculateSellingInfo(data,dataProposal){vm.sellInTotal=0,vm.sellOutTotal=0,vm.stockTotal=0,vm.groupBy.forEach(function(group,index){var initDrugPotential,groupProperties=vm.properties[group.id];initGroupCounters(group),dataProposal&&dataProposal.groups&&(initDrugPotential=dataProposal.groups.filter(function(el){return el.group_id==group.id}),initDrugPotential.length&&setProposalProperties(initDrugPotential[0],group)),vm.column.sellIn.visibility&&redefineForDrugstore(group,"sellIn",groupProperties),vm.column.sellOut.visibility&&redefineForDrugstore(group,"sellOut",groupProperties),setDrugData(data,group),calculateGroup(group),calculateTotal(group)}),vm.originalData=JSON.stringify(vm.groupBy),$scope.$watch(function(){return JSON.stringify(vm.groupBy)},function(newValue){vm.parent.isPageChange=newValue!==vm.originalData})}function calculateDrug(drug,fieldName){var numSell=drug[fieldName],divider=vm.multiplier;return""===numSell&&(numSell=0),numSell/=divider,parseFloat(campaignsDataservice.calcAmountForDrug(numSell,drug.price))}function groupAmount(drug,group,fieldName){var total=0,num=drug[fieldName],amountDrugs=0;return num||(num=0),amountDrugs=calculateDrug(drug,fieldName),group.amountDrugs[fieldName]+=amountDrugs,group.numberDrugs[fieldName]+=num,total+=parseFloat(num*drug.price)}function calculateGroup(group,fieldChange){var groupProperties=vm.properties[group.id],amountDrugs=cloneObj(group.amountDrugs),numberDrugsSellOut=cloneObj(group.numberDrugs.sellOut),gained_percent=0,calculateMinMax=function(fieldName){var maxPercent,minPercent;maxPercent=groupProperties[fieldName].number_values.map(function(el){return el.declaratedValue}).max(),minPercent=group[fieldName+"MinPercent"],group[fieldName+"maxPercent"]=maxPercent,group[fieldName+"AgreedPotential"]&&(group[fieldName+"MaxAmountDrugs"]=parseFloat(group[fieldName+"AgreedPotential"]*maxPercent/100),group[fieldName+"MinAmountDrugs"]=parseFloat(group[fieldName+"AgreedPotential"]*minPercent/100))},calculateMkShProgress=function(fieldName){group.nowTotalDrugstoreSales&&(group[fieldName+"PointsProgress"]=+parseFloat(campaignsDataservice.calcSelling(numberDrugsSellOut,Number(group.nowTotalDrugstoreSales))).toFixed(2)),group[fieldName+"RealPointsProgress"]=group[fieldName+"PointsProgress"],group[fieldName+"PointsProgress"]>100&&(group[fieldName+"PointsProgress"]=100)},calculateFieldGroup=function(fieldName){group[fieldName+"AgreedPotential"]&&(group[fieldName+"PointsProgress"]=+parseFloat(campaignsDataservice.calcSelling(amountDrugs[fieldName],Number(group[fieldName+"AgreedPotential"].toFixed(2)))).toFixed(2)),group[fieldName+"RealPointsProgress"]=group[fieldName+"PointsProgress"],group[fieldName+"PointsProgress"]>100&&(group[fieldName+"PointsProgress"]=100),group[fieldName+"HundredsNumber"]=parseInt(group[fieldName+"RealPointsProgress"]/100),group[fieldName+"MinPercent"]=groupProperties[fieldName].number_values.map(function(el){return el.declaratedValue}).min(),fieldName==vm.dominant&&calculateMinMax(fieldName)};fieldChange?calculateFieldGroup(fieldChange):(vm.column.sellIn.visibility&&calculateFieldGroup("sellIn"),vm.column.sellOut.visibility&&calculateFieldGroup("sellOut")),vm.dataFromKamSoftMkSh&&calculateMkShProgress("mkSh"),gained_percent=getPercent(group,vm.dominant),group[vm.dominant+"MinAmountDrugs"]&&amountDrugs[vm.dominant]<group[vm.dominant+"MinAmountDrugs"]&&(gained_percent=0),group[vm.dominant+"MaxAmountDrugs"]&&amountDrugs[vm.dominant]>group[vm.dominant+"MaxAmountDrugs"]&&(amountDrugs[vm.dominant]=group[vm.dominant+"MaxAmountDrugs"]),calculateGroupMoney(group,amountDrugs[vm.dominant],gained_percent,vm.dominant)}function calculateTotal(group){vm.column.sellIn.visibility&&(vm.sellInTotal+=parseFloat(group.sellInTotal)),vm.column.sellOut.visibility&&(vm.sellOutTotal+=parseFloat(group.sellOutTotal)),vm.column.stock.visibility&&(vm.stockTotal+=parseFloat(group.stockTotal))}function calculateGroupMoney(group,amountDrugs,gained_percent,fieldName){var groupProperties=vm.properties[group.id];group[fieldName+"Money"]=0,groupProperties[fieldName].earn_stable_quota?group[fieldName+"Earns"]&&(group[fieldName+"Money"]=parseFloat(campaignsDataservice.calcEarns(group[fieldName+"Earns"],gained_percent)),"P"==group[fieldName+"Sign"]&&(group[fieldName+"Money"]=parseInt(group[fieldName+"Money"]))):group[fieldName+"Money"]=parseFloat(campaignsDataservice.calcEarns(amountDrugs,gained_percent))}function getPercent(group,dominant){var gained_percent=0,groupProperties=vm.properties[group.id];return gained_percent=vm.useMatrix?getMatrix(group):groupProperties[dominant].earn_stable_quota?group[dominant+"RealPointsProgress"]>group[dominant+"maxPercent"]?group[dominant+"maxPercent"]:group[dominant+"RealPointsProgress"]:groupProperties[dominant].gain_percent_agreed}function getCompareNumberForMatrix(group,fieldName){var fieldOrMkSh=vm.dataFromKamSoftMkSh&&"sellOut"==fieldName?"mkSh":fieldName;return"mkSh"==fieldOrMkSh?(100*group[fieldOrMkSh+"RealPointsProgress"]/group.sellOutMkSh).toFixed(2):group[fieldOrMkSh+"RealPointsProgress"]}function getMatrixField(group,fieldName){var compareNumber,idField,findMatrixValue,groupProperties=vm.properties[group.id],fieldNameInMatrix="sellIn"==fieldName?"sell_in":"sell_out",gained_percent=0;return compareNumber=getCompareNumberForMatrix(group,fieldName),group[fieldName+"MinValue"]=findMinRang(compareNumber,groupProperties[fieldName].number_values,"declaratedValue").min,idField=group[fieldName+"MinValue"].id||0,idField&&group[fieldName+"MinValue"].declaratedEarnings&&(group[fieldName+"Earns"]=group[fieldName+"MinValue"].declaratedEarnings),findMatrixValue=groupProperties.gain_percent_done.filter(function(el){return el[fieldNameInMatrix+"_id"]==idField}),findMatrixValue.length&&1==findMatrixValue.length&&(gained_percent=parseInt(findMatrixValue[0].gained_percent),console.log("only "+fieldName+" in matrix gained_percent=",gained_percent)),{id:idField,gained_percent:gained_percent}}function getMatrix(group){var groupProperties=vm.properties[group.id],findMatrixValue=[],gained_percent=0,def_percent=groupProperties[vm.dominant].earn_stable_quota?0:groupProperties[vm.dominant].gain_percent_agreed||0,result={sellIn:{},sellOut:{}};return group.sellInMinValue=-1,group.sellOutMinValue=-1,groupProperties.sellIn.number_values&&groupProperties.sellIn.number_values.length&&vm.column.sellIn.visibility&&(result.sellIn=getMatrixField(group,"sellIn"),!vm.column.sellOut.visibility)?result.sellIn.gained_percent:groupProperties.sellOut.number_values&&groupProperties.sellOut.number_values.length&&vm.column.sellOut.visibility&&(result.sellOut=getMatrixField(group,"sellOut"),!vm.column.sellIn.visibility)?result.sellOut.gained_percent:(group.sellInMinValue&&group.sellOutMinValue&&vm.column.sellIn.visibility&&vm.column.sellOut.visibility&&(findMatrixValue=groupProperties.gain_percent_done.filter(function(el){return el.sell_in_id==result.sellIn.id&&el.sell_out_id==result.sellOut.id}),findMatrixValue.length&&(gained_percent=parseInt(findMatrixValue[0].gained_percent),isNaN(gained_percent)&&(gained_percent=def_percent),console.log(" sellIn minValue in matrix = ",group.sellInMinValue.declaratedValue," sellOut minValue in matrix = ",group.sellOutMinValue.declaratedValue," gained_percent=",gained_percent))),gained_percent)}function setCampaignKnob(){var diffDaysFromStart,campaignDays,daysBeforeEnd,campaignDateStart=calcTime(vm.campaign.date_start,!0),campaignDateEnd=calcTime(vm.campaign.date_end,!0),now=new Date;now<campaignDateStart?diffDaysFromStart=0:now<=campaignDateEnd?(diffDaysFromStart=calculatePassedDays(campaignDateStart),daysBeforeEnd=calculatePassedDays(campaignDateEnd),vm.campaignDaysBeforeEnd=daysBeforeEnd,now<campaignDateEnd&&0===daysBeforeEnd&&(vm.campaignDaysBeforeEnd=1,diffDaysFromStart-=1)):diffDaysFromStart=calculatePassedDays(campaignDateStart,campaignDateEnd),campaignDays=calculatePassedDays(campaignDateStart,campaignDateEnd),campaignDays>=diffDaysFromStart&&campaignDays>0&&(vm.percentDays=parseFloat(diffDaysFromStart/campaignDays*100))}function setMultiKnob(){var diffDaysFromStart,cycleDays,diffDaysFromEnd=0,cycleDateStart=calcTime(vm.parent.campaignProgress.cycle_date_start,!0),cycleDateEnd=calcTime(vm.parent.campaignProgress.cycle_date_end,!0);calcTime()>=cycleDateEnd?diffDaysFromStart=calculatePassedDays(cycleDateStart,cycleDateEnd):(diffDaysFromStart=calculatePassedDays(cycleDateStart),diffDaysFromEnd=calculatePassedDays(cycleDateEnd)),cycleDays=calculatePassedDays(cycleDateStart,cycleDateEnd),cycleDays>=diffDaysFromStart&&cycleDays>0&&(vm.cyclePercentDays=parseInt(diffDaysFromStart/cycleDays*100)),vm.cycleDaysBeforeEnd=diffDaysFromEnd}function initPageProperties(){var drugsProperties=vm.page.properties||{},drugs=angular.copy(vm.parent.drugs);vm.column={sellIn:{label:drugsProperties.ds_drug_sell_in_column?drugsProperties.ds_drug_sell_in_column.label:"Sell In",visibility:!drugsProperties.ds_drug_sell_in_column||stringToBoolean(drugsProperties.ds_drug_sell_in_column.visible)},sellOut:{label:drugsProperties.ds_drug_sell_out_column?drugsProperties.ds_drug_sell_out_column.label:"Sell Out",visibility:!drugsProperties.ds_drug_sell_out_column||stringToBoolean(drugsProperties.ds_drug_sell_out_column.visible)},stock:{label:drugsProperties.ds_drug_stock_column?drugsProperties.ds_drug_stock_column.label:"Stock",visibility:!drugsProperties.ds_drug_stock_column||stringToBoolean(drugsProperties.ds_drug_stock_column.visible)},btn_photo:{label:drugsProperties.ds_selling_info_photo_button?drugsProperties.ds_selling_info_photo_button.label:"Photo",visible:!drugsProperties.ds_selling_info_photo_button||stringToBoolean(drugsProperties.ds_selling_info_photo_button.visible)}},vm.useMatrix=drugsProperties.ds_drugstore_use_matrix&&stringToBoolean(drugsProperties.ds_drugstore_use_matrix.use_matrix),"undefined"==typeof vm.useMatrix&&(vm.useMatrix=!0),vm.groupBy=cloneObj(vm.parent.drugsGroups),vm.groupBy.forEach(function(group){var drugstoreMatrix;vm.properties[group.id]||(vm.properties[group.id]=[]),vm.properties[group.id]={sellIn:drugsProperties["ds_drugs_group_slider_sell_in_"+group.id]?drugsProperties["ds_drugs_group_slider_sell_in_"+group.id]:vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id]?vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id]:{},sellOut:drugsProperties["ds_drugs_group_slider_sell_out_"+group.id]?drugsProperties["ds_drugs_group_slider_sell_out_"+group.id]:vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id]?vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id]:{},gain_percent_done:drugsProperties["ds_gain_percent_done_"+group.id]?drugsProperties["ds_gain_percent_done_"+group.id]:[],earned_visibility:{sellIn:!0,sellOut:!0}},vm.properties[group.id].sellIn.visible&&(vm.properties[group.id].sellIn.visible=stringToBoolean(vm.properties[group.id].sellIn.visible),vm.properties[group.id].sellIn.earn_stable_quota||(vm.properties[group.id].sellIn.earn_stable_quota=!1)),vm.properties[group.id].sellOut.visible&&(vm.properties[group.id].sellOut.visible=stringToBoolean(vm.properties[group.id].sellOut.visible),vm.properties[group.id].sellOut.earn_stable_quota||(vm.properties[group.id].sellOut.earn_stable_quota=!1)),drugsProperties["ds_drugs_group_gain_percent_matrix_"+group.id]&&drugsProperties["ds_drugs_group_gain_percent_matrix_"+group.id].drugstores&&(drugstoreMatrix=drugsProperties["ds_drugs_group_gain_percent_matrix_"+group.id].drugstores.filter(function(elMatrix){return elMatrix.drugstores.indexOf(vm.drugstoreId)>-1}),drugstoreMatrix.length&&(drugstoreMatrix=drugstoreMatrix[0],vm.properties[group.id].gain_percent_done=drugstoreMatrix.matrix)),
vm.pageProposal&&(vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id]&&(vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].earned_visibility&&(vm.properties[group.id].earned_visibility.sellIn=stringToBoolean(vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].earned_visibility)),(vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].earn_stable_quota||"points"==vm.pageProposal["ds_drugs_group_slider_sell_in_"+group.id].earned)&&(vm.properties[group.id].sellIn.earn_stable_quota=!0)),vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id]&&(vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].earned_visibility&&(vm.properties[group.id].earned_visibility.sellOut=stringToBoolean(vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].earned_visibility)),(vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].earn_stable_quota||"points"==vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].earned)&&(vm.properties[group.id].sellOut.earn_stable_quota=!0),vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].number_values&&(vm.properties[group.id].sellOut.number_values&&vm.properties[group.id].sellOut.number_values.length||(vm.properties[group.id].sellOut.number_values=vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].number_values),vm.properties[group.id].sellOut.earn_stable_quota&&vm.properties[group.id].sellOut.number_values.length&&!vm.properties[group.id].sellOut.number_values[0].declaratedEarnings&&vm.pageProposal["ds_drugs_group_slider_sell_out_"+group.id].number_values.forEach(function(elProposal,index){var elGroupValue=vm.properties[group.id].sellOut.number_values[index]||null;elProposal.declaratedEarnings&&elGroupValue&&!elGroupValue.declaratedEarnings&&(elGroupValue.declaratedEarnings=elProposal.declaratedEarnings)})))),group.groups=[],group.drugs.forEach(function(drugId){var drug=drugs.filter(function(drug){return drug.id==drugId});drug.length&&group.groups.push(drug[0])})})}function initGroupCounters(group){group.sellInTotal=0,group.sellOutTotal=0,group.stockTotal=0,group.sellInHundredsNumber=0,group.sellInPointsProgress=0,group.sellOutHundredsNumber=0,group.sellOutPointsProgress=0,group.sellInRealPointsProgress=0,group.sellOutRealPointsProgress=0,group.sellInMoney=0,group.sellOutMoney=0,group.sellInSign="",group.sellOutSign="",group.amountDrugs={sellIn:0,sellOut:0},group.numberDrugs={sellIn:0,sellOut:0},vm.dataFromKamSoftMkSh&&(group.mkShPointsProgress=0,group.mkShRealPointsProgress=0)}function redefineForDrugstore(group,fieldName,groupProperties){var redefineDrugstore,drugstoresProperties;groupProperties[fieldName]&&groupProperties[fieldName].drugstores&&groupProperties[fieldName].drugstores.length&&(redefineDrugstore=vm.parent.getDrugstoresGroup(vm.drugstoreId),redefineDrugstore.length&&(redefineDrugstore=redefineDrugstore[0],drugstoresProperties=groupProperties[fieldName].drugstores.filter(function(el){return el.group_id==redefineDrugstore.id}),drugstoresProperties.length&&(drugstoresProperties=drugstoresProperties[0],drugstoresProperties.number_values&&drugstoresProperties.number_values.length&&(drugstoresProperties.number_values.forEach(function(elDrugstore,index){var elGroup=groupProperties[fieldName].number_values[index]||null;elGroup&&elGroup.declaratedEarnings&&(elDrugstore.declaratedEarnings=elGroup.declaratedEarnings)}),groupProperties[fieldName].number_values=drugstoresProperties.number_values))))}function setProposalProperties(proposal,group){group.sellInSign=proposal.signIn||"Zł",group.sellInNewPotential=proposal.sellIn||0,group.sellInEarns=proposal.sellInEarns||0,group.sellInAgreedPotential=proposal.sellInAgreedPotential||0,group.sellInPercent=proposal.sellInPercent||100,group.sellInFrom=proposal.sellInFrom||0,group.sellOutSign=proposal.signOut||"Zł",group.sellOutNewPotential=proposal.sellOut||0,group.sellOutEarns=proposal.sellOutEarns,group.sellOutAgreedPotential=proposal.sellOutAgreedPotential||0,group.sellOutPercent=proposal.sellOutPercent||100,group.sellOutFrom=proposal.sellInFrom||0,group.sellOutMkSh=proposal.mk_sh||undefined,!group.sellOutAgreedPotential&&group.sellInAgreedPotential&&(group.sellOutAgreedPotential=group.sellInAgreedPotential),!group.sellInAgreedPotential&&group.sellOutAgreedPotential&&(group.sellInAgreedPotential=group.sellOutAgreedPotential)}function recalculateGroup(){vm.sellInTotal=0,vm.sellOutTotal=0,vm.stockTotal=0,vm.groupBy.forEach(function(group){group.amountDrugs={sellIn:0,sellOut:0},group.numberDrugs={sellIn:0,sellOut:0},group.sellInTotal=0,group.sellOutTotal=0,group.stockTotal=0,group.sellInMoney=0,group.sellOutMoney=0,group.groups.forEach(function(drug){vm.column.sellIn.visibility&&(group.sellInTotal+=groupAmount(drug,group,"sellIn")),vm.column.sellOut.visibility&&(group.sellOutTotal+=groupAmount(drug,group,"sellOut")),vm.column.stock.visibility&&(group.stockTotal+=groupAmount(drug,group,"stock"))}),calculateGroup(group),vm.column.sellIn.visibility&&(vm.sellInTotal+=parseFloat(group.sellInTotal)),vm.column.sellOut.visibility&&(vm.sellOutTotal+=parseFloat(group.sellOutTotal)),vm.column.stock.visibility&&(vm.stockTotal+=parseFloat(group.stockTotal))})}function fillDrugsWithKamSoft(data){data.forEach(function(el,index){var group;"not_found"!=el.drug_id&&(group=vm.groupBy.find(function(group){return group.drugs.indexOf(el.drug_id)>-1}),group&&setDrugDataInGroup(group,el))}),recalculateGroup()}function setDrugDataInGroup(group,drugData){var findDrug=group.groups.find(function(d){return d.id==drugData.drug_id});findDrug&&(drugData.sell_in&&vm.column.sellIn.visibility&&(findDrug.sellIn=parseInt(drugData.sell_in)),drugData.sell_out&&vm.column.sellOut.visibility&&(findDrug.sellOut=parseInt(drugData.sell_out)),drugData.stock&&vm.column.stock.visibility&&(findDrug.stock=parseInt(drugData.stock)))}function fillDrugsWithKamSoftMkSh(data){data.group&&angular.forEach(data.group,function(groupData,group_id){var group=vm.groupBy.find(function(g){return g.id==group_id});group&&(group.nowSellOutMkSh=groupData.mk_sh||undefined,group.nowTotalDrugstoreSales=groupData.totalSales||0,angular.forEach(data.sumByDrug[group_id],function(drugData,drug_id){var findDrug=group.groups.find(function(d){return d.id==Number(drug_id)});findDrug&&(drugData.sellIn&&vm.column.sellIn.visibility&&(findDrug.sellIn=parseInt(drugData.sellIn)),drugData.sellOut&&vm.column.sellOut.visibility&&(findDrug.sellOut=parseInt(drugData.sellOut)))}))}),recalculateGroup()}function setDrugData(data,group){var lastUpdatedDate;group.groups.forEach(function(drug){var isSetcycleCounter,initDrug=0;drug.sellIn=0,drug.sellOut=0,drug.stock=0,data&&(initDrug=data.filter(function(el){return el.drug_id==drug.id}),initDrug.length&&(vm.useCycle&&!vm.fromPrevStep&&!isSetcycleCounter&&initDrug[0].cycle_counter&&(vm.cycleCounterDisabled=!1,vm.cycleCounter=initDrug[0].cycle_counter,isSetcycleCounter=!0),drug.sellIn=initDrug[0].sell_in,drug.sellOut=initDrug[0].sell_out,drug.stock=initDrug[0].stock,drug.sellInSave=initDrug[0].sell_in,drug.sellOutSave=initDrug[0].sell_out,lastUpdatedDate||(vm.lastUpdatedDate=calcTime(initDrug[0].updated_at,!0)))),vm.column.sellIn.visibility&&(group.sellInTotal+=groupAmount(drug,group,"sellIn")),vm.column.sellOut.visibility&&(group.sellOutTotal+=groupAmount(drug,group,"sellOut")),vm.column.stock.visibility&&(group.stockTotal+=groupAmount(drug,group,"stock"))})}function setCloseStepStatus(){var serviceControl=vm.step.pages.find(function(page){return"services_control"==page.type});vm.stepStatus=null,serviceControl?getServiceControl(campaignProgress):vm.stepStatus="completed"}function setMessageProps(isPageReadOnly){vm.messageSellingClass="negative-text",vm.pageReadOnly=isPageReadOnly}function animateCycleNumber(){notifier.animateSemantic(".cycle_counter","jiggle",function(){$scope.$apply(function(){vm.cycleNewCounter=!0})})}function checkDate(){var actualDate=new Date,isInDates=stepsService.isWithinDates(calcTime(new Date(vm.step.date_start),!0),calcTime(new Date(vm.step.date_end),!0)),isToday=vm.lastUpdatedDate&&vm.lastUpdatedDate.toDateString()==actualDate.toDateString(),msg=isInDates?isToday?"ONE_CYCLE_PER_DAY":"":"STEP_NOT_IN_DATE";return{isInDates:isInDates&&!isToday,message:msg}}function setKamSoftMkSh(data){var kamsoftMkSh;try{kamsoftMkSh=JSON.parse(data),kamsoftMkSh.counterKamsoftDrugstores&&(vm.parent.counterKamsoftDrugstores=kamsoftMkSh.counterKamsoftDrugstores),kamsoftMkSh.groups&&kamsoftMkSh.groups.forEach(function(g){var group=vm.groupBy.find(function(gr){return gr.id==g.group_id});group&&(group.nowTotalDrugstoreSales=g.totalSales)}),kamsoftMkSh.chart_values&&kamsoftMkSh.dates&&($scope.dates=kamsoftMkSh.dates,$scope.chartData=[{key:"Sprzedaż",values:kamsoftMkSh.chart_values,mean:kamsoftMkSh.averagePercent}],setChartOptions())}catch(e){}}function setChartData(data){var values=[],dates=[],total=0,total_percent=0;data.forEach(function(dataDrug,index){var value={},drugIds=dataDrug.drug_ids.split(/[\s,]+/).map(Number),group=vm.groupBy.find(function(group){return containsInArray(drugIds,group.drugs)});group&&(dates.push(moment(dataDrug.report_date).format("DD.MM.YY").toString()),value.x=index+1,total+=parseFloat(dataDrug.sell_out_sum),value.y=Number(parseFloat(dataDrug.mk_sh_percent).toFixed(2)),total_percent+=value.y,values.push(value))}),$scope.dates=dates,vm.chartDates=dates,total_percent=Number(parseFloat(total_percent/data.length).toFixed(0)),vm.chartDataValues=cloneObj(values),vm.averagePercent=total_percent,$scope.chartData=[{key:"Sprzedaż",values:values,mean:total_percent}]}function setChartOptions(){$scope.options={chart:{type:"lineChart",height:350,margin:{top:20,right:20,bottom:60,left:50},x:function(d){return d.x},y:function(d){return d.y/100},average:function(d){return d3.format(",.2")(d.mean/100)},color:d3.scale.category10().range(),duration:300,useInteractiveGuideline:!0,clipVoronoi:!1,xAxis:{axisLabel:"daty",showMaxMin:!1,tickFormat:function(d){return $scope.dates[d]},staggerLabels:!0},yAxis:{axisLabel:"",tickFormat:function(d){return d3.format(",.1%")(d)},axisLabelDistance:-10}}}}function setChart(data){setChartData(data),setChartOptions()}function activate(){var pageProposal=null;vm.pageProposal=null,vm.parent=$scope.$parent.vm,vm.templateIndex=vm.parent.templateIndex,vm.drugstoreId=vm.parent.drugstoreId,vm.campaignId=vm.parent.campaignId,vm.campaign=vm.parent.campaign,vm.step=vm.parent.step,vm.page=vm.step.pages[vm.templateIndex],vm.uid=vm.step.unique_id,vm.multiplier=vm.parent.multiplier||1,vm.dataServiceControl=[],vm.dataSellingInfo=[],vm.lockForm=!1,vm.selling_style={},vm.percentDays=0,vm.campaignDaysBeforeEnd=0,vm.cyclePercentDays=0,vm.cycleDaysBeforeEnd=0,vm.properties={},vm.dominant="sell_in"==vm.parent.dominant?"sellIn":"sellOut",vm.fromPrevStep=!1,vm.dataFromKamSoftMkSh=vm.parent.campaign.kamsoft_market_share_is_on,vm.dataFromKamSoft=vm.parent.campaign.kamsoft_qr_code_is_on,vm.dataFromKamSoftMkSh&&(vm.parent.counterKamsoftDrugstores=0),pageProposal=getObjectByKey(vm.parent.steps,"type","proposal"),pageProposal.length&&(vm.pageProposal=pageProposal[0].properties),vm.colors=["ab4473","1fbbda","ab4473","1fbbda","ab4473","1fbbda"],vm.campaign.selling_info_cycles_use&&vm.campaign.selling_info_cycles_counter&&(vm.useCycle=!0,vm.minCycleNumber=vm.campaign.selling_info_cycles_counter,vm.cycleCounter=1,vm.changeCycleCounter=!1,vm.cycleCounterDisabled=!0,vm.page.needCloseStep=!1,vm.cycleNewCounter=!1,vm.lastUpdatedDate=new Date),setSellingInfo()}var vm=this;vm.changeCycleNumber=function(){var resCheckDate=checkDate();!vm.changeCycleCounter&&resCheckDate.isInDates?(animateCycleNumber(),vm.cycleCounter++,vm.changeCycleCounter=!0,vm.cycleCounter==vm.minCycleNumber&&(vm.page.needCloseStep=!0,setCloseStepStatus()),vm.step.readOnly&&(vm.step.readOnly=!1),vm.selling_style.color="#0000FF"):resCheckDate.message&&(vm.messageSelling=resCheckDate.message,setMessageProps(!1))},vm.changeSellField=function(groupChange,drugChange,fieldName){var total=0;groupChange[fieldName+"Total"]||(groupChange[fieldName+"Total"]=0),vm[fieldName+"Total"]=0,groupChange.amountDrugs[fieldName]=0,groupChange.numberDrugs[fieldName]=0,groupChange.groups.forEach(function(drug){total+=groupAmount(drug,groupChange,fieldName)}),groupChange[fieldName+"Total"]=total,vm.groupBy.forEach(function(group){vm[fieldName+"Total"]+=group[fieldName+"Total"]}),drugChange[fieldName+"Style"]=undefined,drugChange[fieldName+"Save"]&&drugChange[fieldName]<drugChange[fieldName+"Save"]&&(drugChange[fieldName+"Style"]={},drugChange[fieldName+"Style"].color="red"),calculateGroup(groupChange,fieldName)},vm.saveSellingInfo=function(isCloseStep){vm.page.needCloseStep?angular.element("#confirmCloseStep").modal("show"):vm.saveSelling(isCloseStep)},vm.saveSelling=function(isCloseStep){var sendData,sellings=[],groups=[],sell={},chartData={},initDrug=[],isUpdate=!(!vm.dataSellingInfo||!vm.dataSellingInfo.length),props={},closeStep=isCloseStep&&vm.page.needCloseStep;return!vm.lockForm&&(vm.lockForm=!0,showDimmer(),vm.chartDataValues&&(chartData={campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,campaign_progress_id:vm.parent.campaignProgressActiveId,step_id:vm.uid,staff_id:vm.parent.userData.id,date_start:vm.parent.period.start,date_end:vm.parent.period.now,kamsoft_data:{}},chartData.kamsoft_data.groups=[]),vm.groupBy.forEach(function(group,index){vm.chartDataValues&&group.nowTotalDrugstoreSales&&(chartData.kamsoft_data.groups[index]={group_id:group.id,totalSales:group.nowTotalDrugstoreSales}),groups[index]={group_id:group.id,amount_drugstores:vm.parent.listDrugstores.length||1,progress:JSON.stringify({sellIn:group.sellInRealPointsProgress,sellInEarns:group.sellInMoney,sellInVisible:vm.column.sellIn.visibility,sellOut:group.sellOutRealPointsProgress,sellOutEarns:group.sellOutMoney,sellOutVisible:vm.column.sellOut.visibility})},vm.kamSoftPicture&&vm.kamSoftPicture.name&&(groups[index].selling_img={name:vm.kamSoftPicture.name,value:vm.kamSoftPicture.value||"",id:vm.kamSoftPicture.id||undefined}),group.groups.forEach(function(drug){(angular.isDefined(drug.sellIn)||angular.isDefined(drug.sellOut))&&(vm.dataSellingInfo&&(initDrug=vm.dataSellingInfo.filter(function(el){return el.drug_id==drug.id})),sell={id:initDrug.length?initDrug[0].id:undefined,campaign_id:vm.campaignId,drugstore_id:vm.drugstoreId,campaign_progress_id:vm.parent.campaignProgressActiveId,step_id:vm.uid,drug_id:drug.id,sell_in:drug.sellIn||0,sell_out:drug.sellOut||0,stock:drug.stock||0,cycle_counter:vm.cycleCounter||1},sellings.push(sell))})}),void(sellings.length&&(sendData={data:sellings,groups:groups},vm.chartDataValues&&(chartData.kamsoft_data.dates=vm.chartDates,chartData.kamsoft_data.averagePercent=vm.averagePercent,chartData.kamsoft_data.chart_values=vm.chartDataValues,chartData.kamsoft_data.counterKamsoftDrugstores=vm.parent.counterKamsoftDrugstores,chartData.kamsoft_data=JSON.stringify(chartData.kamsoft_data),sendData.kamsoft_daily_chart=chartData),closeStep&&(vm.stepStatus?sendData.setStepStatus=vm.parent.closeStep(vm.step,[],vm.stepStatus):sendData.setStepStatus=vm.parent.closeStep(vm.step,vm.dataServiceControl)),props={isCloseStep:closeStep,funcCloseStep:closeStep?vm.parent.setStepStatus:null,step:vm.step,sendData:sendData,isUpdate:isUpdate},localDBService.saveSelling(props).then(function(data){hideDimmer(),vm.lockForm=!1,vm.parent.isPageChange=!1,vm.canEditData=!vm.dataFromKamSoft,vm.parent.offlineMode||(vm.parent.goNextPage?vm.parent.goNextPage=!1:vm.parent.refresh())},function(err){hideDimmer(),vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)}))))},$rootScope.$on("getKamSoftMkShError",function(event,data){var del="";vm.addMessageSelling="",data&&(data.drugstores_diff.length?(vm.messageSelling="no_mk_sh"==data.word?"MK_SH_ERROR_NO_MK_SH":"MK_SH_ERROR_NO_SELL",data.drugstores_diff.forEach(function(el){vm.addMessageSelling+=del+el.identifier+" ("+el.id+")",del=", "})):"no_data"==data.word&&(vm.messageSelling="MK_SH_ERROR_NO_DATA"),vm.specialDisable=!0),setMessageProps(!1)}),$rootScope.$on("getKamSoftMkSh",function(event,data){vm.specialDisable=!1,data.sell_in_out_reports&&fillDrugsWithKamSoftMkSh(data.sell_in_out_reports),data.sell_out_daily_reports&&setChart(data.sell_out_daily_reports)}),$rootScope.$on("getKamSoft",function(event,data){fillDrugsWithKamSoft(data)}),vm.editKamSoftData=function(){vm.canEditData=!0,vm.kamSoftPicture&&vm.kamSoftPicture.src&&(vm.kamSoftPicture.src="",vm.kamSoftPicture.name=""),vm.showImg=null},vm.showKamSoftPicture=function(){vm.kamSoftPicture&&vm.kamSoftPicture.src&&(vm.showImg=vm.kamSoftPicture.src,angular.element("#showKamSoftPicture").modal("show"))},activate()}angular.module("app.campaigns").controller("CampaignsSellingInfoController",CampaignsSellingInfoController),CampaignsSellingInfoController.$inject=["$rootScope","$scope","campaignsDataservice","localDBService","stepsService","notifier","TEXT_MESSAGE","MERCH_IMAGES_PATH"]}(),function(){"use strict";function campaignsDataservice($rootScope,$state,dataservice,$sessionStorage,$q,principal,exifService){function getOptimizedCampaignDataset(campaignId,staffId){var defer=$q.defer();return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("unified-api","optimized-campaign-dataset/campaign/"+campaignId+"/staff/"+staffId).then(function(res){_cache.campaignDataset=res.plain(),defer.resolve("OK")}),defer.promise}function getOptimizedCampaignDrugstoreDataset(campaignId,drugstoreId,staffId){var defer=$q.defer();return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("unified-api","optimized-campaign-drugstore-dataset/campaign/"+campaignId+"/drugstore/"+drugstoreId+"/staff/"+staffId).then(function(res){_cache.campaignDataset=res.plain(),defer.resolve("OK")}),defer.promise}function getOptimizedCampaignsDrugstoreDataset(drugstoreId,staffUid){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("unified-api","optimized-campaigns-drugstore-dataset/drugstore/"+drugstoreId+"/staff/"+staffUid).then(function(data){return data.plain()})}function loadStepsStatuses(){var defer=$q.defer();return defer.resolve(_cache.campaignDataset.campaign_steps_statuses),defer.promise}function getCampaigns(currentPage){return dataservice.tenant.index("campaigns",{page:currentPage,query:{type:"campaign"}})}function getCampaignFiltered(campaignId,uid,cached){if(cached){var defer=$q.defer();return defer.resolve({resource:_cache.campaignDataset.campaign,gifts_number:_cache.campaignDataset.gifts_number,gazetki_number:_cache.campaignDataset.gazetki_number,campaigns_selling:_cache.campaignDataset.campaigns_selling,drugstores_first_step:_cache.campaignDataset.drugstores_first_step,drugstores_last_step:_cache.campaignDataset.drugstores_last_step,campaign_counters:_cache.campaignDataset.campaign_counters,budget:_cache.campaignDataset.budget,service_control_statuses:_cache.campaignDataset.service_control_statuses,dynamic_steps:_cache.campaignDataset.dynamic_steps}),defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns","show/"+campaignId+"/staff/"+uid).then(function(data){return data})}function getCampaignFilteredForDrugstore(campaignId,drugstoreId,uid,cached){if(cached){var defer=$q.defer();return defer.resolve({resource:_cache.campaignDataset.campaign,gifts_number:_cache.campaignDataset.gifts_number,gazetki_number:_cache.campaignDataset.gazetki_number,campaigns_selling:_cache.campaignDataset.campaigns_selling,drugstore:_cache.campaignDataset.drugstore,staffForDrugstore:_cache.campaignDataset.staffForDrugstore,staff_job_titles:_cache.campaignDataset.staff_job_titles,countMainOffices:_cache.campaignDataset.countMainOffices,mainDrugstoreId:_cache.campaignDataset.mainDrugstoreId,dataProgress:_cache.campaignDataset.dataProgress,first_step_start:_cache.campaignDataset.first_step_start,is_proposal_saved:_cache.campaignDataset.is_proposal_saved,budget:_cache.campaignDataset.budget,service_control_statuses:_cache.campaignDataset.service_control_statuses,dynamic_steps:_cache.campaignDataset.dynamic_steps}),defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns","show/"+campaignId+"/staff/"+uid+"/drugstore/"+drugstoreId)}function getCampaignsQuicklyFilteredByStaffAndPromoline(currentPage,staffUid){if(_cache.campaignsByStaff){var defer=$q.defer();return defer.resolve(_cache.campaignsByStaff),defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns","index/page/"+currentPage+"/staff/"+staffUid).then(function(data){return _cache.campaignsByStaff=data.plain(),_cache.campaignsByStaff})}function getBudgetProgress(staffUid,campaignIds){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns","progress/staff/"+staffUid+"/campaigns/"+campaignIds).then(function(data){return data})}function getCampaignsWithDrugstoresQuicklyFilteredByStaffAndPromoline(currentPage,staffUid){if(_cache.campaignsByStaffWithDrugstores){var defer=$q.defer();return defer.resolve(_cache.campaignsByStaffWithDrugstores),defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns","index/with-drugstores/page/"+currentPage+"/staff/"+staffUid).then(function(data){return _cache.campaignsByStaffWithDrugstores=data.plain(),_cache.campaignsByStaffWithDrugstores})}function getSelectedDrugstore(drugstoreId,cached){if(cached){var defer=$q.defer();return defer.resolve(_cache.campaignDataset.drugstore),defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("drugstores",drugstoreId).then(function(data){return data.resource})}function isSetOfflineMode(drugstoreId,campaignId){var ssn=campaignId+"-"+drugstoreId;return $sessionStorage.storage&&$sessionStorage.storage[ssn]&&Object.keys($sessionStorage.storage[ssn].data).length||!1}function getOfflineModeData(drugstoreId,campaignId){var ssn=campaignId+"-"+drugstoreId;return $sessionStorage.storage[ssn].data}function getDataCampaignPages(drugstoreId,campaignId){var offlineModeData,defer,isOfflineMode=isSetOfflineMode(drugstoreId,campaignId),dataProgress={};return isOfflineMode?(defer=$q.defer(),offlineModeData=getOfflineModeData(drugstoreId,campaignId),dataProgress.progress=offlineModeData.progress||[],dataProgress.proposal=offlineModeData.proposal||[],_cache.campaignDataset||(_cache.campaignDataset={}),_cache.campaignDataset.staff_job_titles=offlineModeData.staffJobTitles||[],defer.resolve({campaign:offlineModeData.campaign||[],drugstore:offlineModeData.drugstore||[],staffForDrugstore:offlineModeData.staffForDrugstore,dataProgress:dataProgress,countMainOffices:offlineModeData.countMainOffices||1,mainDrugstoreId:offlineModeData.mainDrugstoreId,campaigns_selling:offlineModeData.campaigns_selling,first_step_start:offlineModeData.first_step_start,is_proposal_saved:offlineModeData.is_proposal_saved,budget:offlineModeData.budget,service_control_statuses:offlineModeData.service_control_statuses,dynamic_steps:offlineModeData.dynamic_steps}),defer.promise):principal.identity(!1,"mobile").then(function(identity){return getOptimizedCampaignDrugstoreDataset(campaignId,drugstoreId,identity.id).then(function(res){return getCampaignFilteredForDrugstore(campaignId,drugstoreId,identity.id,!0).then(function(campaignResource){var campaign=campaignResource.resource;return angular.isArray(campaign.drugstores)||(campaign.drugstores=Object.keys(campaign.drugstores).map(function(key){return campaign.drugstores[key]})),{campaign:campaign,drugstore:campaignResource.drugstore,staffForDrugstore:campaignResource.staffForDrugstore,staff_job_titles:campaignResource.staff_job_titles,countMainOffices:campaignResource.countMainOffices||1,mainDrugstoreId:campaignResource.mainDrugstoreId,dataProgress:campaignResource.dataProgress,campaigns_selling:campaignResource.campaigns_selling,first_step_start:campaignResource.first_step_start,is_proposal_saved:campaignResource.is_proposal_saved,budget:campaignResource.budget,service_control_statuses:campaignResource.service_control_statuses,dynamic_steps:campaignResource.dynamic_steps}})})})}function getCountCampaignDrugstoreNetwork(campaignId,drugstoreId,staffId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("unified-api","optimized-campaign-drugstore-network/campaign/"+campaignId+"/drugstore/"+drugstoreId+"/staff/"+staffId).then(function(data){return data.countNetworkDrugstores})}function getEditDrugstore(drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.edit("drugstores",drugstoreId).then(function(data){return data})}function getStaffJobTitles(cached){if(cached){var defer=$q.defer();return defer.resolve(_cache.campaignDataset.staff_job_titles),defer.promise}return dataservice.tenant.customOauth.get("staff-job-titles","list").then(function(staffJobTitles){return _cache.campaignDataset||(_cache.campaignDataset={}),_cache.campaignDataset.staff_job_titles=staffJobTitles,staffJobTitles})}function getCategories(){return dataservice.tenant.customOauth.get("drugstores-categories")}function getNetworks(){return dataservice.tenant.customOauth.get("drugstores-networks","list")}function getProperties(){return dataservice.tenant.customOauth.get("drugstores-properties","list")}function saveDrugstore(drugstore){return dataservice.tenant.update("drugstores",drugstore.id,drugstore)}function saveCampaign(campaignId,data){return dataservice.tenant.update("campaigns",campaignId,data)}function saveDrugstoresList(campaignId,ids){return dataservice.tenant.customOauth.post("campaigns",{drugstores_ids:ids},"unassign-drugstores/campaign/"+campaignId).then(function(res){return res})}function getAddress(addressid){return dataservice.tenant.edit("addresses",addressid)}function saveAddress(address_id,address){dataservice.tenant.update("addresses",address_id,address)}function getCities(ids){var ids_cities=JSON.stringify(ids);return dataservice.tenant.customOauth.get("cities","list",{ids:ids_cities})}function savePerson(person){return person.id?dataservice.tenant.update("drugstores-staff",person.id,person):dataservice.tenant.store("drugstores-staff",person)}function removePerson(personId){return dataservice.tenant.destroy("drugstores-staff",personId)}function getSellingPotential(campaignId,campaignProgressId,drugstoreId,drugs){return drugs=JSON.stringify(drugs),dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-selling-potential","search-by-data",{campaign_id:campaignId,campaignProgressId:campaignProgressId,drugstore_id:drugstoreId,drugs:drugs})}function saveSellingPotential(selling,isUpdate){return isUpdate?dataservice.tenant.update("campaigns-selling-potential",selling):dataservice.tenant.store("campaigns-selling-potential",selling)}function getProposal(campaignId,campaignProgressId,drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-selling-proposal","search-by-data",{campaign_id:campaignId,campaignProgressId:campaignProgressId,drugstore_id:drugstoreId})}function saveProposal(selling,isUpdate){return isUpdate?dataservice.tenant.update("campaigns-selling-proposal",selling.id,selling):dataservice.tenant.store("campaigns-selling-proposal",selling)}function getSellingInfo(requestData){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-selling","search-by-data",requestData)}function getInvoice(campaignId,campaignProgressId,drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-invoice","search-by-data",{campaign_id:campaignId,campaignProgressId:campaignProgressId,drugstore_id:drugstoreId})}function saveInvoice(data,isUpdate){return isUpdate?dataservice.tenant.update("campaigns-invoice",data):dataservice.tenant.store("campaigns-invoice",data)}function saveSelling(selling,isUpdate){return isUpdate?dataservice.tenant.update("campaigns-selling",selling):dataservice.tenant.store("campaigns-selling",selling)}function getServiceControl(campaignId,campaignProgressId,stepId,drugstoreId,staffId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-service-control","search-by-data",{campaign_id:campaignId,campaignProgressId:campaignProgressId,step_id:stepId,drugstore_id:drugstoreId,staff_id:staffId})}function getLastServiceByDrugstore(drugstoreId,campaignId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-service-control","search-by-drugstore",{drugstore_id:drugstoreId,campaign_id:campaignId})}function getServicesByDrugstores(drugstores,campaignId,campaignProgressId){return drugstores=JSON.stringify(drugstores),dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-service-control","search-by-drugstores",{drugstores:drugstores,campaign_id:campaignId,campaignProgressId:campaignProgressId})}function saveServiceControl(merch,isUpdate){return dataservice.tenant.store("campaigns-service-control",merch)}function getCampaignProgress(drugstoreId,campaignId,cached){if(cached){var defer=$q.defer();return defer.resolve(_cache.campaignDataset.campaign_progress),defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-drugstores-progress","search-by-data",{drugstore_id:drugstoreId,campaign_id:campaignId})}function saveCampaignProgress(data,isUpdate){return isUpdate?dataservice.tenant.update("campaigns-drugstores-progress",data.id,data):dataservice.tenant.store("campaigns-drugstores-progress",data)}function getCampaignsDataSelling(dataSelling,countDrugstoresByCampaign,campaignsDominant){var progress={};return dataSelling.groupBy(function(o){return o.campaign_id}).forEach(function(el){var campaign_id=el.key,dominant=campaignsDominant[campaign_id]?campaignsDominant[campaign_id]:"neutral",countDrugstores=countDrugstoresByCampaign[campaign_id]?countDrugstoresByCampaign[campaign_id]:0,result=getDataSelling(el.group,countDrugstores);"sell_in"==dominant?progress[campaign_id]=result.sellIn:"sell_out"==dominant&&(progress[campaign_id]=result.sellOut)}),progress}function getCampaignsSelling(campaigns,userId,countDrugstoresByCampaign,campaignsDominant){return campaigns=JSON.stringify(campaigns),dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-selling","search-by-campaigns",{campaigns:campaigns,staffId:userId}).then(function(dataSelling){return getCampaignsDataSelling(dataSelling,countDrugstoresByCampaign,campaignsDominant)})}function getCampaignSelling(campaignId,drugstores_ids,cache){if(cache){var defer=$q.defer(),countDrugstores=drugstores_ids?drugstores_ids.length:0;return defer.resolve(getDataSelling(_cache.campaignDataset.campaigns_selling,countDrugstores,!0)),defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-selling","search-by-campaign",{campaign_id:campaignId}).then(function(dataSelling){return getDataSelling(dataSelling,countDrugstores,!0)})}function getDataSelling(dataSelling,countDrugstores,isEarnsCalc){var progressCampaign={sellIn:0,sellInEarns:0,sellOut:0,sellOutEarns:0};return dataSelling.groupBy(function(o){return o.drugstore_id}).forEach(function(el,index){var result,isInt;result=getDataDrugstoreProgress(el.group,isEarnsCalc),isInt=function(n){return n%1===0},(result.sellIn||result.sellOut)&&(progressCampaign.sellIn+=parseFloat(result.sellIn),progressCampaign.sellOut+=parseFloat(result.sellOut),isEarnsCalc&&(isInt(result.sellInEarns)?progressCampaign.sellInEarns+=parseInt(result.sellInEarns):progressCampaign.sellInEarns+=parseFloat(result.sellInEarns),isInt(result.sellOutEarns)?progressCampaign.sellOutEarns+=parseInt(result.sellOutEarns):progressCampaign.sellOutEarns+=parseFloat(result.sellOutEarns)))}),countDrugstores&&(0!==progressCampaign.sellIn&&(progressCampaign.sellIn=parseFloat(progressCampaign.sellIn/countDrugstores).toFixed(2)),0!==progressCampaign.sellOut&&(progressCampaign.sellOut=parseFloat(progressCampaign.sellOut/countDrugstores).toFixed(2))),progressCampaign}function getDataDrugstoreProgress(dataSelling,isEarnsCalc){var progressCampaign={
sellIn:0,sellInEarns:0,sellOut:0,sellOutEarns:0},count=0;return dataSelling.forEach(function(elGroup){var progress,isInt=function(n){return n%1===0},multiplier=elGroup.multiplier?parseInt(elGroup.multiplier):1;try{progress=JSON.parse(elGroup.progress)}catch(e){}progress&&(progress.sellInVisible&&(progressCampaign.sellIn+=parseFloat(progress.sellIn)*multiplier,isEarnsCalc&&(isInt(progress.sellInEarns)?progressCampaign.sellInEarns+=parseInt(progress.sellInEarns):progressCampaign.sellInEarns+=parseFloat(progress.sellInEarns))),progress.sellOutVisible&&(progressCampaign.sellOut+=parseFloat(progress.sellOut)*multiplier,isEarnsCalc&&(isInt(progress.sellOutEarns)?progressCampaign.sellOutEarns+=parseInt(progress.sellOutEarns):progressCampaign.sellOutEarns+=parseFloat(progress.sellOutEarns))),count++)}),count&&(progressCampaign.sellIn=parseFloat(progressCampaign.sellIn/count),progressCampaign.sellOut=parseFloat(progressCampaign.sellOut/count)),progressCampaign}function calcAmountForDrug(num,price){return parseFloat(num)*parseFloat(price)}function calcSelling(amount,newAgreedPotential){var result=0;return 0!==parseFloat(newAgreedPotential)&&(result=parseFloat(100*amount/newAgreedPotential)),result}function calcEarns(amount,percent){var result=0;return result=parseFloat(amount*percent/100)}function calcEarnsPoints(proposalEarns,percentSell,arrEarns){var rang,result=0,percent=parseFloat(percentSell);return 0!==percent&&(result=percent/100*parseFloat(proposalEarns)),result=parseInt(result),arrEarns&&(rang=findMinRang(result,arrEarns),result=rang.min),result}function saveMessage(message){var instance=$state.current.settings.help?"helpmessages":"messages";return message.id>0?dataservice.tenant.update(instance,message.id,message):dataservice.tenant.store(instance,message)}function getStaffJobs(){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("staff-drugstores","list",{timeout:1e3,cache:!1})}function _getStaffJobs(userId,staffJobs){var staff={},needDrugstores=[],staffDrugstores={};return userId&&staffJobs.staff[userId]&&(needDrugstores=staffJobs.staff[userId].drugstoresIds),staffJobs.drugstores&&staffJobs.staff&&(needDrugstores.length?needDrugstores.forEach(function(el){staffJobs.drugstores[el]&&(staffDrugstores[el]=staffJobs.drugstores[el])}):staffDrugstores=staffJobs.drugstores,angular.forEach(staffDrugstores,function(drugstore){drugstore.staff.forEach(function(person){var job_duties=person.job_duties.split(",");staffJobs.staff[person.staff_id]&&(staff[person.staff_id]=staffJobs.staff[person.staff_id],staff[person.staff_id].job_duties||(staff[person.staff_id].job_duties=[]),staff[person.staff_id].job_duties=staff[person.staff_id].job_duties.concat(job_duties).unique())})})),{staff:staff,drugstores:staffDrugstores}}function getStaffJobsByDrugstores(userId){if($sessionStorage.hasOwnProperty("staffJobs")&&$sessionStorage.staffJobs.length>0){var staffJobs,defer=$q.defer();try{staffJobs=JSON.parse($sessionStorage.staffJobs),defer.resolve(_getStaffJobs(userId,staffJobs))}catch(e){defer.reject("Can not fetch staff_jobs")}return defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("staff-drugstores","search-by-drugstores",{timeout:1e3,cache:!1}).then(function(staffJobs){return sizeOf(sessionStorage)+sizeOf(angular.toJson(staffJobs))<=10240&&($sessionStorage.staffJobs=JSON.stringify(staffJobs)),_getStaffJobs(userId,staffJobs)})}function getStaffJobsByDrugstoreId(drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("staff-drugstores","search-by-drugstore",{drugstore_id:drugstoreId,timeout:1e3,cache:!1})}function getManagersForDrugstore(drugstoreId){return getStaffJobsByDrugstoreId(drugstoreId).then(function(staffJobs){var staffByDrugstore=[];return staffByDrugstore=staffJobs.filter(function(el){var job_duties=el.job_duties;return job_duties.indexOf("[2]")>-1||job_duties.indexOf("[3]")>-1}).map(function(el){return el.staff_id})})}function getGift(giftId){return dataservice.tenant.edit("gifts",giftId)}function setCampaignStepStatus(campaignId,drugstoreId,data){return dataservice.tenant.customOauth.post("campaigns-drugstores-progress",data,"update-step-status/campaign/"+campaignId+"/drugstore/"+drugstoreId)}function getCampaignOfflineMode(properties){var staffId=properties.staffId,campaignId=properties.campaignId,progressId=properties.progressId,drugstoreId=properties.drugstoreId,drugstores=properties.drugstores,mainDrugstoreId=properties.mainDrugstoreId;return drugstores=JSON.stringify(drugstores),dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("offline-mode/fetch-dataset/staff/"+staffId+"/drugstore/"+drugstoreId+"/mainDrugstoreId/"+mainDrugstoreId+"/campaign/"+campaignId+"/progress/"+progressId+"/drugstores/"+drugstores)}function getDrugstoreDataOfflineMode(campaignId,drugstoreId){return dataservice.tenant.customOauth.get("offline-mode/fetch-dataset/drugstore/"+drugstoreId+"/campaign/"+campaignId)}function getTodo(userId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("todo/user/"+userId)}function removeTodo(id){return dataservice.tenant.customOauth.post("todo/remove/"+id)}function getDrugstoresWithCampaignsByStaff(staffUid){if(_cache.drugstoresByStaff){var defer=$q.defer();return defer.resolve(_cache.drugstoresByStaff),defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("unified-api","optimized-campaigns-drugstore-dataset/drugstores/staff/"+staffUid).then(function(data){var result=data.plain();return _cache.drugstoresByStaff=result,result})}function isCampaignWithoutCounters(campaign){var date=new Date(campaign.date_start),year=date.getFullYear();return campaign.id<45&&"2016"==year||campaign.not_paid_campaign===!0}function getKamsoftReport(drugstoreId,data){return dataservice.tenant.customOauth.post("kamsoft",data,"get-report/drugstore/"+drugstoreId)}function getKamsoftMarketShareReports(data){return dataservice.tenant.customOauth.post("kamsoft-osoz",data,"fetch-sell-out-market-share-data")}function storeKamsoftMissingData(data){return dataservice.tenant.customOauth.post("kamsoft-osoz",data,"store-missing-data")}function getKamsoftDailyMarketShareReports(data){return dataservice.tenant.customOauth.post("kamsoft-osoz",data,"fetch-sell-in-out-daily")}function saveCloneStep(data){return data.id?dataservice.tenant.update("campaigns-dynamic-step",data.id,data):dataservice.tenant.store("campaigns-dynamic-step",data)}function getOriginalPhotoDate(file,callback){exifService.getData(file,function(){var realDateTime,takenDateTime,takenDateTime2,diffMn,res={},originalDate=exifService.getOriginalDate(this),modifiedDate=file.lastModifiedDate;return originalDate?(realDateTime=originalDate,takenDateTime=moment(originalDate,"YYYY:MM:DD HH:mm:ss").format("DD.MM.YYYY HH:mm:ss"),takenDateTime2=moment(originalDate,"YYYY:MM:DD HH:mm:ss").format("YYYY-MM-DD-HH-mm-ss")):modifiedDate&&(realDateTime=modifiedDate,takenDateTime=moment(modifiedDate).format("DD.MM.YYYY HH:mm:ss"),takenDateTime2=moment(modifiedDate).format("YYYY-MM-DD-HH-mm-ss")),diffMn=calculateMinutesFromStr(takenDateTime2),res.originalDate=takenDateTime,res.diffMn=diffMn,callback(res)})}var _cache={};return $rootScope.$on("stateReload",function(event,data){_cache={}}),{getOptimizedCampaignDataset:getOptimizedCampaignDataset,getOptimizedCampaignDrugstoreDataset:getOptimizedCampaignDrugstoreDataset,getOptimizedCampaignsDrugstoreDataset:getOptimizedCampaignsDrugstoreDataset,loadStepsStatuses:loadStepsStatuses,getCampaigns:getCampaigns,getCampaignFiltered:getCampaignFiltered,getCampaignFilteredForDrugstore:getCampaignFilteredForDrugstore,getCampaignsQuicklyFilteredByStaffAndPromoline:getCampaignsQuicklyFilteredByStaffAndPromoline,getCampaignsWithDrugstoresQuicklyFilteredByStaffAndPromoline:getCampaignsWithDrugstoresQuicklyFilteredByStaffAndPromoline,getSelectedDrugstore:getSelectedDrugstore,getDataCampaignPages:getDataCampaignPages,getCountCampaignDrugstoreNetwork:getCountCampaignDrugstoreNetwork,isSetOfflineMode:isSetOfflineMode,getEditDrugstore:getEditDrugstore,getStaffJobTitles:getStaffJobTitles,getProperties:getProperties,saveDrugstore:saveDrugstore,saveCampaign:saveCampaign,saveDrugstoresList:saveDrugstoresList,getAddress:getAddress,saveAddress:saveAddress,getCities:getCities,savePerson:savePerson,removePerson:removePerson,getCategories:getCategories,getNetworks:getNetworks,getSellingPotential:getSellingPotential,saveSellingPotential:saveSellingPotential,getProposal:getProposal,saveProposal:saveProposal,getSellingInfo:getSellingInfo,getInvoice:getInvoice,saveInvoice:saveInvoice,getCampaignSelling:getCampaignSelling,getCampaignsDataSelling:getCampaignsDataSelling,getCampaignsSelling:getCampaignsSelling,getDataSelling:getDataSelling,saveSelling:saveSelling,calcAmountForDrug:calcAmountForDrug,calcSelling:calcSelling,calcEarns:calcEarns,calcEarnsPoints:calcEarnsPoints,saveMessage:saveMessage,getStaffJobs:getStaffJobs,getStaffJobsByDrugstores:getStaffJobsByDrugstores,getStaffJobsByDrugstoreId:getStaffJobsByDrugstoreId,getManagersForDrugstore:getManagersForDrugstore,getGift:getGift,getServiceControl:getServiceControl,getLastServiceByDrugstore:getLastServiceByDrugstore,getServicesByDrugstores:getServicesByDrugstores,saveServiceControl:saveServiceControl,getCampaignProgress:getCampaignProgress,saveCampaignProgress:saveCampaignProgress,getCampaignOfflineMode:getCampaignOfflineMode,setCampaignStepStatus:setCampaignStepStatus,getDrugstoreDataOfflineMode:getDrugstoreDataOfflineMode,getTodo:getTodo,removeTodo:removeTodo,getDrugstoresWithCampaignsByStaff:getDrugstoresWithCampaignsByStaff,isCampaignWithoutCounters:isCampaignWithoutCounters,getKamsoftReport:getKamsoftReport,getKamsoftMarketShareReports:getKamsoftMarketShareReports,getKamsoftDailyMarketShareReports:getKamsoftDailyMarketShareReports,storeKamsoftMissingData:storeKamsoftMissingData,getBudgetProgress:getBudgetProgress,saveCloneStep:saveCloneStep,getOriginalPhotoDate:getOriginalPhotoDate}}angular.module("app.campaigns").factory("campaignsDataservice",campaignsDataservice),campaignsDataservice.$inject=["$rootScope","$state","dataservice","$sessionStorage","$q","principal","exifService"]}(),function(){"use strict";function localDBService($sessionStorage,campaignsDataservice,$q,notifier,TEXT_MESSAGE){function setSSN(campaignId,drugstoreId){var ssn=campaignId+"-"+drugstoreId;return GSSN=ssn,ssn}function getSSN(campaignId,drugstoreId){return setSSN(campaignId,drugstoreId)}function setOfflineMode(isOffline){offlineMode=isOffline}function getOfflineMode(){return offlineMode}function init(properties){var ssn=setSSN(properties.campaignId,properties.drugstoreId);$sessionStorage.storage||($sessionStorage.storage={}),$sessionStorage.storage[ssn]={data:{},action:[]},properties.resultDB&&properties.resultDB.data&&($sessionStorage.storage[ssn].data=properties.resultDB.data)}function getAllData(){return $sessionStorage.storage}function getData(campaignId,drugstoreId){var ssn=getSSN(campaignId,drugstoreId);return $sessionStorage.storage[ssn]?$sessionStorage.storage[ssn].data:[]}function clear(campaignId,drugstoreId){var ssn;campaignId&&drugstoreId?(ssn=getSSN(campaignId,drugstoreId),$sessionStorage.storage[ssn]&&delete $sessionStorage.storage[ssn]):$sessionStorage.storage={},setOfflineMode(!1)}function isSetOfflineData(campaignId,drugstoreId){var ssn=getSSN(campaignId,drugstoreId);return $sessionStorage.storage&&$sessionStorage.storage[ssn]&&Object.keys($sessionStorage.storage[ssn].data).length}function getPageData(aliasPage){return $sessionStorage.storage&&$sessionStorage.storage[GSSN]&&$sessionStorage.storage[GSSN].data[aliasPage]?$sessionStorage.storage[GSSN].data[aliasPage]:[]}function setPageData(aliasPage,data){$sessionStorage.storage[GSSN]&&($sessionStorage.storage[GSSN].data[aliasPage]=data)}function getActions(campaignId,drugstoreId){var ssn;return ssn=getSSN(campaignId,drugstoreId),$sessionStorage.storage&&$sessionStorage.storage[ssn]?$sessionStorage.storage[ssn].action:[]}function getIndexAction(actionType){var index=-1;return $sessionStorage.storage[GSSN]&&$sessionStorage.storage[GSSN].action.length&&(index=$sessionStorage.storage[GSSN].action.findIndex(function(el){return el.actionType==actionType})),index}function setAction(action){var index=getIndexAction(action.actionType);index!=-1?$sessionStorage.storage[GSSN].action[index]=action:GSSN&&$sessionStorage.storage[GSSN].action.push(action)}function removeAction(actionType){var index=getIndexAction(actionType);return index!=-1&&$sessionStorage.storage[GSSN].action.splice(index,1),$sessionStorage.storage[GSSN]?$sessionStorage.storage[GSSN].action.length:0}function saveSellingPotential(sendData,isUpdate){var defer=$q.defer(),action={};return offlineMode?(action={alias:"potential",actionType:"last_selling_info_save",name:"Save",title:"Last Selling Potential",sendData:sendData,isUpdate:isUpdate,func:saveDBSellingPotential},setAction(action),setPageData("potential",sendData),defer.resolve(),notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.OFFLINE_SAVED),defer.promise):saveDBSellingPotential(sendData,isUpdate)}function saveDBSellingPotential(sendData,isUpdate){return campaignsDataservice.saveSellingPotential(sendData,isUpdate).then(function(data){return notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),data})}function saveProposal(sendData,isUpdate){var defer=$q.defer(),action={};return offlineMode?(action={alias:"proposal",actionType:"proposal_save",name:"Save",title:"Proposal",sendData:sendData,isUpdate:isUpdate,func:saveDBProposal},setAction(action),setPageData("proposal",[sendData]),defer.resolve(),notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.OFFLINE_SAVED),defer.promise):saveDBProposal(sendData,isUpdate)}function saveDBProposal(sendData,isUpdate){return campaignsDataservice.saveProposal(sendData,isUpdate).then(function(data){return notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),data})}function saveCampaignProgress(sendData,isUpdate){var defer=$q.defer(),action={};return offlineMode?(action={alias:"proposal_multi",actionType:"campaign_progress_multi_save",name:"Save",title:"Proposal, Multi Campaign",sendData:sendData,isUpdate:isUpdate,func:saveDBCampaignProgress},setAction(action),setPageData("proposal_multi",[sendData]),defer.resolve(),notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.OFFLINE_SAVED),defer.promise):saveDBCampaignProgress(sendData,isUpdate)}function saveDBCampaignProgress(sendData,isUpdate){return campaignsDataservice.saveCampaignProgress(sendData,isUpdate).then(function(data){return angular.element("#showMulti").modal("hide"),notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),data})}function saveSelling(props){var defer=$q.defer(),action={},sendData=props.sendData,isUpdate=props.isUpdate,step=props.step,alias="selling_info_"+step.unique_id,actionType="selling_info_save_"+step.unique_id;return action={alias:alias,actionType:actionType,name:"Save",title:"Selling Info, step "+props.step.identifier,sendData:sendData,isUpdate:isUpdate,func:saveDBSelling,isCloseStep:props.isCloseStep||null,funcCloseStep:props.funcCloseStep||null,step:props.step},offlineMode?(setAction(action),setPageData(alias,sendData.data),defer.resolve(),notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.OFFLINE_SAVED),defer.promise):saveDBSelling(sendData,isUpdate,action)}function saveDBSelling(sendData,isUpdate,action){return campaignsDataservice.saveSelling(sendData,isUpdate).then(function(data){return notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),action.isCloseStep&&action.funcCloseStep&&sendData.setStepStatus&&data.update_step_status&&action.funcCloseStep(action.step,sendData.setStepStatus.step_status),data})}function saveServiceControl(props){var defer=$q.defer(),action={},sendData=props.sendData,isUpdate=props.isUpdate,step=props.step,alias="service_control_"+step.unique_id,actionType="service_control_save_"+step.unique_id;return action={alias:alias,actionType:actionType,name:"Save",title:"Service Control, step "+step.identifier,sendData:sendData,isUpdate:isUpdate,func:saveDBServiceControl,step:step,isSendMessage:props.isSendMessage,funcSendMessage:props.funcSendMessage,paramsSendMessage:props.paramsSendMessage,isCloseStep:props.isCloseStep,funcCloseStep:props.funcCloseStep},offlineMode?(setAction(action),setPageData(alias,sendData.data),defer.resolve(),notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.OFFLINE_SAVED),defer.promise):saveDBServiceControl(sendData,isUpdate,action)}function saveDBServiceControl(sendData,isUpdate,action){return campaignsDataservice.saveServiceControl(sendData,isUpdate).then(function(data){return notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),action.isCloseStep&&action.funcCloseStep&&sendData.setStepStatus&&(data.update_step_status||!sendData.isSetProgressStepStatus)&&action.funcCloseStep(action.step,sendData.setStepStatus.step_status),action.isSendMessage&&action.funcSendMessage&&action.funcSendMessage(action.paramsSendMessage.subject,action.paramsSendMessage.message),data})}function getDrugstoreOfflineMode(campaignId,drugstoreId){var page,defer=$q.defer();return offlineMode?(page=getPageData("drugstoreData"),defer.resolve(page),defer.promise):getDBDrugstoreOfflineMode(campaignId,drugstoreId)}function getDBDrugstoreOfflineMode(campaignId,drugstoreId){return campaignsDataservice.getDrugstoreDataOfflineMode(campaignId,drugstoreId)}function saveDrugstore(drugstore){var defer=$q.defer(),action={};return offlineMode?(action={alias:"drugstore",actionType:"drugstore_save",name:"Save",title:"Drugstore",sendData:drugstore,isUpdate:!0,func:saveDBDrugstore},setAction(action),setPageData("drugstore",drugstore),defer.resolve(),notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.OFFLINE_SAVED),defer.promise):saveDBDrugstore(drugstore)}function saveDBDrugstore(drugstore){return drugstore.address&&drugstore.address.id&&campaignsDataservice.saveAddress(drugstore.address.id,drugstore.address),campaignsDataservice.saveDrugstore(drugstore).then(function(data){return notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),data})}function savePerson(person){var defer=$q.defer(),alias="person_"+person.email,action={};return offlineMode?(action={alias:alias,actionType:alias+"_save",name:"Save",title:"Save Person "+person.first_name+" "+person.last_name,sendData:person,func:saveDBPerson},setAction(action),setPageData(alias,person),defer.resolve(),notifier.warning("Ostrzeżenie",TEXT_MESSAGE.WARNING.OFFLINE_SAVED),defer.promise):saveDBPerson(person)}function saveDBPerson(person){var address;return person.address&&person.address.id&&(person.address.id&&person.address.city&&person.address.city_id&&(person.address.city.id=person.address.city_id),campaignsDataservice.saveAddress(person.address.id,person.address),address=person.address,address.city_id&&"object"!=typeof address.city&&(address.city_id=address.city),delete person.address),campaignsDataservice.savePerson(person).then(function(data){return notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),data})}var offlineMode,GSSN="";return{setSSN:setSSN,getSSN:getSSN,setOfflineMode:setOfflineMode,getOfflineMode:getOfflineMode,init:init,getAllData:getAllData,getData:getData,clear:clear,isSetOfflineData:isSetOfflineData,getPageData:getPageData,setPageData:setPageData,getActions:getActions,setAction:setAction,removeAction:removeAction,saveSellingPotential:saveSellingPotential,saveProposal:saveProposal,saveCampaignProgress:saveCampaignProgress,saveDBCampaignProgress:saveDBCampaignProgress,saveSelling:saveSelling,saveDBSelling:saveDBSelling,saveServiceControl:saveServiceControl,saveDBServiceControl:saveDBServiceControl,getDrugstoreOfflineMode:getDrugstoreOfflineMode,getDBDrugstoreOfflineMode:getDBDrugstoreOfflineMode,saveDrugstore:saveDrugstore,saveDBDrugstore:saveDBDrugstore,savePerson:savePerson,saveDBPerson:saveDBPerson}}angular.module("app.campaigns").factory("localDBService",localDBService),localDBService.$inject=["$sessionStorage","campaignsDataservice","$q","notifier","TEXT_MESSAGE"]}(),function(){"use strict";function ClientsAdditionalInfoController($rootScope,$state,clientsDataservice,notifier,TEXT_MESSAGE){function activate(){showDimmer(),$rootScope.subtitle="Additional Info Page",vm.drugstoreId=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,clientsDataservice.getSelectedDrugstore(vm.drugstoreId).then(function(data){vm.isVisit=getRights(data.job_duties).visit,clientsDataservice.getProperties().then(function(properties){data.properties=properties,vm.drugstore=data;var metadata=jQuery.isEmptyObject(data.metadata)?[]:data.metadata;vm.drugstore.metadata={},metadata.forEach(function(metadata){_.isEmpty(data.properties)||(vm.drugstore.metadata[metadata.key]=metadata.value)}),vm.properties=data.properties,hideDimmer()},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}var vm=this;vm.editAdditionalInfo=function(drugstoreId){vm.isVisit&&$state.go("clients.additionalInfoEdit",{id:drugstoreId})},activate()}angular.module("app.clients").controller("ClientsAdditionalInfoController",ClientsAdditionalInfoController),ClientsAdditionalInfoController.$inject=["$rootScope","$state","clientsDataservice","notifier","TEXT_MESSAGE"]}(),function(){"use strict";function ClientsAdditionalInfoEditController($rootScope,$state,clientsDataservice,notifier,TEXT_MESSAGE){function activate(){showDimmer(),$rootScope.subtitle="Additional Info Edit Page",vm.drugstoreId=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,clientsDataservice.getSelectedDrugstore(vm.drugstoreId).then(function(data){clientsDataservice.getProperties().then(function(properties){data.properties=properties,vm.drugstore=data;var metadata=jQuery.isEmptyObject(data.metadata)?[]:data.metadata;vm.drugstore.metadata={},properties.forEach(function(property){var meta_data=metadata.filter(function(p){return property.id==p.key});meta_data.length?(meta_data=meta_data[0],"boolean"==property.type?vm.drugstore.metadata[meta_data.key]="1"==meta_data.value||0:"number"==property.type?vm.drugstore.metadata[meta_data.key]=parseInt(meta_data.value):vm.drugstore.metadata[meta_data.key]=meta_data.value):"boolean"==property.type||"number"==property.type?vm.drugstore.metadata[property.id]=0:"string"==property.type&&(vm.drugstore.metadata[property.id]="")}),vm.properties=data.properties,hideDimmer()},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}var vm=this;activate(),vm.saveAdditionalInfo=function(){for(var key in vm.drugstore.metadata)vm.drugstore.metadata.hasOwnProperty(key)&&vm.drugstore.metadata[key]===!1&&(vm.drugstore.metadata[key]="0");clientsDataservice.saveDrugstore(vm.drugstore),$state.go("clients.additionalInfo",{id:vm.drugstoreId})},vm.cancelAdditionalInfoSave=function(){$state.go("clients.additionalInfo",{id:vm.drugstoreId})}}angular.module("app.clients").controller("ClientsAdditionalInfoEditController",ClientsAdditionalInfoEditController),ClientsAdditionalInfoEditController.$inject=["$rootScope","$state","clientsDataservice","notifier","TEXT_MESSAGE"]}(),function(undefined){"use strict";function ClientsCardController($rootScope,$scope,$state,$timeout,$sessionStorage,clientsDataservice,campaignsDataservice,localDBService,stepsService,notifier,TEXT_MESSAGE,MERCH_IMAGES_PATH,OFFLINE_MODE,principal,geolocation){function activate(){var userId=null;showDimmer(),$sessionStorage.stepFilter=null,vm.drugstoreId=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,$rootScope.subtitle="Card drugstore #"+vm.drugstoreId,vm.currentPage=$state.params.hasOwnProperty("page")?parseInt($state.params.page):1,vm.campaigns=[],vm.campaignsHistory=[],vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.lockForm=!1,vm.isManager=!1,vm.userData&&(userId=vm.userData.id),vm.isSetOfflineMode=OFFLINE_MODE,vm.offlineMode={},vm.offlineMode[vm.drugstoreId]={},vm.actionAfterOffline={},vm.actionAfterOffline[vm.drugstoreId]={},vm.ischeckDatePhotoIfSetDateInvalid=!0,campaignsDataservice.getOptimizedCampaignsDrugstoreDataset(vm.drugstoreId,userId).then(function(resource){var listDrugstores,campaigns_ids,mainDrugstoreId,mainId,stepStatuses,campaignsStatus,campaignsProgressBar,properties=resource.props||[],metadata=jQuery.isEmptyObject(resource.drugstore.metadata)?[]:resource.drugstore.metadata,campaigns_selling=resource.campaigns_selling,campaigns_progress=resource.campaigns_progress,drugstoreCampaigns=resource.campaigns,campaigns_first_step=resource.campaigns_first_step,campaigns_last_step=resource.campaigns_last_step,campaignsDominant={};service_control_statuses=resource.service_control_statuses,dynamic_steps=resource.dynamic_steps,hideDimmer(),vm.drugstore=resource.drugstore,vm.hasWarningSign=clientsDataservice.hasWarningSign(vm.drugstore),listDrugstores=vm.drugstore.network_drugstores,campaigns_ids=resource.campaigns.map(function(el){return el.id}),mainDrugstoreId=vm.drugstore.main_drugstore_id,vm.drugstore.metadata={},vm.drugstore.picture={},vm.drugstore.buttonSave=!1,vm.isDrugstoreConference=resource.isDrugstoreConference,$rootScope.breadcrumbTitle=vm.drugstore.name,$rootScope.breadcrumbParentTitle="Klienci",$rootScope.breadcrumbParentState="clients.list",$rootScope.$emit("receivedMainRequest",!0),vm.isRegisteredAtPortal(),vm.drugstore.photo&&(vm.drugstore.picture.src=MERCH_IMAGES_PATH+vm.drugstore.photo+"?r="+randomNumber(1,100),vm.photo_date_invalid=cloneObj(vm.drugstore.photo_date_invalid),vm.photo_rejected=vm.drugstore.photo_rejected),vm.drugstore.photos&&vm.drugstore.photos.length&&(vm.photoIndex=0,vm.path_img=MERCH_IMAGES_PATH,vm.hideBlankPhoto=!0),vm.netWorkIcon=getNetWorkIcon(),vm.netDrugstores=listDrugstores,metadata.forEach(function(metadata){_.isEmpty(properties)||(vm.drugstore.metadata[metadata.key]=metadata.value)}),vm.properties=properties,vm.netDrugstores.length||vm.netDrugstores.push({id:vm.drugstoreId,identifier:vm.drugstore.identifier,NIP:vm.drugstore.NIP,name:vm.drugstore.name,address:vm.drugstore.address,campaigns:campaigns_ids}),vm.countNetDrugstores=vm.netDrugstores.filter(function(d){return!d.isHide}).length,campaigns_ids.length&&(mainId=vm.drugstore.negotiation_point?vm.drugstoreId:mainDrugstoreId?mainDrugstoreId:vm.drugstoreId,stepsService.initStepsStatusesByDrugstore(mainId,campaigns_ids,campaigns_progress),campaignsStatus=stepsService.getCampaignsStatus(),drugstoreCampaigns.forEach(function(campaign){var isFirstStepStart=campaigns_first_step.indexOf(campaign.id)>-1,isLastStepStart=campaigns_last_step.indexOf(campaign.id)>-1;campaign.date_start=calcTime(campaign.date_start,!0),campaign.date_end=calcTime(campaign.date_end,!0),campaign.steps=stepsService.getSteps(campaign.definition),campaign.icon=stepsService.getCampaignIcon(),campaign.initSteps=cloneObj(campaign.steps),campaignsDominant[campaign.id]=campaign.dominant,mainId!=vm.drugstoreId&&(stepStatuses=stepsService.getStepsStatuses(mainId,campaign.id),"{}"!=stepStatuses&&stepsService.setStepsStatuses(vm.drugstoreId,campaign.id,stepStatuses)),campaign.progressId=0,campaignsStatus[campaign.id]&&campaignsStatus[campaign.id].progress_id&&(campaign.progressId=campaignsStatus[campaign.id].progress_id),vm.offlineMode[vm.drugstoreId][campaign.id]=localDBService.isSetOfflineData(campaign.id,vm.drugstoreId),vm.actionAfterOffline[vm.drugstoreId][campaign.id]=null,vm.drugstore.isBlocked=stepsService.checkDrugstoreBlockProperty(vm.drugstoreId,campaign.id,vm.drugstore.metadata,campaigns_selling),campaign.steps=stepsService.getDrugstoreSteps({drugstoreId:vm.drugstoreId,campaignId:campaign.id,has_network:vm.drugstore.drugstores_network_id,negotiation_point:vm.drugstore.negotiation_point,selling_point:vm.drugstore.selling_point,is_blocked:vm.drugstore.isBlocked,is_first_step_start:isFirstStepStart,is_last_step_start:isLastStepStart,service_control_statuses:service_control_statuses[campaign.id]?service_control_statuses[campaign.id]:undefined,dynamic_steps:dynamic_steps[campaign.id]?dynamic_steps[campaign.id]:undefined}),campaign.stepsCopy=cloneObj(campaign.steps),campaignsStatus[campaign.id]&&"active"!=campaignsStatus[campaign.id].campaign_status&&"pending"!=campaignsStatus[campaign.id].campaign_status?vm.campaignsHistory.push(campaign):campaign.archived||vm.campaigns.push(campaign)}),campaignsProgressBar=clientsDataservice.getCampaignsDataSelling(vm.drugstoreId,mainId,campaigns_selling,campaignsDominant),vm.campaigns.forEach(function(campaign){campaign.progress=campaignsProgressBar[campaign.id]?campaignsProgressBar[campaign.id].progress:0}))}),$sessionStorage.listDrugstores&&$sessionStorage.listDrugstores[vm.drugstoreId]&&$sessionStorage.listDrugstores[vm.drugstoreId].staff?(vm.staffForDrugstore=$sessionStorage.listDrugstores[vm.drugstoreId].staff,$sessionStorage.listStaff&&setInfoForStaff($sessionStorage.listStaff)):(vm.userData&&(userId=vm.userData.id),setStaffForDrugstore(userId))}function setStaffForDrugstore(userId){campaignsDataservice.getStaffJobsByDrugstores(userId,!0).then(function(staffDrugstores){staffDrugstores.drugstores&&staffDrugstores.drugstores[vm.drugstoreId]&&staffDrugstores.drugstores[vm.drugstoreId].staff&&(vm.staffForDrugstore=staffDrugstores.drugstores[vm.drugstoreId].staff,setInfoForStaff(staffDrugstores.staff),$sessionStorage.listDrugstores=staffDrugstores.drugstores,$sessionStorage.listStaff=staffDrugstores.staff)})}function setInfoForStaff(staffDrugstores){angular.forEach(vm.staffForDrugstore,function(el){el.iSManager=el.job_duties.indexOf("[2]")>-1,el.job=staffDrugstores[el.staff_id].job,el.staff_info=staffDrugstores[el.staff_id].staff_info,el.staff_id==vm.userData.id&&el.iSManager&&(vm.isManager=!0)})}function getNetWorkIcon(){var isGlobal=vm.drugstore.drugstores_network&&"central"==vm.drugstore.drugstores_network.type,nameIcon="drugstore_";return vm.drugstore.drugstores_network_id?(nameIcon+="network_",nameIcon+=isGlobal?"global_":"local_",vm.drugstore.negotiation_point?nameIcon+=vm.drugstore.selling_point?"negotiation_selling_point":"negotiation_point":vm.drugstore.selling_point&&(nameIcon+="selling_point")):nameIcon+="individual",nameIcon+".png"}var service_control_statuses,dynamic_steps,vm=this;vm.showMainInfo=function(drugstoreId){$state.go("clients.mainInfo",{id:drugstoreId})},vm.showAdditionalInfo=function(drugstoreId){$state.go("clients.additionalInfo",{id:drugstoreId})},vm.selectCampaign=function(campaignId){$state.go("campaigns.main",{id:campaignId})},vm.selectDrugstore=function(drugstoreId){$state.go("clients.card",{id:drugstoreId})},vm.selectCampaignStep=function(campaign,stepIdentifier){var stepIndex=null;if($sessionStorage.drugstoreSteps=campaign.steps,!stepIdentifier)for(var i=0,len=campaign.steps.length;i<len;i++)if(!campaign.steps[i].disabled){stepIdentifier=campaign.steps[i].identifier;break}stepIndex=campaign.stepsCopy.findIndex(function(step){return step.identifier==stepIdentifier}),showDimmer(),$state.go("campaigns.steps.pages",{campaignId:campaign.id,drugstoreId:vm.drugstoreId,stepIndex:stepIndex?stepIndex+1:1,pageIndex:1})},vm.showConfirmSetMode=function(campaign){vm.campaign=campaign,vm.campaignId=campaign.id,vm.offlineMode[vm.drugstoreId][vm.campaignId]?vm.setMode():angular.element("#confirmOfflineMode").modal("show")},vm.setMode=function(){var campaign,mainDrugstore,countMainOffices,mainDrugstoreId,campaignDrugstores,drugstoresIds,actionAfterOffline=localDBService.getActions(vm.campaignId,vm.drugstoreId);campaign=cloneObj(vm.campaign),removeProperties(campaign,["initSteps","stepsCopy"]),vm.offlineMode[vm.drugstoreId][vm.campaignId]=!vm.offlineMode[vm.drugstoreId][vm.campaignId],vm.offlineMode[vm.drugstoreId][vm.campaignId]?(vm.actionAfterOffline[vm.drugstoreId][vm.campaignId]=null,campaignDrugstores=vm.netDrugstores.filter(function(el){return containsInArray(el.campaigns,[vm.campaignId]);
}),drugstoresIds=campaignDrugstores.length>1?campaignDrugstores.map(function(el){return el.id}):[vm.drugstoreId],mainDrugstore=campaignDrugstores.filter(function(el){return el.negotiation_point}),countMainOffices=mainDrugstore.length,mainDrugstoreId=countMainOffices?mainDrugstore[0].id:vm.drugstoreId,campaignsDataservice.getStaffJobTitles(!1).then(function(staffJobTitles){campaignsDataservice.getCampaignOfflineMode({staffId:vm.userData.id,campaignId:vm.campaignId,drugstoreId:vm.drugstoreId,mainDrugstoreId:mainDrugstoreId,progressId:vm.campaign.progressId,drugstores:drugstoresIds}).then(function(result){result.data||(result.data={}),result.data.drugstore=vm.drugstore,result.data.campaign=campaign,result.data.campaign.drugstores=campaignDrugstores,result.data.countMainOffices=countMainOffices,result.data.mainDrugstoreId=mainDrugstoreId,result.data.staffJobTitles=staffJobTitles,result.data.service_control_statuses=service_control_statuses[campaign.id]?service_control_statuses[campaign.id]:undefined,result.data.dynamic_steps=dynamic_steps[campaign.id]?dynamic_steps[campaign.id]:undefined,localDBService.init({campaignId:vm.campaignId,drugstoreId:vm.drugstoreId,resultDB:result}),notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_GET_OFFLINE)},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})):(localDBService.setOfflineMode(!1),actionAfterOffline.length?(vm.actionAfterOffline[vm.drugstoreId][vm.campaignId]=actionAfterOffline,vm.showActionMode()):(vm.actionAfterOffline[vm.drugstoreId][vm.campaignId]=null,localDBService.clear(vm.campaignId,vm.drugstoreId)))},vm.showActionMode=function(){angular.element("#actionsAfterOffline").modal("show")},vm.executeOfflineAction=function(){return vm.isCloseStep=!1,!vm.lockForm&&(vm.lockForm=!0,localDBService.setSSN(vm.campaignId,vm.drugstoreId),void angular.forEach(vm.actionAfterOffline[vm.drugstoreId][vm.campaignId],function(act){act.isCloseStep&&(vm.isCloseStep=!0),act.func&&vm.todoAction(act)}))},vm.todoAction=function(act){return act.func(act.sendData,act.isUpdate,act).then(function(data){vm.removeOfflineAction(act.actionType)},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})},vm.removeOfflineAction=function(actionType){var countActions=localDBService.removeAction(actionType);countActions||(angular.element("#actionsAfterOffline").modal("hide"),vm.actionAfterOffline[vm.drugstoreId][vm.campaignId]=null,vm.lockForm=!1,localDBService.clear(vm.campaignId,vm.drugstoreId),vm.isCloseStep&&vm.refresh())},vm.refresh=function(){$state.go($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})},vm.conference=function(){$state.go("clients.conference",{id:vm.drugstoreId})},vm.showStaffActivity=function(){angular.element("#staffActivity").modal("show")},vm.showStaffList=function(){angular.element("#staffForDrugstore").modal("show")},vm.showDrugstoresList=function(){angular.element("#networkDrugstoresList").modal("show")},vm.findNotRegisteredPortalAccount=function(){var drugstoresStaff;return drugstoresStaff=vm.drugstore.drugstores_staff.find(function(dss){return dss.is_drugstore===!0&&dss.registered_at_portal===!1&&dss.email==vm.drugstore.email})},vm.isRegisteredAtPortal=function(){var isExistsNotRegistered=!1,isRegistered=vm.drugstore.parent_drugstore?vm.drugstore.parent_drugstore.registered_at_portal:vm.drugstore.registered_at_portal;isRegistered||(isExistsNotRegistered=vm.findNotRegisteredPortalAccount()),vm.portalRegistered=isRegistered,vm.isExistsNotRegistered=isExistsNotRegistered},vm.isJobDutiesSignatureVisit=function(staff){return clientsDataservice.isJobDutiesSignatureVisit(staff)},vm.isNegotiationPoint=function(drugstore){return clientsDataservice.isNegotiationPoint(drugstore)},vm.showStaffPhotos=function($event){vm.hideBlankPhoto&&!angular.isDefined(vm.photoIndex)&&(vm.photoIndex=0)},vm.toggleImage=function(){vm.photoIndex<vm.drugstore.photos.length-1?vm.photoIndex++:vm.photoIndex=0},vm.drugstoreImageUpload=function(){var drugstoreDefinition,drugstoreData,location;return drugstoreDefinition={originalDate:vm.drugstore.picture.date||""},principal.getGeolocationIsOn()&&(location=geolocation.getLastLocation(),location&&(drugstoreDefinition.geolocation=location)),drugstoreData={staff_id:vm.userData.id,drugstore_id:vm.drugstoreId,value:vm.drugstore.picture.value,name:vm.drugstore.picture.name,newName:"drugstoreCard_"+vm.drugstoreId,definition:JSON.stringify(drugstoreDefinition)},clientsDataservice.drugstoreImageUpload(drugstoreData).then(function(data){vm.drugstore.buttonSave=!1},function(err){vm.drugstore.picture.src="",notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)}),!0},$scope.loadPhoto=function(elem){var file=elem.files[0],reader=(angular.element(elem),new FileReader);reader.onload=function(e){var tempImg=new Image;tempImg.src=reader.result,tempImg.onload=function(){var maxWidth=400,maxHeight=400,tempWidth=tempImg.width,tempHeight=tempImg.height;tempWidth>tempHeight?tempWidth>maxWidth&&(tempHeight*=maxWidth/tempWidth,tempWidth=maxWidth):tempHeight>maxHeight&&(tempWidth*=maxHeight/tempHeight,tempHeight=maxHeight);var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=tempWidth,canvas.height=tempHeight,ctx.drawImage(this,0,0,tempWidth,tempHeight),$timeout(function(){vm.drugstore.picture.src=canvas.toDataURL("image/jpeg"),vm.drugstore.picture.value=canvas.toDataURL("image/jpeg"),vm.drugstore.picture.name=file.name,vm.drugstore.buttonSave=!1,vm.drugstore.buttonSave=!vm.photo_date_invalid||!vm.ischeckDatePhotoIfSetDateInvalid},0)}},file&&campaignsDataservice.getOriginalPhotoDate(file,function(response){var realPhotoDate,photoNeedDate,differenceDates;response.originalDate&&(vm.drugstore.picture.date=response.originalDate),vm.drugstore.photo_date_invalid&&(realPhotoDate=calcTime(moment(response.originalDate,"DD.MM.YYYY HH:mm:ss")),photoNeedDate=calcTime(vm.drugstore.photos_invalid_from,!0),differenceDates=compareDates(realPhotoDate,photoNeedDate),null!==differenceDates&&(vm.photo_date_invalid=differenceDates<0)),reader.readAsDataURL(file)})},vm.confirmCloneStep=function(campaign){var isStepWarning,isClose,isNotInDate,last_step_date,lastStep=campaign.steps.length?campaign.steps[campaign.steps.length-1]:null,isCan=vm.isJobDutiesSignatureVisit,now=new Date,campaign_date_end=calcTime(campaign.date_end,!0);lastStep&&(now.setHours(0,0,0,0),campaign_date_end.setHours(0,0,0,0),last_step_date=calcTime(lastStep.date_end,!0),isStepWarning=stepsService.isWarningStep(last_step_date),last_step_date.setHours(0,0,0,0),isNotInDate=!lastStep.inDate&&now>last_step_date,isClose="completed"==lastStep.status,isCan?isStepWarning||isClose||isNotInDate?now>campaign_date_end?angular.element("#banOnCloningByDate").modal("show"):(vm.cloneCampaign=campaign,angular.element("#confirmAddStep").modal("show")):angular.element("#banOnCloning").modal("show"):angular.element("#banOnCloningByRights").modal("show"))},vm.cloneStep=function(){var isClose,step,date_end,campaign_date_end,diffDays,lastStep=vm.cloneCampaign.initSteps.length?vm.cloneCampaign.initSteps[vm.cloneCampaign.initSteps.length-1]:null,drugstoreLastStep=vm.cloneCampaign.steps.length?vm.cloneCampaign.steps[vm.cloneCampaign.steps.length-1]:null,now=new Date,data={};lastStep&&drugstoreLastStep&&vm.userData.id&&(step=cloneObj(lastStep),isClose="completed"==drugstoreLastStep.status,step.pages=[],step.unique_id=now.valueOf(),step.identifier=incrementLast(drugstoreLastStep.identifier),removeProperties(step,["allPages","isWarningStep","isStepStart","readOnly","color","status","disabled"]),diffDays=Number(calculatePassedDays(drugstoreLastStep.date_end,drugstoreLastStep.date_start)),isClose||!drugstoreLastStep.inDate?(now.setHours(0,0,0,0),step.date_start=now,date_end=new Date,date_end.setDate(date_end.getDate()+diffDays),date_end.setHours(0,0,0,0),campaign_date_end=calcTime(vm.cloneCampaign.date_end,!0),campaign_date_end.setHours(0,0,0,0),calcTime(date_end,!0)>campaign_date_end&&(date_end=campaign_date_end),step.date_end=new Date(date_end)):drugstoreLastStep.inDate&&(date_end=new Date(drugstoreLastStep.date_end),step.date_start=drugstoreLastStep.date_end,date_end.setDate(date_end.getDate()+diffDays),step.date_end=new Date(date_end)),drugstoreLastStep.pages.forEach(function(page){"services_control"==page.type&&step.pages.push(page)}),data={campaign_id:vm.cloneCampaign.id,drugstore_id:vm.drugstoreId,step_id:step.unique_id,step_definition:JSON.stringify(step),staff_id:vm.userData.id},showDimmer(),campaignsDataservice.saveCloneStep(data).then(function(res){var newStep=stepsService.addOneStepNotPaidCampaign(step,{drugstoreId:vm.drugstoreId,campaignId:vm.cloneCampaign.id,has_network:vm.drugstore.drugstores_network_id,negotiation_point:vm.drugstore.negotiation_point,selling_point:vm.drugstore.selling_point,is_blocked:vm.drugstore.isBlocked,service_control_statuses:service_control_statuses});notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),hideDimmer(),vm.cloneCampaign.steps.push(newStep),vm.cloneCampaign.stepsCopy.push(newStep),$rootScope.$broadcast("addElement",{targetId:vm.cloneCampaign.id})},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)}))},activate()}angular.module("app.clients").controller("ClientsCardController",ClientsCardController),ClientsCardController.$inject=["$rootScope","$scope","$state","$timeout","$sessionStorage","clientsDataservice","campaignsDataservice","localDBService","stepsService","notifier","TEXT_MESSAGE","MERCH_IMAGES_PATH","OFFLINE_MODE","principal","geolocation"]}(),function(){"use strict";function ClientsController($rootScope,dataservice,logger){function activate(){vm.subtitle=$rootScope.subtitle,$rootScope.assignModuleTranslations("clients")}$rootScope.breadcrumbTitle="Klienci",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="";var vm=this;vm.title="Klienci",activate()}angular.module("app.clients").controller("ClientsController",ClientsController),ClientsController.$inject=["$rootScope","dataservice","logger"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"clients",config:{parent:"root",templateUrl:"app/clients/clients.html",controller:"ClientsController",controllerAs:"vm",settings:{}}},{state:"clients.list",config:{url:"/clients",templateUrl:"app/clients/list/clients.list.html",controller:"ClientsListController",controllerAs:"vm",title:"Clients List",data:{roles:[]},settings:{}}},{state:"clients.list_rights",config:{url:"/clients/{rights:[a-z]{1,10}}",templateUrl:"app/clients/list/clients.list.html",controller:"ClientsListController",controllerAs:"vm",title:"Clients List",data:{roles:[]},settings:{}}},{state:"clients.filter",config:{url:"/clients/filter/{id:[0-9]{1,8}}",templateUrl:"app/clients/list/clients.filter.html",controller:"ClientsFilterController",controllerAs:"vm",title:"Clients List",data:{roles:[]},settings:{}}},{state:"clients.filter_rights",config:{url:"/clients/filter/{id:[0-9]{1,8}}/{rights:[a-z]{1,10}}",templateUrl:"app/clients/list/clients.filter.html",controller:"ClientsFilterController",controllerAs:"vm",title:"Clients List",data:{roles:[]},settings:{}}},{state:"clients.card",config:{url:"/clients/card/{id:[0-9]{1,8}}",templateUrl:"app/clients/card/clients.card.html",controller:"ClientsCardController",controllerAs:"vm",title:"Client Card",data:{roles:[]},settings:{}}},{state:"clients.mainInfo",config:{url:"/clients/mainInfo/{id:[0-9]{1,8}}",templateUrl:"app/clients/mainInfo/clients.mainInfo.html",controller:"ClientsMainInfoController",controllerAs:"vm",title:"Client Main Info",data:{roles:[]},settings:{}}},{state:"clients.additionalInfo",config:{url:"/clients/additionalInfo/{id:[0-9]{1,8}}",templateUrl:"app/clients/additionalInfo/clients.additionalInfo.html",controller:"ClientsAdditionalInfoController",controllerAs:"vm",title:"Client Additional Info",data:{roles:[]},settings:{}}},{state:"clients.mainInfoEdit",config:{url:"/clients/mainInfo/edit/{id:[0-9]{1,8}}",templateUrl:"app/clients/mainInfo/clients.mainInfoEdit.html",controller:"ClientsMainInfoEditController",controllerAs:"vm",title:"Client Main Info Edit",data:{roles:[]},settings:{}}},{state:"clients.additionalInfoEdit",config:{url:"/clients/additionalInfo/edit/{id:[0-9]{1,8}}",templateUrl:"app/clients/additionalInfo/clients.additionalInfoEdit.html",controller:"ClientsAdditionalInfoEditController",controllerAs:"vm",title:"Client Additional Info Edit",data:{roles:[]},settings:{}}},{state:"clients.mainInfoCreate",config:{url:"/clients/mainInfo/create",templateUrl:"app/clients/mainInfo/clients.mainInfoEdit.html",controller:"ClientsMainInfoCreateController",controllerAs:"vm",title:"Client Create",data:{roles:[]},settings:{}}},{state:"clients.conference",config:{url:"/clients/conference/{id:[0-9]{1,8}}",templateUrl:"app/clients/conference/clients.conference.html",controller:"ClientsConferenceController",controllerAs:"vm",title:"Conference",data:{roles:[]},settings:{}}}]}angular.module("app.clients").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function ClientsConferenceController($rootScope,$state,clientsDataservice,principal,notifier,TEXT_MESSAGE){function clearMessage(){vm.message="Choose Conference",vm.messageClass=""}function clearCalculateStaff(){vm.count_include_staff=0,vm.count_one_bed_room_include_staff=0,vm.count_two_bed_room_include_staff=0,vm.date.overrun_one_rooms=0,vm.date.overrun_two_rooms=0}function setMessageProps(txt){vm.message=txt,vm.messageClass="negative-text"}function setConferenceCityData(city){vm.conference.cities_data.filter(function(data){return data.city_id==city.id}).forEach(function(datePlace){datePlace.dates_and_placement.forEach(function(el){var date_start=new Date(el.date_start),date_end=new Date(el.date_end),period=moment(date_start).format("DD.MM.YYYY")+" - "+moment(date_end).format("DD.MM.YYYY"),obj={date_start:date_start,date_end:date_end,period:period,one_bed_rooms_quantity:el.one_bed_rooms_quantity,count_one_bed_rooms:el.one_bed_rooms_quantity,two_bed_rooms_quantity:el.two_bed_rooms_quantity,count_two_bed_rooms:el.two_bed_rooms_quantity};obj.staff=cloneObj(vm.persons),obj.staff.map(function(person){person.fullName=person.first_name+" "+person.last_name,person.number_beds=null,person.number_room=0,person.number_bed=0,person.selected=!1}),vm.selected.data[city.id].dates||(vm.selected.data[city.id].dates=[]),vm.selected.data[city.id].dates.push(obj)})})}function initConferenceData(){vm.cities.length&&vm.cities.forEach(function(city){vm.selected.data[city.id]||(vm.selected.data[city.id]={}),vm.conference.staff_data&&vm.conference.staff_data[city.id]?vm.selected.data[city.id]=vm.conference.staff_data[city.id]:(vm.selected.data[city.id].city||(vm.selected.data[city.id].city={id:city.id,name:city.name}),setConferenceCityData(city))})}function calculateRooms(){var remaining_one_rooms,remaining_two_rooms;vm.date.count_one_bed_rooms=vm.one_bed_rooms_quantity,vm.date.count_two_bed_rooms=vm.two_bed_rooms_quantity,vm.disabled=!1,clearMessage(),clearCalculateStaff(),calculateIncludedStaff(),remaining_one_rooms=vm.one_bed_rooms_quantity-vm.count_one_bed_room_include_staff,remaining_one_rooms<0&&(vm.date.overrun_one_rooms=Math.abs(remaining_one_rooms),setMessageProps("overrun one bed rooms on "+vm.date.overrun_one_rooms),remaining_one_rooms=0,vm.disabled=!0),vm.date.count_one_bed_rooms=remaining_one_rooms,remaining_two_rooms=vm.two_bed_rooms_quantity-vm.count_two_bed_room_include_staff,remaining_two_rooms<0&&(vm.date.overrun_two_rooms=Math.abs(remaining_two_rooms),setMessageProps("overrun two bed rooms on "+vm.date.overrun_two_rooms),remaining_two_rooms=0,vm.disabled=!0),vm.date.count_two_bed_rooms=remaining_two_rooms}function calculateIncludedStaff(){var count_include_staff=vm.date.staff.filter(function(person){return person.selected}),count_one_bed_room_include_staff=vm.date.staff.filter(function(person){return person.selected&&1==person.number_beds}),count_two_bed_room_include_staff=vm.date.staff.filter(function(person){return person.selected&&2==person.number_beds});vm.count_include_staff=count_include_staff.length||0,vm.count_one_bed_room_include_staff=count_one_bed_room_include_staff.length||0,vm.count_two_bed_room_include_staff=count_two_bed_room_include_staff.length||0}function clearPlacementData(){vm.date.staff.forEach(function(person){person.number_beds=null,person.number_room=0,person.number_bed=0,person.selected=!1})}function activate(){var colors=["green","yellow","red","purple","orange"];vm.conferences=[],vm.city_dates=[],vm.city=0,vm.date={},vm.allSelected=!1,vm.selected={},vm.disabled=!1,vm.personsDropped=[],$rootScope.subtitle="Conference Page",vm.drugstoreId=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,clearCalculateStaff(),clearMessage(),clientsDataservice.getSelectedDrugstore(vm.drugstoreId).then(function(data){var persons=data.drugstores_staff.filter(function(person,index){return!person.is_drugstore});vm.drugstore=data,vm.persons=cloneObj(persons),clientsDataservice.getConferences().then(function(conferences){var fistConference,indexColor=0;conferences=conferences.filter(function(cf){return cf.drugstores.find(function(cd){return cd.id==vm.drugstoreId})}),conferences.length?conferences.map(function(conference,index){0===index&&(fistConference=conference);try{conference.cities_data=JSON.parse(conference.cities_data)}catch(e){}try{conference.staff_data=JSON.parse(conference.staff_data)}catch(e){}conference.color=colors[indexColor],(indexColor-1)%5!=4&&0!==indexColor||(indexColor=0),indexColor++}):vm.disabled=!0,vm.conferences=conferences})})}var vm=this;vm.selectConference=function(conference){clearMessage(),vm.conference=conference,vm.cities=conference.cities,vm.selected.id=conference.id,vm.selected.name=conference.name,vm.selected.topic=conference.topic,vm.selected.data={},vm.cities.length&&initConferenceData()},vm.changeCity=function(){clearMessage(),vm.city?(vm.city_dates=vm.selected.data[vm.city.id]&&vm.selected.data[vm.city.id].dates?vm.selected.data[vm.city.id].dates:[],vm.city_dates.length&&(vm.date=vm.city_dates[0],vm.changeDate())):vm.date=null},vm.changeDate=function(){vm.allSelectedRoom=null,vm.allSelected=!1,vm.one_bed_rooms_quantity=vm.date.one_bed_rooms_quantity,vm.two_bed_rooms_quantity=vm.date.two_bed_rooms_quantity,clearCalculateStaff(),clearMessage()},vm.toggleAllSelectedRoom=function(){vm.date.staff.forEach(function(person){person.number_beds=vm.allSelectedRoom}),calculateRooms()},vm.togglePersonsSelected=function(){vm.date.staff.forEach(function(person){person.selected=vm.allSelected}),calculateRooms()},vm.togglePerson=function(person){vm.allSelected=null,calculateRooms()},vm.personSelectedRoom=function(person){vm.allSelectedRoom=null,calculateRooms()},vm.placement=function(){clearPlacementData(),vm.personsTemp=cloneObj(vm.date.staff),vm.personsDropped=[],angular.element("#showPlacement").modal("show")},vm.cancelPlacement=function(){clearPlacementData(),calculateRooms(),angular.element("#showPlacement").modal("hide")},vm.savePlacement=function(){calculateRooms(),angular.element("#showPlacement").modal("hide")},vm.refresh=function(){$state.go($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})},vm.generateInvitation=function(){var data;vm.lockForm=!0,vm.date.staff&&vm.selected.id&&(data={id:vm.selected.id,staff_data:JSON.stringify(vm.selected.data)},clientsDataservice.updateConference(data).then(function(res){vm.lockForm=!1,notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),vm.refresh()},function(res){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(res.data.message)}))},activate(),vm.onDragStart=function(data,evt){},vm.onDragEnd=function(data,evt){},vm.onDropComplete=function(data,evt,amountBeds,numberRoom,numberBed){var el,index,indexPerson,findPerson;return vm.selected.data&&vm.selected.data[vm.city.id]?(el=evt.element,indexPerson=vm.personsTemp.indexOf(data),indexPerson>-1&&vm.personsTemp.splice(indexPerson,1),void(data&&(data.number_room==numberRoom+1&&data.number_bed==numberBed+1&&data.number_beds==amountBeds||(index=vm.personsDropped.indexOf(data),data.number_room=numberRoom+1,data.number_bed=numberBed+1,data.number_beds=amountBeds,index==-1&&(vm.personsDropped.push(data),data.selected=!0),findPerson=vm.date.staff.find(function(el){return el.id==data.id}),findPerson&&(findPerson.selected=data.selected,findPerson.number_room=data.number_room,findPerson.number_bed=data.number_bed,findPerson.number_beds=data.number_beds))))):void console.log("there are no conferences or not choose a city!")},vm.onDropCompletePerson=function(data,evt){var el,index,indexPerson,findPerson;el=evt.element,indexPerson=vm.personsTemp.indexOf(data),index=vm.personsDropped.indexOf(data),data.number_room=0,data.number_bed=0,data.number_beds=0,findPerson=vm.date.staff.find(function(el){return el.id==data.id}),indexPerson==-1&&(vm.personsTemp.push(data),data.selected=!1),index>-1&&vm.personsDropped.splice(index,1),findPerson&&(findPerson.selected=data.selected,findPerson.number_room=data.number_room,findPerson.number_bed=data.number_bed,findPerson.number_beds=data.number_beds)}}angular.module("app.clients").controller("ClientsConferenceController",ClientsConferenceController),ClientsConferenceController.$inject=["$rootScope","$state","clientsDataservice","principal","notifier","TEXT_MESSAGE"]}(),function(undefined){"use strict";function ClientsFilterController($rootScope,$state,$filter,campaignsDataservice,clientsDataservice,$sessionStorage,stepsService,notifier,TEXT_MESSAGE,PAGING){function activate(){var userId=null,isPaging=PAGING.APPLY;vm.colorStepCounter=[],vm.stepColorInfo=[],showDimmer(),vm.listSlider={width:0,height:0},vm.campaignId=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,vm.rightsName=$state.params.hasOwnProperty("rights")?$state.params.rights:"",vm.pagingLimit=PAGING.ITEMS_ON_PAGE,$rootScope.subtitle="List page",vm.sort={column:["drugstores_network.name","drugstores_network.id","-negotiation_point"],descending:!1,"class":"ascending"},vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.drugstores=[],vm.isManager=$sessionStorage.isManager||!1,vm.userData&&(userId=vm.userData.id),vm.stepColors=["marine","green","yellow","red","lightgreen","greenwarning","grey"],vm.stepColorLabels={green:"STEP_START",lightgreen:"STEP_TURN",marine:"STEP_OK",yellow:"STEP_WAIT",red:"STEP_ATTENTION"},vm.selectedColor="",vm.selectedStep="",vm.activeColorRights={visit:"my"==vm.rightsName?"marine":"",management:"observed"==vm.rightsName?"marine":"",colleague:"colleague"==vm.rightsName?"marine":""},vm.selectedStaff=null,vm.isManager&&(vm.listStaff={},vm.listDrugstores={},$sessionStorage.listStaff&&$sessionStorage.listDrugstores?(vm.listStaff=$sessionStorage.listStaff,vm.listDrugstores=$sessionStorage.listDrugstores):setStaffForDrugstores(userId));var currentPage=1;setCampaigns(currentPage,userId),campaignsDataservice.getOptimizedCampaignDataset(vm.campaignId,userId).then(function(res){campaignsDataservice.getCampaignFiltered(vm.campaignId,userId,!0).then(function(campaignResource){var campaign,campaigns_selling,drugstores_first_step,drugstores_last_step,service_control_statuses,dynamic_steps;campaign=campaignResource.resource,campaigns_selling=campaignResource.campaigns_selling,drugstores_first_step=campaignResource.drugstores_first_step,drugstores_last_step=campaignResource.drugstores_last_step,service_control_statuses=campaignResource.service_control_statuses,dynamic_steps=campaignResource.dynamic_steps,angular.isArray(campaign.drugstores)||(campaign.drugstores=Object.keys(campaign.drugstores).map(function(key){return campaign.drugstores[key]})),vm.searchArrFields=["identifier","name","drugstores_network.name","addressLine1","cityName"],vm.activeColor=[],vm.activeColor[vm.campaignId]="",vm.activeCampaign=campaign,vm.activeCampaign.steps=stepsService.getSteps(vm.activeCampaign.definition),vm.activeColor[vm.activeCampaign.id]="orange",vm.not_paid_campaign=vm.activeCampaign.not_paid_campaign,hideDimmer(),stepsService.loadStepsStatuses(vm.campaignId,!0).then(function(){vm.activeCampaign.netWorkDrugstores.groupBy(function(o){return o.drugstores_network_id}).forEach(function(el,index){var networkId=el.key,networkDrugstores=order(el.group,"negotiation_point");setDrugstoreSteps({networkId:networkId,networkDrugstores:networkDrugstores,drugstores_first_step:drugstores_first_step,drugstores_last_step:drugstores_last_step,campaigns_selling:campaigns_selling,service_control_statuses:service_control_statuses,dynamic_steps:dynamic_steps})}),vm.pagingLimit=isPaging&&PAGING.ITEMS_ON_PAGE<vm.drugstores.length?PAGING.ITEMS_ON_PAGE:vm.drugstores.length,$rootScope.$emit("receivedMainRequest",!0),vm.setColorStepCounter(),vm.setStepColorInfo()},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})})},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function setDrugstoreSteps(props){var stepStatuses=null,statuses="{}",campaignProgress=null;props.networkDrugstores.forEach(function(drugstore){var item,job_duties,isFirstStepStart=props.drugstores_first_step.indexOf(drugstore.id)>-1,isLastStepStart=props.drugstores_last_step.indexOf(drugstore.id)>-1,userDrugstore=vm.activeCampaign.drugstores.find(function(d){return drugstore.id==d.id}),in_filter=!0,arrRights=[],drugstoreNetworkNpRights=[];if(vm.rightsName&&userDrugstore){for(var d in vm.activeCampaign.drugstores)vm.activeCampaign.drugstores.hasOwnProperty(d)&&(item=vm.activeCampaign.drugstores[d],item.negotiation_point===!0&&item.drugstores_network_id>0&&(job_duties=item.job_duties.split(","),job_duties.indexOf("[4]")==-1&&job_duties.indexOf("[5]")==-1||(drugstoreNetworkNpRights[item.drugstores_network_id]=item.id)));arrRights=userDrugstore.job_duties.split(","),"my"==vm.rightsName?in_filter=vm.isManager?arrRights.indexOf("[2]")!=-1:arrRights.indexOf("[4]")!=-1||arrRights.indexOf("[5]")!=-1:"observed"===vm.rightsName?in_filter=arrRights.indexOf("[3]")!=-1&&drugstore.negotiation_point===!1&&drugstore.selling_point===!0&&drugstore.drugstores_network_id>0:"colleague"===vm.rightsName&&(in_filter=vm.isManager?arrRights.indexOf("[2]")!=-1&&drugstore.negotiation_point===!1&&drugstore.selling_point===!0&&drugstore.drugstores_network_id>0:(arrRights.indexOf("[4]")!=-1||arrRights.indexOf("[5]")!=-1)&&drugstore.negotiation_point===!1&&drugstore.selling_point===!0&&drugstore.drugstores_network_id>0&&!drugstoreNetworkNpRights[drugstore.drugstores_network_id])}props.networkId&&(stepStatuses=stepsService.getStepsStatuses(drugstore.id,vm.campaignId),"{}"!=stepStatuses&&(statuses=stepStatuses),"{}"!=statuses&&stepsService.setStepsStatuses(drugstore.id,vm.campaignId,statuses)),in_filter&&userDrugstore&&(userDrugstore.isBlocked=!1,userDrugstore.addressLine1=userDrugstore.address?userDrugstore.address.address_line_1:"",userDrugstore.zip=userDrugstore.address?userDrugstore.address.zip:"",userDrugstore.cityName=userDrugstore.address&&userDrugstore.address.city&&userDrugstore.address.city.name?userDrugstore.address.city.name:"",(props.networkId&&userDrugstore.negotiation_point||!props.networkId)&&(campaignProgress=stepsService.getDrugstoresStepsStatuses(userDrugstore.id,vm.campaignId)),userDrugstore.isBlocked=stepsService.checkDrugstoreBlockProperty(userDrugstore.id,vm.campaignId,userDrugstore.metadata,props.campaigns_selling),userDrugstore.steps=stepsService.getDrugstoreSteps({drugstoreId:userDrugstore.id,campaignId:vm.campaignId,has_network:userDrugstore.drugstores_network_id,negotiation_point:userDrugstore.negotiation_point,selling_point:userDrugstore.selling_point,is_blocked:userDrugstore.isBlocked,is_first_step_start:isFirstStepStart,is_last_step_start:isLastStepStart,service_control_statuses:vm.not_paid_campaign?props.service_control_statuses:undefined,dynamic_steps:vm.not_paid_campaign?props.dynamic_steps:undefined}),userDrugstore.campaignDateEnd=campaignProgress&&campaignProgress.progress_info&&campaignProgress.progress_info.cycle_end?calcTime(campaignProgress.progress_info.cycle_end,!0):calcTime(vm.activeCampaign.date_end,!0),vm.drugstores.push(userDrugstore))})}function getCopyDrugstores(){return angular.copy(vm.drugstores)}function order(arr,predicate){var orderBy=$filter("orderBy");return orderBy(arr,predicate,!0)}function setStaffForDrugstores(userId){campaignsDataservice.getStaffJobsByDrugstores(userId).then(function(staffDrugstores){staffDrugstores.staff&&(vm.listStaff=staffDrugstores.staff,$sessionStorage.listStaff=vm.listStaff),staffDrugstores.drugstores&&(vm.listDrugstores=staffDrugstores.drugstores,$sessionStorage.listDrugstores=vm.listDrugstores)})}function setCampaigns(currentPage,userId){$sessionStorage.selectedCampaigns?(vm.campaigns=$sessionStorage.selectedCampaigns,vm.indexCampaign=vm.campaigns.findIndex(function(campaign){return campaign.id==vm.campaignId})):getCampaigns(currentPage,userId).then(function(campaigns){vm.campaigns=campaigns.filter(function(campaign,index){return campaign.id==vm.campaignId&&(vm.indexCampaign=index),campaign.icon=stepsService.getCampaignIcon(campaign.definition),!campaign.archived})},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function getCampaigns(currentPage,userDataId){return vm.isManager?campaignsDataservice.getCampaignsWithDrugstoresQuicklyFilteredByStaffAndPromoline(currentPage,userDataId):campaignsDataservice.getCampaignsQuicklyFilteredByStaffAndPromoline(currentPage,userDataId)}var vm=this;vm.selectDrugstore=function(drugstoreId){$state.go("clients.card",{id:drugstoreId})},vm.selectDrugstoreStep=function(drugstoreId,stepIdentifier,stepDisabled,$event){var drugstore,stepIndex=null;return $event.stopPropagation(),!stepDisabled&&(drugstore=vm.drugstores.find(function(drugstore){return drugstore.id==drugstoreId}),$sessionStorage.drugstoreSteps=null,drugstore&&($sessionStorage.drugstoreSteps=drugstore.steps),stepIndex=vm.not_paid_campaign?drugstore.steps.findIndex(function(step){return step.identifier==stepIdentifier}):vm.activeCampaign.steps.findIndex(function(step){return step.identifier==stepIdentifier}),void $state.go("campaigns.steps.pages",{campaignId:vm.activeCampaign.id,drugstoreId:drugstoreId,stepIndex:stepIndex?stepIndex+1:1,pageIndex:1}))},vm.filterByCampaign=function(campaignId){vm.activeColor[campaignId]?vm.clearFilter():$state.go("clients.filter",{id:campaignId})},vm.filterByRights=function(rightsName){vm.activeColorRights.visit&&"my"==rightsName||vm.activeColorRights.management&&"observed"==rightsName||vm.activeColorRights.colleague&&"colleague"==rightsName?$state.go("clients.filter",{id:vm.campaignId}):$state.go("clients.filter_rights",{id:vm.campaignId,rights:rightsName})},vm.clearFilter=function(){$state.go("clients.list")},vm.changeSorting=function(column){var condition,sort=vm.sort;sort["class"]="",condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition?(sort.descending=!sort.descending,sort["class"]=sort.descending?"descending":"ascending"):(sort.column=column,sort.descending=!1,sort["class"]="")},vm.sortingClass=function(column){var condition,sort=vm.sort;return sort["class"]="",condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition&&(sort["class"]=sort.descending?"descending":"ascending"),sort["class"]},vm.changeStaff=function(){var drugstores=[];vm.drugstoresCopy||(vm.drugstoresCopy=getCopyDrugstores()),drugstores="0"!=vm.selectedStaff?vm.drugstoresCopy.filter(function(drugstore){return vm.listStaff[vm.selectedStaff].drugstoresIds.indexOf(drugstore.id)>-1}):vm.drugstoresCopy,vm.drugstores=drugstores},vm.loadMore=function(){vm.pagingLimit+=PAGING.ITEMS_INCREMENT,vm.drugstores&&vm.pagingLimit>vm.drugstores.length&&(vm.pagingLimit=vm.drugstores.length);
},vm.selectColor=function(stepName,color){return vm.not_paid_campaign?stepsService.selectOnlyColor(color,function(){vm.selectedColor=color}):stepsService.selectStepColor(stepName,color,function(){vm.selectedColor=color,vm.selectedStep=stepName})},vm.setClassButton=function(stepName){var res="";return vm.selectedStep&&vm.selectedColor&&stepName==vm.selectedStep&&(res=vm.selectedColor),res},vm.isJobDutiesSignatureVisit=function(staff){return clientsDataservice.isJobDutiesSignatureVisit(staff)},vm.setStepIdentifier=function(identifier){vm.selectedStep==identifier?vm.selectColor("",""):vm.selectColor(identifier,"white")},vm.setColorStepCounter=function(){vm.colorStepCounter=stepsService.setColorStepCounter(vm.activeCampaign.drugstores)},vm.setStepColorInfo=function(){vm.stepColorInfo=stepsService.setStepColorInfo(vm.activeCampaign.drugstores)},vm.hasWarningSign=function(drugstore){return clientsDataservice.hasWarningSign(drugstore)},activate()}angular.module("app.clients").controller("ClientsFilterController",ClientsFilterController),ClientsFilterController.$inject=["$rootScope","$state","$filter","campaignsDataservice","clientsDataservice","$sessionStorage","stepsService","notifier","TEXT_MESSAGE","PAGING"]}(),function(){"use strict";function ClientsListController($rootScope,$scope,$state,campaignsDataservice,clientsDataservice,stepsService,$sessionStorage,notifier,TEXT_MESSAGE,PAGING){function activate(){$rootScope.breadcrumbTitle="Klienci",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="";var userId=null,isPaging=PAGING.APPLY;showDimmer(),$rootScope.subtitle="List page",vm.listSlider={width:0,height:0},vm.rightsName=$state.params.hasOwnProperty("rights")?$state.params.rights:"",vm.pagingLimit=PAGING.ITEMS_ON_PAGE,vm.campaigns=[],vm.sort={column:["drugstores_network_name","drugstores_network_id","-negotiation_point"],descending:!1,"class":"ascending"},vm.colorRights={visit:"my"==vm.rightsName?"marine":"",management:"observed"==vm.rightsName?"marine":"",colleague:"colleague"==vm.rightsName?"marine":""},vm.sortingCampaign={},vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.isManager=$sessionStorage.isManager||!1,vm.userData&&(userId=vm.userData.id),vm.selectedStaff=null,campaignsDataservice.getDrugstoresWithCampaignsByStaff(userId).then(function(resource){var drugstores=resource.drugstores;if(vm.campaigns=resource.campaigns.filter(function(campaign){return!campaign.archived}),vm.campaigns.forEach(function(campaign){campaign.hasWarningStep=!1,campaign.steps=stepsService.getSteps(campaign.definition),campaign.steps.forEach(function(step){step.isWarningStep&&(campaign.hasWarningStep=!0)})}),vm.states=resource.states,vm.rightsName){var drugstoreNetworkNpRights=[];for(var d in drugstores){var item=drugstores[d];if(item.negotiation_point===!0&&item.drugstores_network_id>0){var job_duties=item.job_duties.split(",");job_duties.indexOf("[4]")==-1&&job_duties.indexOf("[5]")==-1||(drugstoreNetworkNpRights[item.drugstores_network_id]=item.id)}}vm.drugstores=drugstores.filter(function(drugstore){var arrRights=drugstore.job_duties.split(","),in_filter=!1;return"my"==vm.rightsName?in_filter=vm.isManager?arrRights.indexOf("[2]")!=-1:arrRights.indexOf("[4]")!=-1||arrRights.indexOf("[5]")!=-1:"observed"===vm.rightsName?in_filter=arrRights.indexOf("[3]")!=-1&&drugstore.negotiation_point===!1&&drugstore.selling_point===!0&&drugstore.drugstores_network_id>0:"colleague"===vm.rightsName&&(in_filter=vm.isManager?arrRights.indexOf("[2]")!=-1&&drugstore.negotiation_point===!1&&drugstore.selling_point===!0&&drugstore.drugstores_network_id>0:(arrRights.indexOf("[4]")!=-1||arrRights.indexOf("[5]")!=-1)&&drugstore.negotiation_point===!1&&drugstore.selling_point===!0&&drugstore.drugstores_network_id>0&&!drugstoreNetworkNpRights[drugstore.drugstores_network_id]),in_filter})}else vm.drugstores=drugstores;hideDimmer(),vm.isManager&&(vm.listStaff={},vm.listDrugstores={},$sessionStorage.listStaff&&$sessionStorage.listDrugstores?(vm.listStaff=$sessionStorage.listStaff,vm.listDrugstores=$sessionStorage.listDrugstores,$rootScope.$emit("receivedMainRequest",!0)):setStaffForDrugstores(userId)),vm.searchArrFields=["identifier","name","drugstores_network_name","address.address_line_1","address.city_name"],vm.pagingLimit=isPaging&&PAGING.ITEMS_ON_PAGE<vm.drugstores.length?PAGING.ITEMS_ON_PAGE:vm.drugstores.length,sizeOf(sessionStorage)+sizeOf(angular.toJson(vm.selectedCampaigns))<=10240&&($sessionStorage.selectedCampaigns=vm.campaigns)},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function getCopyDrugstores(){return cloneObj(vm.drugstores)}function setStaffForDrugstores(userId){campaignsDataservice.getStaffJobsByDrugstores(userId).then(function(staffDrugstores){staffDrugstores.staff&&(vm.listStaff=staffDrugstores.staff,sizeOf(sessionStorage)+sizeOf(angular.toJson(vm.listStaff))<=10240&&($sessionStorage.listStaff=vm.listStaff)),staffDrugstores.drugstores&&(vm.listDrugstores=staffDrugstores.drugstores,sizeOf(sessionStorage)+sizeOf(angular.toJson(vm.listDrugstores))<=10240&&($sessionStorage.listDrugstores=vm.listDrugstores)),$rootScope.$emit("receivedMainRequest",!0)})}var vm=this;vm.selectDrugstore=function(drugstoreId){$state.go("clients.card",{id:drugstoreId})},vm.filterByCampaign=function(campaignId){$state.go("clients.filter",{id:campaignId})},vm.selectCampaign=function(campaignId){$state.go("campaigns.main",{id:campaignId})},vm.addDrugstore=function(){$state.go("clients.mainInfoCreate")},vm.changeSortingCampaigns=function(campaign){vm.sortingCampaign=campaign,vm.sort.column="",vm.sort.descending=!1,vm.sort["class"]=""},vm.changeSorting=function(column){var condition,sort=vm.sort;sort["class"]="",vm.sortingCampaign={},condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition?(sort.descending=!sort.descending,sort["class"]=sort.descending?"descending":"ascending"):(sort.column=column,sort.descending=!1,sort["class"]="")},vm.applyClass=function(drugstoreId,campaignId){var resClass="";return resClass=vm.states[drugstoreId]&&vm.states[drugstoreId][campaignId]?"campaign_state_"+vm.states[drugstoreId][campaignId]:"campaign_state_empty",vm.sortingCampaign.id==campaignId&&(resClass+=" orange"),resClass},vm.sortingClass=function(column){var condition,sort=vm.sort;return sort["class"]="",condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition&&(sort["class"]=sort.descending?"descending":"ascending"),sort["class"]},vm.changeStaff=function(){var drugstores=[];vm.drugstoresCopy||(vm.drugstoresCopy=getCopyDrugstores()),drugstores=vm.selectedStaff?vm.drugstoresCopy.filter(function(drugstore){return vm.listStaff[vm.selectedStaff].drugstoresIds.indexOf(drugstore.id)>-1}):vm.drugstoresCopy,vm.drugstores=drugstores},vm.loadMore=function(){vm.pagingLimit+=PAGING.ITEMS_INCREMENT,vm.drugstores&&vm.pagingLimit>vm.drugstores.length&&(vm.pagingLimit=vm.drugstores.length)},vm.filterByRights=function(rightsName){vm.colorRights.visit&&"my"==rightsName||vm.colorRights.management&&"observed"==rightsName||vm.colorRights.colleague&&"colleague"==rightsName?$state.go("clients.list",{id:vm.campaignId}):$state.go("clients.list_rights",{id:vm.campaignId,rights:rightsName})},vm.isJobDutiesSignatureVisit=function(staff){return clientsDataservice.isJobDutiesSignatureVisit(staff)},vm.hasWarningSign=function(drugstore){return clientsDataservice.hasWarningSign(drugstore)},activate()}angular.module("app.clients").controller("ClientsListController",ClientsListController).filter("sortingCampaigns",[function(){return function(drugstores,campaign){if(drugstores){if(!Object.keys(campaign).length)return drugstores;var tempDrugstores=[],tempNotFind=[];return angular.forEach(drugstores,function(drugstore){var findNeed=getObjectByKey(drugstore.campaigns,"id",campaign.id);findNeed.length?tempDrugstores.push(drugstore):tempNotFind.push(drugstore)}),tempDrugstores=tempDrugstores.concat(tempNotFind)}}}]).filter("selectedJobDuties",[function(){return function(objStaff,userData){if(objStaff){var tempStaff={};return angular.forEach(objStaff,function(value,key){(value.job_duties.indexOf("[4]")>-1||value.job_duties.indexOf("[5]")>-1||userData.id==key)&&(tempStaff[key]=value)}),tempStaff}return!1}}]).filter("filterDrugstoreCampaigns",[function(){return function(campaigns,campaign_ids){if(campaign_ids){var tempCampaigns=[];return tempCampaigns=campaigns.filter(function(campaign){return campaign_ids.indexOf(campaign.id.toString())!=-1})}return!1}}]),ClientsListController.$inject=["$rootScope","$scope","$state","campaignsDataservice","clientsDataservice","stepsService","$sessionStorage","notifier","TEXT_MESSAGE","PAGING"]}(),function(){"use strict";function ClientsMainInfoController($scope,$state,$sessionStorage,clientsDataservice,campaignsDataservice,SIGNED_CONTRACTS_PATH,notifier,TEXT_MESSAGE){function activate(){var userId=null;showDimmer(),vm.drugstoreId=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.userData&&(userId=vm.userData.id),campaignsDataservice.getSelectedDrugstore(vm.drugstoreId).then(function(drugstore){vm.isVisit=getRights(drugstore.job_duties).visit,campaignsDataservice.getStaffJobTitles().then(function(staffJobTitles){vm.staffJobTitles={},staffJobTitles.forEach(function(jobTitle){vm.staffJobTitles[jobTitle.id]=jobTitle.title}),vm.isExistsNotRegistered=!1,drugstore.drugstores_staff.forEach(function(person,index){person.is_drugstore===!0&&person.registered_at_portal===!1&&person.email==drugstore.email&&(vm.isExistsNotRegistered=!0),person.jobTitleName=vm.staffJobTitles[person.job_title_id]}),vm.drugstore=drugstore,vm.netWorkIcon=getNetWorkIcon(),vm.drugstore.signed_conract_uploaded=!_.isEmpty(drugstore.signed_contract),vm.netDrugstores=drugstore.network_drugstores,vm.portalRegistered=vm.drugstore.parent_drugstore?vm.drugstore.parent_drugstore.registered_at_portal:vm.drugstore.registered_at_portal,vm.netDrugstores.length||vm.netDrugstores.push({id:vm.drugstoreId,identifier:vm.drugstore.identifier,NIP:vm.drugstore.NIP,name:vm.drugstore.name,address:vm.drugstore.address}),hideDimmer()},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)}),$sessionStorage.listDrugstores&&$sessionStorage.listDrugstores[vm.drugstoreId]&&$sessionStorage.listDrugstores[vm.drugstoreId].staff?(vm.staffForDrugstore=$sessionStorage.listDrugstores[vm.drugstoreId].staff,$sessionStorage.listStaff&&setInfoForStaff($sessionStorage.listStaff)):(vm.userData&&(userId=vm.userData.id),setStaffForDrugstore(userId))}function setStaffForDrugstore(userId){campaignsDataservice.getStaffJobsByDrugstores(userId,!0).then(function(staffDrugstores){staffDrugstores.drugstores&&staffDrugstores.drugstores[vm.drugstoreId]&&staffDrugstores.drugstores[vm.drugstoreId].staff&&(vm.staffForDrugstore=staffDrugstores.drugstores[vm.drugstoreId].staff,setInfoForStaff(staffDrugstores.staff),$sessionStorage.listDrugstores=staffDrugstores.drugstores,$sessionStorage.listStaff=staffDrugstores.staff)})}function setInfoForStaff(staffDrugstores){angular.forEach(vm.staffForDrugstore,function(el){el.iSManager=el.job_duties.indexOf("[2]")>-1,el.job=staffDrugstores[el.staff_id].job,el.staff_info=staffDrugstores[el.staff_id].staff_info})}function getNetWorkIcon(){var isGlobal=vm.drugstore.drugstores_network&&"central"==vm.drugstore.drugstores_network.type,nameIcon="drugstore_";return vm.drugstore.drugstores_network_id?(nameIcon+="network_",nameIcon+=isGlobal?"global_":"local_",vm.drugstore.negotiation_point?nameIcon+=vm.drugstore.selling_point?"negotiation_selling_point":"negotiation_point":vm.drugstore.selling_point&&(nameIcon+="selling_point")):nameIcon+="individual",nameIcon+".png"}var vm=this;vm.editMainInfo=function(drugstoreId){vm.isVisit&&$state.go("clients.mainInfoEdit",{id:drugstoreId})},vm.selectDrugstore=function(drugstoreId){$state.go("clients.card",{id:drugstoreId})},vm.showConfirmFrameContractSigningModalWindow=function(){$scope.showConfirmFrameContractSigningModal=!0},vm.hideConfirmFrameContractSigningModalWindow=function(){$scope.showConfirmFrameContractSigningModal=!1},vm.signFrameContract=function(){clientsDataservice.signFrameContract(vm.drugstoreId).then(function(){vm.drugstore.frame_conract_signed=!0})},vm.showFrameContractPrintWindow=function(){clientsDataservice.getFrameContractPrint(vm.drugstore.frame_contract_id,vm.drugstore.id).then(function(res){$("#print-frame-contract-content").empty().append(res.template),$scope.showFrameContractPrintModal=!0})},vm.hideFrameContractPrintWindow=function(){$scope.showFrameContractPrintModal=!1},vm.printFrameContract=function(){var printWindow=window.open("","my div","height=400,width=600");return printWindow.document.write("<html><head><title>my div</title>"),printWindow.document.write("</head><body >"),printWindow.document.write($("#print-frame-contract-content").html()),printWindow.document.write("</body></html>"),printWindow.document.close(),printWindow.focus(),printWindow.print(),printWindow.close(),!0},vm.showOrUploadScannedContract=function(){vm.drugstore.signed_conract_uploaded?vm.showViewSignedContractModal():vm.showUploadSignedContractModal()},vm.showUploadSignedContractModal=function(){$scope.showUploadSignedContractModal=!0},vm.uploadScannedContract=function(){vm.isScannedContractFileReadyToUpload&&clientsDataservice.uploadScannedContract(vm.drugstore,vm.scannedContractFileToUpload).then(function(res){$scope.showUploadSignedContractModal=!1})},vm.selectScannedContractFile=function(){$("#scanned-contract-file").click()},$scope.onSelectScannedContractFile=function($element){var allowedFiletypes=["image/jpeg","image/png","image/gif","image/tiff","application/pdf"];$scope.$apply(function(){"files"in $element&&$element.files.length>0&&(vm.scannedContractFileToUpload=$element.files[0],allowedFiletypes.indexOf(vm.scannedContractFileToUpload.type)>-1?(vm.scannedContractFilename=vm.scannedContractFileToUpload.name,vm.isScannedContractFileReadyToUpload=!0):(vm.scannedContractFilename="",vm.isScannedContractFileReadyToUpload=!1))})},vm.hideUploadSignedContractModal=function(){$scope.showUploadSignedContractModal=!1},vm.isStaff=function(staff){return!staff.is_drugstore},vm.showViewSignedContractModal=function(){$scope.showViewSignedContractModal=!0},vm.getSignedContractScanPath=function(){if(!_.isEmpty(vm.drugstore)&&!_.isEmpty(vm.drugstore.signed_contract))return SIGNED_CONTRACTS_PATH+vm.drugstore.signed_contract.filename},vm.hideUploadSignedContractModal=function(){$scope.showViewSignedContractModal=!1},vm.showStaffList=function(){angular.element("#staffForDrugstore").modal("show")},vm.showDrugstoresList=function(){angular.element("#networkDrugstoresList").modal("show")},activate()}angular.module("app.clients").controller("ClientsMainInfoController",ClientsMainInfoController),ClientsMainInfoController.$inject=["$scope","$state","$sessionStorage","clientsDataservice","campaignsDataservice","SIGNED_CONTRACTS_PATH","notifier","TEXT_MESSAGE"]}(),function(){"use strict";function ClientsMainInfoCreateController($state,clientsDataservice,logger,principal){function activate(){}var vm=this;activate(),vm.showEditPersonModal=function(person){person?(vm.personId=person.id,vm.personFirstName=person.first_name,vm.personLastName=person.last_name):vm.personId=null,$("#editPersonModal").modal("show")},vm.showRemovePersonModal=function(person){person&&(vm.personId=person.id),$("#removePersonModal").modal("show")},vm.saveDrugstore=function(){clientsDataservice.saveDrugstore(vm.drugstore)},vm.savePerson=function(){var person={id:vm.personId,first_name:vm.personFirstName,last_name:vm.personLastName,drugstore_id:vm.drugstoreId,email:"a@b2",job_title_id:1,profession_number:1};clientsDataservice.savePerson(person).then(function(data){person.id?vm.drugstore.drugstores_staff.forEach(function(staff,index){staff.id==vm.personId&&(vm.drugstore.drugstores_staff[index]=person)}):(person.id=data.last_insert_id,vm.drugstore.drugstores_staff.push(person))})},vm.removePerson=function(){clientsDataservice.removePerson(vm.personId).then(function(data){vm.drugstore.drugstores_staff=vm.drugstore.drugstores_staff.filter(function(staff){return staff.id!=vm.personId})})},vm.cancelDrugstoreSave=function(){$state.go("clients.list")}}angular.module("app.clients").controller("ClientsMainInfoCreateController",ClientsMainInfoCreateController),ClientsMainInfoCreateController.$inject=["$state","clientsDataservice","logger","principal"]}(),function(undefined){"use strict";function ClientsMainInfoEditController($rootScope,$scope,$state,$sessionStorage,clientsDataservice,campaignsDataservice,notifier,$localStorage,TEXT_MESSAGE){function activate(){var userId=null;showDimmer(),vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.userData&&(userId=vm.userData.id),vm.drugstoreId=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,campaignsDataservice.getSelectedDrugstore(vm.drugstoreId).then(function(drugstore){campaignsDataservice.getStaffJobTitles().then(function(staffJobTitles){vm.staffJobTitles=staffJobTitles,vm.jobTitles={},vm.drugstore=drugstore,vm.oldEmail=angular.copy(vm.drugstore.email),vm.netWorkIcon=getNetWorkIcon(),vm.netDrugstores=drugstore.network_drugstores,vm.registeredAtPortal=vm.isRegisteredAtPortal(),vm.existsUnRegister=vm.isUnRegisterButtonVisible(),vm.staffJobTitles.forEach(function(jobTitle){vm.jobTitles[jobTitle.id]=jobTitle.title}),vm.portalRegistered=vm.drugstore.parent_drugstore?vm.drugstore.parent_drugstore.registered_at_portal:vm.drugstore.registered_at_portal,vm.netDrugstores.length||vm.netDrugstores.push({id:vm.drugstoreId,identifier:vm.drugstore.identifier,NIP:vm.drugstore.NIP,name:vm.drugstore.name,address:vm.drugstore.address}),setJobTitle(),hideDimmer()},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)}),$sessionStorage.listDrugstores&&$sessionStorage.listDrugstores[vm.drugstoreId]&&$sessionStorage.listDrugstores[vm.drugstoreId].staff?(vm.staffForDrugstore=$sessionStorage.listDrugstores[vm.drugstoreId].staff,$sessionStorage.listStaff&&setInfoForStaff($sessionStorage.listStaff)):(vm.userData&&(userId=vm.userData.id),setStaffForDrugstore(userId))}function getNetWorkIcon(){var isGlobal=vm.drugstore.drugstores_network&&"central"==vm.drugstore.drugstores_network.type,nameIcon="drugstore_";return vm.drugstore.drugstores_network_id?(nameIcon+="network_",nameIcon+=isGlobal?"global_":"local_",vm.drugstore.negotiation_point?nameIcon+=vm.drugstore.selling_point?"negotiation_selling_point":"negotiation_point":vm.drugstore.selling_point&&(nameIcon+="selling_point")):nameIcon+="individual",nameIcon+".png"}function setStaffForDrugstore(userId){campaignsDataservice.getStaffJobsByDrugstores(userId,!0).then(function(staffDrugstores){staffDrugstores.drugstores&&staffDrugstores.drugstores[vm.drugstoreId]&&staffDrugstores.drugstores[vm.drugstoreId].staff&&(vm.staffForDrugstore=staffDrugstores.drugstores[vm.drugstoreId].staff,setInfoForStaff(staffDrugstores.staff),$sessionStorage.listDrugstores=staffDrugstores.drugstores,$sessionStorage.listStaff=staffDrugstores.staff)})}function setInfoForStaff(staffDrugstores){angular.forEach(vm.staffForDrugstore,function(el){el.iSManager=el.job_duties.indexOf("[2]")>-1,el.job=staffDrugstores[el.staff_id].job,el.staff_info=staffDrugstores[el.staff_id].staff_info})}function setJobTitle(){vm.drugstore.drugstores_staff.forEach(function(person,index){vm.drugstore.drugstores_staff[index].jobTitleName=vm.jobTitles[person.job_title_id]})}var vm=this;vm.editDrugstore=!0,vm.changedFields=[],vm.selectedDrugstoreStaff=undefined,vm.registeredAtPortal=!1,vm.prettify=function(date){var locale=$localStorage.preferredLanguage||"en",obj=new Date(date),m=moment(obj).locale(locale);return m.format("ll")},vm.selectDrugstore=function(drugstoreId){$state.go("clients.card",{id:drugstoreId})},vm.showEditPersonModal=function(person){var country=vm.drugstore.address.country&&vm.drugstore.address.country.id?vm.drugstore.address.country.id:1,region=vm.drugstore.address.region&&vm.drugstore.address.region.id?vm.drugstore.address.region.id:1,city=vm.drugstore.address.city&&vm.drugstore.address.city.id?vm.drugstore.address.city.id:1;vm.personId=null,vm.personTemp={},person&&(vm.personId=person.id,vm.personTemp=person),vm.personTemp.address||(vm.personTemp.address={country:country,region:region,city:city,city_id:city,address_line_1:"",address_line_2:"",phone:"",zip:""}),angular.element("#editPersonModal").modal("show")},vm.showRemovePersonModal=function(person){person&&(vm.personId=person.id),angular.element("#removePersonModal").modal("show")},vm.showContractAnnexWindow=function(){0!==vm.changedFields.length&&(vm.drugstore.contract_annex_id?clientsDataservice.getContractAnnexPrint(vm.drugstore.contract_annex_id,vm.drugstore.id).then(function(res){$("#print_preview").empty().append(res.template),$scope.showContractAnnexModalWindow=!0}):vm.onFormSubmit())},vm.hideContractAnnexWindow=function(){$scope.showContractAnnexModalWindow=!1},vm.storeContractAnnex=function(){var description="Signed Contract Annex on Main Info Changes\nDrugstore: "+vm.drugstore.name+" ("+vm.drugstore.nip+")\nChanged fields: "+vm.changedFields.join(", "),data={drugstore_id:vm.drugstore.id,name:"Annex "+vm.drugstore.name+" "+vm.prettify((new Date).getUTCDate()),description:description,changed_fields:vm.changedFields.join(",")};clientsDataservice.storeContractAnnex(data).then(function(res){vm.changedFields=[]},function(res){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(res.data.message)})},vm.refresh=function(){$state.go("clients.mainInfo",{id:vm.drugstoreId})},vm.isButtonVisible=function(){return(vm.isRegisterButtonVisible()||vm.isUnRegisterButtonVisible())&&(vm.drugstore.negotiation_point||!vm.drugstore.drugstores_network)},vm.isRegisterButtonVisible=function(){return!vm.findNotRegisteredPortalAccount()&&!vm.isRegisteredAtPortal()},vm.isUnRegisterButtonVisible=function(){return vm.findNotRegisteredPortalAccount()},vm.isEmailReadonly=function(){return vm.findNotRegisteredPortalAccount()?"readonly":undefined},vm.findNotRegisteredPortalAccount=function(){var drugstoresStaff;return drugstoresStaff=vm.drugstore.drugstores_staff.find(function(dss){return dss.is_drugstore===!0&&dss.registered_at_portal===!1&&dss.email==vm.drugstore.email})},vm.onChangeEmail=function(valid){valid&&vm.drugstore.email?clientsDataservice.checkPortalEmail(vm.drugstore.email).then(function(res){res&&(vm.existentAccount=res.plain().resource),vm.onChangeField("email")}):vm.onChangeField("email")},vm.onFormSubmit=function(){clientsDataservice.checkPortalEmail(vm.drugstore.email).then(function(res){return res&&(vm.existentAccount=res.plain().resource),vm.existentAccount&&vm.existentAccount.drugstore&&!vm.existentAccount.drugstore.registered_at_portal?void angular.element("#email_used_in_unregistered_drugstore_modal").modal("show"):(vm.changeAccountEmail=!1,void(vm.drugstore.parent_drugstore||vm.drugstore.registered_at_portal||!vm.existentAccount?vm.drugstore.registered_at_portal&&vm.changedFields.indexOf("email")>-1?(vm.changeAccountEmail=!0,angular.element("#confirm_email_change_modal_main").modal("show")):vm.drugstore.parent_drugstore&&!vm.drugstore.registered_at_portal&&vm.changedFields.indexOf("email")>-1?(vm.drugstore.email=vm.oldEmail,angular.element("#confirm_email_change_modal").modal("show")):vm.saveDrugstore():angular.element("#confirm_attach_to_group_modal").modal("show")))})},vm.saveDrugstore=function(cb){vm.drugstore.contract_annex_id&&vm.storeContractAnnex();var drugstore;vm.drugstore.address&&"object"==typeof vm.drugstore.address.city&&vm.drugstore.address.city_id&&vm.drugstore.address.city.id!=vm.drugstore.address.city_id&&(vm.drugstore.address.city_id=vm.drugstore.address.city.id),vm.drugstore.address&&vm.drugstore.address.id&&clientsDataservice.saveAddress(vm.drugstore.address.id,vm.drugstore.address),drugstore=angular.copy(vm.drugstore),delete drugstore.address,delete drugstore.step_uid,delete drugstore.staffJobTitles,delete drugstore.jobTitles,delete drugstore.drugstores_staff,delete drugstore.drugstores_network,delete drugstore.category,delete drugstore.metadata,clientsDataservice.saveDrugstore(drugstore).then(function(data){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),vm.changedFields.indexOf("email")>-1&&(vm.changeAccountEmail||!drugstore.parent_drugstore&&drugstore.registered_at_portal)?clientsDataservice.changePortalEmail(drugstore).then(function(res){var oldEmail=res.plain().old_email;clientsDataservice.changePortalTenantEmail(drugstore.email,oldEmail).then(function(){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.LOGIN_FOR_PORTAL_CHANGE),vm.changedFields=[],cb?cb():vm.refresh()},function(res){notifier.warning("Ostrzeżenie",res.data.message)})},function(res){notifier.warning("Ostrzeżenie",res.data.message)}):(vm.changedFields=[],cb?cb():vm.refresh())},function(res){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.savePerson=function(){var person=vm.personTemp,address=vm.personTemp.address;person.id=vm.personId,person.drugstore_id=vm.drugstoreId,person.address.drugstore_id=person.drugstore_id,person.address&&person.address.id&&(clientsDataservice.saveAddress(person.address.id,person.address),address=person.address,address.city_id&&"object"!=typeof address.city&&(address.city_id=address.city),delete person.address),clientsDataservice.savePerson(person).then(function(data){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),person.id?(vm.personTemp.address=address,vm.drugstore.drugstores_staff.forEach(function(staff,index){staff.id==vm.personId&&(vm.drugstore.drugstores_staff[index]=person)})):(person.id=data.last_insert_id,vm.drugstore.drugstores_staff.push(person)),setJobTitle()},function(res){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.removePerson=function(){clientsDataservice.removePerson(vm.personId).then(function(data){vm.drugstore.drugstores_staff=vm.drugstore.drugstores_staff.filter(function(staff){return staff.id!=vm.personId})},function(res){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.cancelDrugstoreSave=function(){$state.go("clients.mainInfo",{id:vm.drugstoreId})},vm.onChangeField=function(field){vm.changedFields.indexOf(field)==-1&&vm.changedFields.push(field),"email"==field&&(vm.registeredAtPortal=!1)},vm.showRegisterAtPortalWindow=function(){clientsDataservice.checkPortalEmail(vm.drugstore.email).then(function(res){return res&&(vm.existentAccount=res.plain().resource),vm.onChangeField("email"),vm.existentAccount&&vm.existentAccount.drugstore&&!vm.existentAccount.drugstore.registered_at_portal?void angular.element("#email_used_in_unregistered_drugstore_modal").modal("show"):(vm.changeAccountEmail=!1,void(vm.drugstore.parent_drugstore||vm.drugstore.registered_at_portal||!vm.existentAccount?vm.drugstore.registered_at_portal&&vm.changedFields.indexOf("email")>-1?(vm.changeAccountEmail=!0,angular.element("#confirm_email_change_modal_main").modal("show")):vm.drugstore.parent_drugstore&&!vm.drugstore.registered_at_portal&&vm.changedFields.indexOf("email")>-1?(vm.drugstore.email=vm.oldEmail,angular.element("#confirm_email_change_modal").modal("show")):angular.element("#confirm_register_drugstore_at_portal_modal").modal("show"):angular.element("#confirm_attach_to_group_modal").modal("show")))})},vm.showUnregisterAtPortalWindow=function(){vm.drugstore.stored_docs?angular.element("#unable_to_unregister_drugstore_at_portal_warning_modal").modal("show"):angular.element("#confirm_unregister_drugstore_at_portal_modal").modal("show")},vm.getEmailColspan=function(){return vm.registeredAtPortal?2:undefined},vm.registerAtPortal=function(){function send(){var email;clientsDataservice.registerAtPortal(vm.drugstore).then(function(res){email=vm.drugstore.parent_drugstore?vm.drugstore.parent_drugstore.email:vm.drugstore.email,clientsDataservice.addDrugstoresStaff(vm.drugstore.email).then(function(){vm.lockRegisterAtPortal=!1,notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.REGISTER_LINK_SENT),vm.refresh()},function(res){vm.lockRegisterAtPortal=!1,notifier.warning("Ostrzeżenie",res.data.message)})},function(res){vm.lockRegisterAtPortal=!1,notifier.warning("Ostrzeżenie",res.data.message)})}vm.drugstore.parent_drugstore||vm.drugstore.registered_at_portal||(vm.changedFields.indexOf("email")>-1?vm.saveDrugstore(send):(vm.lockRegisterAtPortal=!0,send()))},vm.unregisterAtPortal=function(){clientsDataservice.unregisterAtPortal(vm.drugstore).then(function(res){clientsDataservice.removeDrugstoresStaff(vm.drugstore.email).then(function(){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.REGISTER_LINK_CANCELED),vm.refresh()},function(res){notifier.warning("Ostrzeżenie",res.data.message),vm.refresh()})})},vm.isStaff=function(staff){return!staff.is_drugstore},vm.isRegisteredAtPortal=function(){return!!vm.drugstore&&(vm.drugstore.parent_drugstore?vm.drugstore.parent_drugstore.registered_at_portal:vm.drugstore.registered_at_portal)},vm.showStaffList=function(){angular.element("#staffForDrugstore").modal("show")},vm.showDrugstoresList=function(){angular.element("#networkDrugstoresList").modal("show")},activate()}angular.module("app.clients").controller("ClientsMainInfoEditController",ClientsMainInfoEditController),ClientsMainInfoEditController.$inject=["$rootScope","$scope","$state","$sessionStorage","clientsDataservice","campaignsDataservice","notifier","$localStorage","TEXT_MESSAGE"]}(),function(){"use strict";function clientsDataservice($q,dataservice,$sessionStorage,FRAME_CONTRACTS_PRINT_PATH){function getDrugstores(){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("drugstores","list-by-staff")}function getSelectedDrugstore(drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("drugstores",drugstoreId).then(function(data){return data.resource})}function drugstoreImageUpload(drugstoreData){return dataservice.tenant.customOauth.post("image-upload",drugstoreData,"upload-drugstore-image")}function getEditDrugstore(drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.edit("drugstores",drugstoreId).then(function(data){return data})}function saveDrugstore(drugstore){return dataservice.tenant.update("drugstores",drugstore.id,drugstore)}function storeContractAnnex(data){return dataservice.tenant.store("signed-contracts-annexes",data)}function savePerson(person){return person.id?dataservice.tenant.update("drugstores-staff",person.id,person):dataservice.tenant.store("drugstores-staff",person)}function removePerson(personId){return dataservice.tenant.destroy("drugstores-staff",personId)}function getStaffJobTitles(){return dataservice.tenant.customOauth.get("staff-job-titles","list")}function getAddress(addressid){return dataservice.tenant.edit("addresses",addressid)}function saveAddress(address_id,address){dataservice.tenant.update("addresses",address_id,address)}function getProperties(){return dataservice.tenant.customOauth.get("drugstores-properties","list")}function getCampaigns(){return dataservice.tenant.index("campaigns",{page:1,query:{type:"campaign"}})}function getCampaignsFiltered(currentPage,uid){var filters={page:currentPage,query:{type:"campaign"},field:{filter:"staff",value:[uid]}};return dataservice.setOneCallConfig({cache:!1}).tenant.index("campaigns",filters).then(function(data){return data})}function getCampaignsPromolineFiltered(currentPage,staffUid){var filters={page:currentPage,query:{type:"campaign"},field:{filter:"promolines",value:[staffUid]}};return dataservice.setOneCallConfig({cache:!1}).tenant.index("campaigns",filters).then(function(data){
return data})}function getCampaignById(campaignid){return dataservice.tenant.edit("campaigns",campaignid).then(function(data){return data.resource})}function getDrugStoreCampaigns(drugstoreId){return dataservice.tenant.index("campaigns",{page:1}).then(function(campaigns){var drugstoreCampaigns=[];return campaigns.map(function(campaign){var campaignForDrugstore=campaign.drugstores.filter(function(d){return d.id==drugstoreId});campaignForDrugstore.length&&drugstoreCampaigns.push(campaign)}),drugstoreCampaigns})}function getCampaignsDataSelling(drugstoreId,mainDrugstoreId,dataSelling,campaignsDominant){var campaignsProgress={};return dataSelling.groupBy(function(o){return o.campaign_id}).forEach(function(el){var progress,groups,status,result,campaign_id=el.key,dominant=campaignsDominant[campaign_id]?campaignsDominant[campaign_id]:"neutral";groups=el.group.filter(function(g){return g.drugstore_id==(mainDrugstoreId?mainDrugstoreId:drugstoreId)}),status=groups.length?groups[0].campaign_status:"active",result=getDataSelling(groups),"sell_in"==dominant?progress=parseFloat(result.sellIn).toFixed(2):"sell_out"==dominant&&(progress=parseFloat(result.sellOut).toFixed(2)),campaignsProgress[campaign_id]={progress:progress,status:"completed"!=status?"active":"history"}}),campaignsProgress}function getCampaignsSelling(campaignsIds,drugstoreId,mainDrugstoreId){return campaignsIds=JSON.stringify(campaignsIds),dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-selling","search-by-campaigns",{campaigns:campaignsIds}).then(function(dataSelling){return getCampaignsDataSelling(drugstoreId,mainDrugstoreId,dataSelling)})}function getDataSelling(dataSelling){var progressCampaign={sellIn:0,sellOut:0},count=0;return dataSelling.forEach(function(el,index){var result=getDataDrugstoreProgress(el);count++,progressCampaign.sellIn+=parseFloat(result.sellIn),progressCampaign.sellOut+=parseFloat(result.sellOut),progressCampaign.drugstore_id=el.key}),count&&(progressCampaign.sellIn=parseFloat(progressCampaign.sellIn/count).toFixed(2),progressCampaign.sellOut=parseFloat(progressCampaign.sellOut/count).toFixed(2)),progressCampaign}function getDataDrugstoreProgress(elGroup){var progress,progressCampaign={sellIn:0,sellOut:0};try{progress=JSON.parse(elGroup.progress)}catch(e){}return progress&&(progress.sellInVisible&&(progressCampaign.sellIn=parseFloat(progress.sellIn)),progress.sellOutVisible&&(progressCampaign.sellOut=parseFloat(progress.sellOut))),progressCampaign}function signFrameContract(drugstoreId){return dataservice.tenant.customOauth.post("drugstores",{},"sign-frame-contract/"+drugstoreId).then(function(data){return data})}function getCompanyStaff(staffId){return dataservice.tenant.edit("staff",staffId)}function getFrameContractPrint(contractTemplateId,drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("frame-contracts",contractTemplateId+"/drugstore/"+drugstoreId+"/print")}function getCalendarByUserId(userid){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("calendars","search-by-user",{user_id:userid})}function saveEventCalendar(event){return event.id?dataservice.tenant.update("calendars",event.id,event):dataservice.tenant.store("calendars",event)}function removeEventCalendar(eventid){return dataservice.tenant.destroy("calendars",eventid)}function uploadScannedContract(drugstore,file){var deferred=$q.defer(),data=new FormData,signedContract={drugstore_id:drugstore.id,name:drugstore.name+" Frame Contract Scan",description:"Signed Contract Scanned Image\nDrugstore: "+drugstore.name};if(file){for(var idx in signedContract)signedContract.hasOwnProperty(idx)&&data.append(idx,signedContract[idx]);data.append("file",file),dataservice.tenant.customOauth.post("signed-contracts",data,"store",{},{"Content-Type":void 0}).then(function(res){deferred.resolve(res)})}else deferred.reject();return deferred.promise}function getContractAnnexPrint(contractTemplateId,drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("contracts-annexes",contractTemplateId+"/drugstore/"+drugstoreId+"/print")}function getStaffJobsByDrugstores(userId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("staff-drugstores","search-by-drugstores",{timeout:1e3,cache:!1}).then(function(staffJobs){var staff={},needDrugstores=[],staffDrugstores={};return userId&&staffJobs.staff[userId]&&(needDrugstores=staffJobs.staff[userId].drugstoresIds),staffJobs.drugstores&&staffJobs.staff&&(needDrugstores.length?needDrugstores.forEach(function(el){staffJobs.drugstores[el]&&(staffDrugstores[el]=staffJobs.drugstores[el])}):staffDrugstores=staffJobs.drugstores,angular.forEach(staffDrugstores,function(drugstore){drugstore.staff.forEach(function(person){staffJobs.staff[person.staff_id]&&(staff[person.staff_id]=staffJobs.staff[person.staff_id])})})),{staff:staff,drugstores:staffDrugstores}})}function registerAtPortal(drugstore){return dataservice.tenant.customOauth.post("drugstores-staff",{},"issue-registration-token/"+drugstore.id)}function unregisterAtPortal(drugstore){return dataservice.tenant.customOauth.post("drugstores-staff",{},"cancel-registration-token/"+drugstore.id)}function getConferences(){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("conferences")}function updateConference(data){return dataservice.tenant.update("conferences",data.id,data)}function addDrugstoresStaff(email){var currentTenant=JSON.parse($sessionStorage.currentTenant);return dataservice.customPost("tenants",{tenant_name:currentTenant.name,drugstores_staff_email:email},"add-drugstores-staff")}function removeDrugstoresStaff(email){var currentTenant=JSON.parse($sessionStorage.currentTenant);return dataservice.customPost("tenants",{tenant_name:currentTenant.name,drugstores_staff_email:email},"remove-drugstores-staff")}function changePortalEmail(drugstore){var data={email:drugstore.email};return dataservice.tenant.customOauth.post("drugstores-staff",data,"change-portal-email/"+drugstore.id)}function checkPortalEmail(email){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("drugstores-staff","check-email/"+email)}function changePortalTenantEmail(email,oldEmail){var currentTenant=JSON.parse($sessionStorage.currentTenant);return dataservice.customPost("tenants",{tenant_name:currentTenant.name,drugstores_staff_old_email:oldEmail,drugstores_staff_email:email},"change-drugstores-staff-login")}function isJobDutiesSignatureVisit(staff){var job_duties=staff.job_duties.split(",");return job_duties.indexOf("[4]")!=-1||job_duties.indexOf("[5]")!=-1}function isNegotiationPoint(drugstore){return drugstore.negotiation_point===!0}function hasWarningSign(drugstore){return!drugstore.frame_contract_sign_date||drugstore.frame_contract_sign_date.search(/^\d{2}\.\d{2}\.\d{4}$/)<0}return{getDrugstores:getDrugstores,getSelectedDrugstore:getSelectedDrugstore,drugstoreImageUpload:drugstoreImageUpload,getEditDrugstore:getEditDrugstore,saveDrugstore:saveDrugstore,storeContractAnnex:storeContractAnnex,savePerson:savePerson,removePerson:removePerson,getStaffJobTitles:getStaffJobTitles,getAddress:getAddress,saveAddress:saveAddress,getProperties:getProperties,getCampaigns:getCampaigns,getCampaignsFiltered:getCampaignsFiltered,getCampaignsPromolineFiltered:getCampaignsPromolineFiltered,getCampaignById:getCampaignById,getDrugStoreCampaigns:getDrugStoreCampaigns,getCampaignsDataSelling:getCampaignsDataSelling,getCampaignsSelling:getCampaignsSelling,signFrameContract:signFrameContract,getCompanyStaff:getCompanyStaff,getContractAnnexPrint:getContractAnnexPrint,getFrameContractPrint:getFrameContractPrint,getCalendarByUserId:getCalendarByUserId,saveEventCalendar:saveEventCalendar,removeEventCalendar:removeEventCalendar,uploadScannedContract:uploadScannedContract,getStaffJobsByDrugstores:getStaffJobsByDrugstores,registerAtPortal:registerAtPortal,unregisterAtPortal:unregisterAtPortal,getConferences:getConferences,updateConference:updateConference,changePortalEmail:changePortalEmail,changePortalTenantEmail:changePortalTenantEmail,checkPortalEmail:checkPortalEmail,addDrugstoresStaff:addDrugstoresStaff,removeDrugstoresStaff:removeDrugstoresStaff,isJobDutiesSignatureVisit:isJobDutiesSignatureVisit,isNegotiationPoint:isNegotiationPoint,hasWarningSign:hasWarningSign}}angular.module("app.clients").factory("clientsDataservice",clientsDataservice),clientsDataservice.$inject=["$q","dataservice","$sessionStorage","FRAME_CONTRACTS_PRINT_PATH"]}(),function(){"use strict";var core=angular.module("app.core"),server_path="https://demo.3mind-solutions.com/";core.constant("moment",moment).constant("VERSION_NUMBER","0.9.80").constant("ROOT_SERVER_URI",server_path+"portal/#/").constant("PORTAL_SERVER_URI","https://demo.3mind-solutions.com/bgx/#/").constant("SERVER_URI",server_path+"mobile-").constant("IMAGES_PATH",server_path+"assets/img/").constant("MESSAGE_FILE_PATH",server_path+"assets/img/messages/").constant("GIFT_IMAGES_PATH",server_path+"assets/img/gifts/").constant("PRESENTATIONS_PATH",server_path+"assets/presentations/").constant("FRAME_CONTRACTS_PRINT_PATH",server_path+"assets/documents/frame-contracts/print/").constant("AFTER_PRESENTATIONS_EXPORT_PATH",server_path+"assets/documents/after-presentations-export/").constant("SIGNED_CONTRACTS_PATH",server_path+"assets/documents/signed-contracts/").constant("MERCH_IMAGES_PATH",server_path+"assets/img/sample-images/").constant("APP_ENVIRONMENT","development").constant("CLIENT_NAME","mobile-client").constant("CURRENT_LANGUAGE","pl").constant("IDLE_TIMEOUT",72e5).constant("RECORDS_PER_PAGE",10).constant("LANGUAGES",[{code:"en",flag:"flag flag-us",alt:"United States",title:"English (US)"},{code:"ru",flag:"flag flag-ru",alt:"Russia",title:"Русский язык"},{code:"pl",flag:"flag flag-pl",alt:"Poland",title:"Polski"}]).constant("TEXT_MESSAGE",{ERROR:{SERVER_ERROR:"Serwer jest niedostępny, spróbuj ponownie później!",SEND_MESSAGE_ERROR:"Nie udało się wysłać wiadomość!",CANNOT_EXECUTE_ACTION:"Operacja nie może być wykonana, skontaktuj się z HelpDesk!",BUDGET_EXCEEDED:"Budżet zostanie przekroczony"},SUCCESS:{SUCCESS_SAVED:"Dane zostały zapisane!",REGISTER_LINK_SENT:"Link rejestracyjny wysłany",REGISTER_LINK_CANCELED:"Link rejestracyjny został skasowany",LOGIN_FOR_PORTAL_CHANGE:"Login do portalu został zmieniony!",SUCCESS_EVENT_SAVED:"Wydarzenie zapisane!",SUCCESS_PROGRESS_SAVED:"Dane dla Postępu kampanii zostały zapisane!",SUCCESS_GET_OFFLINE:"Dane dla trybu offline jest z powodzeniem uzyskuje!",SUCCESS_HELP_CYCLE:"Koło ratunkowe zostało użyte. Próg wejścia został obniżony. Możesz przystąpić do dalszych negocjacji",SUCCESS_GET_DATA:"Dane uzyskano pomyślnie"},WARNING:{OFFLINE_SAVED:"Dane zostały zapisane w lokalnym buforze! Po ponownym podłączeniu do sieci, dane należy przesłać na serwer.",NOT_ENOUGH_PHOTOS:"Sprawdź czy dołączyłeś wszystkie wymagane zdjęcia!",NOT_ENOUGH_POTENTIAL:"Potencjał jest zbyt niski, by użyć koła ratunkowego. Jeśli chcesz obniżyć próg wejścia w kampanię wyślij mail z indywidualną prośbą",NOT_RKS:"Apteka nie ma RKS",CYCLE_NUMBER_CHANGED:"Zmieniono cykl, naciśnij przelicz",NOT_REQUIRED_PHOTO:"Brak zdjęć. Nie można zapisać!",NEED_RECALCULATE_LAST_SELLING:"Liczba aptek w sieci uległa zmianie. Pierwszy przelicz rotację!"}}).constant("ATLAS_MODULES",{DETAILING:!0,GAZETKI:!0,COACHING:!0,DICTIONARY:!0}).constant("STEP_IN_DATES",!1).constant("STEP_IS_FINISHING_IN_DAYS",7).constant("STEP_ADD_MONTH_TO_END_CYCLE",6).constant("OFFLINE_MODE",!0).constant("PAGING",{APPLY:!0,ITEMS_ON_PAGE:30,ITEMS_INCREMENT:30})}(),function(undefined){"use strict";function ApiV2Dataservice($q,$timeout,$cacheFactory,$state,Restangular,$sessionStorage,SERVER_URI,VERSION_NUMBER,logger){function isTokenExpired(accessToken){var now=Date.now()/1e3|0;return now-accessToken.expires_in>accessToken.tokenIssuedAt}function setDefaultHeaders(){var deferred=$q.defer(),accessToken=JSON.parse($sessionStorage.accessToken);return accessToken&&!isTokenExpired(accessToken)?(Restangular.setDefaultHeaders({Authorization:"Bearer "+accessToken.access_token,"X-Application-Version":VERSION_NUMBER}),deferred.resolve(accessToken)):accessToken&&isTokenExpired(accessToken)?doNotUpdateTokenNow?deferred.resolve({}):(doNotUpdateTokenNow=!0,$timeout(function(){doNotUpdateTokenNow=!1,logout()},500)):deferred.resolve({}),deferred.promise}function statingMainRoute(collection){return Restangular.setBaseUrl(SERVER_URI+"api/v2/"),Restangular.all(collection)}function statingMainRouteOAuth2(collection){return setDefaultHeaders().then(function(){return Restangular.setBaseUrl(SERVER_URI+"api/v2/"),Restangular.all(collection)},fail)}function statingMainObjectOAuth2(collection,id){return setDefaultHeaders().then(function(){return Restangular.setBaseUrl(SERVER_URI+"api/v2/"),Restangular.one(collection,id)},fail)}function statingTenantMainRoute(collection){var currentTenant=JSON.parse($sessionStorage.currentTenant);return Restangular.setBaseUrl(SERVER_URI+"api/v2/tenant/"+currentTenant.name),Restangular.all(collection)}function statingTenantMainRouteOAuth2(collection){var currentTenant=JSON.parse($sessionStorage.currentTenant);return setDefaultHeaders().then(function(){return Restangular.setBaseUrl(SERVER_URI+"api/v2/tenant/"+currentTenant.name),Restangular.all(collection)},fail)}function statingTenantMainObjectOAuth2(collection,id){var currentTenant=JSON.parse($sessionStorage.currentTenant);return setDefaultHeaders().then(function(){return Restangular.setBaseUrl(SERVER_URI+"api/v2/tenant/"+currentTenant.name),Restangular.one(collection,id)},fail)}function fail(res){logger.error("Restangular fail",res)}function applyOneCallConfig(rng){var configuredRng=nextCallConfig?rng.withHttpConfig(nextCallConfig):rng;return nextCallConfig=null,configuredRng}function logout(){service.custom.get("oauth2","logout").then(onLogoutSuccess)}function onLogoutSuccess(){$cacheFactory.get("$http").removeAll(),$sessionStorage.$reset(),$state.go("auth.login")}var service,nextCallConfig,doNotUpdateTokenNow=!1;return service={setOneCallConfig:function(httpConfig){return nextCallConfig=httpConfig,service},getCurrentTenant:function(){var currentTenant=JSON.parse($sessionStorage.currentTenant);return currentTenant.name},custom:{get:function(collection,path,params,headers){var rng=statingMainRoute(collection);return rng.customGET(path,params,headers)},post:function(collection,data,path,params,headers){var rng=statingMainRoute(collection);return rng.customPOST(data,path,params,headers)}},sysdb:{show:function(collection,id){return statingMainObjectOAuth2(collection,id).then(function(rng){return applyOneCallConfig(rng).get()})},index:function(collection,filter){return statingMainRouteOAuth2(collection).then(function(rng){return applyOneCallConfig(rng).getList(filter)})},list:function(collection,filter){return statingMainObjectOAuth2(collection).then(function(rng){return applyOneCallConfig(rng).customGET("list",filter)})},edit:function(collection,id){return statingMainObjectOAuth2(collection,id).then(function(rng){return applyOneCallConfig(rng).one("edit").get()})},create:function(collection){return statingMainObjectOAuth2(collection).then(function(rng){return rng.get("create")})},store:function(collection,data){return statingMainRouteOAuth2(collection).then(function(rng){return rng.post(data)})},update:function(collection,id,data){return statingMainObjectOAuth2(collection,id).then(function(rng){return rng.patch(data)})},destroy:function(collection,id){return statingMainObjectOAuth2(collection,id).then(function(rng){return rng.remove()})},custom:{get:function(collection,path,params,headers){var rng=statingMainRoute(collection);return applyOneCallConfig(rng).customGET(path,params,headers)},post:function(collection,data,path,params,headers){var rng=statingMainRoute(collection);return rng.customPOST(data,path,params,headers)},oauth:{get:function(collection,path,params,headers){return statingMainRouteOAuth2(collection).then(function(rng){return applyOneCallConfig(rng).customGET(path,params,headers)})},post:function(collection,data,path,params,headers){return statingMainRouteOAuth2(collection).then(function(rng){return applyOneCallConfig(rng).customPOST(data,path,params,headers)})}}}},tenant:{show:function(collection,id){return statingTenantMainObjectOAuth2(collection,id).then(function(rng){return applyOneCallConfig(rng).get()})},index:function(collection,filter){return statingTenantMainRouteOAuth2(collection).then(function(rng){return applyOneCallConfig(rng).getList(filter)})},list:function(collection,filter){return statingTenantMainRouteOAuth2(collection).then(function(rng){return applyOneCallConfig(rng).customGET("list",filter)})},edit:function(collection,id){return statingTenantMainObjectOAuth2(collection,id).then(function(rng){return applyOneCallConfig(rng).one("edit").get()})},create:function(collection){return statingTenantMainRouteOAuth2(collection).then(function(rng){return rng.get("create")})},store:function(collection,data){return statingTenantMainRouteOAuth2(collection).then(function(rng){return rng.post(data)})},update:function(collection,id,data){return statingTenantMainObjectOAuth2(collection,id).then(function(rng){return rng.patch(data)})},destroy:function(collection,id){return statingTenantMainObjectOAuth2(collection,id).then(function(rng){return rng.remove()})},custom:{get:function(collection,path,params,headers){var rng=statingTenantMainRoute(collection);return applyOneCallConfig(rng).customGET(path,params,headers)},post:function(collection,data,path,params,headers){var rng=statingTenantMainRoute(collection);return rng.customPOST(data,path,params,headers)},oauth:{get:function(collection,path,params,headers){return statingTenantMainRouteOAuth2(collection).then(function(rng){return applyOneCallConfig(rng).customGET(path,params,headers)})},post:function(collection,data,path,params,headers){return statingTenantMainRouteOAuth2(collection).then(function(rng){return applyOneCallConfig(rng).customPOST(data,path,params,headers)})}}}}}}angular.module("app.core").factory("ApiV2Dataservice",ApiV2Dataservice),ApiV2Dataservice.$inject=["$q","$timeout","$cacheFactory","$state","Restangular","$sessionStorage","SERVER_URI","VERSION_NUMBER","logger"]}(),function(){"use strict";function authorization($cacheFactory,dataservice,logger,principal,$state,$rootScope,$sessionStorage,$localStorage,clientName){function login(options){dataservice.custom.post("oauth2",{email:options.email,password:options.password,remember:options.remember,client_name:clientName},"login").then(authorize,onAuthorizationFail)}function tenantLogin(options){dataservice.tenant.custom.post("oauth2",{email:options.email,password:options.password,remember:options.remember,client_name:clientName},"login").then(tenantAuthorize,onAuthorizationFail)}function authorize(data){$sessionStorage.client=JSON.stringify({client_id:data.client_id,client_secret:data.client_secret}),dataservice.authorize().then(onAuthorizationSuccess,onAuthorizationFail)}function tenantAuthorize(data){$sessionStorage.client=JSON.stringify({client_id:data.client_id,client_secret:data.client_secret}),dataservice.tenantAuthorize().then(onTenantAuthorizationSuccess,onAuthorizationFail)}function onAuthorizationSuccess(data){dataservice.token(data).then(onTokenObtainSuccess,onAuthorizationFail)}function onTenantAuthorizationSuccess(data){dataservice.tenantToken(data).then(onTokenObtainSuccess,onAuthorizationFail)}function onTokenObtainSuccess(data){switch(dataservice.setAccessToken(data),clientName){case"mobile-client":principal.identity(!0,"mobile").then(function(data){$localStorage.lastLogin=data.email,$state.go("dashboard.main")});break;case"portal-dashboard":principal.identity(!0,"portal").then(function(data){$localStorage.lastLogin=data.email,$state.go("drugstores.select")});break;case"desktop-dashboard":principal.identity(!0).then(function(data){$localStorage.lastLogin=data.email,$state.go("tenants.select")})}}function onAuthorizationFail(error){error.data&&logger.error("Server error: "+error.data.message),$rootScope.$emit("authError")}function logout(){dataservice.custom.get("oauth2","logout").then(onLogoutSuccess)}function onLogoutSuccess(){$cacheFactory.get("$http").removeAll(),$sessionStorage.$reset(),principal.reset(),$state.go("auth.login")}function checkAuthorization(){return principal.identity().then(function(){var isAuthenticated=principal.isAuthenticated();$rootScope.toState.data.roles&&$rootScope.toState.data.roles.length>0&&!principal.isInAnyRole($rootScope.toState.data.roles)&&(isAuthenticated?$state.go("accessdenied"):($rootScope.returnToState=$rootScope.toState,$rootScope.returnToStateParams=$rootScope.toStateParams,$state.go("auth.login")))})}function getDrugstoreStaffData(tenant,token){return dataservice.customGet("drugstores-staff","tenant/"+tenant+"/fetch-data-by-token/"+token)}function setDrugstoreStaffData(tenant,token,id,staff){return dataservice.customPost("drugstores-staff",{password:staff.password},"tenant/"+tenant+"/token/"+token+"/drugstore-staff/"+id).then(function(res){return dataservice.customPost("tenants",{tenant_name:tenant,drugstores_staff_email:staff.email},"add-drugstores-staff")})}var service;return service={login:login,tenantLogin:tenantLogin,checkAuthorization:checkAuthorization,logout:logout,getDrugstoreStaffData:getDrugstoreStaffData,setDrugstoreStaffData:setDrugstoreStaffData,tenantAuthorize:tenantAuthorize}}angular.module("app.core").factory("authorization",authorization),authorization.$inject=["$cacheFactory","dataservice","logger","principal","$state","$rootScope","$sessionStorage","$localStorage","CLIENT_NAME"]}(),function(){"use strict";function ngCkEditor($parse){function link($scope,$element,$attributes,$ctrls){var controller=$ctrls[0],ngModelController=$ctrls[1];controller.ready().then(function(){["dataReady","change","blur","saveSnapshot"].forEach(function(event){controller.onCKEvent(event,function(){ngModelController.$setViewValue(controller.instance.getData()||"")})}),controller.instance.setReadOnly(!!$attributes.readonly),$attributes.$observe("readonly",function(readonly){controller.instance.setReadOnly(!!readonly)}),setImmediate(function(){$parse($attributes.ready)($scope)})}),ngModelController.$render=function(){controller.ready().then(function(){controller.instance.setData(ngModelController.$viewValue||"")})}}function ckEditorController($scope,$element,$attrs,$parse,$q){var instance,vm=this,config=$parse($attrs.ngCkEditor)($scope)||{},editorElement=$element[0],readyDeferred=$q.defer();instance=editorElement.hasAttribute("contenteditable")&&"true"==editorElement.getAttribute("contenteditable").toLowerCase()?vm.instance=CKEDITOR.inline(editorElement,config):vm.instance=CKEDITOR.replace(editorElement,config),vm.onCKEvent=function(event,listener){function asyncListener(){var args=arguments;setImmediate(function(){applyListener.apply(null,args)})}function applyListener(){var args=arguments;$scope.$apply(function(){listener.apply(null,args)})}return instance.on(event,asyncListener),function(){instance.removeListener(event,applyListener)}},vm.onCKEvent("instanceReady",function(){readyDeferred.resolve(!0)}),vm.ready=function(){return readyDeferred.promise},$scope.$on("$destroy",function(){readyDeferred.promise.then(function(){instance.destroy(!1)})})}var directive={restrict:"A",require:["ngCkEditor","ngModel"],controller:["$scope","$element","$attrs","$parse","$q",ckEditorController],link:link};return directive}angular.module("app.core").directive("ngCkEditor",ngCkEditor);var setImmediate=window&&window.setImmediate?window.setImmediate:function(fn){setTimeout(fn,0)};ngCkEditor.$inject=["$parse"]}(),function(){"use strict";function compileHtml($compile,$parse){function link($scope,$element,$attributes){$scope.$watch($attributes.content,function(){$element.html($parse($attributes.content)($scope)),$compile($element.contents())($scope)},!0)}var directive;return directive={restrict:"E",link:link}}angular.module("app.core").directive("compileHtml",compileHtml),compileHtml.$inject=["$compile","$parse"]}(),function(){"use strict";function appRun(routerHelper,$rootScope,principal,$sessionStorage,$translate,CURRENT_LANGUAGE){var otherwise="/404";routerHelper.configureStates(getStates(),otherwise),activate($rootScope,principal,$sessionStorage,$translate,CURRENT_LANGUAGE)}function getStates(){return[{state:"404",data:{roles:[]},config:{url:"/404",templateUrl:"app/layout/404.html",title:"404"}},{state:"accessdenied",data:{roles:[]},config:{url:"/access-denied",templateUrl:"assets/js/app/backbone/core/accessdenied.html",title:"Access Denied"}}]}function activate($rootScope,principal,$sessionStorage,$translate,currentLanguage){$rootScope.assignModuleTranslations=function(moduleName){$translate.use("app/"+moduleName+"/i18n/"+currentLanguage+".json")}}angular.module("app.core").run(appRun)}(),function(){"use strict";function dataservice(Restangular,$q,$sessionStorage,logger,$timeout,SERVER_URI,$state,$cacheFactory,VERSION_NUMBER){function setOneCallConfig(httpConfig){return nextCallConfig=httpConfig,service}function applyOneCallConfig(rng){var configuredRng=nextCallConfig?rng.withHttpConfig(nextCallConfig):rng;return nextCallConfig=null,configuredRng}function isTokenExpired(accessToken){var now=Date.now()/1e3|0;return now-accessToken.expires_in>accessToken.tokenIssuedAt}function setAccessToken(data){var accessToken=data.plain();return accessToken.tokenIssuedAt=Date.now()/1e3|0,$sessionStorage.accessToken=JSON.stringify(accessToken),accessToken}function setDefaultHeaders(){var deferred=$q.defer(),accessToken=JSON.parse($sessionStorage.accessToken);return accessToken&&!isTokenExpired(accessToken)?(Restangular.setDefaultHeaders({Authorization:"Bearer "+accessToken.access_token,"X-Application-Version":VERSION_NUMBER}),deferred.resolve(accessToken)):accessToken&&isTokenExpired(accessToken)?doNotUpdateTokenNow?deferred.resolve({}):(doNotUpdateTokenNow=!0,$timeout(function(){doNotUpdateTokenNow=!1,logout()},500)):deferred.resolve({}),deferred.promise}function logout(){customGet("oauth2","logout").then(onLogoutSuccess)}function onLogoutSuccess(){$cacheFactory.get("$http").removeAll(),$sessionStorage.$reset(),$state.go("auth.login")}function statingMainRoute(collection){return Restangular.setDefaultHeaders({"X-Application-Version":VERSION_NUMBER}),Restangular.setBaseUrl(SERVER_URI+"api/v1/"),Restangular.all(collection)}function statingMainRouteOAuth2(collection){return setDefaultHeaders().then(function(){return Restangular.setBaseUrl(SERVER_URI+"api/v1/"),Restangular.all(collection)},fail)}function statingMainObjectOAuth2(collection,id){return setDefaultHeaders().then(function(){return Restangular.setBaseUrl(SERVER_URI+"api/v1/"),Restangular.one(collection,id)},fail)}function statingTenantMainRoute(collection){try{var currentTenant=JSON.parse($sessionStorage.currentTenant);return Restangular.setBaseUrl(SERVER_URI+"api/v1/tenant/"+currentTenant.name),Restangular.all(collection)}catch(e){console.log(e),logout()}}function statingTenantMainRouteOAuth2(collection){try{var currentTenant=JSON.parse($sessionStorage.currentTenant);return setDefaultHeaders().then(function(){return Restangular.setBaseUrl(SERVER_URI+"api/v1/tenant/"+currentTenant.name),Restangular.all(collection)},fail)}catch(e){console.log(e),logout()}}function statingTenantMainObjectOAuth2(collection,id){try{var currentTenant=JSON.parse($sessionStorage.currentTenant);return setDefaultHeaders().then(function(){return Restangular.setBaseUrl(SERVER_URI+"api/v1/tenant/"+currentTenant.name),Restangular.one(collection,id)},fail)}catch(e){console.log(e),logout()}}function tenantAuthorize(){var client=$sessionStorage.client;if(client){var data=JSON.parse(client);return tenantCustomGet("oauth2","authorize",{grant_type:"authorization_code",client_id:data.client_id,client_secret:data.client_secret,redirect_uri:"https://demo.3mind-solutions.com/",response_type:"code"})}}function authorize(){var client=$sessionStorage.client;if(client){var data=JSON.parse(client);return customGet("oauth2","authorize",{grant_type:"authorization_code",client_id:data.client_id,client_secret:data.client_secret,redirect_uri:"https://demo.3mind-solutions.com/",response_type:"code"})}}function token(code){var client=$sessionStorage.client;if(client){var data=JSON.parse(client);return customPost("oauth2",{grant_type:"authorization_code",client_id:data.client_id,client_secret:data.client_secret,redirect_uri:"https://demo.3mind-solutions.com/",code:code},"token")}}function tenantToken(code){var client=$sessionStorage.client;if(client){var data=JSON.parse(client);return tenantCustomPost("oauth2",{grant_type:"authorization_code",client_id:data.client_id,client_secret:data.client_secret,redirect_uri:"https://demo.3mind-solutions.com/",code:code},"token")}}function fail(res){logger.error("Restangular fail",res)}function show(collection,id){return statingMainObjectOAuth2(collection,id).then(function(rng){return rng.get()})}function index(collection,filter){return statingMainRouteOAuth2(collection).then(function(rng){return rng.getList(filter)})}function edit(collection,id){return statingMainObjectOAuth2(collection,id).then(function(rng){return applyOneCallConfig(rng).one("edit").get()})}function create(collection){return statingMainRouteOAuth2(collection).then(function(rng){return rng.get("create")})}function store(collection,data){return statingMainRouteOAuth2(collection).then(function(rng){return rng.post(data)})}function update(collection,id,data){return statingMainObjectOAuth2(collection,id).then(function(rng){return rng.patch(data)})}function destroy(collection,id){return statingMainObjectOAuth2(collection,id).then(function(rng){return rng.remove()})}function tenantShow(collection,id){return statingTenantMainObjectOAuth2(collection,id).then(function(rng){return rng.get()})}function tenantIndex(collection,filter){return statingTenantMainRouteOAuth2(collection).then(function(rng){return applyOneCallConfig(rng).getList(filter)})}function tenantList(collection,filter){return statingTenantMainRouteOAuth2(collection).then(function(rng){return rng.customGET("list",filter)})}function tenantEdit(collection,id){return statingTenantMainObjectOAuth2(collection,id).then(function(rng){return rng.one("edit").get()})}function tenantCreate(collection){return statingTenantMainRouteOAuth2(collection).then(function(rng){return rng.get("create")})}function tenantStore(collection,data){return statingTenantMainRouteOAuth2(collection).then(function(rng){return rng.post(data)})}function tenantUpdate(collection,id,data){return statingTenantMainObjectOAuth2(collection,id).then(function(rng){return rng.patch(data)})}function tenantDestroy(collection,id){return statingTenantMainObjectOAuth2(collection,id).then(function(rng){return rng.remove()})}function customGet(collection,path,params,headers){var rng=statingMainRoute(collection);return rng.customGET(path,params,headers)}function customGetOAuth2(collection,path,params,headers){return statingMainRouteOAuth2(collection).then(function(rng){return rng.customGET(path,params,headers)})}function customPostOAuth2(collection,data,path,params,headers){return statingMainRouteOAuth2(collection).then(function(rng){return rng.customPOST(data,path,params,headers)})}function tenantCustomGetOAuth2(collection,path,params,headers){return statingTenantMainRouteOAuth2(collection).then(function(rng){return applyOneCallConfig(rng).customGET(path,params,headers)})}function tenantCustomGet(collection,path,params,headers){var rng=statingTenantMainRoute(collection);return rng.customGET(path,params,headers)}function tenantCustomPost(collection,data,path,params,headers){var rng=statingTenantMainRoute(collection);return rng.customPOST(data,path,params,headers)}function tenantCustomPostOAuth2(collection,data,path,params,headers){return statingTenantMainRouteOAuth2(collection).then(function(rng){return rng.customPOST(data,path,params,headers)})}function customPost(collection,data,path,params,headers){
var rng=statingMainRoute(collection);return rng.customPOST(data,path,params,headers)}var service,nextCallConfig,doNotUpdateTokenNow=!1;return service={customGet:customGet,customPost:customPost,customGetOAuth2:customGetOAuth2,authorize:authorize,tenantAuthorize:tenantAuthorize,token:token,tenantToken:tenantToken,setAccessToken:setAccessToken,sysdb:{show:show,index:index,edit:edit,create:create,store:store,update:update,destroy:destroy},tenant:{show:tenantShow,index:tenantIndex,list:tenantList,edit:tenantEdit,create:tenantCreate,store:tenantStore,update:tenantUpdate,destroy:tenantDestroy,custom:{get:tenantCustomGet,post:tenantCustomPost},customOauth:{get:tenantCustomGetOAuth2,post:tenantCustomPostOAuth2}},custom:{get:customGet,post:customPost},customOauth:{get:customGetOAuth2,post:customPostOAuth2},oauth:{authorize:authorize,token:token,setAccessToken:setAccessToken},setOneCallConfig:setOneCallConfig}}angular.module("app.core").factory("dataservice",dataservice),dataservice.$inject=["Restangular","$q","$sessionStorage","logger","$timeout","SERVER_URI","$state","$cacheFactory","VERSION_NUMBER"]}(),function(){"use strict";function ngDropzone(){function link($scope,$element,$attributes){var dropzone=new Dropzone($element[0],$scope.dropzoneConfig);$scope.eventHandlers&&Object.keys($scope.dropzoneEventHandlers).forEach(function(event){dropzone.on(event,$scope.dropzoneEventHandlers[event])}),$scope.dropzone=dropzone}var directive={restrict:"AE",template:"<div ng-transclude></div>",transclude:!0,scope:{dropzone:"=",dropzoneConfig:"=",dropzoneEventHandlers:"="},link:link};return directive}angular.module("app.core").directive("ngDropzone",ngDropzone)}(),function(){"use strict";function fileModel($parse){function link($scope,$element,$attributes){var model=$parse($attributes.fileModel),modelSetter=model.assign;$element.bind("change",function(){$scope.$apply(function(){$attributes.multiple?modelSetter($scope,$element[0].files):modelSetter($scope,[$element[0].files[0]])})})}var directive;return directive={restrict:"A",link:link}}angular.module("app.core").directive("fileModel",fileModel),fileModel.$inject=["$parse"]}(),function(){"use strict";function logger($log){function error(message,data,title){$log.error("Error: "+message,data?data:"")}function info(message,data,title){$log.info("Info: "+message,data?data:"")}function success(message,data,title){$log.info("Success: "+message,data?data:"")}function warning(message,data,title){$log.warn("Warning: "+message,data?data:"")}var service={error:error,info:info,success:success,warning:warning,log:$log.log};return service}angular.module("blocks.logger").factory("logger",logger),logger.$inject=["$log"]}(),function(){"use strict";function compareTo(){function link(scope,element,attributes,ngModel){ngModel.$validators.compareTo=function(modelValue){return modelValue==scope.otherModelValue},scope.$watch("otherModelValue",function(){ngModel.$validate()})}var directive={require:"?ngModel",scope:{otherModelValue:"=compareTo"},link:link,restrict:"A"};return directive}angular.module("app.core").directive("compareTo",compareTo)}(),function(){"use strict";function ngOnLastElement(){function link($scope,$element,$attributes){console.log("works!"),console.log($scope.onLoadTemplate),console.log($attributes.ngOnLastElement),$scope.$last&&$scope[$attributes.ngOnLastElement]&&$scope[$attributes.ngOnLastElement]()}var directive={$scope:{predicate:"=ngOnLastElement"},link:link,restrict:"A"};return directive}angular.module("app.core").directive("ngOnLastElement",ngOnLastElement)}(),function(){"use strict";angular.module("notifier").factory("notifier",["$timeout",function($timeout){var notifications=[],queue=[],settings={info:{duration:5e3},warning:{duration:5e3},error:{duration:7e3},success:{duration:5e3},animate_semantic:!0};return{getSettings:function(){return settings},getAll:function(){return notifications},getQueue:function(){return queue},info:function(title,content){return this.notify("info",title,content)},error:function(title,content){return this.notify("error",title,content)},success:function(title,content){return this.notify("success",title,content)},warning:function(title,content){return this.notify("warning",title,content)},animateSemantic:function(selector,type,callback){angular.element(selector).transition({animation:type,onComplete:function(){callback&&callback()}})},notify:function(type,title,content){var length=queue.length,self=this,notification={type:type,title:title,content:content,timestamp:+new Date,number:length};return notifications.push(notification),queue.push(notification),settings.animate_semantic&&$timeout(function(){self.animateSemantic(".notifier"+length,"pulse")},0),$timeout(function(){var number=queue.indexOf(notification);settings.animate_semantic&&(self.animateSemantic(".notifier"+number,"scale"),queue.splice(number,1))},settings[type].duration),notification},clear:function(){notifications=[]}}}]).directive("atlNotifier",["notifier","$timeout",function(notifier,$timeout){function link(scope,element,attrs){}var html='<div id="gritter-notice-wrapper"><div class="ui {{item.type}} message notifier{{$index}}" ng-repeat="item in queue"><i class="close icon" ng-click="removeNotification(item)"></i><div class="header">{{item.title}}</div><p>{{item.content}}</p></div></div>';return{restrict:"AE",scope:{},template:html,link:link,controller:["$scope",function($scope){$scope.queue=notifier.getQueue(),$scope.removeNotification=function(item){var number=$scope.queue.indexOf(item);notifier.animateSemantic(".notifier"+number,"scale"),$scope.queue.splice(number,1)}}]}}])}(),function(undefined){"use strict";function principal($q,$sessionStorage,dataservice){function isIdentityResolved(){return angular.isDefined(_identity)}function isAuthenticated(){return _authenticated}function isInRole(role){return!(!_authenticated||!_identity.roles)&&_identity.roles.indexOf(role)!=-1}function isInAnyRole(roles){if(!_authenticated||!_identity.roles)return!1;for(var i=0;i<roles.length;i++)if(isInRole(roles[i]))return!0;return!1}function authenticate(identity){_identity=identity,_authenticated=identity||undefined}function parseIdentity(identity){var roles=[];return identity.roles&&identity.roles.length&&identity.roles.forEach(function(role){roles.push(role.name)}),identity.roles=roles,identity}function reset(){_identity=null,_authenticated=!1}function identity(force,platform){var dataserviceGet,deferred=$q.defer();if(force===!0&&(_identity=undefined),angular.isDefined(_identity))return deferred.resolve(_identity),deferred.promise;if($sessionStorage._identity){if(_identity=JSON.parse($sessionStorage._identity),!jQuery.isEmptyObject(_identity))return _authenticated=!0,deferred.resolve(_identity),deferred.promise;delete $sessionStorage._identity}return dataserviceGet=platform?dataservice.tenant.custom.get:dataservice.custom.get,dataserviceGet("oauth2","principal").then(function(data){_identity=parseIdentity(data.plain()),$sessionStorage._identity=JSON.stringify(_identity),_authenticated=!0,deferred.resolve(_identity)},function(){_identity=null,_authenticated=!1,deferred.resolve(_identity)}),deferred.promise}function getName(){return isIdentityResolved()?_identity.firstName+" "+_identity.lastName:"Jane Doe"}function getId(){return isIdentityResolved()?_identity.id:undefined}function getEmail(){return isIdentityResolved()?_identity.email:undefined}function getJobTitle(){return isIdentityResolved()?_identity.job_title:undefined}function getBudgetModuleIsOn(){return isIdentityResolved()?_identity.budget_module_is_on:undefined}function getGeolocationIsOn(){return isIdentityResolved()?_identity.geolocation_is_on:undefined}function getGeolocationInterval(){return isIdentityResolved()?_identity.geolocation_interval:undefined}var service,_identity,_authenticated=!1;return service={isIdentityResolved:isIdentityResolved,isAuthenticated:isAuthenticated,isInRole:isInRole,isInAnyRole:isInAnyRole,getName:getName,getId:getId,getJobTitle:getJobTitle,getBudgetModuleIsOn:getBudgetModuleIsOn,getGeolocationIsOn:getGeolocationIsOn,getGeolocationInterval:getGeolocationInterval,getEmail:getEmail,authenticate:authenticate,identity:identity,reset:reset}}angular.module("app.core").factory("principal",principal),principal.$inject=["$q","$sessionStorage","dataservice"]}(),function(undefined){"use strict";function QueueManager(){function Queue(){_queue=[],_offset=0}var _queue,_offset;return Queue.prototype={getLength:function(){return _queue.length-_offset},isEmpty:function(){return 0===_queue.length},enqueue:function(item){_queue.push(item)},dequeue:function(){if(0===_queue.length)return undefined;var item=_queue[offset];return 2*++_offset>=_queue.length&&(_queue=_queue.slice(_offset),_offset=0),item},peek:function(){return _queue.length?_queue[_offset]:undefined},stringify:function(){return JSON.stringify(_queue)}},Queue}angular.module("app.core").factory("QueueManager",QueueManager),QueueManager.$inject=[]}(),function(){"use strict";function uiDateConverter(uiDateFormatConfig){function dateToString(dateFormat,value){if(dateFormat=dateFormat||uiDateFormatConfig,value){if(dateFormat)try{return jQuery.datepicker.formatDate(dateFormat,value)}catch(formatException){return}if(value.toISOString)return value.toISOString()}return null}function stringToDate(dateFormat,valueToParse){if(dateFormat=dateFormat||uiDateFormatConfig,angular.isDate(valueToParse)&&!isNaN(valueToParse))return valueToParse;if(angular.isString(valueToParse)){if(dateFormat)return jQuery.datepicker.parseDate(dateFormat,valueToParse);var isoDate=new Date(valueToParse);return isNaN(isoDate.getTime())?null:isoDate}return angular.isNumber(valueToParse)?new Date(valueToParse):null}var service;return service={stringToDate:stringToDate,dateToString:dateToString}}angular.module("app.core").factory("uiDateConverter",uiDateConverter),uiDateConverter.$inject=["uiDateFormatConfig"]}(),function(jQuery){"use strict";function uiDateFormat(uiDateConverter){function link(scope,element,attrs,modelCtrl){var dateFormat=attrs.uiDateFormat;console.log("dateFormat",dateFormat),console.log("uiDateConverter",uiDateConverter),modelCtrl.$formatters.unshift(function(value){return uiDateConverter.stringToDate(dateFormat,value)}),modelCtrl.$parsers.push(function(value){return uiDateConverter.dateToString(dateFormat,value)})}var directive;return directive={require:"ngModel",link:link}}angular.module("app.core").constant("uiDateFormatConfig","").directive("uiDateFormat",uiDateFormat),uiDateFormat.$inject=["uiDateConverter"]}(jQuery),function(){"use strict";function uiDate(uiDateConfig,uiDateConverter){function link(scope,element,attrs,controller){var getOptions=function(){return angular.extend({},uiDateConfig,scope.$eval(attrs.uiDate))},initDateWidget=function(){function setVal(){var keys=["Hours","Minutes","Seconds","Milliseconds"],isDate=angular.isDate(controller.$modelValue),preserve={};isDate&&controller.$modelValue.toDateString()===element.datepicker("getDate").toDateString()||(isDate&&angular.forEach(keys,function(key){preserve[key]=controller.$modelValue["get"+key]()}),controller.$setViewValue(element.datepicker("getDate")),isDate&&angular.forEach(keys,function(key){controller.$viewValue["set"+key](preserve[key])}))}var showing=!1,opts=getOptions();if(controller){var _onSelect=opts.onSelect||angular.noop;opts.onSelect=function(value,picker){scope.$apply(function(){showing=!0,setVal(),_onSelect(value,picker),element.blur()})};var _beforeShow=opts.beforeShow||angular.noop;opts.beforeShow=function(input,picker){showing=!0,_beforeShow(input,picker)};var _onClose=opts.onClose||angular.noop;opts.onClose=function(value,picker){showing=!1,_onClose(value,picker)},element.off("blur.datepicker").on("blur.datepicker",function(){showing||scope.$apply(function(){element.datepicker("setDate",element.datepicker("getDate")),setVal()})}),controller.$validators.uiDateValidator=function(modelValue,viewValue){return angular.isDate(uiDateConverter.stringToDate(attrs.uiDateFormat,viewValue))},controller.$parsers.push(function(valueToParse){return uiDateConverter.stringToDate(attrs.uiDateFormat,valueToParse)}),controller.$render=function(){element.datepicker("setDate",controller.$modelValue)}}element.data("datepicker")?(element.datepicker("option",opts),element.datepicker("refresh")):(element.datepicker(opts),element.on("$destroy",function(){element.datepicker("hide"),element.datepicker("destroy")})),controller&&controller.$render()};scope.$watch(getOptions,initDateWidget,!0)}var options,directive={require:"?ngModel",link:link};return options={},angular.extend(options,uiDateConfig),directive}angular.module("app.core").constant("uiDateConfig",{dateFormat:"yy-mm-dd"}).directive("uiDate",uiDate),uiDate.$inject=["uiDateConfig","uiDateConverter"]}(),function(){"use strict";function DashboardController($rootScope,dataservice,logger){function activate(){vm.subtitle=$rootScope.subtitle}$rootScope.breadcrumbTitle="",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="";var vm=this;vm.title="Dashboard",activate()}angular.module("app.dashboard").controller("DashboardController",DashboardController),DashboardController.$inject=["$rootScope","dataservice","logger"]}(),function(){"use strict";function DashboardMainController($rootScope,geolocation,principal,$localStorage,ATLAS_MODULES){function getMenuItems(){var params,state,myMenu,menu=[{label:"Klienci",state:"clients.list",icon:"clients"},{label:"Kampanie",state:"campaigns.list",icon:"campaigns"},{label:"Wiadomości",state:"messages.inbox({page: 1})",icon:"messages"},{label:"Pomoc",state:"messages.supportInbox({page: 1})",icon:"help"}];vm.principalJobTitle=principal.getJobTitle(),vm.budgetModuleIsOn=principal.getBudgetModuleIsOn(),ATLAS_MODULES.GAZETKI&&menu.push({label:"Gazetki",state:"gazetki.list",icon:"gazetki"}),ATLAS_MODULES.DETAILING&&menu.push({label:"Detailing",state:"detailing.list({page: 1})",icon:"detailing"}),ATLAS_MODULES.COACHING&&menu.push({label:"Coaching",state:"profile.coaching",icon:"coaching"}),vm.budgetModuleIsOn&&"4"==vm.principalJobTitle&&menu.push({label:"Budżet",state:"budgets.main",icon:"my"});var customClass=0;if(vm.principalId=principal.getId(),vm.principalId&&$localStorage[vm.principalId]&&$localStorage[vm.principalId].urls&&Object.keys($localStorage[vm.principalId].urls).length)for(var i in $localStorage[vm.principalId].urls)$localStorage[vm.principalId].urls.hasOwnProperty(i)&&(customClass++,params=JSON.stringify($localStorage[vm.principalId].urls[i].params),state=$localStorage[vm.principalId].urls[i].state+"("+params+")",myMenu={icon:"my custom-"+customClass,label:$localStorage[vm.principalId].urls[i].label,state:state},menu.push(myMenu));return menu}function activate(){$rootScope.subtitle="Main page",principal.getGeolocationIsOn()&&geolocation.startGeolocation()}var vm=this;vm.menuItems=getMenuItems(),activate()}angular.module("app.dashboard").controller("DashboardMainController",DashboardMainController),DashboardMainController.$inject=["$rootScope","geolocation","principal","$localStorage","ATLAS_MODULES"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"dashboard",config:{parent:"root",templateUrl:"app/dashboard/dashboard.html",controller:"DashboardController",controllerAs:"vm",settings:{}}},{state:"dashboard.main",config:{url:"/",templateUrl:"app/dashboard/dashboard.main.html",controller:"DashboardMainController",controllerAs:"vm",title:"Dashboard Main Page",data:{roles:[]},settings:{}}}]}angular.module("app.dashboard").run(appRun),appRun.$inject=["routerHelper"]}(),function(undefined){"use strict";function DetailingAfterPresentationController($rootScope,principal,$state,DetailingsManager,DrugstoresManager,PresentationsManager,ProgressManager,GiftsManager,GIFT_IMAGES_PATH,AFTER_PRESENTATIONS_EXPORT_PATH){function activate(){$rootScope.subtitle="Detailing #"+vm._id+" After Presentation",principal.identity(!1,"mobile").then(function(identity){vm._representantId=identity.id,vm._id=$state.params.hasOwnProperty("id")?parseInt($state.params.id):undefined,vm._presentationId=$state.params.hasOwnProperty("presentationId")?parseInt($state.params.presentationId):undefined,vm._drugstoreId=$state.params.hasOwnProperty("drugstoreId")?parseInt($state.params.drugstoreId):undefined,DetailingsManager.fetch(vm._id).then(function(detailing){vm.detailing=detailing,vm.detailingGifts=GiftsManager,DrugstoresManager.fetch(vm._drugstoreId).then(function(drugstore){vm.drugstore=drugstore,vm.staff=drugstore.getStaff(),PresentationsManager.fetch(vm._presentationId).then(function(presentation){vm.presentation=presentation,ProgressManager.fetch(vm._id).then(function(progress){progress.id?progress.setData({drugstore_id:vm._drugstoreId}):progress.setData({campaign_id:vm._id,total_points:0,current_points:0,stats:{},drugstore_id:vm._drugstoreId}),vm.detailingGifts["import"](detailing.getGifts(),detailing.getGiftsNumber(),vm._representantId,progress),vm.detailingGifts.setGiftsPoints(detailing.getGiftsPoints()),progress.resetGiftsToGive(),vm.progress=progress,vm.progress.dropped=progress.getStaffGifts(vm.staff),vm.progress.issued=progress.getStaffIssuedGifts(vm.staff),vm.seenThePresentation=progress.getStatsSeen(drugstore,presentation),vm.points=progress.getPoints(drugstore),vm.spentPoints=progress.getSpentPoints(drugstore),vm.totalPoints=detailing.getTotalPresentationsPoints(),vm.detailingGifts.list=vm.detailingGifts.index(),angular.forEach(vm.detailingGifts.list,function(gift,index){var arrName=[];arrName=gift.name.split(" "),gift.title=gift.name,gift.name=arrName.length>1?arrName[0]:gift.name,gift.image="",gift.image=GIFT_IMAGES_PATH+gift.image_id+".jpg"})})})})})})}var vm=this;vm.seenThePresentation={},vm.points={},vm.totalPoints=0,vm.selectedStaffId=0,vm.spreadsheetFilename="",vm.cancelSavingChanges=function(){$state.go("detailing.list",{page:1})},vm.replayPdfPresentation=function(){$state.go("detailing.presentation",{id:vm._id,presentationId:vm._presentationId,drugstoreId:vm._drugstoreId})},vm.onSeenPresentationToggle=function(drugstoreStaffId){var addPoints=vm.progress.toggleSeenPresentation(vm.seenThePresentation[drugstoreStaffId],vm.drugstore,vm.presentation,drugstoreStaffId);vm.points[drugstoreStaffId]||(vm.points[drugstoreStaffId]=0),vm.points[drugstoreStaffId]+=addPoints},vm.saveProgress=function(){vm.progress.id?vm.progress.update():vm.progress.store()},vm.now=function(){return(new Date).getTime()},vm.giftsGive=function(){vm.progress.giftsGive(vm.staff),vm.points=vm.progress.getPoints(vm.drugstore),vm.spentPoints=vm.progress.getSpentPoints(vm.drugstore)},vm.selectStaff=function(staffId){staffId!=vm.selectedStaffId?vm.selectedStaffId=staffId:vm.selectedStaffId=0},vm.isStaffRowSelected=function(staffId){return staffId?staffId==vm.selectedStaffId:0!==vm.selectedStaffId},vm.getSelectedStaffProgressPercents=function(){var retval=0;return vm.progress&&vm.isStaffRowSelected()&&(retval=Math.round(vm.progress.getStaffGainedPoints(vm._drugstoreId,vm.selectedStaffId)/vm.totalPoints*100)),retval},vm.getSpentPoints=function(staffId){var retval=0;return vm.progress&&(vm.spentPoints=vm.progress.getSpentPoints(vm.drugstore),retval=vm.spentPoints[staffId]),retval},vm.disableSwitch=function(staffId){var seenThePresentation=vm.seenThePresentation[staffId]||!1,presentationPoints=vm.presentation&&vm.presentation.points||0,points=vm.points&&vm.points[staffId]||0,spentPoints=vm.spentPoints&&vm.spentPoints[staffId]||0;return seenThePresentation&&points-spentPoints<presentationPoints},vm.showGiftInfo=function(obj){vm.showGift=obj,angular.element("#showGift").modal("show")},vm.exportDataToExcel=function(){var drugstoresStaff=[];vm.staff.forEach(function(staff){drugstoresStaff.push({id:staff.id,first_name:staff.first_name,last_name:staff.last_name,seen_the_presentation:vm.seenThePresentation[staff.id],points:vm.points[staff.id]||0,spent_points:vm.getSpentPoints(staff.id)||0,available_points:(vm.points[staff.id]||0)-(vm.spentPoints[staff.id]||0)})}),vm.progress.exportDataToExcel({staff_id:vm._representantId,presentation_id:vm._presentationId,drugstore_id:vm._drugstoreId,drugstores_staff:drugstoresStaff}).then(function(res){vm.spreadsheetFilename=res})},vm.getSpreadsheetPath=function(){return AFTER_PRESENTATIONS_EXPORT_PATH+vm.spreadsheetFilename},activate()}angular.module("app.detailing").controller("DetailingAfterPresentationController",DetailingAfterPresentationController),DetailingAfterPresentationController.$inject=["$rootScope","principal","$state","DetailingsManager","DrugstoresManager","PresentationsManager","ProgressManager","GiftsManager","GIFT_IMAGES_PATH","AFTER_PRESENTATIONS_EXPORT_PATH"]}(),function(){"use strict";function DetailingController($rootScope,dataservice,logger){function activate(){vm.subtitle=$rootScope.subtitle,$rootScope.assignModuleTranslations("detailing")}$rootScope.breadcrumbTitle="Detailing",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="";var vm=this;vm.title="Detailing",activate()}angular.module("app.detailing").controller("DetailingController",DetailingController),DetailingController.$inject=["$rootScope","dataservice","logger"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"detailing",config:{parent:"root",templateUrl:"app/detailing/detailing.html",controller:"DetailingController",controllerAs:"vm",settings:{}}},{state:"detailing.list",config:{url:"/detailing/list/{page:[0-9]{1,8}}",templateUrl:"app/detailing/list/detailing.list.html",controller:"DetailingListController",controllerAs:"vm",title:"Detailing",data:{roles:[]},settings:{}}},{state:"detailing.main",config:{url:"/detailing/main/{id:[0-9]{1,8}}",templateUrl:"app/detailing/main/detailing.main.html",controller:"DetailingMainController",controllerAs:"vm",title:"Detailing",data:{roles:[]},settings:{}}},{state:"detailing.presentation",config:{url:"/detailing/{id:[0-9]{1,8}}/presentation/{presentationId:[0-9]{1,8}}/drugstore/{drugstoreId:[0-9]{1,8}}",templateUrl:"app/detailing/presentation/detailing.presentation.html",controller:"DetailingPresentationController",controllerAs:"vm",title:"Detailing",data:{roles:[]},settings:{}}},{state:"detailing.presentationOhneDs",config:{url:"/detailing/{id:[0-9]{1,8}}/presentation/{presentationId:[0-9]{1,8}}",templateUrl:"app/detailing/presentation/detailing.presentation.html",controller:"DetailingPresentationController",controllerAs:"vm",title:"Detailing",data:{roles:[]},settings:{}}},{state:"detailing.afterPresentation",config:{url:"/detailing/{id:[0-9]{1,8}}/after-presentation/{presentationId:[0-9]{1,8}}/drugstore/{drugstoreId:[0-9]{1,8}}",templateUrl:"app/detailing/after-presentation/detailing.after-presentation.html",controller:"DetailingAfterPresentationController",controllerAs:"vm",title:"Detailing",data:{roles:[]},settings:{}}},{state:"detailing.previewFilms",config:{url:"/detailing/{id:[0-9]{1,8}}/preview-films/",templateUrl:"app/detailing/preview-films/detailing.preview-films.html",controller:"DetailingPreviewFilmsController",controllerAs:"vm",title:"Detailing",data:{roles:[]},settings:{}}}]}angular.module("app.detailing").run(appRun),appRun.$inject=["routerHelper"]}(),function(undefined){"use strict";function DetailingListController($scope,$state,DetailingsManager,ProgressManager){function activate(){var filter,progress;vm.currentPage=$state.params.hasOwnProperty("page")?parseInt($state.params.page):1,filter={page:vm.currentPage,query:{type:"detailing"}},DetailingsManager.index(filter).then(function(data){data.forEach(function(detailing){detailing.definition=JSON.parse(detailing.definition),detailing.icon=detailing.definition.icon;try{detailing.steps=JSON.parse(detailing.definition).steps}catch(e){}detailing.progress?(progress=detailing.progress,detailing.progress=ProgressManager.setData(progress),vm.detailings=DetailingsManager):ProgressManager.initialize(detailing.id).then(function(progress){detailing.progress=progress,vm.detailings=DetailingsManager})})})}var vm=this;vm.selectDetailing=function(id){$state.go("detailing.main",{id:id})},vm.getCycleProgressPercents=function(detailingId){var detailing=vm.detailings.find(detailingId),retval=0;return detailing&&"undefined"!=typeof detailing.progress&&(retval=Math.round(detailing.progress.getCurrentCyclePoints()/detailing.progress.getCurrentCycleTotalPoints()*100)),retval},vm.getProgressPercents=function(detailingId){var detailing=vm.detailings.find(detailingId),retval=0;return detailing&&"undefined"!=typeof detailing.progress&&(retval=Math.round(detailing.progress.current_points/detailing.progress.total_points*100)),retval},vm.getCurrentCyclePoints=function(detailingId){var detailing=vm.detailings.find(detailingId),retval=0;return detailing&&"undefined"!=typeof detailing.progress&&(retval=detailing.progress.getCurrentCyclePoints()),retval},vm.getCurrentCycleTotalPoints=function(detailingId){var detailing=vm.detailings.find(detailingId),retval=0;return detailing&&"undefined"!=typeof detailing.progress&&(retval=detailing.progress.getCurrentCycleTotalPoints()),retval},activate()}angular.module("app.detailing").controller("DetailingListController",DetailingListController),DetailingListController.$inject=["$scope","$state","DetailingsManager","ProgressManager"]}(),function(undefined){"use strict";function DetailingMainController($rootScope,principal,$state,DetailingsManager,ProgressManager){function activate(){vm._id=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,$rootScope.subtitle="Detailing #"+vm._id,principal.identity(!1,"mobile").then(function(identity){vm._representantId=identity.id,DetailingsManager.fetch(vm._id).then(function(detailing){vm.detailing=detailing,ProgressManager.fetch(vm._id).then(function(progress){progress.id||progress.setData({campaign_id:vm._id,total_points:0,current_points:0,stats:{}}),vm.progress=progress})})})}var vm=this;vm.showPresentation=function(presentationId,drugstoreId){presentationId&&drugstoreId&&$state.go("detailing.presentation",{id:vm._id,presentationId:presentationId,drugstoreId:drugstoreId})},vm.listView=!1,vm.changeView=function(){vm.listView=vm.listView!==!0},activate()}angular.module("app.detailing").controller("DetailingMainController",DetailingMainController),DetailingMainController.$inject=["$rootScope","principal","$state","DetailingsManager","ProgressManager"]}(),function(undefined){"use strict";function DetailingPresentationController($scope,$state,$interval,PresentationsManager,PRESENTATIONS_PATH){function activate(){vm._id=$state.params.hasOwnProperty("id")?parseInt($state.params.id):undefined,vm._presentationId=$state.params.hasOwnProperty("presentationId")?parseInt($state.params.presentationId):undefined,vm._drugstoreId=$state.params.hasOwnProperty("drugstoreId")?parseInt($state.params.drugstoreId):undefined,$scope.play=!1,PresentationsManager.fetch(vm._presentationId).then(function(presentation){presentation.filename&&($scope.pdfUrl=PRESENTATIONS_PATH+presentation.filename)})}function startSlideshow(){var interval=1e3*$scope.slideshowInterval;vm.stop=$interval($scope.goNext,interval)}function pauseSlideshow(){$interval.cancel(vm.stop)}var vm=this;activate(),$scope.toggleSlideshow=function(){$scope.play=!$scope.play,$scope.play?startSlideshow():pauseSlideshow()}}angular.module("app.detailing").controller("DetailingPresentationController",DetailingPresentationController),DetailingPresentationController.$inject=["$scope","$state","$interval","PresentationsManager","PRESENTATIONS_PATH"]}(),function(undefined){"use strict";function DetailingPreviewFilmsController($rootScope,$scope,$state,DetailingsManager){function activate(){vm._id=$state.params.hasOwnProperty("id")?parseInt($state.params.id):undefined,$rootScope.subtitle="Detailing #"+vm._id+" Preview Films";var filter;vm.currentPage=$state.params.hasOwnProperty("page")?parseInt($state.params.page):1,filter={page:vm.currentPage,query:{type:"detailing"}},DetailingsManager.index(filter).then(function(data){vm.detailings=data})}var vm=this;vm.playPdf=function(presentationId){$state.go("detailing.presentationOhneDs",{id:vm._id,presentationId:presentationId})},activate()}angular.module("app.detailing").controller("DetailingPreviewFilmsController",DetailingPreviewFilmsController),DetailingPreviewFilmsController.$inject=["$rootScope","$scope","$state","DetailingsManager"]}(),function(){"use strict";function addressRepresentation(){var filter;return filter=function(address){if(!address||jQuery.isEmptyObject(address))return"";var city=address.city?address.city.name:"",region=address.region?address.region.name:"",country=address.country?address.country.name:"";return address.address_line_1+"\n"+(address.address_line_2?address.address_line_2+"\n":"")+(address.phone?address.phone+"\n":"")+city+", "+region+" "+address.zip+"\n"+country}}function addressHtmlRepresentation(){var filter;return filter=function(address){if(!address||jQuery.isEmptyObject(address))return"";var city=address.city?address.city.name:"",region=address.region?address.region.name:"",country=address.country?address.country.name:"";return address.address_line_1+"<br>"+(address.address_line_2?address.address_line_2+"<br>":"")+city+", "+region+" "+address.zip+"<br>"+country}}angular.module("app.filters").filter("addressRepresentation",addressRepresentation).filter("addressHtmlRepresentation",addressHtmlRepresentation)}(),function(){"use strict";function filesize(){var filter;return filter=function(bytes){return humanFileSize(bytes)}}function siFilesize(){var filter;return filter=function(bytes){return humanFileSize(bytes,!0)}}function humanFileSize(bytes,si){if("undefined"==typeof bytes)return"Size unknown";var thresh=si?1e3:1024;if(_.isString(bytes)&&(bytes=parseInt(bytes)),Math.abs(bytes)<thresh)return bytes+" B";var units=si?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],u=-1;do bytes/=thresh,++u;while(Math.abs(bytes)>=thresh&&u<units.length-1);return bytes.toFixed(1)+" "+units[u]}angular.module("app.filters").filter("filesize",filesize).filter("siFilesize",siFilesize)}(),function(){"use strict";function htmlToPlaintext(){return function(text){return text?String(text).replace(/<[^>]+>/gm," "):""}}angular.module("app.filters").filter("htmlToPlaintext",htmlToPlaintext)}(),function(){"use strict";function orderObjectBy(){var filter;return filter=function(items,field,reverse){var filtered=[];return angular.forEach(items,function(item){filtered.push(item)}),filtered.sort(function(a,b){return a[field]>b[field]?1:-1}),reverse&&filtered.reverse(),filtered}}angular.module("app.filters").filter("orderObjectBy",orderObjectBy)}(),function(){"use strict";function range(){var filter=function(input,total){total=parseInt(total);for(var i=0;i<total;i++)input.push(i);return input};return filter}angular.module("app.filters").filter("range",range)}(),function(){"use strict";function slownie(){var filter;return filter=function(number){return(new Slownie).get(number)}}function currencySlownie(){var filter;return filter=function(number){return(new Slownie).currency(parseFloat(number))}}angular.module("app.filters").filter("slownie",slownie).filter("currencySlownie",currencySlownie);var Slownie=function(number){this.liczba=number||0,this.setki=["","sto ","dwieście ","trzysta ","czterysta ","pięćset ","sześćset ","siedemset ","osiemset ","dziewięcset "],this.nastki=["dziesięc ","jedenaście ","dwanaście ","trzynaście ","czternaście ","piętnaście ","szesnaście ","siedemnaście ","osiemnaście ","dziewiętnaście "],this.dziesiatki=["","dziesięć ","dwadzieścia ","trzydzieści ","czterdzieści ","pięćdziesiąt ","sześćdziesiąt ","siedemdziesiąt ","osiemdziesiąt ","dziewiecdziesiąt "],this.jednosci=["","jeden ","dwa ","trzy ","cztery ","pięć ","sześć ","siedem ","osiem ","dziewięć "],this.wielkosci=[["","jeden","",""],["","tysiąc ","tysiące ","tysięcy "],["","milion ","miliony ","milionów "],["","miliard ","miliardy ","miliardów "],["","bilion ","biliony ","bilionów "],["","biliard ","biliardy ","biliardów "],["","trylion ","tryliony ","trylionów "],["","tryliard ","tryliardy ","tryliardów "],["","kwadrylion ","kwadryliony ","kwadrylionów "]],
this.str=""};Slownie.prototype.trim=function(str){return str.replace(/^\s+|\s+$/g,"")},Slownie.prototype.sdj=function(s,d,j){if(!d&&!s){if(0===j)return 0;if(1==j)return 1}return this.setki[s]&&(this.str=this.str+this.setki[s]),1==d&&this.nastki[j]?this.str=this.str+this.nastki[j]:(this.dziesiatki[d]&&(this.str=this.str+this.dziesiatki[d]),this.jednosci[j]&&(this.str=this.str+this.jednosci[j])),1!=d&&j>=2&&j<=4?2:3},Slownie.prototype.get=function(liczba){"undefined"==typeof liczba&&(liczba=this.liczba),this.str="";var forma,i,tmp,ilosc=0,cyfry=[];for(liczba=liczba.toString(),ilosc=liczba.length,i=0;i<ilosc&&(tmp=liczba[i]-"0",!(tmp>9));i++)cyfry[ilosc-i-1]=tmp;if(0===ilosc)this.str=this.str+"zero ";else for(i=parseInt((ilosc-1)/3);i>=0;i--)forma=this.sdj(cyfry[3*i+2],cyfry[3*i+1],cyfry[3*i]),this.str=this.str+this.wielkosci[i][forma];return this.trim(this.str)},Slownie.prototype.currency=function(liczba){var zloty,groszy;return"undefined"==typeof liczba&&(liczba=this.liczba),zloty=Math.floor(liczba),groszy=100*(liczba%1).toFixed(2),(this.get(zloty)||"zero")+" PLN "+(groszy<10?"0":"")+groszy+"/100"}}(),function(){"use strict";function characters(){return function(input,chars,breakOnWord){if(isNaN(chars))return input;if(chars<=0)return"";if(input&&input.length>chars){if(input=input.substring(0,chars),breakOnWord)for(;" "===input.charAt(input.length-1);)input=input.substr(0,input.length-1);else{var lastspace=input.lastIndexOf(" ");lastspace!==-1&&(input=input.substr(0,lastspace))}return input+"…"}return input}}function splitcharacters(){return function(input,chars){if(isNaN(chars))return input;if(chars<=0)return"";if(input&&input.length>chars){var prefix=input.substring(0,chars/2),postfix=input.substring(input.length-chars/2,input.length);return prefix+"..."+postfix}return input}}function words(){return function(input,words){if(isNaN(words))return input;if(words<=0)return"";if(input){var inputWords=input.split(/\s+/);inputWords.length>words&&(input=inputWords.slice(0,words).join(" ")+"…")}return input}}angular.module("app.filters").filter("characters",characters).filter("splitcharacters",splitcharacters).filter("words",words)}(),function(){"use strict";function unsafe($sce){var filter;return filter=function(input){return $sce.trustAsHtml(input)}}angular.module("app.filters").filter("unsafe",unsafe),unsafe.$inject=["$sce"]}(),function(){"use strict";function GazetkiController($rootScope,dataservice,logger){function activate(){vm.subtitle=$rootScope.subtitle,$rootScope.assignModuleTranslations("gazetki")}$rootScope.breadcrumbTitle="Gazetki",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="";var vm=this;vm.title="Gazetki",activate()}angular.module("app.gazetki").controller("GazetkiController",GazetkiController),GazetkiController.$inject=["$rootScope","dataservice","logger"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"gazetki",config:{parent:"root",templateUrl:"app/gazetki/gazetki.html",controller:"GazetkiController",controllerAs:"vm",settings:{}}},{state:"gazetki.list",config:{url:"/gazetki",templateUrl:"app/gazetki/list/gazetki.list.html",controller:"GazetkiListController",controllerAs:"vm",title:"Gazetki List",data:{roles:[]},settings:{}}},{state:"gazetki.filter",config:{url:"/gazetki/filter/{id:[0-9]{1,8}}",templateUrl:"app/gazetki/list/gazetki.filter.html",controller:"GazetkiFilterController",controllerAs:"vm",title:"gazetki List",data:{roles:[]},settings:{}}},{state:"gazetki.create",config:{url:"/gazetki/create/{campaignId:[0-9]{1,8}}/{drugstoreId:[0-9]{1,8}}",templateUrl:"app/gazetki/generator/gazetki.generator.html",controller:"GazetkiCreateController",controllerAs:"vm",title:"Gazetki Generator",data:{roles:[]},settings:{}}},{state:"gazetki.edit",config:{url:"/gazetki/edit/{id:[0-9]{1,8}}/{drugstoreId:[0-9]{1,8}}",templateUrl:"app/gazetki/generator/gazetki.generator.html",controller:"GazetkiEditController",controllerAs:"vm",title:"Gazetki Generator",data:{roles:[]},settings:{}}}]}angular.module("app.gazetki").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function GazetkiCreateController($scope,$http,$state,dataservice,logger,principal,IMAGES_PATH,notifier){function activate(){vm.campaignId=$state.params.hasOwnProperty("campaignId")?parseInt($state.params.campaignId):-1,vm.currentDrugstoreId=$state.params.hasOwnProperty("drugstoreId")?parseInt($state.params.drugstoreId):-1,showDimmer(),dataservice.tenant.customOauth.post("get-gazetki-definition",{campaign:vm.campaignId,drugstore:vm.currentDrugstoreId}).then(function(definition){principal.identity(!1,"mobile").then(function(identity){vm.representant=identity,dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns","show/"+vm.campaignId+"/staff/"+identity.id).then(function(data){vm.gazetka.printing={min:data.resource.min_gazetki_printing_amount,current:parseInt(JSON.parse(data.resource.definition).gazetkiNumber.gazetki[data.resource.gazetka_definition_id].reps[identity.id]),max:data.resource.max_gazetki_printing_amount};for(var i in data.resource.drugstores)data.resource.drugstores[i].id==vm.currentDrugstoreId&&(vm.currentDrugstore=data.resource.drugstores[i]);for(i in data.resource.drugstores)vm.currentDrugstore.drugstores_network_id==data.resource.drugstores[i].drugstores_network_id&&vm.drugstores.push(data.resource.drugstores[i]);for(vm.gazetka.pages=[],i=0;i<definition.pages.length;i++)vm.gazetka.pages.push({backgrounds:JSON.parse(definition.pages[i].backgrounds),graphicalSample:definition.pages[i].graphical_sample,units:JSON.parse(definition.pages[i].template)});for(vm.gazetka.backgrounds=[],i=0;i<vm.gazetka.pages.length;i++)vm.currentPage=i,vm.changeBackground(vm.gazetka.pages[i].backgrounds[0].id);for(vm.currentPage=0,vm.logo=JSON.parse(definition.gazetka_definition.logo),vm.haslo=JSON.parse(definition.gazetka_definition.haslo),vm.gazetka.logo=0,i=0;i<vm.gazetka.pages.length;i++)vm.currentLayouts.push(vm.setCurrentLayouts(i));vm.changeAddresser(),vm.setBackgroundUrl(vm.currentPage,"generator"),hideDimmer()})})})}function clone(obj){if(null===obj||"object"!=typeof obj)return obj;var copy=obj.constructor();for(var attr in obj)obj.hasOwnProperty(attr)&&(copy[attr]=obj[attr]);return copy}var vm=this;vm.gazetka={},vm.gazetka.pages=[],vm.gazetka.drugstoresList=[],vm.gazetka.backgrounds=[],vm.gazetka.drugstores=[],vm.gazetka.addresser="1",vm.representant={},vm.currentPage=0,vm.currentPreviewPage=0,vm.currentLayouts=[],vm.addresses=[],vm.drugstores=[],vm.gazetkaUploadsImagesPath=IMAGES_PATH+"gazetka/",vm.logoPath=vm.gazetkaUploadsImagesPath+"logo/",vm.unitsImagesPath=vm.gazetkaUploadsImagesPath+"units/",vm.gazetkaBackgroundsPath=IMAGES_PATH+"gazetki-images/backgrounds/",vm.currentDrugstoreId=0,vm.currentDrugstore={},vm.templates=["app/gazetki/templates/tlo1_3moduly.html","app/gazetki/templates/tlo1_4moduly.html","app/gazetki/templates/tlo1_5moduly.html","app/gazetki/templates/tlo1_6moduly.html"],vm.previewTemplates=["app/gazetki/templates/previewTemplates/tlo1_3moduly.html","app/gazetki/templates/previewTemplates/tlo1_4moduly.html","app/gazetki/templates/previewTemplates/tlo1_5moduly.html","app/gazetki/templates/previewTemplates/tlo1_6moduly.html"],vm.cancelGazetkaSave=function(){$state.go("gazetki.list")},vm.findArrayIndexBackgrounds=function(_id){for(var i=0;i<vm.gazetka.pages[vm.currentPage].backgrounds.length;i++)if(_id==vm.gazetka.pages[vm.currentPage].backgrounds[i].id)return i},vm.findMainOffice=function(){for(var i in vm.drugstores)if(vm.drugstores[i].negotiation_point)return vm.drugstores[i];return vm.currentDrugstore},vm.changeAddresser=function(){var mainOffice={};switch(vm.gazetka.drugstoresList=[],vm.gazetka.address="",vm.gazetka.addresser){case"1":mainOffice=vm.findMainOffice(),vm.gazetka.address=vm.setAddress(mainOffice.address),vm.gazetka.drugstoresList=[mainOffice],vm.gazetka.drugstores=[],vm.selectDrugstore(mainOffice.id);break;case"2":mainOffice=vm.findMainOffice(),vm.gazetka.address=vm.setAddress(mainOffice.address),vm.gazetka.drugstoresList=vm.drugstores,vm.gazetka.drugstores=[];for(var i in vm.gazetka.drugstoresList)vm.selectDrugstore(vm.gazetka.drugstoresList[i].id);break;case"3":vm.gazetka.address="",vm.gazetka.drugstores=[],vm.gazetka.address=vm.setAddress(vm.representant.address)}},vm.changeBackground=function(_id){void 0!==vm.gazetka.backgrounds[vm.currentPage]?vm.gazetka.backgrounds[vm.currentPage]=vm.findArrayIndexBackgrounds(_id):vm.gazetka.backgrounds.push(vm.findArrayIndexBackgrounds(_id)),vm.setBackgroundUrl(vm.currentPage,"generator")},vm.prevUnit=function(_id){vm.currentLayouts[vm.currentPage][_id]>0&&vm.currentLayouts[vm.currentPage][_id]--},vm.nextUnit=function(_id){vm.currentLayouts[vm.currentPage][_id]<vm.gazetka.pages[vm.currentPage].units[_id].layouts.length-1&&vm.currentLayouts[vm.currentPage][_id]++},vm.prevPage=function(){vm.currentPage>0&&(vm.currentPage--,vm.setBackgroundUrl(vm.currentPage,"generator"))},vm.nextPage=function(){vm.currentPage<vm.gazetka.pages.length-1&&(vm.currentPage++,vm.setBackgroundUrl(vm.currentPage,"generator"))},vm.prevPreviewPage=function(){vm.currentPreviewPage>0&&(vm.currentPreviewPage--,vm.setBackgroundUrl(vm.currentPreviewPage,"preview"))},vm.nextPreviewPage=function(){vm.currentPreviewPage<vm.currentLayouts.length-1&&(vm.currentPreviewPage++,vm.setBackgroundUrl(vm.currentPreviewPage,"preview"))},vm.selectDrugstore=function(_id){var index=vm.gazetka.drugstores.indexOf(_id);index!==-1?vm.gazetka.drugstores.splice(index,1):vm.gazetka.drugstores.push(_id)},vm.setAddress=function(_address){return _address?(_address.country?_address.country.name+"\n":"")+(_address.region?_address.region.name+"\n":"")+(_address.city?_address.city.name+"\n":"")+(_address.address_line_1?_address.address_line_1:""):"Address not found."},vm.findDrugstore=function(_id){for(var i in vm.drugstores)if(vm.drugstores[i].id==_id)return vm.drugstores[i];return!1},vm.send=function(){console.log(vm.gazetka)},vm.preview=function(){vm.currentPreviewPage=0,vm.setBackgroundUrl(vm.currentPreviewPage,"preview"),$("#previewModalForm").modal("show")},vm.prevLogo=function(){vm.gazetka.logo>0&&vm.gazetka.logo--},vm.nextLogo=function(){vm.logo.length-1>vm.gazetka.logo&&vm.gazetka.logo++},vm.setCurrentLayouts=function(_id){for(var layouts=[],j=0;j<vm.gazetka.pages[_id].units.length;j++)layouts.push(0);return layouts},vm.setBackgroundUrl=function(_currentPage,_type){switch(_type){case"generator":vm.backgroundUrl=null!==vm.gazetka.backgrounds[_currentPage]&&vm.gazetka.pages[_currentPage].backgrounds[vm.gazetka.backgrounds[_currentPage]]?vm.gazetkaBackgroundsPath+vm.gazetka.pages[_currentPage].backgrounds[vm.gazetka.backgrounds[_currentPage]].name:"";break;case"preview":vm.prewiewBackgroundUrl=null!==vm.gazetka.backgrounds[_currentPage]&&vm.gazetka.pages[_currentPage].backgrounds[vm.gazetka.backgrounds[_currentPage]]?vm.gazetkaBackgroundsPath+vm.gazetka.pages[_currentPage].backgrounds[vm.gazetka.backgrounds[_currentPage]].name:""}},vm.store=function(){var data=clone(vm.gazetka);data.pages=JSON.stringify(vm.currentLayouts),data.currentDrugstore=vm.currentDrugstoreId,data.campaignId=vm.campaignId,data.backgrounds=JSON.stringify(data.backgrounds),data.price=data.price?1:0,data.printing=data.printing.current,dataservice.tenant.store("gazetki",data).then(function(data){logger.info("Gazetka data has been successfully saved."),notifier.success("Sukces","Gazetka data has been successfully saved."),$state.go("gazetki.edit",{id:data.last_insert_id,drugstoreId:vm.currentDrugstoreId})})},activate()}angular.module("app.gazetki").controller("GazetkiCreateController",GazetkiCreateController),GazetkiCreateController.$inject=["$scope","$http","$state","dataservice","logger","principal","IMAGES_PATH","notifier"]}(),function(){"use strict";function GazetkiEditController($scope,$http,$state,dataservice,logger,principal,IMAGES_PATH,notifier){function activate(){vm._id=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,vm.currentDrugstoreId=$state.params.hasOwnProperty("drugstoreId")?parseInt($state.params.drugstoreId):-1,showDimmer(),dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("gazetki-edit",vm._id).then(function(data){principal.identity(!1,"mobile").then(function(identity){vm.representant=identity,dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns","show/"+data.campaign.id+"/staff/"+vm.representant.id).then(function(drugstoresData){for(var i in drugstoresData.resource.drugstores)drugstoresData.resource.drugstores[i].id==vm.currentDrugstoreId&&(vm.currentDrugstore=drugstoresData.resource.drugstores[i]);for(i in drugstoresData.resource.drugstores.length)vm.currentDrugstore.drugstores_network_id==drugstoresData.resource.drugstores[i].drugstores_network_id&&vm.drugstores.push(drugstoresData.resource.drugstores[i]);for(vm.selectedDrugstores=data.resource.drugstores,vm.currentLayouts=JSON.parse(data.resource.pages),vm.gazetka=data.resource,vm.gazetka.backgrounds=JSON.parse(data.resource.backgrounds),vm.gazetka.date=new Date(data.resource.date),vm.logo=JSON.parse(data.definition.logo),vm.haslo=JSON.parse(data.definition.haslo),vm.gazetka.drugstores=[],i=0;i<vm.selectedDrugstores.length;i++)vm.selectDrugstore(vm.selectedDrugstores[i].id);for(vm.gazetka.pages=[],i=0;i<data.pages.length;i++)vm.gazetka.pages.push({id:data.pages[i].id,backgrounds:JSON.parse(data.pages[i].backgrounds),units:JSON.parse(data.pages[i].template),graphicalSample:data.pages[i].graphical_sample});for(i=vm.currentLayouts.length;i<vm.gazetka.pages.length;i++)vm.currentLayouts.push(vm.setCurrentLayouts(i));for(i=vm.gazetka.backgrounds.length;i<vm.gazetka.pages.length;i++)vm.gazetka.backgrounds.push(null);vm.gazetka.printing={min:drugstoresData.resource.min_gazetki_printing_amount,current:data.resource.printing,max:drugstoresData.resource.max_gazetki_printing_amount},vm.changeAddresser(),vm.setBackgroundUrl(vm.currentPage,"generator"),hideDimmer()})})})}function clone(obj){if(null===obj||"object"!=typeof obj)return obj;var copy=obj.constructor();for(var attr in obj)obj.hasOwnProperty(attr)&&(copy[attr]=obj[attr]);return copy}var vm=this;vm._id=0,vm.gazetka={},vm.gazetka.pages=[],vm.gazetka.drugstores=[],vm.gazetka.addresser="1",vm.gazetka.drugstoresList=[],vm.representant={},vm.currentPage=0,vm.currentPreviewPage=0,vm.currentLayouts=[],vm.addresses=[],vm.drugstores=[],vm.gazetkaUploadsImagesPath=IMAGES_PATH+"gazetka/",vm.logoPath=vm.gazetkaUploadsImagesPath+"logo/",vm.unitsImagesPath=vm.gazetkaUploadsImagesPath+"units/",vm.gazetkaBackgroundsPath=IMAGES_PATH+"gazetki-images/backgrounds/",vm.templates=["app/gazetki/templates/tlo1_3moduly.html","app/gazetki/templates/tlo1_4moduly.html","app/gazetki/templates/tlo1_5moduly.html","app/gazetki/templates/tlo1_6moduly.html"],vm.previewTemplates=["app/gazetki/templates/previewTemplates/tlo1_3moduly.html","app/gazetki/templates/previewTemplates/tlo1_4moduly.html","app/gazetki/templates/previewTemplates/tlo1_5moduly.html","app/gazetki/templates/previewTemplates/tlo1_6moduly.html"],vm.cancelGazetkaSave=function(){$state.go("gazetki.list")},vm.findArrayIndexBackgrounds=function(_id){for(var i=0;i<vm.gazetka.pages[vm.currentPage].backgrounds.length;i++)if(_id==vm.gazetka.pages[vm.currentPage].backgrounds[i].id)return i},vm.findMainOffice=function(){for(var i=0;i<vm.drugstores.length;i++)if(vm.drugstores[i].negotiation_point)return vm.drugstores[i];return vm.currentDrugstore},vm.changeBackground=function(_id){void 0!==vm.gazetka.backgrounds[vm.currentPage]?vm.gazetka.backgrounds[vm.currentPage]=vm.findArrayIndexBackgrounds(_id):vm.gazetka.backgrounds.push(vm.findArrayIndexBackgrounds(_id)),vm.setBackgroundUrl(vm.currentPage,"generator")},vm.prevUnit=function(_id){vm.currentLayouts[vm.currentPage][_id]>0&&vm.currentLayouts[vm.currentPage][_id]--},vm.nextUnit=function(_id){vm.currentLayouts[vm.currentPage][_id]<vm.gazetka.pages[vm.currentPage].units[_id].layouts.length-1&&vm.currentLayouts[vm.currentPage][_id]++},vm.prevPage=function(){vm.currentPage>0&&(vm.currentPage--,vm.setBackgroundUrl(vm.currentPage,"generator"))},vm.nextPage=function(){vm.currentPage<vm.gazetka.pages.length-1&&(vm.currentPage++,vm.setBackgroundUrl(vm.currentPage,"generator"))},vm.prevPreviewPage=function(){vm.currentPreviewPage>0&&(vm.currentPreviewPage--,vm.setBackgroundUrl(vm.currentPreviewPage,"preview"))},vm.nextPreviewPage=function(){vm.currentPreviewPage<vm.currentLayouts.length-1&&(vm.currentPreviewPage++,vm.setBackgroundUrl(vm.currentPreviewPage,"preview"))},vm.changeAddresser=function(){var mainOffice={};switch(vm.gazetka.drugstoresList=[],vm.gazetka.address="",vm.gazetka.addresser+="",vm.gazetka.addresser){case"1":mainOffice=vm.findMainOffice(),vm.gazetka.address=vm.setAddress(mainOffice.address),vm.gazetka.drugstoresList=[mainOffice],vm.gazetka.drugstores=[],vm.selectDrugstore(mainOffice.id);break;case"2":mainOffice=vm.findMainOffice(),vm.gazetka.address=vm.setAddress(mainOffice.address),vm.gazetka.drugstoresList=vm.drugstores,vm.gazetka.drugstores=[];for(var i=0;i<vm.gazetka.drugstoresList.length;i++)vm.selectDrugstore(vm.gazetka.drugstoresList[i].id);break;case"3":vm.gazetka.address="",vm.gazetka.drugstores=[],vm.gazetka.address=vm.setAddress(vm.representant.address)}},vm.selectDrugstore=function(_id){var index=vm.gazetka.drugstores.indexOf(_id);index!==-1?vm.gazetka.drugstores.splice(index,1):vm.gazetka.drugstores.push(_id)},vm.setAddress=function(_address){return _address?(_address.country?_address.country.name+"\n":"")+(_address.region?_address.region.name+"\n":"")+(_address.city?_address.city.name+"\n":"")+(_address.address_line_1?_address.address_line_1:""):"Address not found."},vm.findDrugstore=function(_id){for(var i=0;i<vm.drugstores.length;i++)if(vm.drugstores[i].id==_id)return vm.drugstores[i];return!1},vm.send=function(){console.log(vm.gazetka)},vm.preview=function(){vm.currentPreviewPage=0,vm.setBackgroundUrl(vm.currentPreviewPage,"preview"),$("#previewModalForm").modal("show")},vm.store=function(){var data=clone(vm.gazetka);data.pages=JSON.stringify(vm.currentLayouts),data.currentDrugstore=vm.currentDrugstore,data.campaignId=vm.campaignId,data.backgrounds=JSON.stringify(data.backgrounds),data.printing=data.printing.current,dataservice.tenant.update("gazetki",vm._id,data).then(function(data){logger.info("Gazetka data has been successfully saved."),notifier.success("Sukces","Gazetka data has been successfully saved.")})},vm.setCurrentLayouts=function(_id){for(var layouts=[],j=0;j<vm.gazetka.pages[_id].units.length;j++)layouts.push(0);return layouts},vm.prevLogo=function(){vm.gazetka.logo>0&&vm.gazetka.logo--},vm.nextLogo=function(){vm.logo.length-1>vm.gazetka.logo&&vm.gazetka.logo++},vm.setBackgroundUrl=function(_currentPage,_type){switch(_type){case"generator":vm.backgroundUrl=null!==vm.gazetka.backgrounds[_currentPage]&&vm.gazetka.pages[_currentPage].backgrounds[vm.gazetka.backgrounds[_currentPage]]?vm.gazetkaBackgroundsPath+vm.gazetka.pages[_currentPage].backgrounds[vm.gazetka.backgrounds[_currentPage]].name:"";break;case"preview":vm.prewiewBackgroundUrl=null!==vm.gazetka.backgrounds[_currentPage]&&vm.gazetka.pages[_currentPage].backgrounds[vm.gazetka.backgrounds[_currentPage]]?vm.gazetkaBackgroundsPath+vm.gazetka.pages[_currentPage].backgrounds[vm.gazetka.backgrounds[_currentPage]].name:""}},activate()}angular.module("app.gazetki").controller("GazetkiEditController",GazetkiEditController),GazetkiEditController.$inject=["$scope","$http","$state","dataservice","logger","principal","IMAGES_PATH","notifier"]}(),function(){"use strict";function GazetkiFilterController($rootScope,$state,$filter,gazetkiDataservice,$sessionStorage,stepsService,notifier,TEXT_MESSAGE,PAGING){function activate(){var userId=null,isPaging=PAGING.APPLY;showDimmer(),vm.campaignId=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,vm.rightsName=$state.params.hasOwnProperty("rights")?$state.params.rights:"",vm.pagingLimit=PAGING.ITEMS_ON_PAGE,$rootScope.subtitle="List page",vm.sort={column:["drugstores_network.name","drugstores_network.id","-negotiation_point"],descending:!1,"class":"ascending"},vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.drugstores=[],vm.isManager=$sessionStorage.isManager||!1,vm.userData&&(userId=vm.userData.id),vm.stepColors=["green","lightgreen","greenwarning","marine","yellow","red"],vm.selectedColor="",vm.selectedStep="",vm.activeColorRights={visit:"my"==vm.rightsName?"marine":"",management:"observed"==vm.rightsName?"marine":""},vm.selectedStaff=null,vm.isManager&&(vm.listStaff={},vm.listDrugstores={},$sessionStorage.listStaff&&$sessionStorage.listDrugstores?(vm.listStaff=$sessionStorage.listStaff,vm.listDrugstores=$sessionStorage.listDrugstores):setStaffForDrugstores(userId));var currentPage=1;setCampaigns(currentPage,userId),gazetkiDataservice.getOptimizedCampaignDataset(vm.campaignId,userId).then(function(res){gazetkiDataservice.getCampaignFiltered(vm.campaignId,userId,!0).then(function(campaignResource){var campaigns_selling;vm.campaign=campaignResource.resource,campaigns_selling=campaignResource.campaigns_selling,angular.isArray(vm.campaign.drugstores_with_address)||(vm.campaign.drugstores_with_address=Object.keys(campaign.drugstores).map(function(key){return campaign.drugstores[key]})),vm.searchArrFields=["identifier","name","drugstores_network.name","addressLine1","cityName"],vm.activeColor=[],vm.activeColor[vm.campaignId]="",vm.activeCampaign=vm.campaign,vm.activeCampaign.steps=stepsService.getSteps(vm.activeCampaign.definition),vm.activeColor[vm.activeCampaign.id]="orange",hideDimmer();var campaignProgress;vm.activeCampaign.drugstores_with_address.groupBy(function(o){return campaignProgress=null,o.drugstores_network_id}).forEach(function(el,index){var networkId=el.key,networkDrugstores=el.group,stepStatuses=null,statuses={};networkDrugstores=order(networkDrugstores,"negotiation_point"),networkDrugstores.forEach(function(drugstore){drugstore.campaignId=vm.campaignId;var in_filter=!0;in_filter&&(drugstore.addressLine1=drugstore.address?drugstore.address.address_line_1:"",drugstore.zip=drugstore.address?drugstore.address.zip:"",drugstore.cityName=drugstore.address&&drugstore.address.city&&drugstore.address.city.name?drugstore.address.city.name:"",networkId&&(stepStatuses=stepsService.getStepsStatuses(drugstore.id,vm.campaignId),"{}"!=stepStatuses&&(statuses=stepStatuses),"{}"!=statuses&&stepsService.setStepsStatuses(drugstore.id,vm.campaignId,statuses)),(networkId&&drugstore.negotiation_point||!networkId)&&(campaignProgress=stepsService.getDrugstoresStepsStatuses(drugstore.id,vm.campaignId)),drugstore.isBlocked=stepsService.checkDrugstoreBlockProperty(drugstore.id,vm.campaignId,drugstore.metadata,campaigns_selling),drugstore.campaignDateEnd=campaignProgress&&campaignProgress.progress_info&&campaignProgress.progress_info.cycle_end?calcTime(campaignProgress.progress_info.cycle_end,!0):calcTime(vm.activeCampaign.date_end,!0),vm.drugstores.push(drugstore))})}),vm.pagingLimit=isPaging&&PAGING.ITEMS_ON_PAGE<vm.drugstores.length?PAGING.ITEMS_ON_PAGE:vm.drugstores.length})},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function getCopyDrugstores(){return angular.copy(vm.drugstores)}function order(arr,predicate){var orderBy=$filter("orderBy");return orderBy(arr,predicate,!0)}function setStaffForDrugstores(userId){gazetkiDataservice.getStaffJobsByDrugstores(userId).then(function(staffDrugstores){staffDrugstores.staff&&(vm.listStaff=staffDrugstores.staff,$sessionStorage.listStaff=vm.listStaff),staffDrugstores.drugstores&&(vm.listDrugstores=staffDrugstores.drugstores,$sessionStorage.listDrugstores=vm.listDrugstores)})}function setCampaigns(currentPage,userId){$sessionStorage.selectedCampaigns?(vm.campaigns=$sessionStorage.selectedCampaigns,vm.indexCampaign=vm.campaigns.findIndex(function(campaign){return campaign.id==vm.campaignId})):getCampaigns(currentPage,userId).then(function(campaigns){vm.campaigns=campaigns.filter(function(campaign,index){return campaign.id==vm.campaignId&&(vm.indexCampaign=index),campaign.icon=stepsService.getCampaignIcon(campaign.definition),!campaign.archived})},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function getCampaigns(currentPage,userDataId){return vm.isManager?gazetkiDataservice.getCampaignsWithDrugstoresQuicklyFilteredByStaffAndPromoline(currentPage,userDataId):gazetkiDataservice.getCampaignsQuicklyFilteredByStaffAndPromoline(currentPage,userDataId)}var vm=this;vm.selectDrugstore=function(drugstoreId){$state.go("clients.card",{id:drugstoreId})},vm.filterByCampaign=function(campaignId){vm.activeColor[campaignId]?vm.clearFilter():$state.go("gazetki.filter",{id:campaignId})},vm.filterByRights=function(rightsName){vm.activeColorRights.visit&&"my"==rightsName||vm.activeColorRights.management&&"observed"==rightsName?$state.go("gazetki.filter",{id:vm.campaignId}):$state.go("gazetki.filter_rights",{id:vm.campaignId,rights:rightsName})},vm.clearFilter=function(){$state.go("gazetki.list")},vm.changeSorting=function(column){var condition,sort=vm.sort;sort["class"]="",condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition?(sort.descending=!sort.descending,sort["class"]=sort.descending?"descending":"ascending"):(sort.column=column,sort.descending=!1,sort["class"]="")},vm.sortingClass=function(column){var condition,sort=vm.sort;return sort["class"]="",condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition&&(sort["class"]=sort.descending?"descending":"ascending"),sort["class"]},vm.changeStaff=function(){var drugstores=[];vm.drugstoresCopy||(vm.drugstoresCopy=getCopyDrugstores()),drugstores="0"!=vm.selectedStaff?vm.drugstoresCopy.filter(function(drugstore){return vm.listStaff[vm.selectedStaff].drugstoresIds.indexOf(drugstore.id)>-1}):vm.drugstoresCopy,vm.drugstores=drugstores},vm.loadMore=function(){vm.pagingLimit+=PAGING.ITEMS_INCREMENT,vm.drugstores&&vm.pagingLimit>vm.drugstores.length&&(vm.pagingLimit=vm.drugstores.length)},vm.selectColor=function(stepName,color){vm.selectedColor=color,vm.selectedStep=stepName,""===vm.selectedColor&&""===vm.selectedStep&&($sessionStorage.stepFilter=null)},vm.setClassButton=function(stepName){var res="";return vm.selectedStep&&vm.selectedColor&&stepName==vm.selectedStep&&(res=vm.selectedColor),res},vm.isGazetkaDefined=function(_drugstoreId){for(var i=0;i<vm.campaign.gazetki.length;i++)if(vm.campaign.gazetki[i].drugstore_id==_drugstoreId)return!0;return!1},vm.selectGazetki=function(campaignId,drugstoreId){if(vm.isGazetkaDefined(drugstoreId)){for(var gazetkaId,i=0;i<vm.campaign.gazetki.length;i++)vm.campaign.gazetki[i].drugstore_id==drugstoreId&&(gazetkaId=vm.campaign.gazetki[i].id);$state.go("gazetki.edit",{id:gazetkaId,drugstoreId:drugstoreId})}else $state.go("gazetki.create",{campaignId:campaignId,drugstoreId:drugstoreId})},activate()}angular.module("app.gazetki").controller("GazetkiFilterController",GazetkiFilterController),GazetkiFilterController.$inject=["$rootScope","$state","$filter","gazetkiDataservice","$sessionStorage","stepsService","notifier","TEXT_MESSAGE","PAGING"]}(),function(){"use strict";function GazetkiListController($rootScope,$scope,$state,gazetkiDataservice,stepsService,$sessionStorage,notifier,TEXT_MESSAGE,PAGING){function activate(){var userId=null,isPaging=PAGING.APPLY;showDimmer(),$rootScope.subtitle="List page",vm.rightsName=$state.params.hasOwnProperty("rights")?$state.params.rights:"",vm.pagingLimit=PAGING.ITEMS_ON_PAGE,vm.campaigns=[],vm.sort={column:["drugstores_network.name","drugstores_network.id","-negotiation_point"],descending:!1,"class":"ascending"},vm.colorRights={visit:"my"==vm.rightsName?"marine":"",management:"observed"==vm.rightsName?"marine":""},vm.sortingCampaign={},vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.isManager=$sessionStorage.isManager||!1,vm.userData&&(userId=vm.userData.id),vm.selectedStaff=null,gazetkiDataservice.getDrugstoresWithCampaignsByStaff(userId).then(function(resource){var drugstores=resource.drugstores;vm.campaigns=resource.campaigns.filter(function(campaign){return!campaign.archived}),vm.rightsName?vm.drugstores=drugstores.filter(function(drugstore){var arrRights=drugstore.job_duties.split(","),in_filter=!1;return"my"==vm.rightsName?in_filter=vm.isManager?arrRights.indexOf("[2]")!=-1:arrRights.indexOf("[4]")!=-1||arrRights.indexOf("[5]")!=-1:"observed"===vm.rightsName&&(in_filter=arrRights.indexOf("[3]")!=-1),in_filter}):vm.drugstores=drugstores,hideDimmer(),vm.searchArrFields=["identifier","name","drugstores_network.name","address.address_line_1","address.city.name"],vm.pagingLimit=isPaging&&PAGING.ITEMS_ON_PAGE<vm.drugstores.length?PAGING.ITEMS_ON_PAGE:vm.drugstores.length,setDrugstoresCampaigns(),$sessionStorage.selectedCampaigns=vm.campaigns,vm.isManager&&(vm.listStaff={},vm.listDrugstores={},$sessionStorage.listStaff&&$sessionStorage.listDrugstores?(vm.listStaff=$sessionStorage.listStaff,vm.listDrugstores=$sessionStorage.listDrugstores):setStaffForDrugstores(userId))},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function setDrugstoresCampaigns(){vm.drugstores.forEach(function(drugstore){var arrCampaignIds=drugstore.campaignids.split(",");drugstore.campaigns=vm.campaigns.filter(function(campaign){return arrCampaignIds.indexOf(campaign.id.toString())!=-1})})}function getCopyDrugstores(){return cloneObj(vm.drugstores)}function setStaffForDrugstores(userId){gazetkiDataservice.getStaffJobsByDrugstores(userId).then(function(staffDrugstores){staffDrugstores.staff&&(vm.listStaff=staffDrugstores.staff,$sessionStorage.listStaff=vm.listStaff),staffDrugstores.drugstores&&(vm.listDrugstores=staffDrugstores.drugstores,$sessionStorage.listDrugstores=vm.listDrugstores)})}var vm=this;vm.selectDrugstore=function(drugstoreId){$state.go("clients.card",{id:drugstoreId})},vm.filterByCampaign=function(campaignId){$state.go("gazetki.filter",{id:campaignId})},vm.selectCampaign=function(campaignId){$state.go("campaigns.main",{id:campaignId})},vm.addDrugstore=function(){$state.go("gazetki.mainInfoCreate")},vm.changeSortingCampaigns=function(campaign){vm.sortingCampaign=campaign,vm.sort.column="",vm.sort.descending=!1,vm.sort["class"]=""},vm.changeSorting=function(column){var condition,sort=vm.sort;sort["class"]="",vm.sortingCampaign={},condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition?(sort.descending=!sort.descending,sort["class"]=sort.descending?"descending":"ascending"):(sort.column=column,sort.descending=!1,sort["class"]="")},vm.sortingClass=function(column){var condition,sort=vm.sort;return sort["class"]="",condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition&&(sort["class"]=sort.descending?"descending":"ascending"),sort["class"]},vm.changeStaff=function(){var drugstores=[];vm.drugstoresCopy||(vm.drugstoresCopy=getCopyDrugstores()),drugstores=vm.selectedStaff?vm.drugstoresCopy.filter(function(drugstore){return vm.listStaff[vm.selectedStaff].drugstoresIds.indexOf(drugstore.id)>-1}):vm.drugstoresCopy,vm.drugstores=drugstores},vm.loadMore=function(){vm.pagingLimit+=PAGING.ITEMS_INCREMENT,vm.drugstores&&vm.pagingLimit>vm.drugstores.length&&(vm.pagingLimit=vm.drugstores.length)},vm.filterByRights=function(rightsName){vm.colorRights.visit&&"my"==rightsName||vm.colorRights.management&&"observed"==rightsName?$state.go("gazetki.list",{id:vm.campaignId}):$state.go("gazetki.list_rights",{id:vm.campaignId,rights:rightsName})},activate()}angular.module("app.gazetki").controller("GazetkiListController",GazetkiListController).filter("sortingCampaigns",[function(){return function(drugstores,campaign){
if(drugstores){if(!Object.keys(campaign).length)return drugstores;var tempDrugstores=[],tempNotFind=[];return angular.forEach(drugstores,function(drugstore){var findNeed=getObjectByKey(drugstore.campaigns,"id",campaign.id);findNeed.length?tempDrugstores.push(drugstore):tempNotFind.push(drugstore)}),tempDrugstores=tempDrugstores.concat(tempNotFind)}}}]).filter("selectedJobDuties",[function(){return function(objStaff,userData){if(objStaff){var tempStaff={};return angular.forEach(objStaff,function(value,key){(value.job_duties.indexOf("[4]")>-1||value.job_duties.indexOf("[5]")>-1||userData.id==key)&&(tempStaff[key]=value)}),tempStaff}return!1}}]),GazetkiListController.$inject=["$rootScope","$scope","$state","gazetkiDataservice","stepsService","$sessionStorage","notifier","TEXT_MESSAGE","PAGING"]}(),function(){"use strict";function gazetkiDataservice($rootScope,$state,dataservice,$sessionStorage,$q,principal){function getDrugstoresWithCampaignsByStaff(staffUid){if(_cache.drugstoresByStaff){var defer=$q.defer();return defer.resolve(_cache.drugstoresByStaff),defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("gazetki","list/"+staffUid).then(function(data){var result=data.plain();return _cache.drugstoresByStaff=result,result})}function getCampaignFiltered(campaignId,uid,cached){if(cached){var defer=$q.defer();return defer.resolve({resource:_cache.campaignDataset.campaign}),defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("gazetki-filter","campaign/"+campaignId+"/staff/"+uid).then(function(data){return data})}function getOptimizedCampaignDataset(campaignId,staffId){var defer=$q.defer();return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("gazetki","filter/campaign/"+campaignId+"/staff/"+staffId).then(function(res){_cache.campaignDataset=res.plain(),defer.resolve("OK")}),defer.promise}function getStaffJobsByDrugstores(userId){if($sessionStorage.hasOwnProperty("staffJobs")&&$sessionStorage.staffJobs.length>0){var staffJobs,defer=$q.defer();try{staffJobs=JSON.parse($sessionStorage.staffJobs),defer.resolve(_getStaffJobs(userId,staffJobs))}catch(e){defer.reject("Can not fetch staff_jobs")}return defer.promise}return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("staff-drugstores","search-by-drugstores",{timeout:1e3,cache:!1}).then(function(staffJobs){return $sessionStorage.staffJobs=JSON.stringify(staffJobs),_getStaffJobs(userId,staffJobs)})}function _getStaffJobs(userId,staffJobs){var staff={},needDrugstores=[],staffDrugstores={};return userId&&staffJobs.staff[userId]&&(needDrugstores=staffJobs.staff[userId].drugstoresIds),staffJobs.drugstores&&staffJobs.staff&&(needDrugstores.length?needDrugstores.forEach(function(el){staffJobs.drugstores[el]&&(staffDrugstores[el]=staffJobs.drugstores[el])}):staffDrugstores=staffJobs.drugstores,angular.forEach(staffDrugstores,function(drugstore){drugstore.staff.forEach(function(person){var job_duties=person.job_duties.split(",");staffJobs.staff[person.staff_id]&&(staff[person.staff_id]=staffJobs.staff[person.staff_id],staff[person.staff_id].job_duties||(staff[person.staff_id].job_duties=[]),staff[person.staff_id].job_duties=staff[person.staff_id].job_duties.concat(job_duties).unique())})})),{staff:staff,drugstores:staffDrugstores}}var _cache={};return $rootScope.$on("stateReload",function(event,data){_cache={}}),{getOptimizedCampaignDataset:getOptimizedCampaignDataset,getDrugstoresWithCampaignsByStaff:getDrugstoresWithCampaignsByStaff,getCampaignFiltered:getCampaignFiltered,getStaffJobsByDrugstores:getStaffJobsByDrugstores}}angular.module("app.campaigns").factory("gazetkiDataservice",gazetkiDataservice),gazetkiDataservice.$inject=["$rootScope","$state","dataservice","$sessionStorage","$q","principal"]}(),function(){"use strict";function customLoader($timeout,languages){return function(options){return $timeout(function(){return JSON.parse(languages.get(options.key))},0)}}var i18n=angular.module("app.i18n");i18n.config(function($translateProvider){$translateProvider.useSanitizeValueStrategy(null),$translateProvider.useLoader("customLoader",{}),$translateProvider.preferredLanguage="en"}),i18n.factory("customLoader",customLoader),customLoader.$inject=["$timeout","languages"]}(),function(){"use strict";function layoutHeader(){function LayoutHeaderController($rootScope,$scope,authorization,$state,principal,$sessionStorage,$localStorage,clientsDataservice,notifier,$window,TEXT_MESSAGE,geolocation){function isManager(){var jobDuties=userData.jobDuties||[],result=jobDuties.find(function(duty){var checkDuties=[2,3];return checkDuties.indexOf(duty.level)>-1});$sessionStorage.isManager=angular.isDefined(result)}function initEventValues(){var now=new Date,date_start=new Date(now.getFullYear(),now.getMonth(),now.getDate()),date_end=new Date(now.getFullYear(),now.getMonth(),now.getDate()),time_start=new Date(1970,0,1,now.getHours(),now.getMinutes(),0),time_end=new Date(1970,0,1,now.getHours()+1,now.getMinutes(),0);vm.eventId=0,vm.note={user_id:0,title:"",description:"",date_start:date_start,time_start:time_start,date_end:date_end,time_end:time_end,allDay:!1,repeat:!1,repeat_days:""}}var vm=this;vm.currentTenant=JSON.parse($sessionStorage.currentTenant),vm.principal={};var userData=JSON.parse($sessionStorage._identity);vm.principalName=userData.login,isManager(),vm.url="",vm.currentPage={},vm.starClass="empty",principal.identity(!1,"mobile").then(function(identity){vm.principal=identity,vm.todo_count=vm.principal.todo_count}),vm.logout=function(){$sessionStorage.listStaff=null,$sessionStorage.listDrugstores=null,$sessionStorage.isManager=null,$rootScope.$emit("stateReload"),principal.getGeolocationIsOn()&&geolocation.stopGeolocation(),authorization.logout()},vm.headerLinks={dashboard:{state:"dashboard.main"},profile:{state:"profile.main"}},$rootScope.breadcrumbTitle="",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="",$rootScope.$on("changeTodo",function(event,data){vm.todo_count=data}),vm.showBookmark=function(){$("#editBookmarkModal").modal("show")},vm.saveBookmark=function(){vm.url&&vm.currentPage[vm.url]&&($localStorage[vm.principal.id]||($localStorage[vm.principal.id]={},$localStorage[vm.principal.id].urls={}),$localStorage[vm.principal.id].urls[vm.url]={label:vm.currentPage[vm.url],state:$state.current.name,params:$state.params},vm.starClass="",$scope.$emit("changeBookMark"))},vm.deleteBookmark=function(){vm.url&&$localStorage[vm.principal.id].urls[vm.url]&&(delete $localStorage[vm.principal.id].urls[vm.url],vm.starClass="empty",$scope.$emit("changeBookMark"),$("#editBookmarkModal").modal("hide"))},vm.showAddEvent=function(){initEventValues(),angular.element("#addEventModal").modal("show")},vm.saveCalendarEvent=function(){var event={id:vm.note.id||0,user_id:vm.principal.id,title:vm.note.title,description:vm.note.description,all_day:vm.note.allDay,repeat:!1,date_start:new Date(vm.note.date_start.getFullYear(),vm.note.date_start.getMonth(),vm.note.date_start.getDate(),vm.note.time_start.getHours(),vm.note.time_start.getMinutes()),date_end:new Date(vm.note.date_end.getFullYear(),vm.note.date_end.getMonth(),vm.note.date_end.getDate(),vm.note.time_end.getHours(),vm.note.time_end.getMinutes()),repeat_days:""};clientsDataservice.saveEventCalendar(event).then(function(data){data.length&&notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_EVENT_SAVED)},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.refresh=function(){$rootScope.serviceControl?$window.location.reload():($state.go($state.current,$state.params,{reload:!0,inherit:!0,notify:!0}),$rootScope.$emit("stateReload"))},vm.go=function(state){$state.go(state)},$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){hideDimmer()}),treatBackButton($rootScope,vm,$state,$localStorage)}var directive;directive={bindToController:!0,controller:LayoutHeaderController,controllerAs:"vm",restrict:"EA",scope:{},templateUrl:"app/layout/layout.header.html"},LayoutHeaderController.$inject=["$rootScope","$scope","authorization","$state","principal","$sessionStorage","$localStorage","clientsDataservice","notifier","$window","TEXT_MESSAGE","geolocation"];var treatBackButton=function($rootScope,vm,$state,$localStorage){var traversedPathKeys=$rootScope.traversedPath?Object.keys($rootScope.traversedPath):[];$rootScope.$on("$stateChangeSuccess",function(event,to,toParams,from,fromParams){var statesWithOutBackButton=["dashboard.main","clients.list","campaigns.list","gazetki.list"];vm.url=$state.href($state.current.name,{},{absolute:!1}),vm.currentPage[vm.url]=$state.current.title,vm.starClass="empty",$localStorage[vm.principal.id]&&$localStorage[vm.principal.id].urls&&$localStorage[vm.principal.id].urls[vm.url]&&(vm.currentPage[vm.url]=$localStorage[vm.principal.id].urls[vm.url].label,vm.starClass=""),to.name!=from.name&&(vm.previousState=null,$rootScope.traversedPath||($rootScope.traversedPath={}),statesWithOutBackButton.indexOf(to.name)>-1?($rootScope.traversedPath={},vm.previousState=null):from.name&&($rootScope.traversedPath[to.name]||($rootScope.traversedPath[to.name]={previousState:{name:from.name,params:fromParams}}),vm.previousState=$rootScope.traversedPath[to.name].previousState))}),vm.back=function(){$state.go(vm.previousState.name,vm.previousState.params),delete $rootScope.traversedPath[$state.current.name]},!vm.previousState&&traversedPathKeys.length&&(vm.previousState=$rootScope.traversedPath[traversedPathKeys[traversedPathKeys.length-1]].previousState)};return directive}angular.module("app.layout").directive("layoutHeader",layoutHeader)}(),function(){"use strict";function layoutNavigation(MessagesManager){function LayoutNavigationController($rootScope,principal,$state,$localStorage,$interval,dataservice,ATLAS_MODULES){function getMenuItems(){var menu=[{name:"Home",label:"Home",state:"dashboard.main",icon:"menu-home",children:[]},{name:"Clients",label:"Klienci",state:"clients.list",icon:"menu-clients",children:[]},{name:"Campaigns",label:"Kampanie",state:"campaigns.list",icon:"menu-campaigns",children:[]}];if(ATLAS_MODULES.GAZETKI&&menu.push({name:"Gazetki",label:"Gazetki",state:"gazetki.list",icon:"menu-gazetki",children:[]}),ATLAS_MODULES.DETAILING&&menu.push({name:"Detailing",label:"Detailing",state:"detailing.list({page: 1})",icon:"menu-detailing",children:[]}),vm.budgetModuleIsOn&&"4"==vm.principalJobTitle&&menu.push({name:"Budgeting",label:"Budżet",state:"budgets.main",icon:"",children:[]}),menu.push({name:"Messages",label:"Wiadomości",state:"messages.inbox({page: 1})",icon:"menu-messages",children:[]}),menu.push({name:"Help",label:"Pomoc",state:"messages.supportInbox({page: 1})",icon:"menu-help",children:[]}),vm.principalId&&$localStorage[vm.principalId]&&$localStorage[vm.principalId].urls&&Object.keys($localStorage[vm.principalId].urls).length){menu.push({name:"My Menu",label:"My Menu",state:"mymenu.main",icon:"",children:[]});for(var i in $localStorage[vm.principalId].urls)$localStorage[vm.principalId].urls.hasOwnProperty(i)&&menu[menu.length-1].children.push({label:$localStorage[vm.principalId].urls[i].label,state:$localStorage[vm.principalId].urls[i].state+"("+JSON.stringify($localStorage[vm.principalId].urls[i].params)+")"})}return menu}var vm=this;vm.isActive=function(menuItem){if(menuItem.state.indexOf("messages.help")>-1)return menuItem.state.indexOf("messages.help")>-1&&$state.current.name.indexOf("messages.help")>-1;if($state.current.name.indexOf("messages.help")==-1){var mainPartOfMenuState=menuItem.state.substring(0,menuItem.state.indexOf(".")),mainPartOfCurrentState=$state.current.name.substring(0,$state.current.name.indexOf("."));return mainPartOfMenuState==mainPartOfCurrentState}},vm.principalName=principal.getName(),vm.principalId=principal.getId(),vm.principalJobTitle=principal.getJobTitle(),vm.budgetModuleIsOn=principal.getBudgetModuleIsOn(),vm.menuItems=getMenuItems(),$rootScope.$on("changeBookMark",function(event,data){vm.menuItems=getMenuItems()}),vm.recentMessages=0,vm.recentHelp=0,vm.updateMsgCounter=function(timestamp){MessagesManager.unread("internal").then(function(res){$rootScope.recentMessages=res.count})},vm.updateHelpCounter=function(timestamp){MessagesManager.unread("support").then(function(res){$rootScope.recentHelp=res.count})},MessagesManager.init().then(function(res){var timestamp=(new Date).getTime();"dashboard.main"==$state.current.name&&(vm.updateMsgCounter(timestamp),vm.updateHelpCounter(timestamp)),$rootScope.$on("receivedMainRequest",function(event,data){vm.updateMsgCounter(timestamp),vm.updateHelpCounter(timestamp)})})}var directive;return directive={bindToController:!0,controller:LayoutNavigationController,controllerAs:"vm",restrict:"EA",scope:{},templateUrl:"app/layout/layout.navigation.html"},LayoutNavigationController.$inject=["$rootScope","principal","$state","$localStorage","$interval","dataservice","ATLAS_MODULES"],directive}angular.module("app.layout").directive("layoutNavigation",layoutNavigation),layoutNavigation.$inject=["MessagesManager"]}(),function(){"use strict";function ShellController($timeout,$rootScope,config,logger){function activate(){hideSplash(),$rootScope.assignModuleTranslations("layout")}function hideSplash(){$timeout(function(){vm.showSplash=!1},1e3)}var vm=this;activate()}angular.module("app.layout").controller("ShellController",ShellController),ShellController.$inject=["$timeout","$rootScope","config","logger"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"root",config:{templateUrl:"app/layout/shell.html",controller:"ShellController",controllerAs:"vm",settings:{},resolve:{authorize:["authorization",function(authorization){return!0}]}}}]}angular.module("app.layout").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function MessagesController($rootScope,dataservice,logger){function activate(){vm.subtitle=$rootScope.subtitle,$rootScope.assignModuleTranslations("messaging")}$rootScope.breadcrumbTitle="Messages",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="";var vm=this;vm.title="Messages",activate()}angular.module("app.messaging").controller("MessagesController",MessagesController),MessagesController.$inject=["$rootScope","dataservice","logger"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"messages",config:{parent:"root",templateUrl:"app/messaging/messages.html",controller:"MessagesController",controllerAs:"vm",settings:{}}},{state:"messages.inbox",config:{url:"/messages/inbox/{page:[0-9]{1,8}}",templateUrl:"app/messaging/messages/messages.view.html",controller:"MessagesViewController",controllerAs:"vm",title:"Inbox",data:{roles:[]},settings:{category:"internal",filter:"inbox"}}},{state:"messages.outbox",config:{url:"/messages/outbox/{page:[0-9]{1,8}}",templateUrl:"app/messaging/messages/messages.view.html",controller:"MessagesViewController",controllerAs:"vm",title:"Inbox",data:{roles:[]},settings:{category:"internal",filter:"outbox"}}},{state:"messages.supportInbox",config:{url:"/messages/support-inbox/{page:[0-9]{1,8}}",templateUrl:"app/messaging/messages/messages.view.html",controller:"MessagesViewController",controllerAs:"vm",title:"Inbox",data:{roles:[]},settings:{category:"support",filter:"inbox"}}},{state:"messages.supportOutbox",config:{url:"/messages/support-outbox/{page:[0-9]{1,8}}",templateUrl:"app/messaging/messages/messages.view.html",controller:"MessagesViewController",controllerAs:"vm",title:"Inbox",data:{roles:[]},settings:{category:"support",filter:"outbox"}}}]}angular.module("app.messaging").run(appRun),appRun.$inject=["routerHelper"]}(),function(undefined){"use strict";function MessagesViewController($q,$scope,$rootScope,$translate,notifier,$state,CURRENT_LANGUAGE,MessagesManager,CampaignsProposalContractsManager,FinalReportInvoicesManager,MESSAGE_FILE_PATH,DocumentsWorkflowManager){function initManager(id,docType){var defer=$q.defer(),data={originator:vm.messageMetadata.originator.id,metadata:vm.messageMetadata};return DocumentsWorkflowManager.start(id,docType,data).then(function(res){switch(docType){case"campaign_proposal_contract":CampaignsProposalContractsManager.retrieveInstance(res.id,res).then(function(instance){vm.campaignProposalContract=instance,vm.dwStep=DocumentsWorkflowManager.selectCurrentWorkflowStep().getCurrentStep(),defer.resolve(instance)},function(err){defer.reject(err)});break;case"final_report":FinalReportInvoicesManager.retrieveInstance(res.id,res).then(function(instance){vm.finalReportInvoice=instance,vm.dwStep=DocumentsWorkflowManager.selectCurrentWorkflowStep().getCurrentStep(),defer.resolve(instance)},function(err){defer.reject(err)})}}),defer.promise}function applyStep(decision,data,document){var defer=$q.defer(),rksStatus="accept"==decision?"accepted":"rejected";return DocumentsWorkflowManager.jumpToNextStepOnDecision(decision).then(function(){DocumentsWorkflowManager.executeAction(data).then(function(){DocumentsWorkflowManager.setCampaignStepStatus().then(function(){DocumentsWorkflowManager.jumpToNextStep().then(function(res){DocumentsWorkflowManager.updateDocument(document,rksStatus).then(function(res){DocumentsWorkflowManager.updateMessage(decision,vm.selected).then(function(res){DocumentsWorkflowManager.commit().then(function(res){defer.resolve(res)},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}),defer.promise}function activate(){moment.locale(CURRENT_LANGUAGE),vm.page=$state.params.hasOwnProperty("page")?parseInt($state.params.page):1,vm.tab=$state.current.settings.tab||"inbox",vm.category=$state.current.settings.category||"internal",vm.sortingOrder="-created_at",MessagesManager.init().then(function(identity){showDimmer(),vm.identity=identity,loadMessages(),MessagesManager.getAdressees().then(function(addressees){vm.addressees=addressees;for(var i in addressees)vm.emails[addressees[i].id]=addressees[i].email,vm.tos[addressees[i].id]=addressees[i].first_name+" "+addressees[i].last_name})})}function loadMessages(){vm.messages=[],vm.selected=undefined,MessagesManager[vm.tab](vm.addresseeCategories[vm.tab],vm.senderCategories[vm.tab],[vm.category],vm.page).then(function(res){vm.messages=res,hideDimmer()})}function toggleComposeEmailForm(){vm.showMessagesListSegment=!vm.showMessagesListSegment,vm.showComposeMessageSegment=!vm.showComposeMessageSegment,vm.showComposeMessageSegment&&(vm.isDropdownInit?$(".ui.dropdown").dropdown("restore defaults"):($(".ui.dropdown").dropdown(),vm.isDropdownInit=!0))}function getAttachments(){if(vm.attachfiles)return JSON.stringify({attachments:vm.attachfiles})}var vm=this;vm.tab="",vm.messages=[],vm.addressees=[],vm.emails=[],vm.tos=[],vm.identity=undefined,vm.selected=undefined,vm.campaignProposalContract=undefined,vm.finalReportInvoice=undefined,vm.dwStep=undefined,vm.isReply=!1,vm.addresseeCategories={inbox:["representant"],outbox:["administrator","representant","drugstore_staff"],trash:["administrator","representant","drugstore_staff"]},vm.senderCategories={inbox:["administrator","representant","drugstore_staff"],outbox:["representant"],trash:["administrator","representant","drugstore_staff"]},vm.showMessagesListSegment=!0,vm.showComposeMessageSegment=!1,vm.attachfiles=[],vm.messagesFilter="",vm.messageMetadata={},vm.isDropdownInit=!1,vm.isAllSelected=!1,$scope.loadFile=function(inputData){for(var files=inputData.files,numFiles=files.length,i=0;i<numFiles;i++){var file=files[i],filedata={};filedata.file=file,filedata.name=file.name;var reader=new FileReader;reader.onload=vm.attachFileSrc(filedata),reader.readAsDataURL(file)}},vm.attachFileSrc=function(thisFile){return function(e){thisFile.src=e.target.result,vm.attachfiles.push({name:thisFile.name,src:thisFile.src})}},vm.switchTab=function(tab){vm.tab=tab,vm.messagesFilter="",vm.messages.forEach(function(msg){msg.selected&&(msg.selected=!1)}),vm.showMessagesListSegment=!0,vm.showComposeMessageSegment=!1,loadMessages()},vm.selectMessage=function(id){MessagesManager.fetch(id).then(function(msg){if(msg.attachedFiles=[],msg.attachments&&msg.attachments.split(";").forEach(function(file){msg.attachedFiles.push({filename:file,path:MESSAGE_FILE_PATH+msg.from+"-"+msg.to+"/"+file})}),vm.selected=msg,vm.selected.metadata)try{vm.messageMetadata=JSON.parse(vm.selected.metadata)}catch(e){}"inbox"!=vm.tab||msg.is_read||MessagesManager.markAsRead(msg.id).then(function(res){msg.is_read=!0,"internal"==vm.category?$rootScope.recentMessages--:$rootScope.recentHelp--})})},vm.deleteMessages=function(){var recentMessages,toRemove=[];vm.messages.forEach(function(msg){msg.selected&&(msg.selected=!1,toRemove.push(msg.id),msg.is_read||(msg.is_read=!0,recentMessages++))}),toRemove.length&&MessagesManager.moveToTrash(vm.tab,{ids:toRemove}).then(function(){"internal"==vm.category?$rootScope.recentMessages-=recentMessages:$rootScope.recentHelp-=recentMessages,notifier.success("Sukces","Messages has been removed successfully!"),loadMessages()},function(err){console.log(err),notifier.error("Error","Unable to remove messages!")})},vm.fastReply=function(){$translate(["ORIGINAL_MESSAGE","FROM"]).then(function(translations){vm.isReply=!0,vm.attachfiles=[],vm.composeMessage={to:[vm.selected.from],subject:"Re: "+vm.selected.subject,text:""},toggleComposeEmailForm()})},vm.composeEmail=function(){vm.isReply=!1,vm.attachfiles=[],angular.isObject(vm.composeMessage)?(vm.composeMessage.subject="",vm.composeMessage.text=""):vm.composeMessage={to:undefined,subject:"",text:""},toggleComposeEmailForm()},vm.onFormSubmit=function(){var data={message_category:vm.category,from:vm.identity.id,to:vm.composeMessage.to.shift(),sender_category:"representant",addressee_category:"representant",subject:vm.composeMessage.subject,message:vm.composeMessage.text,is_sent:!0,attachment:getAttachments()};MessagesManager.create(data).then(function(msg){msg.send().then(function(res){notifier.success("Sukces","Wiadomość została pomyślnie wysłana"),toggleComposeEmailForm()},function(err){console.log(err),notifier.error("Error","Unable to send the message!")})})},vm.closeComposeEmailForm=function(){toggleComposeEmailForm()},vm.confirmRepresentantMessage=function(){var messageText;MessagesManager.create({message_category:"internal",from:vm.identity.id,to:0,sender_category:"representant",addressee_category:"administrator",subject:"Confirmation Message",message:"<h2>"+$(".quotMsgTitle").html()+"</h2><div><i>"+$(".quotMsgMeta").html()+"</i></div><div>"+$(".quoteMsg").html()+"</div>",is_sent:!0}).then(function(msg){msg.send().then(function(res){messageText=$(".quoteMsg").html()+'<div class="ui column"><button type="button" class="large ui button"><i class="icon checkmark"></i>Confirmed</button></div>',MessagesManager.update(vm.selected.id,{message:messageText}).then(function(res){notifier.success("Sukces","Wiadomość została pomyślnie wysłana"),$(".sendAdminMessage").hide()},function(err){notifier.error("Error","Unable to update the message!")})},function(err){notifier.error("Error","Unable to send the message!")})})},vm.matchesFilter=function(msg){if(!vm.messagesFilter)return!0;var regexp=new RegExp(vm.messagesFilter,"gi");return msg.sender.first_name.match(regexp)||msg.sender.last_name.match(regexp)||msg.subject.match(regexp)},vm.showAcceptConfirmationWindow=function(){"campaign_proposal_contract"==vm.messageMetadata.document_type?$("#confirmProposalAcceptance").modal("show"):"final_report"==vm.messageMetadata.document_type&&$("#confirmFinalReportAcceptance").modal("show")},vm.showRejectConfirmationWindow=function(){"campaign_proposal_contract"==vm.messageMetadata.document_type?$("#confirmProposalRejection").modal("show"):"final_report"==vm.messageMetadata.document_type&&$("#confirmFinalReportRejection").modal("show")},vm.acceptProposal=function(){initManager(vm.messageMetadata.document_id,"campaign_proposal_contract").then(function(instance){applyStep("accept",undefined,instance).then(function(){vm.statusChanged=!0,$("#confirmProposalAcceptance").modal("hide")})})},vm.rejectProposal=function(){var data={reason_of_reject:vm.reasonOfReject};initManager(vm.messageMetadata.document_id,"campaign_proposal_contract").then(function(instance){applyStep("reject",data,instance).then(function(){vm.statusChanged=!0,$("#confirmProposalRejection").modal("hide")})})},vm.acceptFinalReport=function(){initManager(vm.messageMetadata.document_id,"final_report").then(function(instance){applyStep("accept",undefined,instance).then(function(){vm.statusChanged=!0,$("#confirmFinalReportAcceptance").modal("hide")})})},vm.rejectFinalReport=function(){var data={reason_of_reject:vm.reasonOfReject};initManager(vm.messageMetadata.document_id,"final_report").then(function(instance){applyStep("reject",data,instance).then(function(){vm.statusChanged=!0,$("#confirmFinalReportRejection").modal("hide")})})},vm.toggleSortingOrder=function(){vm.sortingOrder="-created_at"==vm.sortingOrder?"created_at":"-created_at"},vm.toggleSelection=function(){vm.isAllSelected=!vm.isAllSelected,vm.messages.forEach(function(msg){msg.selected=vm.isAllSelected})},vm.showAttachmentModal=function(path){vm.attachmentPath=path,angular.element("#showAttachmentModal").modal("show")},activate()}angular.module("app.messaging").controller("MessagesViewController",MessagesViewController),MessagesViewController.$inject=["$q","$scope","$rootScope","$translate","notifier","$state","CURRENT_LANGUAGE","MessagesManager","CampaignsProposalContractsManager","FinalReportInvoicesManager","MESSAGE_FILE_PATH","DocumentsWorkflowManager"]}(),function(){"use strict";function ProfileCalendarController($rootScope,$scope,$state,principal,$localStorage,clientsDataservice,uiCalendarConfig,notifier){function arrayObjectIndexOf(myArray,searchTerm,property){for(var i=0,len=myArray.length;i<len;i++)if(myArray[i][property]===searchTerm)return i;return-1}function initDaysRepeat(){vm.week_days=[{name:"Son",selected:!1,id:0},{name:"Mon",selected:!1,id:1},{name:"Tue",selected:!1,id:2},{name:"Wed",selected:!1,id:3},{name:"Thu",selected:!1,id:4},{name:"Fri",selected:!1,id:5},{name:"Sat",selected:!1,id:6}]}function initValues(currentDate,newEvent){var now=new Date,date=currentDate?new Date(currentDate):now,date_start=new Date(date.getFullYear(),date.getMonth(),date.getDate()),date_end=new Date(date.getFullYear(),date.getMonth(),date.getDate()),time_start=newEvent?new Date(1970,0,1,now.getHours(),now.getMinutes(),0):new Date(1970,0,1,date.getHours(),date.getMinutes(),0),time_end=newEvent?new Date(1970,0,1,now.getHours()+1,now.getMinutes(),0):new Date(1970,0,1,date.getHours()+1,date.getMinutes(),0);vm.eventId=0,vm.note={user_id:0,title:"",description:"",date_start:date_start,time_start:time_start,date_end:date_end,time_end:time_end,allDay:!1,repeat:!1,repeat_days:""}}function setCalendar(){vm.uiConfig={calendar:{height:650,editable:!0,firstDay:1,lang:"pl",dayNames:["niedziela","poniedziałek","wtorek","środa","czwartek","piątek","sobota"],dayNamesShort:["nie","pon","wt","śr","czw","pt","sb"],monthNames:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],monthNamesShort:["sty","lut","mar","kwi","maj","cze","lip","sie","wrz","paź","lis","gru"],weekHeader:"Tydz",buttonText:{month:"Miesiąc",week:"Tydzień",day:"Dzień",list:"Plan dnia",today:"Dziś"},allDayText:"Cały dzień",timezone:"local",timeFormat:"H:mm",slotLabelFormat:"H:mm",allDaySlot:!0,axisFormat:"H:mm",firstHour:8,columnFormat:{month:"ddd",week:"ddd D/M",day:"dddd D/M"},header:{left:"today prev,next",center:"title",right:"month agendaWeek agendaDay"},eventLimit:!0,dayClick:vm.alertDayClick,eventClick:vm.alertEventClick,eventDrop:vm.eventOnDrop,eventResize:vm.eventOnResize,eventRender:function(event,element,view){if(event&&event.ranges)return event.ranges.filter(function(range){return event.start.isBefore(range.end)&&event.end.isAfter(range.start)}).length>0},events:vm.eventSources}}}function activate(){vm.eventSources=[],principal.identity(!1,"mobile").then(function(identity){vm.principal={},vm.principal.id=identity.id,clientsDataservice.getCalendarByUserId(vm.principal.id).then(function(data){var el,date_start,date_end,time_start,time_end,events=[],event={};if(data.length)for(var i=0,len=data.length;i<len;i++){if(el=data[i],date_start=calcTime(el.date_start,!0),date_end=calcTime(el.date_end,!0),time_start=el.all_day?null:new Date(1970,0,1,date_start.getHours(),date_start.getMinutes()),time_end=el.all_day?null:new Date(1970,0,1,date_end.getHours(),date_end.getMinutes()),event={id:el.id,user_id:el.user_id,title:el.title,description:el.description,start:date_start,end:date_end,date_start:date_start,date_end:date_end,time_start:time_start,time_end:time_end,allDay:el.all_day,repeat:el.repeat},el.repeat&&el.repeat_days)try{event.dow=JSON.parse(el.repeat_days),event.ranges=[{start:moment(event.date_start),end:moment(event.date_end)}]}catch(e){}events.push(event)}vm.eventSources=events,initDaysRepeat(),setCalendar()})}),$rootScope.breadcrumbTitle="Kalendarz",$rootScope.breadcrumbParentTitle="Konto",$rootScope.breadcrumbParentState="profile.main"}var vm=this;vm.alertDayClick=function(dateMoment){var newEvent=!0;initDaysRepeat(),initValues(dateMoment,newEvent),angular.element("#showNote").modal("show")},vm.alertEventClick=function(event){var date_start=new Date(event.start),date_end=event.end?new Date(event.end):date_start;if(event.repeat&&(date_start=new Date(event.date_start),date_end=new Date(event.date_end),event.dow))for(var i=0,len=event.dow.length;i<len;i++)vm.week_days[event.dow[i]].selected=!0;vm.note={id:event.id,date_start:date_start,date_end:date_end,time_start:event.time_start,time_end:event.time_end,title:event.title,description:event.description||"",allDay:event.allDay,repeat:event.repeat},vm.eventId=event.id,angular.element("#showNote").modal("show")},vm.eventOnDrop=function(event,dayDelta,minuteDelta,allDay,revertFunc){vm.eventId=event.id,vm.note=event,vm.isChangeEvent=!0,vm.saveEvent()},vm.eventOnResize=function(event){vm.eventId=event.id,vm.note=event,vm.isChangeEvent=!0,vm.saveEvent()},vm.saveEvent=function(){var arrayDow=[],dow=[],start=vm.note.start?new Date(vm.note.start):new Date,end=vm.note.end?new Date(vm.note.end):start,time_start=vm.isChangeEvent?new Date(1970,0,1,start.getHours(),start.getMinutes()):new Date(1970,0,1,vm.note.time_start.getHours(),vm.note.time_start.getMinutes()),time_end=vm.isChangeEvent?new Date(1970,0,1,end.getHours(),end.getMinutes()):new Date(1970,0,1,vm.note.time_end.getHours(),vm.note.time_end.getMinutes()),event={id:vm.note.id||0,user_id:vm.principal.id,title:vm.note.title,description:vm.note.description,all_day:vm.note.allDay,repeat:vm.note.repeat,date_start:vm.isChangeEvent?new Date(vm.note.start):new Date(vm.note.date_start.getFullYear(),vm.note.date_start.getMonth(),vm.note.date_start.getDate(),vm.note.time_start.getHours(),vm.note.time_start.getMinutes()),date_end:vm.isChangeEvent?new Date(vm.note.end):new Date(vm.note.date_end.getFullYear(),vm.note.date_end.getMonth(),vm.note.date_end.getDate(),vm.note.time_end.getHours(),vm.note.time_end.getMinutes()),repeat_days:""};if(event.all_day?(event.allDay=event.all_day,event.start=event.date_start):(event.start=event.date_start,event.end=event.date_end,event.time_start=time_start,event.time_end=time_end),vm.note.repeat&&(arrayDow=vm.week_days.filter(function(el){return el.selected===!0}),arrayDow.length)){dow=[];for(var i=0,len=arrayDow.length;i<len;i++)dow.push(arrayDow[i].id);
event.repeat_days=JSON.stringify(dow),event.dow=dow,event.ranges=[{start:moment(event.date_start),end:moment(event.date_end)}]}clientsDataservice.saveEventCalendar(event).then(function(data){var indexExistsEvent=arrayObjectIndexOf(vm.eventSources,event.id,"id");vm.isChangeEvent=!1,data.length&&(notifier.success("Sukces","Event saved successfully!"),event.id&&indexExistsEvent!=-1?vm.eventSources[indexExistsEvent]=event:(event.id=data[0],vm.eventSources.push(event)))})},vm.showRemoveEventModal=function(){angular.element("#removeEventModal").modal("show")},vm.removeEvent=function(){clientsDataservice.removeEventCalendar(vm.eventId).then(function(data){var indexExistsEvent=arrayObjectIndexOf(vm.eventSources,vm.eventId,"id");indexExistsEvent!=-1&&vm.eventSources.splice(indexExistsEvent,1),uiCalendarConfig.calendars.profileCalendar&&uiCalendarConfig.calendars.profileCalendar.fullCalendar("removeEvents",vm.eventId),notifier.success("Sukces","Event deleted successfully!")})},activate()}angular.module("app.profile").controller("ProfileCalendarController",ProfileCalendarController),ProfileCalendarController.$inject=["$rootScope","$scope","$state","principal","$localStorage","clientsDataservice","uiCalendarConfig","notifier"]}(),function(){"use strict";function ProfileCoachingController($rootScope,$scope,$state,principal,$sessionStorage,profileDataservice,$timeout,$window,notifier,TEXT_MESSAGE){function activate(){vm.readySessions=[],$scope.chartData=[],vm.activeTab=$state.params.hasOwnProperty("tab")?$state.params.tab:"chart",vm.waiting=!0,"chart"==vm.activeTab&&setChart(),principal.identity(!1,"mobile").then(function(identity){vm.principal=identity,vm.isManager?getRksSession():getRepSession()})}function getRksSession(){profileDataservice.getSubordinatesByParentId(vm.principal.id).then(function(subordinates){var data=subordinates.resource,isSessions=data.find(function(el){return el.sessions.length>0});isSessions?(vm.noCoaching=!1,vm.data=data,initActiveFilter(),buildRksData()):vm.noCoaching=!0,vm.waiting=!1},function(err){vm.waiting=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function getRepSession(){profileDataservice.getStaffSessions(vm.principal.id).then(function(data){vm.rep=data.resource,vm.rep.sessions.length?(initActiveFilter(),vm.noCoaching=!1,vm.rep.chartData=buildChartData(vm.rep.sessions,vm.rep.sessions_rating),vm.sessions.length&&(vm.sessions.forEach(function(s){s.avgRating=getRepAverageSessionRating(vm.rep,s.unique_id),s.staff_params=vm.rep.sessions_staff.find(function(session_staff){return session_staff.session_id==s.id})}),vm.readySessions=vm.sessions.filter(function(s){return 3==s.staff_params.status}),vm.currentSession=vm.sessions[0],setRepChartData())):vm.noCoaching=!0,vm.waiting=!1},function(err){vm.waiting=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function setChart(){$timeout(function(){$window.dispatchEvent(new Event("resize")),vm.isManager?setRksChart():setRepChart()},100)}function buildRksData(){var rep,isSetSteps=!1;vm.steps=[];for(var i=0,len=vm.data.length;i<len;i++){rep=vm.data[i],rep.chartData=buildChartData(rep.sessions,rep.sessions_rating,rep.id),rep.name=rep.firstName+" "+rep.lastName;for(var s in rep.sessions)rep.sessions[s].updated_at=calcTime(rep.sessions[s].updated_at,!0);vm.reps.push(rep),rep.sessions.length&&!isSetSteps&&(setSteps(rep.sessions),isSetSteps=!0)}vm.reps.unshift(teamRec),vm.selectReps.unshift(teamRec.id),setRepsSelected(),setActiveSeries()}function buildChartData(sessions,ratings,repId){var series={};return sessions.forEach(function(session,index){var unique_id,parentSession=vm.sessions.find(function(s){return s.date==session.date&&s.name==session.name});unique_id=parentSession&&parentSession.unique_id?parentSession.unique_id:(new Date).valueOf()+vm.sessions.length,series[unique_id]||(series[unique_id]={}),session.unique_id=unique_id,series[unique_id].enableSession=!0,series[unique_id].date=session.date,series[unique_id].label=session.name,series[unique_id].data=[],series[unique_id].labels=[],setSessionSteps(session,ratings,series,repId),series[unique_id].copyDataRating=cloneObj(series[session.unique_id].data),parentSession||vm.sessions.push(session)}),series}function setRksChartData(){var rep,chart,rating,chartData=[],labels=[],reps=cloneObj(vm.activeReps),lenRep=reps.length;$scope.chartData=[],lenRep>countUsersDisplayed&&(reps=reps.slice(0,countUsersDisplayed),lenRep=countUsersDisplayed),chartData=setSeries();for(var i=0,len=chartData.length;i<len;i++){chart=chartData[i];for(var j=0;j<lenRep;j++)rep=reps[j],chart.values[j]&&(labels.indexOf(rep.name)==-1&&labels.push(rep.name),rating=rep.id==-1?getAllRating(chart.sessions):getSelectedRating(rep,chart.sessions),chart.values[j].y=rating)}vm.labels=labels,$scope.chartData=chartData}function setRepChartData(){var data,rating,chartData=[],session=vm.currentSession,rep=vm.rep,chart={},stepNames=[],stepIndex=0;if(session.step.forEach(function(s){s.sub_step.length>0&&(stepNames[stepIndex]=s.text,stepIndex++)}),chart.key=session.name,chart.values=getInitRepChartValues(),rep.chartData&&rep.chartData[session.unique_id])for(var i=0,len=rep.chartData[session.unique_id].data.length;i<len;i++)data=rep.chartData[session.unique_id].data[i],angular.isDefined(chart.values[i])&&rep.chartData[session.unique_id].data[i]&&(rating=rep.chartData[session.unique_id].data[i],rating&&(chart.values[i].label=stepNames[i],chart.values[i].value=rating,chart.values[i].session_id=session.id,chart.values[i].rep_id=rep.unique_id));chart.values=chart.values.filter(function(el){return!!el.label}),chartData.push(chart),chartData.length>countUsersDisplayed&&(chartData=chartData.splice(countUsersDisplayed-1,chartData.length)),$scope.chartData=chartData}function setActiveSeries(){var res;vm.activeSeries=[],$scope.chartData=[],res=setSession(),res.length&&(vm.activeSeries=res,setRksChartData())}function setSeries(){var chart=(vm.activeSeries,{}),series=[],chartData=[],lenSeries=0;vm.activeSeries.length>countSessionsDisplayed?(series=vm.activeSeries.slice(0,countSessionsDisplayed),lenSeries=countSessionsDisplayed):(series=vm.activeSeries,lenSeries=series.length);for(var i=0;i<lenSeries;i++)chart={},chart.sessions=series[i].sessions,chart.key=series[i].sessionsName,1==chart.sessions.length&&(chart.session_id=chart.sessions[0].unique_id),chart.values=getInitRksChartValues(),chartData[i]=chart;return chartData}function setSteps(sessions){var session=sessions[0],counter=0;session.step.forEach(function(step,stepIndex){step.sub_step.length>0&&(step.label=step.text?step.text:"Krok"+(counter+1),counter++,vm.steps.push(step))})}function setSessionSteps(session,ratings,series,repId){session.step.forEach(function(step,stepIndex){var label,stepOverallRating=0,step_rating=0;step.sub_step.length>0&&(step.enableStep=!0,step.sub_step.forEach(function(subStep){var rating=ratings.find(function(r){return r.step_id==subStep.id});rating&&(stepOverallRating+=parseInt(rating.rating))}),step_rating=Number((stepOverallRating/step.sub_step.length).toFixed(2)),label=step.text?step.text:"krok-"+stepIndex,series[session.unique_id].labels.push(label),step_rating&&(series[session.unique_id].data.push(step_rating),repId&&vm.selectReps.indexOf(repId)==-1&&vm.selectReps.push(repId)))})}function setSession(){var month,nd,filteredSession,retVal=[];return Object.keys(vm.activeFilter.session).sort().forEach(function(key){var session,val=vm.activeFilter.session[key],res={},now=new Date;"ids"!=key&&val?(res.sessionsName=key,"all"==key?res.sessions=vm.sessions:("m6"==key?(month=-6,nd=addMonths(now,month)):"m12"==key?(month=-12,nd=addMonths(now,month)):"ctd"==key?nd=moment(now).startOf("quarter").toDate():"ytd"==key&&(nd=moment(now).startOf("year").toDate()),filteredSession=vm.sessions.filter(function(session){return isWithinDates(nd,new Date(session.date))}),filteredSession.length&&(res.sessions=filteredSession)),res.sessions&&retVal.push(res)):"ids"==key&&val&&val.forEach(function(id){res={},session=filterSessionsIds(id),session.length&&(res.sessions=session,res.sessionsName=session[0].name,retVal.push(res))})}),retVal}function activeFilter(filter,field,id){var pos,countFilter=0,limitLength="session"==filter?countSessionsDisplayed:"staff"==filter?countUsersDisplayed:-1;vm.activeFilter[filter]||(vm.activeFilter[filter]={}),angular.isDefined(vm.activeFilter[filter][field])||(vm.activeFilter[filter][field]="ids"==field&&[]),angular.isDefined(id)?("step"==filter&&(vm.activeFilter.step.all=!1),"session"==filter&&(vm.activeFilter.session.all=!1),pos=vm.activeFilter[filter][field].indexOf(id),countFilter=countActiveFilter(filter,field),pos==-1?(countFilter<limitLength||limitLength==-1)&&vm.activeFilter[filter][field].push(id):vm.activeFilter[filter][field].length>1&&vm.activeFilter[filter][field].splice(pos,1)):("step"==filter&&(vm.activeFilter.step.ids=[]),"session"==filter&&(vm.activeFilter.session.ids=[]),vm.activeFilter[filter][field]=!vm.activeFilter[filter][field],countFilter=countActiveFilter(filter,field),countFilter>limitLength&&limitLength!=-1&&(vm.activeFilter[filter][field]=!1))}function filterChartDataBySteps(){vm.activeFilter.step.ids.length?vm.reps.forEach(function(rep){vm.activeFilter.staff.ids.indexOf(rep.id)>-1&&vm.sessions.forEach(function(session){rep.chartData&&rep.chartData[session.unique_id]&&rep.chartData[session.unique_id].copyDataRating&&(rep.chartData[session.unique_id].data=rep.chartData[session.unique_id].copyDataRating.filter(function(dataRating,ind){return vm.activeFilter.step.ids.indexOf(ind)>-1}))})}):vm.activeFilter.step.all&&vm.reps.forEach(function(rep){vm.sessions.forEach(function(session){rep.chartData&&rep.chartData[session.unique_id]&&rep.chartData[session.unique_id].copyDataRating&&(rep.chartData[session.unique_id].data=rep.chartData[session.unique_id].copyDataRating)})})}function getAllRating(sessions){for(var repRating,totalRating=0,totalSessionRation=0,lenReps=vm.reps.length,countRepsHaveSessions=0,i=0,len=sessions.length;i<len;i++){countRepsHaveSessions=0,totalSessionRation=0;for(var j=0;j<lenReps;j++)vm.reps[j].chartData&&vm.reps[j].chartData[sessions[i].unique_id]&&(countRepsHaveSessions++,repRating=getRepAverageSessionRating(vm.reps[j],sessions[i].unique_id),totalSessionRation+=repRating);countRepsHaveSessions&&(totalSessionRation=Number(parseFloat(totalSessionRation/countRepsHaveSessions).toFixed(2))),totalRating+=totalSessionRation}return sessions.length&&totalRating&&(totalRating=Number(parseFloat(totalRating/sessions.length).toFixed(2))),totalRating}function getSelectedRating(rep,sessions){var sessionsLength,chartSessionsIds,repFilterSessions,totalRating=0;if(chartSessionsIds=sessions.map(function(s){return s.unique_id}),repFilterSessions=rep.sessions.filter(function(s){return chartSessionsIds.indexOf(s.unique_id)>-1}),sessionsLength=repFilterSessions.length){for(var i=0;i<sessionsLength;i++)totalRating+=getRepAverageSessionRating(rep,repFilterSessions[i].unique_id);totalRating=Number((totalRating/sessionsLength).toFixed(2))}return totalRating}function getRepAverageSessionRating(rep,session_id){var data,sum=0,avg=0;if(rep.chartData&&rep.chartData[session_id]&&rep.chartData[session_id].data.length){data=rep.chartData[session_id].data;for(var i=0,len=data.length;i<len;i++)data[i]&&(sum+=parseFloat(data[i]));avg=Number((sum/data.length).toFixed(2))}return avg}function initRksChartValues(){var chartValues,isSet;if(!isSet){chartValues=[];for(var i=0;i<countUsersDisplayed;i++)chartValues.push({y:0,x:i}),isSet=!0}return chartValues}function getInitRksChartValues(){return initRksChartValues()}function getInitRepChartValues(){return[{label:"",value:0},{label:"",value:0},{label:"",value:0},{label:"",value:0}]}function initActiveFilter(){var filters=["session","staff","step"];vm.activeFilter={},vm.activeFilterName=[];for(var i=0,len=filters.length;i<len;i++)vm.activeFilter[filters[i]]={};vm.activeSeries[0]=vm.sessions,vm.activeFilter.session.ids=[],vm.activeFilter.staff.ids=[],vm.activeFilter.step.ids=[],activeFilter("session","all"),activeFilter("step","all")}function setRksChart(){$scope.chartOptions={chart:{type:"multiBarChart",height:450,margin:{top:20,right:20,bottom:80,left:45},duration:500,stacked:!1,showXAxis:!0,xAxis:{axisLabel:"",tickValues:[0,1,2,3,4,5,6,7,8,9],tickFormat:function(d){return vm.labels[d]?vm.labels[d]:""},staggerLabels:!0},yAxis:{axisLabel:"",tickFormat:d3.format(",r"),tickValues:[0,1,2,3,4]},reduceXTicks:!1,rotateLabels:45,yDomain:[0,4],showValues:!0,valueFormat:function(d){return d3.format(",.2f")(d)},callback:function(chart){chart.multibar.dispatch.on("elementClick",function(e){var rep_id=e.data.rep_id,session_id=e.data.session_id;session_id&&rep_id&&vm.selectSession(session_id,rep_id)})}}}}function setRepStatsChart(){$scope.chartOptions={chart:{type:"multiBarChart",height:350,margin:{top:20,right:20,bottom:20,left:45},x:function(d){return d.label},y:function(d){return d.value+1e-10},duration:500,showXAxis:!0,xAxis:{axisLabel:"",width:100},yAxis:{axisLabel:"",axisLabelDistance:-10,tickFormat:d3.format(",r"),tickValues:[0,1,2,3,4]},yDomain:[0,4],showValues:!0,valueFormat:function(d){return d3.format(",.2f")(d)},callback:function(chart){}}}}function setRepChart(){$scope.chartOptions={chart:{type:"discreteBarChart",height:350,margin:{top:20,right:20,bottom:20,left:45},x:function(d){return d.label},y:function(d){return d.value+1e-10},duration:500,maxBarWidth:20,xAxis:{axisLabel:"",width:100},yAxis:{axisLabel:"",axisLabelDistance:-10,tickFormat:d3.format(",r"),tickValues:[0,1,2,3,4]},yDomain:[0,4],showValues:!0,valueFormat:function(d){return d3.format(",.2f")(d)},callback:function(chart){chart.discretebar.dispatch.on("elementClick",function(e){var rep_id=e.data.rep_id,session_id=e.data.session_id;vm.selectSession(session_id,rep_id)})}}}}function isWithinDates(d,sd){return d.getTime()<=sd.getTime()}function addMonths(date,months){return date.setMonth(date.getMonth()+months),date}function setRepsSelected(){if(vm.selectReps.length)for(var i=0,len=vm.selectReps.length;i<len;i++)i<countUsersDisplayed&&vm.activeFilter.staff.ids.push(vm.selectReps[i]);vm.activeReps=vm.reps.filter(function(rep){return vm.activeFilter.staff.ids.indexOf(rep.id)>-1})}function countActiveFilter(filter,field){var countFilter=0;return Object.keys(vm.activeFilter[filter]).forEach(function(key){var val=vm.activeFilter[filter][key];"ids"==key?countFilter=val.length:val&&countFilter++}),countFilter}function filterSessionsIds(id){return vm.sessions.filter(function(session){return session.id==id})}function findArrayIndex(_array,_key,_value){for(var i=0;i<_array.length;i++)if(_array[i][_key]==_value)return i;return-1}var vm=this,countSessionsDisplayed=10,countUsersDisplayed=10,teamRec={id:-1,identifier:"Zespol",name:"Zespol"};$rootScope.breadcrumbTitle="Coaching",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="",$rootScope.subtitle="Coaching page",$rootScope.showModalAttention=!1,vm.principal={},vm.reps=[],vm.selectReps=[],vm.sessions=[],vm.currentSession=[],vm.activeSeries=[],vm.activeReps=[],vm.isManager=$sessionStorage.isManager||!1,vm.labels=[],vm.finishedSessions=[],vm.repStats={sessions:[],sessionNames:[],steps:[],stepNames:[]},vm.allCards=function(_id){$state.go("profile.session",{id:_id})},vm.goTab=function(tab){$state.go("profile.coaching.tab",{tab:tab}),vm.activeTab=tab,"chart"==vm.activeTab&&setChart()},vm.getSessionStatus=function(_id){for(var sessionStatus=0,repIndex=findArrayIndex(vm.reps,"id",_id),i=0;i<vm.reps[repIndex].sessions.length;i++)1==vm.reps[repIndex].sessions[i].status&&(sessionStatus=1);return sessionStatus},vm.selectSession=function(session_id,staff_id){$sessionStorage.staff_id=staff_id,$state.go("profile.session",{id:session_id,staff_id:staff_id})},vm.toExcel=function(){},vm.toPdf=function(){var data=$(".for-export").html();profileDataservice.toPdf(data).then(function(data){})},vm.changeRepSession=function(unique_id){vm.repStats.sessions=[],vm.repStats.sessionNames=[],vm.repStats.steps=[],setRepChart();var session;unique_id&&(session=vm.sessions.find(function(s){return s.unique_id==unique_id}),session&&(vm.currentSession=session),setRepChartData())},vm.cloneSession=function(rep_id){vm.lockForm=!0,profileDataservice.cloneSession(rep_id).then(function(data){vm.lockForm=!1,notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),vm.refresh()},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.refresh=function(){$state.go($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})},vm.activeStaffFilter=function(filterName,id){activeFilter("staff",filterName,id),vm.activeReps=vm.reps.filter(function(rep){return vm.activeFilter.staff.ids.indexOf(rep.id)>-1}),setActiveSeries(),setRksChartData()},vm.activeSessionFilter=function(filterName,id){activeFilter("session",filterName,id),setActiveSeries(),setRksChartData()},vm.activeStepFilter=function(filterName,index){activeFilter("step",filterName,index),filterChartDataBySteps(),setActiveSeries(),setRksChartData()},vm.repStatsFilter=function(type,id,name){var chartData=[],chart={};chart.key="Statystyka",chart.values=[];var value=0;if(vm.steps=[],setSteps(vm.rep.sessions),"sessions"==type)if(vm.repStats.sessions.indexOf(id)!=-1){var findSessionIndex=vm.repStats.sessions.indexOf(id);vm.repStats.sessions.splice(findSessionIndex,1),vm.repStats.sessionNames.splice(findSessionIndex,1)}else vm.repStats.sessions.push(id),vm.repStats.sessionNames.push(name);else if("steps"==type)if(vm.repStats.steps.indexOf(id)!=-1){var findStepIndex=vm.repStats.steps.indexOf(id);vm.repStats.steps.splice(findStepIndex,1)}else vm.repStats.steps.push(id);for(var i in vm.repStats.sessions)if("string"==typeof vm.repStats.sessionNames[i]&&!isNaN(vm.repStats.sessions[i])){if(value=0,vm.repStats.steps.length>0){for(var stepValues=vm.rep.chartData[vm.repStats.sessions[i]].data,stepIndex=0,len=stepValues.length;stepIndex<len;stepIndex++)stepValues[stepIndex]&&vm.repStats.steps.indexOf(stepIndex)>-1&&(value+=parseFloat(stepValues[stepIndex]));value=Number((value/vm.repStats.steps.length).toFixed(2))}else value=getRepAverageSessionRating(vm.rep,vm.repStats.sessions[i]);chart.values.push({label:vm.repStats.sessionNames[i],value:value})}chartData.push(chart),setRepStatsChart(),$scope.chartData=chartData,vm.repStats.sessions.length<1&&(setRepChart(),setRepChartData())},activate()}angular.module("app.profile").controller("ProfileCoachingController",ProfileCoachingController),ProfileCoachingController.$inject=["$rootScope","$scope","$state","principal","$sessionStorage","profileDataservice","$timeout","$window","notifier","TEXT_MESSAGE"]}(),function(){"use strict";function ProfileMainController($rootScope,$state,principal,$sessionStorage,profileDataservice,clientsDataservice,notifier,IMAGES_PATH,ATLAS_MODULES,VERSION_NUMBER){function getMenuItems(){return[{label:"Clients",state:"clients.list",icon:"clients"},{label:"Campaigns",state:"campaigns.list",icon:"campaigns"},{label:"Messages",state:"messages.main",icon:"messages"},{label:"Help",state:"messages.help",icon:"help"},{label:"Gazetki",state:"gazetki.list",icon:"gazetki"},{label:"Detailing",state:"detailing.main",icon:"detailing"}]}function activate(){vm.isManager=$sessionStorage.isManager||!1,principal.identity(!1,"mobile").then(function(identity){var jobTitle=identity.job_title;identity.photo&&(vm.photo=vm.photoPath+identity.photo),clientsDataservice.getCompanyStaff(jobTitle).then(function(data){var staff=data.resource,jobTitles=data.staff_job_titles,job_title=jobTitles.filter(function(el){return el.id==identity.job_title});vm.principal={},vm.principal.identifier=identity.identifier,vm.principal.email=identity.email,vm.principal.job_title=job_title.length?job_title[0].fullname:"",vm.principal.address={region:{code:""},address_line_1:""},vm.principal.address=staff.address,vm.auth={email:vm.principal.email,oldPWD:"",newPWD:"",confirmPWD:""}})}),$rootScope.subtitle="Main page",$rootScope.breadcrumbTitle="Konto",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState=""}var vm=this;vm.menuItems=getMenuItems(),vm.photoPath=IMAGES_PATH+"staff-photo/",vm.coaching_visible=ATLAS_MODULES.COACHING,vm.dictionary_visible=ATLAS_MODULES.DICTIONARY,vm.version_number=VERSION_NUMBER,vm.showModalPassword=function(){angular.element("#editPassword").modal("show")},vm.changePassword=function(){profileDataservice.changePassword(vm.auth).then(function(res){angular.element("#editPassword").modal("hide"),notifier.success("Sukces","Password has been successfully saved.")},function(res){notifier.error("Error!",res.data.message),angular.element("#editPassword").modal("hide")})},vm.selectCampaign=function(campaignId){$state.go("campaigns.main",{id:campaignId})},vm.selectDrugstore=function(drugstoreId){$state.go("clients.card",{id:drugstoreId})},activate()}angular.module("app.profile").controller("ProfileMainController",ProfileMainController),ProfileMainController.$inject=["$rootScope","$state","principal","$sessionStorage","profileDataservice","clientsDataservice","notifier","IMAGES_PATH","ATLAS_MODULES","VERSION_NUMBER"]}(),function(){"use strict";function ProfileController($rootScope){function activate(){vm.subtitle=$rootScope.subtitle,$rootScope.assignModuleTranslations("profile")}$rootScope.breadcrumbTitle="Konto",$rootScope.breadcrumbParentTitle="",$rootScope.breadcrumbParentState="";var vm=this;vm.title="Konto",activate()}angular.module("app.profile").controller("ProfileController",ProfileController),ProfileController.$inject=["$rootScope"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"profile",config:{parent:"root",templateUrl:"app/profile/profile.html",controller:"ProfileController",controllerAs:"vm",settings:{}}},{state:"profile.main",config:{url:"/profile/main",templateUrl:"app/profile/main/profile.main.html",controller:"ProfileMainController",controllerAs:"vm",title:"Profile Main Info",data:{roles:[]},settings:{}}},{state:"profile.calendar",config:{url:"/profile/calendar",templateUrl:"app/profile/calendar/profile.calendar.html",controller:"ProfileCalendarController",controllerAs:"vm",title:"Calendar",data:{roles:[]},settings:{}}},{state:"profile.todo",config:{url:"/profile/todo",templateUrl:"app/profile/todo/profile.todo.html",controller:"ProfileTodoController",controllerAs:"vm",title:"Todo",data:{roles:[]},settings:{}}},{state:"profile.coaching",config:{url:"/profile/coaching",templateUrl:"app/profile/coaching/profile.coaching.html",controller:"ProfileCoachingController",controllerAs:"vm",title:"Coaching",data:{roles:[]},settings:{}}},{state:"profile.coaching.tab",config:{url:"/tab/{tab:[a-z]{1,10}}",data:{roles:[]},settings:{}}},{state:"profile.session",config:{url:"/profile/session/{id:[0-9]{1,8}}",templateUrl:"app/profile/sessions/profile.session.html",controller:"ProfileSessionController",controllerAs:"vm",title:"Session",data:{roles:[]},settings:{}}},{state:"profile.session-create",config:{url:"/profile/session/create/{id:[0-9]{1,8}}",templateUrl:"app/profile/sessions/profile.session.edit.html",controller:"ProfileSessionCreateController",controllerAs:"vm",title:"Session",data:{roles:[]},settings:{}}},{state:"profile.session-edit",config:{url:"/profile/session/edit/{id:[0-9]{1,8}}",templateUrl:"app/profile/sessions/profile.session.edit.html",controller:"ProfileSessionEditController",controllerAs:"vm",title:"Session",data:{roles:[]},settings:{}}}]}angular.module("app.profile").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function profileDataservice($state,dataservice,stepsService){function getCampaigns(currentPage){return dataservice.tenant.index("campaigns",{page:currentPage}).then(function(data){return data})}function getSelectedCampaign(campaignId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns",campaignId).then(function(data){return data.resource})}function getCampaignFiltered(campaignId,uid){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns","show/"+campaignId+"/staff/"+uid).then(function(data){return data.resource})}function getSelectedDrugstore(drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("drugstores",drugstoreId).then(function(data){return data.resource})}function getSelectedDrugstores(ids){var ids_drs=JSON.stringify(ids);return dataservice.tenant.customOauth.get("drugstores","list",{ids:ids_drs})}function getDrugstoreSelectedFields(drugstoreId,objFields){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("drugstores",drugstoreId).then(function(data){var result={};return objFields.forEach(function(item){result[item]=data.resource[item]||""}),result})}function getDrugstoreProperty(drugstore,propertyName){var property,retval;return drugstore.hasOwnProperty("metadata")&&drugstore.hasOwnProperty("props")&&(property=drugstore.props.find(function(prop){return prop.name==propertyName}),angular.isDefined(property)&&(retval=drugstore.metadata.find(function(val){return val.key==property.id}))),retval}function getEditDrugstore(drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.edit("drugstores",drugstoreId).then(function(data){return data})}function getDrugstoreAddress(drugstoreId){return dataservice.tenant.customOauth.get("drugstores",drugstoreId).then(function(data){return data.resource.address})}function getStaffJobTitles(){return dataservice.tenant.customOauth.get("staff-job-titles","list")}function getProperties(){return dataservice.tenant.customOauth.get("drugstores-properties","list")}function saveDrugstore(drugstore){return dataservice.tenant.update("drugstores",drugstore.id,drugstore)}function saveCampaign(campaignId,data){return dataservice.tenant.update("campaigns",campaignId,data)}function getAddress(addressid){return dataservice.tenant.edit("addresses",addressid)}function saveMessage(message){var instance=$state.current.settings.help?"helpmessages":"messages";return message.id>0?dataservice.tenant.update(instance,message.id,message):dataservice.tenant.store(instance,message)}function getStaffJobs(){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("staff-drugstores","list",{timeout:1e3,cache:!1})}function getStaffJobsByDrugstoreId(drugstoreId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("staff-drugstores","search-by-drugstore",{drugstore_id:drugstoreId,timeout:1e3,cache:!1})}function getCompanyStaff(staffId){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("staff-info",staffId)}function getJobDuty(staffId){return dataservice.tenant.edit("job-duties",staffId)}function saveSession(session){return dataservice.tenant.store("sessions",session)}function getSession(session_id,staff_id){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("get-sessions","staff",{session_id:session_id,staff_id:staff_id})}function getStaffSessions(staff_id){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("get-staff-sessions","staff",{staff_id:staff_id})}function getRepSession(_id){return dataservice.tenant.customOauth.get("rep-session",_id)}function updateSession(session_id,staff_id,data,session_data){return dataservice.tenant.customOauth.post("sessions-rating",{data:data,session_data:session_data},"session/"+session_id+"/staff/"+staff_id)}function cloneSession(staff_id){return dataservice.tenant.customOauth.post("sessions-clone",{},"staff/"+staff_id)}function toPdf(_data){return dataservice.tenant.customOauth.post("frame-contracts",{html:_data},"to-pdf")}function deleteSession(_id){return dataservice.tenant.destroy("sessions",_id)}function changePassword(authData){return dataservice.tenant.customOauth.post("staff",authData,"change-password")}function getSubordinatesByParentId(_id){return dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("get-subordinates",_id)}return{getSubordinatesByParentId:getSubordinatesByParentId,getCampaigns:getCampaigns,getSelectedCampaign:getSelectedCampaign,getCampaignFiltered:getCampaignFiltered,getSelectedDrugstore:getSelectedDrugstore,getSelectedDrugstores:getSelectedDrugstores,getDrugstoreSelectedFields:getDrugstoreSelectedFields,getDrugstoreProperty:getDrugstoreProperty,getEditDrugstore:getEditDrugstore,getDrugstoreAddress:getDrugstoreAddress,getStaffJobTitles:getStaffJobTitles,getProperties:getProperties,saveDrugstore:saveDrugstore,saveCampaign:saveCampaign,getAddress:getAddress,getStaffJobs:getStaffJobs,saveMessage:saveMessage,getStaffJobsByDrugstoreId:getStaffJobsByDrugstoreId,getCompanyStaff:getCompanyStaff,getJobDuty:getJobDuty,getSession:getSession,getStaffSessions:getStaffSessions,getRepSession:getRepSession,saveSession:saveSession,updateSession:updateSession,cloneSession:cloneSession,deleteSession:deleteSession,toPdf:toPdf,changePassword:changePassword}}angular.module("app.profile").factory("profileDataservice",profileDataservice),profileDataservice.$inject=["$state","dataservice","stepsService"]}(),function(){"use strict";function ProfileSessionController($rootScope,$scope,$state,principal,$sessionStorage,profileDataservice,notifier,MessagesManager,TEXT_MESSAGE){function activate(){vm.session_id=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,vm.staff_id=$sessionStorage.staff_id?$sessionStorage.staff_id:-1,vm.isManager=$sessionStorage.isManager||!1,vm.valuesSlider=[0,1,2,3,4],vm.waiting=!0,principal.identity(!1,"mobile").then(function(identity){vm.principal=identity,vm.isManager?vm.user_id=vm.staff_id:vm.user_id=vm.principal.id,profileDataservice.getSession(vm.session_id,vm.user_id).then(function(dataSession){vm.session=dataSession.resource,vm.status=vm.session.staff&&vm.session.staff.status?vm.session.staff.status:0,vm.waiting=!1,vm.session.date=vm.session.staff&&3==vm.session.staff.status?calcTime(vm.session.staff.updated_at,!0):"",getRepAverageSessionRating(),vm.session.staff&&3!=vm.session.staff.status&&getPreviousGoal(vm.user_id)})})}function getPreviousGoal(staff_id){profileDataservice.getStaffSessions(staff_id).then(function(data){var rep=data.resource,sessions=rep.sessions,session_ids=[];sessions.forEach(function(session){session_ids.push(session.id)});var current_session_index=session_ids.indexOf(vm.session.id);if(current_session_index>0){var previous_session_id=session_ids[current_session_index-1];profileDataservice.getSession(previous_session_id,vm.user_id).then(function(dataSession){var previous_session=dataSession.resource;null!==previous_session.staff.operational_goal&&(vm.session.staff.coaching_goal=previous_session.staff.operational_goal)})}})}function getRepAverageSessionRating(){var checkZeroRatings=!0;vm.session.avgRating=0,vm.session.step&&vm.session.step.length&&(vm.session.step.forEach(function(step){var sum=0;step.sub_step&&step.sub_step.length?(step.sub_step.forEach(function(sub_step){sum+=parseFloat(sub_step.rating),sub_step.rating>0&&checkZeroRatings===!0?vm.zeroRatingSteps=!1:(vm.zeroRatingSteps=!0,checkZeroRatings=!1)}),step.avgRating=Number((sum/step.sub_step.length).toFixed(2))):step.rating&&(step.avgRating=parseFloat(step.rating.rating),step.avgRating>=1&&checkZeroRatings===!0?vm.zeroRatingSteps=!1:(vm.zeroRatingSteps=!0,checkZeroRatings=!1)),vm.session.avgRating+=step.avgRating}),vm.session.avgRating=Number((vm.session.avgRating/vm.session.step.length).toFixed(2)))}function sendMessage(_message){MessagesManager.create(_message).then(function(msg){msg.send().then(function(res){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),vm.isManager&&vm.back()},function(err){notifier.error("Error","Unable to send the message!")})})}$rootScope.subtitle="Coaching page";var vm=this;vm.principal={},vm.representatives=[],vm.session_id=0,vm.session={},vm.currentSession=0,vm.repSessions=[],vm.rating=1,vm.saved=!1,vm.zeroRatingSteps=!0,vm.back=function(){$state.go("profile.coaching")},vm.changeSession=function(){vm.session=vm.repSessions[vm.currentSession];
},vm.changeSlider=function(data,index,field){field&&$scope.$apply(function(){field.rating=data,getRepAverageSessionRating()})},vm.store=function(isShowNotifier){var data=[],session_data={},session_id=vm.isManager?vm.session_id:vm.session.id,staff_id=vm.session.staff.staff_id,showNotifier=!angular.isDefined(isShowNotifier)||isShowNotifier;vm.lockForm=!0,vm.session.step.forEach(function(step){step.sub_step&&step.sub_step.length&&step.sub_step.forEach(function(sub_step){var res={};res.step_id=sub_step.id,res.rating=sub_step.rating,res.staff_id=vm.user_id,data.push(res)})});vm.isManager?vm.session_id:vm.session.id;session_data={status:vm.status,total:vm.session.staff.total,operational_goal:vm.session.staff.operational_goal,coaching_goal:vm.session.staff.coaching_goal,action:vm.session.staff.action},profileDataservice.updateSession(session_id,staff_id,data,session_data).then(function(data){vm.lockForm=!1,showNotifier&&notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED)},function(err){vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})},vm.sendToRep=function(){var message={message_category:"internal",sender_category:"representant",addressee_category:"representant",from:vm.principal.id,subject:"Session info",message:"Total: "+vm.session.staff.total+"\nGoals: "+vm.session.staff.operational_goal,is_sent:!0,to:vm.session.staff.staff_id,metadata:JSON.stringify({originator:{id:vm.principal.id,category:"representant",first_name:vm.principal.firstName,last_name:vm.principal.lastName}})};vm.saved=!0,vm.status=3,vm.store(!1),sendMessage(message)},vm.sendToRKS=function(){var message={message_category:"internal",sender_category:"representant",addressee_category:"representant",from:vm.principal.id,subject:"Session info: "+vm.principal.identifier,message:"Action: "+vm.session.staff.action+"\n",attachments:"",unique_id:"_"+Math.random().toString(36).substr(2,9),sent:!0,to:vm.session.staff.parent_id,metadata:JSON.stringify({originator:{id:vm.principal.id,category:"representant",first_name:vm.principal.firstName,last_name:vm.principal.lastName}})};vm.saved=!0,vm.store(),sendMessage(message)},activate()}angular.module("app.profile").controller("ProfileSessionController",ProfileSessionController),ProfileSessionController.$inject=["$rootScope","$scope","$state","principal","$sessionStorage","profileDataservice","notifier","MessagesManager","TEXT_MESSAGE"]}(),function(){"use strict";function ProfileSessionCreateController($rootScope,$state,principal,$localStorage,profileDataservice,notifier){function activate(){vm.session.rep_id=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,principal.identity(!1,"mobile").then(function(identity){vm.principal=identity})}$rootScope.subtitle="Coaching page";var vm=this;vm.session={},vm.session.step=[],vm.stepIsOpen=!1,vm.subStepIsOpen=!1,vm.currentStep=0,vm.principal={},vm.back=function(){$state.go("profile.coaching")},vm.openStep=function(_stepId,_subStepId){void 0!==_subStepId?(vm.stepIsOpen=!1,vm.subStepIsOpen=!0,vm.currentSubStep=_subStepId,$(".substep-textarea").focus()):vm.session.step[_stepId].subStep&&vm.session.step[_stepId].subStep.length>0?(vm.stepIsOpen=!1,vm.subStepIsOpen=!1):(vm.stepIsOpen=!0,vm.subStepIsOpen=!1,$(".step-textarea").focus()),vm.currentStep=_stepId},vm.addStep=function(){vm.session.step.push({text:""})},vm.addSubStep=function(_parentId){_parentId==vm.currentStep&&(vm.stepIsOpen=!1),void 0===vm.session.step[_parentId].subStep&&(vm.session.step[_parentId].subStep=[]),vm.session.step[_parentId].subStep.push({text:"",parent_id:_parentId})},vm.deleteStep=function(_id){_id==vm.currentStep&&(vm.stepIsOpen=!1),vm.session.step.splice(_id,1)},vm.deleteSubStep=function(_stepId,_subStepId){_stepId==vm.currentStep&&_subStepId==vm.currentSubStep&&(vm.subStepIsOpen=!1,vm.stepIsOpen=!1),vm.session.step[_stepId].subStep.splice(_subStepId,1)},vm.store=function(){var data=vm.session;data.manager_id=vm.principal.id,data.status=1,profileDataservice.saveSession(data).then(function(data){notifier.success("Sukces","Session data has been successfully saved."),$state.go("profile.session-edit",{id:data.last_insert_id})})},activate()}angular.module("app.profile").controller("ProfileSessionCreateController",ProfileSessionCreateController),ProfileSessionCreateController.$inject=["$rootScope","$state","principal","$localStorage","profileDataservice","notifier"]}(),function(){"use strict";function ProfileSessionEditController($rootScope,$state,principal,$localStorage,profileDataservice,notifier){function activate(){vm._id=$state.params.hasOwnProperty("id")?parseInt($state.params.id):-1,principal.identity(!1,"mobile").then(function(identity){vm.principal=identity,profileDataservice.getSession(vm._id).then(function(dataSession){vm.session=dataSession.resource,vm.session.date=new Date(vm.session.date);for(var i=0;i<vm.session.step.length;i++)vm.session.step[i].subStep=vm.session.step[i].sub_step})})}$rootScope.subtitle="Coaching page";var vm=this;vm.session={},vm.session.step=[],vm.stepIsOpen=!1,vm.subStepIsOpen=!1,vm.currentStep=0,vm.principal={},vm.back=function(){$state.go("profile.coaching")},vm.openStep=function(_stepId,_subStepId){void 0!==_subStepId?(vm.stepIsOpen=!1,vm.subStepIsOpen=!0,vm.currentSubStep=_subStepId,$(".substep-textarea").focus()):vm.session.step[_stepId].subStep&&vm.session.step[_stepId].subStep.length>0?(vm.stepIsOpen=!1,vm.subStepIsOpen=!1):(vm.stepIsOpen=!0,vm.subStepIsOpen=!1,$(".step-textarea").focus()),vm.currentStep=_stepId},vm.addStep=function(){vm.session.step.push({text:""})},vm.addSubStep=function(_parentId){_parentId==vm.currentStep&&(vm.stepIsOpen=!1),void 0===vm.session.step[_parentId].subStep&&(vm.session.step[_parentId].subStep=[]),vm.session.step[_parentId].subStep.push({text:"",parent_id:_parentId})},vm.deleteStep=function(_id){_id==vm.currentStep&&(vm.stepIsOpen=!1),vm.session.step.splice(_id,1)},vm.deleteSubStep=function(_stepId,_subStepId){_stepId==vm.currentStep&&_subStepId==vm.currentSubStep&&(vm.subStepIsOpen=!1,vm.stepIsOpen=!0),vm.session.step[_stepId].subStep.splice(_subStepId,1)},vm.store=function(){var data=vm.session;profileDataservice.updateSession(vm._id,data).then(function(data){notifier.success("Sukces","Session data has been successfully updated.")})},activate()}angular.module("app.profile").controller("ProfileSessionEditController",ProfileSessionEditController),ProfileSessionEditController.$inject=["$rootScope","$state","principal","$localStorage","profileDataservice","notifier"]}(),function(undefined){"use strict";function ProfileTodoController($rootScope,$state,$sessionStorage,$q,campaignsDataservice,DocumentsWorkflowManager,MessagesManager,CampaignsProposalContractsManager,MERCH_IMAGES_PATH,notifier,TEXT_MESSAGE,EmailsManager){function activate(){showDimmer(),vm.userData=$sessionStorage._identity?JSON.parse($sessionStorage._identity):null,vm.isManager=$sessionStorage.isManager||!1,vm.lockForm=!1,vm.isZoom=!1,vm.userId=vm.userData?vm.userData.id:null,vm.path_img=MERCH_IMAGES_PATH,vm.messageToStaff="",vm.todoPict={service_control:"todo_service_control_icon_grey.png",proposal:"todo_proposal_icon_grey.png"},vm.selectedAction=null,vm.isReject=!1,vm.sort={column:["todoDate"],descending:!0,"class":"descending"},setTodo(),$rootScope.breadcrumbTitle="Do zrobienia",$rootScope.breadcrumbParentTitle="Konto",$rootScope.breadcrumbParentState="profile.main"}function setTodo(){campaignsDataservice.getTodo(vm.userId).then(function(result){hideDimmer(),setTodoProperties(result)},function(err){hideDimmer(),notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})}function setTodoProperties(result){vm.todoData=result.data,vm.drugstoresImg=result.drugstores_picture,angular.isArray(vm.todoData)||(vm.todoData=Object.keys(vm.todoData).map(function(key){return vm.todoData[key]})),$rootScope.$emit("changeTodo",vm.todoData.length),vm.todoData.length&&vm.todoData.forEach(function(todo){todo.todoDate=calcTime(todo.todoDate,!0);try{todo.definition=JSON.parse(todo.definition),todo.step_id=todo.definition.step_id||"",todo.proposal&&todo.proposal.definition?todo.proposal=JSON.parse(todo.proposal.definition):todo.proposal=null,todo.service_control&&todo.service_control.forEach(function(service){try{service.definition=JSON.parse(service.definition)[0]}catch(e){}})}catch(e){}})}function getTotalAgreedPotential(groups){groups.forEach(function(group){vm.newAgreedPotential.sellIn+=parseFloat(group.sellInAgreedPotential),vm.newAgreedPotential.sellOut+=parseFloat(group.sellOutAgreedPotential)})}function getServicesEarned(){var totalServices=0;return vm.services.forEach(function(service){var realEarns;service.multiplier||(service.multiplier=service.use_drugstores_number_in_multiplier?vm.servicesMultiplier:1),service.cycleValue||(service.cycleValue=service.use_cycle_duration_in_multiplier?vm.cycleValue:1),service.include&&(realEarns=parseFloat(service.earned*service.multiplier*service.cycleValue),totalServices+=parseFloat(realEarns))}),totalServices}function _pregReplace(data,template){return template.replace(/\{\{([^}]+)\}\}/g,function(m,pattern){return data.hasOwnProperty(pattern)?data[pattern]:"==="})}function removeTodoLocal(id){vm.todoData=vm.todoData.filter(function(todo){return todo.id!=id})}function initManager(id,docType){var defer=$q.defer(),data={originator:vm.rep_id,metadata:{originator:{id:vm.rep_id,category:"representant"},document_type:docType,drugstore_id:vm.drugstoreId,drugstore_name:vm.drugstoreName,drugstore_address:vm.drugstoreAddress||"",drugstore_nip:vm.drugstoreNIP,campaign_identifier:vm.campaignName,campaign_id:vm.campaignId,document_id:id,contract_id:vm.contractId,campaign_step_unique_id:vm.campaignStepUniqueId}};return DocumentsWorkflowManager.start(id,docType,data).then(function(res){switch(docType){case"campaign_proposal_contract":showDimmer(),CampaignsProposalContractsManager.retrieveInstance(res.id,res).then(function(instance){hideDimmer(),vm.campaignProposalContract=instance,vm.dwStep=DocumentsWorkflowManager.selectCurrentWorkflowStep().getCurrentStep(),defer.resolve(instance)},function(err){hideDimmer(),defer.reject(err)});break;case"final_report":}}),defer.promise}function applyStep(decision,data,document,todoId){var defer=$q.defer(),rksStatus="accept"==decision?"accepted":"rejected",isBudget=vm.budget_item||undefined;return showDimmer(),DocumentsWorkflowManager.jumpToNextStepOnDecision(decision).then(function(){DocumentsWorkflowManager.executeAction(data).then(function(){DocumentsWorkflowManager.setCampaignStepStatus().then(function(){DocumentsWorkflowManager.jumpToNextStep().then(function(res){DocumentsWorkflowManager.updateDocument(document,rksStatus,isBudget).then(function(res){DocumentsWorkflowManager.removeTodo(todoId).then(function(res){DocumentsWorkflowManager.commit().then(function(res){hideDimmer(),defer.resolve({})},function(err){hideDimmer(),console.log(err),defer.reject(err)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION),defer.reject(err)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION),defer.reject(err)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION),defer.reject(err)})},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.CANNOT_EXECUTE_ACTION),defer.reject(err)})},function(err){console.log(err),defer.reject(err)})}),defer.promise}function sendMessage(data){MessagesManager.create(data).then(function(msg){msg.send().then(function(res){notifier.success("Sukces","Wiadomość została pomyślnie wysłana")},function(err){notifier.error("Error","Unable to send the message!")})})}var vm=this;vm.showConfirmationProposalWindow=function(todo){var servicesEarned=0;vm.drugstoreAddress="",vm.drugstoreNetworks=null,vm.progress=null,vm.period={campaign_start:calcTime(todo.date_start,!0),campaign_end:calcTime(todo.date_end,!0)},vm.campaignId=todo.campaign_id,vm.drugstoreId=todo.drugstore_id,vm.drugstoreNIP=todo.drugstore.drugstoreNIP,vm.campaignName=todo.campaignName,vm.drugstoreName=todo.drugstore.drugstoreName,vm.budget_item=todo.budget_item,todo.drugstore.address&&todo.drugstore.address.city&&todo.drugstore.address.city.name&&(vm.drugstoreAddress=todo.drugstore.address.city.name+", "+todo.drugstore.address.address_line_1),todo.drugstoreNetworks&&(vm.drugstoreNetworks=todo.drugstoreNetworks),vm.messageProposal=todo.definition.message?todo.definition.message:"",vm.contractId=todo.definition.contract_id?todo.definition.contract_id:"",vm.documentId=todo.definition.document_id?todo.definition.document_id:"",vm.campaignStepUniqueId=todo.definition.campaign_step_unique_id?todo.definition.campaign_step_unique_id:"",vm.total=todo.definition.total?todo.definition.total:"",vm.rep_id=todo.rep_id,vm.todoId=todo.id,vm.newAgreedPotential={sellIn:0,sellOut:0},todo.proposal&&(getTotalAgreedPotential(todo.proposal.groups),vm.cycleValue=todo.proposal.cycleValue,vm.multiplier=todo.proposal.amountNetWorkDrugstores||1,vm.servicesMultiplier=todo.proposal.servicesMultiplier,vm.fixedAmount=todo.proposal.fixedAmount||0,vm.variesAmount=parseFloat(todo.proposal.variesAmount*vm.multiplier)||0,vm.variesAmountPoints=parseInt(todo.proposal.variesAmountPoints*vm.multiplier)||0,vm.services=todo.proposal.services,servicesEarned=getServicesEarned()),todo.progress&&(vm.progress=todo.progress,vm.period.cycle_start=calcTime(vm.progress.cycle_date_start,!0),vm.period.cycle_end=calcTime(vm.progress.cycle_date_end,!0)),angular.element("#proposalAcceptance").modal("show")},vm.showAcceptConfirmationWindow=function(){angular.element("#confirmProposalAcceptance").modal("show")},vm.showRejectConfirmationWindow=function(){angular.element("#confirmProposalRejection").modal("show")},vm.acceptProposal=function(){var currentTenant=JSON.parse($sessionStorage.currentTenant);vm.lockForm=!0,initManager(vm.documentId,"campaign_proposal_contract").then(function(instance){applyStep("accept",undefined,instance,vm.todoId).then(function(){var templateName="emails.portal-notification-email",subject=DocumentsWorkflowManager.getNotificationEmailTemplate().subject,name="Apteka "+instance.drugstore.name,message=_pregReplace({link:"https://demo.3mind-solutions.com/bgx/#/".replace("bgx","TEVA_PROD"==currentTenant.name?"teva":"bgx")+"login?return=campaigns-proposal-contracts/view/"+instance.id+"&email="+instance.drugstore.email},DocumentsWorkflowManager.getNotificationEmailTemplate().message);removeTodoLocal(vm.todoId),vm.lockForm=!1,$rootScope.$emit("changeTodo",vm.todoData.length),EmailsManager.send(instance.drugstore.email,name,subject,message,templateName).then(function(res){notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED)},function(err){notifier.error("Error",TEXT_MESSAGE.ERROR.SEND_MESSAGE_ERROR)}),vm.statusChanged=!0},function(err){console.log(err),vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})})},vm.rejectProposal=function(){var data={reason_of_reject:vm.rejectionReason};vm.lockForm=!0,initManager(vm.documentId,"campaign_proposal_contract").then(function(instance){applyStep("reject",data,instance,vm.todoId).then(function(){vm.statusChanged=!0,vm.lockForm=!1,removeTodoLocal(vm.todoId),$rootScope.$emit("changeTodo",vm.todoData.length),notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED)},function(err){console.log(err),vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR)})})},vm.hideZoom=function(event){return event.preventDefault(),vm.isZoom=!vm.isZoom,!1},vm.setZoomPicture=function(obj,nameImg){var objImg=obj[nameImg+"_image"]?obj[nameImg+"_image"]:null;objImg&&objImg.filename&&(vm.isZoom=!vm.isZoom,vm.imgFileZoom=vm.path_img+objImg.filename,vm.imgDate=obj.definition&&obj.definition[nameImg+"_originalDate"]?obj.definition[nameImg+"_originalDate"]:"",vm.imgObj=objImg,vm.imgRotateClass=objImg.rotateClass)},vm.rotatePict=function(obj){obj||(obj=vm.imgObj),obj.angle||(obj.angle=0),obj.angle=(obj.angle+90)%360,vm.imgRotateClass="rotate"+obj.angle,vm.imgObj.rotateClass=vm.imgRotateClass},vm.checkReject=function(service){var idx,shelfChecked=!service.shelf_image||service.shelf_image.selectedToAccept,envChecked=!service.env_image||service.env_image.selectedToAccept,removeRejected=function(){shelfChecked&&envChecked&&vm.rejectedServices.splice(idx,1)},addRejected=function(){shelfChecked&&envChecked||vm.rejectedServices.push(service.id)};vm.rejectedServices||(vm.rejectedServices=[]),idx=vm.rejectedServices.indexOf(service.id),idx>-1?removeRejected():addRejected(),vm.isReject=vm.rejectedServices.length>=1},vm.showAllPhotos=function(todo){if(vm.imageProps={definition:{},drugstore_image:{id:0,filename:"",rotateClass:""}},vm.messageToStaff="",vm.todoId=todo.id,vm.campaignId=todo.campaign_id,vm.drugstoreId=todo.drugstore_id,vm.campaignName=todo.campaignName,vm.drugstoreName=todo.drugstore.drugstoreName,vm.drugstoreNIP=todo.drugstore.drugstoreNIP,vm.drugstoreAddress=todo.drugstore.address.address_line_1+", "+todo.drugstore.address.city.name,vm.staffName=todo.staffName,vm.rejectedServices=[],vm.isReject=!1,todo.service_control&&(vm.hide_drugstore_photo=todo.hide_drugstore_photo,vm.currentDataServiceControl=todo.service_control.groupBy(function(o){return o.step_id}),vm.drugstoresImg[todo.rep_id]&&vm.drugstoresImg[todo.rep_id][vm.drugstoreId])){vm.imageProps.drugstore_image.id=vm.drugstoresImg[todo.rep_id][vm.drugstoreId].id,vm.imageProps.drugstore_image.filename=vm.drugstoresImg[todo.rep_id][vm.drugstoreId].name,vm.imageProps.drugstore_image.old_date=vm.drugstoresImg[todo.rep_id][vm.drugstoreId].old_date;try{vm.imageProps.definition.drugstore_originalDate=JSON.parse(vm.drugstoresImg[todo.rep_id][vm.drugstoreId].definition).originalDate}catch(e){}}vm.isZoom=!1,angular.element("#showAcceptPhotos").modal("show")},vm.showConfirmAgreed=function(){angular.element("#confirmRksAgreed").modal("show")},vm.setRksAllAgreed=function(){var date_rks=new Date;vm.steps=[],vm.currentDataServiceControl.forEach(function(el){var step={};step.stepId=el.key,step.status="completed",step.services=[],el.group.forEach(function(service){var definition=service.definition,agreed=1;definition&&(service.shelf_image&&definition.shelf_control&&(definition.shelf_agreed=service.shelf_image.selectedToAccept,service.shelf_image.selectedToAccept||(step.status="rejected",agreed=0)),service.env_image&&definition.env_control&&(definition.env_agreed=service.env_image.selectedToAccept,service.env_image.selectedToAccept||(step.status="rejected",agreed=0)),definition.not_paid_campaign_step_status&&(definition.not_paid_campaign_step_status=step.status),definition.date_rks=moment(date_rks).format("YYYY-MM-DD HH:mm:ss"),service.agreed=agreed),service.definition=JSON.stringify([definition]),step.services.push(service)}),vm.steps.push(step)})},vm.refresh=function(){$state.go($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})},vm.saveServiceControl=function(){var todo,sendData={},arrStepStatus=[],arrData=[],msgData={},subject="",text="",drugstoreImg=vm.imageProps.drugstore_image.id?{id:vm.imageProps.drugstore_image.id,definition:{originalDate:vm.imageProps.definition.drugstore_originalDate,accepted:vm.imageProps.drugstore_image.selectedToAccept}}:null,currentTodo=vm.todoData.find(function(todo){return todo.id==vm.todoId});vm.lockForm=!0,todo={id:currentTodo.id,rks_id:currentTodo.rks_id,rep_id:currentTodo.rep_id,campaignId:vm.campaignId,drugstoreId:vm.drugstoreId,action_done:"yes"},vm.isReject&&(subject="Odrzucenie zdjęcia",text="Kampania: "+vm.campaignName+"<br>Apteka: "+vm.drugstoreName+"<br>NIP: "+vm.drugstoreNIP+"<br>Adres: "+vm.drugstoreAddress+"<br>"+vm.messageToStaff,msgData={message_category:"internal",from:vm.userData.id,to:currentTodo.rep_id,subject:subject,message:text,is_sent:!0,metadata:JSON.stringify({originator:{id:vm.userData.id,category:"representant",first_name:vm.userData.firstName,last_name:vm.userData.lastName}})},sendMessage(msgData)),showDimmer(),vm.steps.forEach(function(step,index){var services=step.services;arrStepStatus.push({step_unique_id:step.stepId+"_"+vm.drugstoreId,step_status:step.status,campaignId:vm.campaignId,drugstoreId:currentTodo&&currentTodo.definition.mainDrugstoreId?currentTodo.definition.mainDrugstoreId:vm.drugstoreId}),arrData=arrData.concat(services)}),drugstoreImg&&(drugstoreImg.definition=JSON.stringify(drugstoreImg.definition)),sendData={setStepStatus:arrStepStatus,isSetProgressStepStatus:currentTodo.not_paid_campaign?undefined:1,data:arrData,todo:todo,updateDrugstoreImageDefinition:drugstoreImg||undefined},campaignsDataservice.saveServiceControl(sendData,!0).then(function(data){hideDimmer(),notifier.success("Sukces",TEXT_MESSAGE.SUCCESS.SUCCESS_SAVED),removeTodoLocal(vm.todoId),vm.lockForm=!1,$rootScope.$emit("changeTodo",vm.todoData.length)},function(err){hideDimmer(),vm.lockForm=!1,notifier.error("Error",TEXT_MESSAGE.ERROR.SERVER_ERROR),console.log(err)})},vm.selectAction=function(actionName){vm.selectedAction=actionName==vm.selectedAction?null:actionName,"service_control"==actionName?(vm.todoPict.proposal="todo_proposal_icon_grey.png",vm.selectedAction?vm.todoPict.service_control="todo_service_control_icon_marine.png":vm.todoPict.service_control="todo_service_control_icon_grey.png"):"proposal"==actionName&&(vm.todoPict.service_control="todo_service_control_icon_grey.png",vm.selectedAction?vm.todoPict.proposal="todo_proposal_icon_marine.png":vm.todoPict.proposal="todo_proposal_icon_grey.png")},vm.changeSorting=function(column){var condition,sort=vm.sort;sort["class"]="",condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition?(sort.descending=!sort.descending,sort["class"]=sort.descending?"descending":"ascending"):(sort.column=column,sort.descending=!1,sort["class"]="")},vm.sortingClass=function(column){var condition,sort=vm.sort;return sort["class"]="",condition=angular.isArray(column)?JSON.stringify(sort.column)===JSON.stringify(column):sort.column==column,condition&&(sort["class"]=sort.descending?"descending":"ascending"),sort["class"]},activate()}angular.module("app.profile").controller("ProfileTodoController",ProfileTodoController).filter("selectedAction",[function(){return function(list,actionName){if(list){if(actionName){var tempTodo=[];return angular.forEach(list,function(el){el.action_type==actionName&&tempTodo.push(el)}),tempTodo}return list}return!1}}]),ProfileTodoController.$inject=["$rootScope","$state","$sessionStorage","$q","campaignsDataservice","DocumentsWorkflowManager","MessagesManager","CampaignsProposalContractsManager","MERCH_IMAGES_PATH","notifier","TEXT_MESSAGE","EmailsManager"]}(),function(undefined){"use strict";function exifService(){function imageHasData(img){return!!img.exifdata}function base64ToArrayBuffer(base64,contentType){contentType=contentType||base64.match(/^data\:([^\;]+)\;base64,/im)[1]||"",base64=base64.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var binary=atob(base64),len=binary.length,buffer=new ArrayBuffer(len),view=new Uint8Array(buffer),i=0;i<len;i++)view[i]=binary.charCodeAt(i);return buffer}function objectURLToBlob(url,callback){var http=new XMLHttpRequest;http.open("GET",url,!0),http.responseType="blob",http.onload=function(e){200!=this.status&&0!==this.status||callback(this.response)},http.send()}function getImageData(img,callback){function handleBinaryFile(binFile){var data=findEXIFinJPEG(binFile),iptcdata=findIPTCinJPEG(binFile);img.exifdata=data||{},img.iptcdata=iptcdata||{},callback&&callback.call(img)}var fileReader;if(img.src)if(/^data\:/i.test(img.src)){var arrayBuffer=base64ToArrayBuffer(img.src);handleBinaryFile(arrayBuffer)}else if(/^blob\:/i.test(img.src))fileReader=new FileReader,fileReader.onload=function(e){handleBinaryFile(e.target.result)},objectURLToBlob(img.src,function(blob){fileReader.readAsArrayBuffer(blob)});else{var http=new XMLHttpRequest;http.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";handleBinaryFile(http.response),http=null},http.open("GET",img.src,!0),http.responseType="arraybuffer",http.send(null)}else window.FileReader&&(img instanceof window.Blob||img instanceof window.File)&&(fileReader=new FileReader,fileReader.onload=function(e){debug&&console.log("Got file of length "+e.target.result.byteLength),handleBinaryFile(e.target.result)},fileReader.readAsArrayBuffer(img))}function findEXIFinJPEG(file){var dataView=new DataView(file);if(debug&&console.log("Got file of length "+file.byteLength),255!=dataView.getUint8(0)||216!=dataView.getUint8(1))return debug&&console.log("Not a valid JPEG"),!1;for(var marker,offset=2,length=file.byteLength;offset<length;){if(255!=dataView.getUint8(offset))return debug&&console.log("Not a valid marker at offset "+offset+", found: "+dataView.getUint8(offset)),!1;if(marker=dataView.getUint8(offset+1),debug&&console.log(marker),225==marker)return debug&&console.log("Found 0xFFE1 marker"),readEXIFData(dataView,offset+4,dataView.getUint16(offset+2)-2);offset+=2+dataView.getUint16(offset+2)}}function findIPTCinJPEG(file){var dataView=new DataView(file);if(debug&&console.log("Got file of length "+file.byteLength),255!=dataView.getUint8(0)||216!=dataView.getUint8(1))return debug&&console.log("Not a valid JPEG"),!1;for(var offset=2,length=file.byteLength,isFieldSegmentStart=function(dataView,offset){return 56===dataView.getUint8(offset)&&66===dataView.getUint8(offset+1)&&73===dataView.getUint8(offset+2)&&77===dataView.getUint8(offset+3)&&4===dataView.getUint8(offset+4)&&4===dataView.getUint8(offset+5)};offset<length;){if(isFieldSegmentStart(dataView,offset)){var nameHeaderLength=dataView.getUint8(offset+7);nameHeaderLength%2!==0&&(nameHeaderLength+=1),0===nameHeaderLength&&(nameHeaderLength=4);var startOffset=offset+8+nameHeaderLength,sectionLength=dataView.getUint16(offset+6+nameHeaderLength);return readIPTCData(file,startOffset,sectionLength)}offset++}}function readIPTCData(file,startOffset,sectionLength){for(var fieldValue,fieldName,dataSize,segmentType,segmentSize,dataView=new DataView(file),data={},segmentStartPos=startOffset;segmentStartPos<startOffset+sectionLength;)28===dataView.getUint8(segmentStartPos)&&2===dataView.getUint8(segmentStartPos+1)&&(segmentType=dataView.getUint8(segmentStartPos+2),segmentType in IptcFieldMap&&(dataSize=dataView.getInt16(segmentStartPos+3),segmentSize=dataSize+5,fieldName=IptcFieldMap[segmentType],fieldValue=getStringFromDB(dataView,segmentStartPos+5,dataSize),data.hasOwnProperty(fieldName)?data[fieldName]instanceof Array?data[fieldName].push(fieldValue):data[fieldName]=[data[fieldName],fieldValue]:data[fieldName]=fieldValue)),segmentStartPos++;return data}function readTags(file,tiffStart,dirStart,strings,bigEnd){var entryOffset,tag,i,entries=file.getUint16(dirStart,!bigEnd),tags={};for(i=0;i<entries;i++)entryOffset=dirStart+12*i+2,tag=strings[file.getUint16(entryOffset,!bigEnd)],!tag&&debug&&console.log("Unknown tag: "+file.getUint16(entryOffset,!bigEnd)),tags[tag]=readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd);return tags}function readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd){var offset,vals,val,n,numerator,denominator,type=file.getUint16(entryOffset+2,!bigEnd),numValues=file.getUint32(entryOffset+4,!bigEnd),valueOffset=file.getUint32(entryOffset+8,!bigEnd)+tiffStart;switch(type){case 1:case 7:if(1==numValues)return file.getUint8(entryOffset+8,!bigEnd);for(offset=numValues>4?valueOffset:entryOffset+8,vals=[],n=0;n<numValues;n++)vals[n]=file.getUint8(offset+n);return vals;case 2:return offset=numValues>4?valueOffset:entryOffset+8,getStringFromDB(file,offset,numValues-1);case 3:if(1==numValues)return file.getUint16(entryOffset+8,!bigEnd);for(offset=numValues>2?valueOffset:entryOffset+8,vals=[],n=0;n<numValues;n++)vals[n]=file.getUint16(offset+2*n,!bigEnd);return vals;case 4:if(1==numValues)return file.getUint32(entryOffset+8,!bigEnd);for(vals=[],n=0;n<numValues;n++)vals[n]=file.getUint32(valueOffset+4*n,!bigEnd);return vals;case 5:if(1==numValues)return numerator=file.getUint32(valueOffset,!bigEnd),denominator=file.getUint32(valueOffset+4,!bigEnd),val=new Object(numerator/denominator),val.numerator=numerator,val.denominator=denominator,val;for(vals=[],n=0;n<numValues;n++)numerator=file.getUint32(valueOffset+8*n,!bigEnd),denominator=file.getUint32(valueOffset+4+8*n,!bigEnd),vals[n]=new Object(numerator/denominator),vals[n].numerator=numerator,vals[n].denominator=denominator;return vals;case 9:if(1==numValues)return file.getInt32(entryOffset+8,!bigEnd);for(vals=[],n=0;n<numValues;n++)vals[n]=file.getInt32(valueOffset+4*n,!bigEnd);return vals;case 10:if(1==numValues)return file.getInt32(valueOffset,!bigEnd)/file.getInt32(valueOffset+4,!bigEnd);for(vals=[],n=0;n<numValues;n++)vals[n]=file.getInt32(valueOffset+8*n,!bigEnd)/file.getInt32(valueOffset+4+8*n,!bigEnd);return vals}}function getStringFromDB(buffer,start,length){for(var outstr="",n=start;n<start+length;n++)outstr+=String.fromCharCode(buffer.getUint8(n));return outstr}function readEXIFData(file,start){if("Exif"!=getStringFromDB(file,start,4))return debug&&console.log("Not valid EXIF data! "+getStringFromDB(file,start,4)),!1;var bigEnd,tags,tag,exifData,tiffOffset=start+6;if(18761==file.getUint16(tiffOffset))bigEnd=!1;else{if(19789!=file.getUint16(tiffOffset))return debug&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;bigEnd=!0}if(42!=file.getUint16(tiffOffset+2,!bigEnd))return debug&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var firstIFDOffset=file.getUint32(tiffOffset+4,!bigEnd);if(firstIFDOffset<8)return debug&&console.log("Not valid TIFF data! (First offset less than 8)",file.getUint32(tiffOffset+4,!bigEnd)),!1;if(tags=readTags(file,tiffOffset,tiffOffset+firstIFDOffset,TiffTags,bigEnd),tags.ExifIFDPointer){exifData=readTags(file,tiffOffset,tiffOffset+tags.ExifIFDPointer,ExifTags,bigEnd);for(tag in exifData){switch(tag){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":exifData[tag]=StringValues[tag][exifData[tag]];break;case"ExifVersion":case"FlashpixVersion":exifData[tag]=String.fromCharCode(exifData[tag][0],exifData[tag][1],exifData[tag][2],exifData[tag][3]);break;case"ComponentsConfiguration":exifData[tag]=StringValues.Components[exifData[tag][0]]+StringValues.Components[exifData[tag][1]]+StringValues.Components[exifData[tag][2]]+StringValues.Components[exifData[tag][3]]}tags[tag]=exifData[tag]}}return tags}function getData(img,callback){return!((img instanceof Image||img instanceof HTMLImageElement)&&!img.complete)&&(imageHasData(img)?callback&&callback.call(img):getImageData(img,callback),!0)}function getTag(img,tag){return!!imageHasData(img)&&img.exifdata[tag]}function getAllTags(img){if(!imageHasData(img))return{};var a,data=img.exifdata,tags={};for(a in data)data.hasOwnProperty(a)&&(tags[a]=data[a]);return tags}function getPrettyData(img){if(!imageHasData(img))return"";var a,data=img.exifdata,strPretty="";for(a in data)data.hasOwnProperty(a)&&(strPretty+="object"==typeof data[a]?data[a]instanceof Number?a+" : "+data[a]+" ["+data[a].numerator+"/"+data[a].denominator+"]\r\n":a+" : ["+data[a].length+" values]\r\n":a+" : "+data[a]+"\r\n");return strPretty}function getOriginalDate(img){if(!imageHasData(img))return debug&&console.log("Not data"),"";var data=img.exifdata,strDate="";return data.hasOwnProperty("DateTimeOriginal")?strDate=data.DateTimeOriginal:data.hasOwnProperty("DateTime")&&(strDate=data.DateTime),strDate}var debug=!1,ExifTags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",
33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},IptcFieldMap={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"},TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"};return{objectURLToBlob:objectURLToBlob,base64ToArrayBuffer:base64ToArrayBuffer,getData:getData,getTag:getTag,getAllTags:getAllTags,getPrettyData:getPrettyData,getOriginalDate:getOriginalDate}}angular.module("app.core").factory("exifService",exifService),exifService.$inject=[]}(),function(){"use strict";function geolocation($window,$document,$sessionStorage,principal){function startGeolocation(){var bgGeo=$window.backgroundGeolocation;bgGeo&&$document[0].addEventListener("deviceready",onDeviceReady,!1)}function stopGeolocation(){var bgGeo=$window.backgroundGeolocation;bgGeo&&backgroundGeolocation.stop()}function onDeviceReady(){var bgGeo=$window.backgroundGeolocation,geolocationInterval=principal.getGeolocationInterval();bgGeo.configure(onGeolocationSuccess,onGeolocationError,{desiredAccuracy:10,stationaryRadius:20,distanceFilter:30,interval:geolocationInterval?6e4*geolocationInterval:6e4}),bgGeo.start()}function onGeolocationSuccess(location){var bgGeo=$window.backgroundGeolocation;console.log(location),$sessionStorage.lastLocation=JSON.stringify({latitude:location.latitude,longitude:location.longitude}),bgGeo.finish()}function onGeolocationError(error){console.log("BackgroundGeolocation error",error)}function getLastLocation(){if($sessionStorage.hasOwnProperty("lastLocation")){var lastLocation;try{lastLocation=JSON.parse($sessionStorage.lastLocation)}catch(e){lastLocation=!1}return lastLocation}return!1}var service;return service={startGeolocation:startGeolocation,stopGeolocation:stopGeolocation,getLastLocation:getLastLocation}}angular.module("app.core").factory("geolocation",geolocation),geolocation.$inject=["$window","$document","$sessionStorage","principal"]}(),function(undefined){"use strict";function stepsService(dataservice,campaignsDataservice,$sessionStorage,STEP_IN_DATES,STEP_IS_FINISHING_IN_DAYS,STEP_ADD_MONTH_TO_END_CYCLE){function init(drugstoreId,campaignId,data){var steps_statuses;if(drugstoresStepsStatuses=[],campaignsSteps[campaignId]={},data){try{steps_statuses=JSON.parse(data.campaign_steps_status)}catch(e){steps_statuses={}}drugstoresStepsStatuses.push({drugstore:drugstoreId,campaign:campaignId,statuses:steps_statuses,progress_info:{multi:data.multi,cycle_start:data.cycle_date_start,cycle_end:data.cycle_date_end}})}}function initStepsStatusesByDrugstore(drugstoreId,campaigns_ids,data){var steps_statuses,campaigns_status_done=[];drugstoresStepsStatuses=[],campaignsStatus={},data.forEach(function(el){if(campaigns_ids.indexOf(el.campaign_id)>-1){try{steps_statuses=JSON.parse(el.campaign_steps_status)}catch(e){steps_statuses={}}campaigns_status_done.indexOf(el.campaign_id)==-1&&(campaigns_status_done.push(el.campaign_id),drugstoresStepsStatuses.push({drugstore:drugstoreId,campaign:el.campaign_id,statuses:steps_statuses,progress_info:{multi:el.multi,cycle_start:el.cycle_date_start,cycle_end:el.cycle_date_end}}),campaignsStatus[el.campaign_id]={progress_id:el.id||null,campaign_status:el.campaign_status||null})}})}function loadStepsStatuses(campaignId,cached){return drugstoresStepsStatuses=[],campaignsSteps={},campaignsSteps[campaignId]={},cached?campaignsDataservice.loadStepsStatuses().then(function(data){return _applyStepsStatuses(campaignId,data)}):dataservice.setOneCallConfig({cache:!1}).tenant.customOauth.get("campaigns-drugstores-progress","get-steps-statuses/campaign/"+campaignId).then(function(data){return _applyStepsStatuses(campaignId,data)})}function _applyStepsStatuses(campaignId,data){var steps_statuses;return data.forEach(function(el){try{steps_statuses=JSON.parse(el.campaign_steps_status)}catch(e){steps_statuses={}}drugstoresStepsStatuses.push({drugstore:el.drugstore_id,campaign:campaignId,statuses:steps_statuses,progress_info:{multi:el.multi,cycle_start:el.cycle_date_start,cycle_end:el.cycle_date_end}})}),drugstoresStepsStatuses}function visibility(obj,properties){var hasNetWork=properties.has_network,individual_visibility=parseInt(obj.individual_visibility),negotiation_visibility=parseInt(obj.network_negotiation_point_visibility),selling_visibility=parseInt(obj.network_selling_point_visibility),negotiation_selling_visibility=parseInt(obj.network_negotiation_selling_point_visibility),isVisible=!0;return hasNetWork?properties.negotiation_point?properties.selling_point?negotiation_selling_visibility||negotiation_visibility||(isVisible=!1):negotiation_visibility||(isVisible=!1):properties.selling_point&&!selling_visibility&&(isVisible=!1):individual_visibility||(isVisible=!1),isVisible}function getSteps(strDefinition,properties){var step;try{definition=JSON.parse(strDefinition),steps=definition.steps;for(var i=0,len=steps.length;i<len;i++)step=steps[i],step.allPages=step.pages,step.isWarningStep=isWarningStep(calcTime(new Date(step.date_end),!0)),properties&&(step.disabled=!visibility(step,properties))}catch(e){}return steps}function getStepId(drugstoreId,stepId){return stepId+"_"+drugstoreId}function getNetworkHelper(){var networkHelper=0;return definition&&(networkHelper=definition.drugstore_network_helper),networkHelper}function getServices(strDefinition){var services=[];if(strDefinition)try{services=JSON.parse(strDefinition).services}catch(e){}else definition&&(services=definition.services);return services}function getServicesGroups(){var servicesGroups=[];return definition&&definition.services_groups&&(servicesGroups=definition.services_groups),servicesGroups}function getVisibility(strDefinition){var visibility=[];if(strDefinition)try{visibility=JSON.parse(strDefinition).visibility}catch(e){}else definition&&(visibility=definition.visibility);return visibility}function getPages(stepIndex,properties,userSteps){var step,isVisible,pages=[];if(steps.length&&steps[stepIndex]?step=steps[stepIndex]:userSteps&&userSteps.length&&userSteps[stepIndex]&&(step=userSteps[stepIndex]),step)for(var i=0,len=step.pages.length;i<len;i++)isVisible=visibility(step.pages[i],properties),isVisible&&pages.push(step.pages[i]);return pages}function pageFilterByType(type){var res=!1,obj=[{type:"additional_information",title:"Local Info",name:"localInfo"},{type:"additional_information_start_control",title:"Local Info Control",name:"localInfoControl"},{type:"general_information",title:"General Info",name:"generalInfo"},{type:"general_information_edit",title:"General Info Edit",name:"generalInfoEdit"},{type:"last_selling_info",title:"Last Selling Info",name:"lastSellingInfo"},{type:"proposal_total",title:"Proposal Total",name:"proposalTotal"},{type:"proposal",title:"Proposal",name:"proposal"},{type:"services_control",title:"Merchandising",name:"merchandising"},{type:"final_report",title:"Final Report",name:"finalReport"},{type:"selling_info",title:"Selling info",name:"sellingInfo"},{type:"argumentation_for_client",title:"Argumentation for Client",name:"argsForClient"},{type:"argumentation_for_client_gift",title:"Argumentation Gift",name:"argsForClientGift"},{type:"drugstores_list",title:"Drugstores list",name:"drugstoresList"},{type:"conference_invitation",title:"Conference Invitation",name:"conferenceInvitation"},{type:"campaign_invoice",title:"Invoice",name:"invoice"}],objFiltered=obj.filter(function(el){return el.type==type});return objFiltered.length&&(res={title:objFiltered[0].title,name:objFiltered[0].name}),res}function isInnerStep(step){var needPages;return step&&step.allPages&&(needPages=step.allPages.find(function(page){return"proposal_total"==page.type||"final_report"==page.type})),!angular.isDefined(needPages)}function isFirstStep(step){var needPages=step.pages.find(function(page){return"proposal_total"==page.type});return angular.isDefined(needPages)}function isFinRepStep(step){var needPages=step.pages.find(function(page){return"final_report"==page.type});return angular.isDefined(needPages)}function isServiceControlStep(step){var needPages=step.pages.find(function(page){return"services_control"==page.type});return angular.isDefined(needPages)}function getAdditionalInfo(){var additionalInfoPage;return steps.find(function(step,index){var isAddInfo=step.pages.find(function(page){return"additional_information"==page.type});return isAddInfo&&(additionalInfoPage=isAddInfo),isAddInfo}),additionalInfoPage}function getDrugsGroups(strDefinition){var drugsGroups=[];if(strDefinition)try{drugsGroups=JSON.parse(strDefinition).drugsGroups}catch(e){}else definition&&(drugsGroups=definition.drugsGroups);return drugsGroups}function getCampaignIcon(strDefinition){var icon=null;if(strDefinition)try{icon=JSON.parse(strDefinition).icon||icon}catch(e){}else definition&&(icon=definition.icon||icon);return icon}function getDrugStoresGroups(strDefinition){var drugstoresGroups=[];if(strDefinition)try{drugstoresGroups=JSON.parse(strDefinition).drugstoresGroups}catch(e){}else definition&&(drugstoresGroups=definition.drugstoresGroups);return drugstoresGroups}function getLimitCycleByCurrentMonth(){var isLimit=!1;return definition&&angular.isDefined(definition.limit_cycle_by_current_month)&&(isLimit=definition.limit_cycle_by_current_month),isLimit}function isBlocked(props,metadata){var data,i,prop,yes,no,isBlock=!1,len=metadata.length;for(i=0;i<len;i++)if(data=metadata[i],prop=props["ds_prop_"+data.key]&&props["ds_prop_"+data.key]["ds_prop_"+data.key]?props["ds_prop_"+data.key]["ds_prop_"+data.key]:null)if(yes=prop.yes||"",no=prop.no||"",yes||no){if(yes&&1==prop.yes&&"1"==data.value){isBlock=!0;break}if(no&&1==prop.no&&"0"==data.value){isBlock=!0;break}}else if("1"==prop[data.value]){isBlock=!0;break}return isBlock}function isWithinDates(d1,d2){var now=new Date,isInDates=!0;return now.setHours(0,0,0,0),d1.setHours(0,0,0,0),d2.setHours(0,0,0,0),STEP_IN_DATES&&(isInDates=now.getTime()<=d2.getTime()&&now.getTime()>=d1.getTime()),isInDates}function isWarningStep(dateEnd){var daysBeforeEnd,now=new Date,isWarning=!1;return STEP_IS_FINISHING_IN_DAYS&&(now.setHours(0,0,0,0),dateEnd.setHours(0,0,0,0),daysBeforeEnd=calculatePassedDays(dateEnd),daysBeforeEnd<=STEP_IS_FINISHING_IN_DAYS&&now<=dateEnd&&(0===daysBeforeEnd&&now<=dateEnd&&(daysBeforeEnd=1),isWarning=daysBeforeEnd)),isWarning}function checkDrugstoreBlockProperty(drugstoreId,campaignId,drugstoreMetadata,dataPotential){var dataPotentialForDrugstore,additionalInfo=getAdditionalInfo(),potential=null,blocked=!1;if(additionalInfo&&drugstoreMetadata&&drugstoreMetadata.length&&isBlocked(additionalInfo.properties,drugstoreMetadata)&&(blocked=!0),dataPotential&&(dataPotentialForDrugstore=dataPotential.find(function(el){return el.drugstore_id==drugstoreId&&el.campaign_id==campaignId})))try{potential=JSON.parse(dataPotentialForDrugstore.potential),angular.isDefined(potential.compliant)&&!potential.compliant&&(blocked=!0)}catch(e){}return blocked}function getStep(drugstoreId,campaignId,step,status,isStepStart,isStepWarning,isSetStepStatus){var result,stepProperties=checkStepStatus(status,isStepStart,isStepWarning);return drugstoreId&&isSetStepStatus&&setStepStatus(drugstoreId,campaignId,step.unique_id,status),result={unique_id:step.unique_id,status:status,disabled:step.disabled||!1,readOnly:stepProperties.readOnly,color:stepProperties.color,specColor:stepProperties.specColor||undefined,name:step.name,identifier:step.identifier,icon:step.icon||null,icon_color:step.icon+"-"+stepProperties.color,date_start:new Date(step.date_start),date_end:new Date(step.date_end),pages:step.pages,allPages:step.allPages,inDate:step.inDate||undefined,isStepStart:isStepStart,isWarningStep:isStepWarning?isStepWarning:undefined,debug:step.debug?step.debug:undefined}}function getDrugstoreSteps(properties){var step,status,firstStepStatus,lastStepStatus,isStepStart,isStepWarning,stepDateEnd,stepDateEnd2,drugstoreId=properties.drugstoreId,campaignId=properties.campaignId,isFirstStepStart=properties.is_first_step_start,isLastStepStart=properties.is_last_step_start,isShowDisableStep=properties.is_show_disable_step,isSetStepStatus=!angular.isDefined(properties.is_set_step_status)||properties.is_set_step_status,progressInfo=getDrugstoresStepsStatuses(drugstoreId,campaignId),stepLength=steps.length,isVisible=!0,isInDates=!0,drugstoreSteps=[];if(progressInfo){stepLength&&isFinRepStep(steps[stepLength-1])&&(lastStepStatus=getStepStatus(steps[stepLength-1].unique_id,drugstoreId,campaignId));for(var i=0;i<stepLength;i++){if(step=steps[i],isVisible=visibility(step,{has_network:properties.has_network,negotiation_point:properties.negotiation_point,selling_point:properties.selling_point}),step.disabled=!1,!isVisible){if(!isShowDisableStep&&i>0)continue;step.disabled=!0}isStepStart=!1,isStepWarning=!1,stepDateEnd=calcTime(new Date(step.date_end),!0),status=getStepStatus(step.unique_id,drugstoreId,campaignId),0===i&&isFirstStep(step)?(firstStepStatus=status,isFirstStepStart&&(status==statusInDates?isStepStart=!0:isFirstStepStart=!1)):i>0&&i<stepLength-1?(status!=statusInDates||"completed"==firstStepStatus&&"completed"!=lastStepStatus&&"in_progress"!=lastStepStatus||(status=statusNotInDates),setCloseStepButton(step)):i==stepLength-1&&isFinRepStep(step)&&(lastStepStatus!=statusNotInDates&&lastStepStatus!=statusInDates||("completed"!=firstStepStatus?status=statusNotInDates:("multi"==progressInfo.progress_info.multi?(stepDateEnd=calcTime(progressInfo.progress_info.cycle_end,!0),stepDateEnd2=calcTime(stepDateEnd),stepDateEnd2.setMonth(stepDateEnd2.getMonth()+STEP_ADD_MONTH_TO_END_CYCLE),isInDates=isWithinDates(stepDateEnd,stepDateEnd2)):isInDates=lastStepStatus==statusInDates,status=isInDates?statusInDates:statusNotInDates),status==statusInDates&&isLastStepStart&&(isStepStart=!0))),status==statusInDates&&(isStepWarning=isWarningStep(stepDateEnd)),drugstoreSteps.push(getStep(drugstoreId,campaignId,step,status,isStepStart,isStepWarning,isSetStepStatus))}return drugstoreSteps}return properties.service_control_statuses?getNotPaidCampaignSteps(properties):getCampaignSteps(properties)}function addOneStepNotPaidCampaign(step,properties){var status,stepProperties,stepDateEnd,isInDates,isStepStart,isStepWarning,campaignId=properties.campaignId,service_control_statuses=properties.service_control_statuses;return isInDates=isWithinDates(calcTime(new Date(step.date_start),!0),calcTime(new Date(step.date_end),!0)),status=isInDates?statusInDates:statusNotInDates,setCloseStepButton(step),isStepStart=!1,isStepWarning=!1,isServiceControlStep(step)&&(angular.isDefined(service_control_statuses[properties.drugstoreId])&&angular.isDefined(service_control_statuses[properties.drugstoreId][step.unique_id])?1==service_control_statuses[properties.drugstoreId][step.unique_id]?status="completed":0===service_control_statuses[properties.drugstoreId][step.unique_id]?status="rejected":service_control_statuses[properties.drugstoreId][step.unique_id]==-1?status="in_progress":service_control_statuses[properties.drugstoreId][step.unique_id]==-2&&(isStepStart=!0):isStepStart=!1,status==statusInDates&&(stepDateEnd=calcTime(new Date(step.date_end),!0),isStepWarning=isWarningStep(stepDateEnd))),stepProperties=checkStepStatus(status),step.readOnly=stepProperties.readOnly,step.color=stepProperties.color,step.status=status,step.inDate=isInDates,getStep(properties.drugstoreId,campaignId,step,status,isStepStart,isStepWarning)}function getNotPaidCampaignSteps(properties){var drugstore_steps,step,isVisible,drugstoreSteps=[],isShowDisableStep=properties.is_show_disable_step,dynamic_steps=properties.dynamic_steps;drugstore_steps=cloneObj(steps),dynamic_steps&&angular.isDefined(dynamic_steps[properties.drugstoreId])&&(drugstore_steps=drugstore_steps.concat(dynamic_steps[properties.drugstoreId]));for(var i=0,len=drugstore_steps.length;i<len;i++){if(drugstore_steps[i].disabled=!1,isVisible=visibility(drugstore_steps[i],{has_network:properties.has_network,negotiation_point:properties.negotiation_point,selling_point:properties.selling_point}),!isVisible){if(!isShowDisableStep)continue;drugstore_steps[i].disabled=!0}step=addOneStepNotPaidCampaign(drugstore_steps[i],properties),drugstoreSteps.push(step)}return drugstoreSteps}function getCampaignSteps(properties){var needSteps,drugstoreId,campaignId=properties.campaignId,isFirstStepStart=properties.is_first_step_start,isShowDisableStep=properties.is_show_disable_step,getStepsForCampaign=function(){for(var step,status,isInDates,stepProperties,isStepStart,isStepWarning,stepDateEnd,isVisible=!0,drugstoreSteps=[],i=0,len=steps.length;i<len;i++){if(step=steps[i],step.disabled=!1,isVisible=visibility(step,{has_network:properties.has_network,negotiation_point:properties.negotiation_point,selling_point:properties.selling_point}),!isVisible){if(!isShowDisableStep)continue;step.disabled=!0}isStepStart=!1,isStepWarning=!1,0===i&&isFirstStep(step)?properties.is_blocked?status="drugstore_not_compliant":(isInDates=isWithinDates(calcTime(new Date(step.date_start),!0),calcTime(new Date(step.date_end),!0)),status=isInDates?statusInDates:statusNotInDates,status==statusInDates&&(stepDateEnd=calcTime(new Date(step.date_end),!0),isStepWarning=isWarningStep(stepDateEnd)),isFirstStepStart&&(status==statusInDates?isStepStart=!0:isFirstStepStart=!1)):status=statusNotInDates,stepProperties=checkStepStatus(status),step.readOnly=stepProperties.readOnly,step.color=stepProperties.color,step.status=status,drugstoreId=isFirstStepStart?properties.drugstoreId:0,drugstoreSteps.push(getStep(drugstoreId,campaignId,step,status,isStepStart,isStepWarning))}return drugstoreSteps};return properties.has_network?properties.negotiation_point&&properties.selling_point?needSteps="stepsNegotiationSelling":properties.negotiation_point?needSteps="stepsNegotiation":properties.selling_point&&(needSteps="stepsSelling"):needSteps="stepsIndividual",properties.is_blocked&&(needSteps+="Blocked"),isFirstStepStart&&(needSteps+="FirstStepStart"),campaignsSteps[campaignId]||(campaignsSteps[campaignId]={}),campaignsSteps[campaignId][needSteps]||(campaignsSteps[campaignId][needSteps]=getStepsForCampaign()),campaignsSteps[campaignId][needSteps]}function setColorStepCounter(drugstores){var colorStepCounter=[];return colorStepCounter.all=[],angular.forEach(drugstores,function(drugstore){drugstore.steps&&angular.forEach(drugstore.steps,function(step){if(!step.disabled&&(colorStepCounter[step.identifier]||(colorStepCounter[step.identifier]=[]),step.icon_color)){var color=step.icon_color.split("-")[1];if("green"==color&&step.isStepStart&&(color="lightgreen"),colorStepCounter[step.identifier][color]?colorStepCounter[step.identifier][color]++:colorStepCounter[step.identifier][color]=1,colorStepCounter.all[color]?colorStepCounter.all[color]++:colorStepCounter.all[color]=1,step.isWarningStep){var warningColor="greenwarning";colorStepCounter[step.identifier][warningColor]?colorStepCounter[step.identifier][warningColor]++:colorStepCounter[step.identifier][warningColor]=1,colorStepCounter.all[warningColor]?colorStepCounter.all[warningColor]++:colorStepCounter.all[warningColor]=1}}})}),colorStepCounter}function setStepColorInfo(drugstores){var stepColorInfo=[];return angular.forEach(drugstores,function(drugstore){drugstore.steps&&angular.forEach(drugstore.steps,function(step){step.disabled||(stepColorInfo[drugstore.id]||(stepColorInfo[drugstore.id]=[]),stepColorInfo[drugstore.id][step.identifier]=step.icon_color)})}),stepColorInfo}function getDrugstoreStepsForFinRep(properties){for(var step,isVisible=!0,stepPages=[],drugstoreSteps=[],i=0,len=steps.length;i<len;i++)step=steps[i],isVisible=visibility(step,properties),isVisible&&(stepPages=getPages(i,{has_network:properties.has_network,negotiation_point:properties.negotiation_point,selling_point:properties.selling_point}),drugstoreSteps.push({unique_id:step.unique_id,name:step.name,identifier:step.identifier,pages:stepPages}));return drugstoreSteps}function setStepsStatuses(drugstoreId,campaignId,data){var statuses,drugstoreStepsStatuses,obj;drugstoreStepsStatuses=drugstoresStepsStatuses.find(function(el){return el.drugstore==drugstoreId&&el.campaign==campaignId});try{statuses=JSON.parse(data)}catch(e){statuses={}}return drugstoreStepsStatuses?drugstoreStepsStatuses.statuses=statuses:(obj={drugstore:drugstoreId,campaign:campaignId,statuses:statuses},campaignProgressInfo&&(obj.progress_info=campaignProgressInfo,campaignProgressInfo={}),drugstoresStepsStatuses.push(obj)),drugstoreStepsStatuses?JSON.stringify(drugstoreStepsStatuses.statuses):"{}"}function getStepsStatuses(drugstoreId,campaignId){var drugstoreStepsStatuses;return drugstoreStepsStatuses=drugstoresStepsStatuses.find(function(el){return el.drugstore==drugstoreId&&el.campaign==campaignId}),drugstoreStepsStatuses&&(campaignProgressInfo=drugstoreStepsStatuses.progress_info),drugstoreStepsStatuses?JSON.stringify(drugstoreStepsStatuses.statuses):"{}"}function getStepStatus(stepId,drugstoreId,campaignId){var drugstoreStepsStatuses,status,isInner,isInDates,step=steps.find(function(el){return el.unique_id==stepId});return isInner=isInnerStep(step),isInner&&(stepId=getStepId(drugstoreId,stepId)),drugstoreStepsStatuses=drugstoresStepsStatuses.find(function(el){return el.drugstore==drugstoreId&&el.campaign==campaignId}),drugstoreStepsStatuses&&drugstoreStepsStatuses.statuses.hasOwnProperty(stepId)?status=drugstoreStepsStatuses.statuses[stepId]:(isInDates=isWithinDates(calcTime(new Date(step.date_start),!0),calcTime(new Date(step.date_end),!0)),status=isInDates?statusInDates:statusNotInDates),status}function setStepStatus(drugstoreId,campaignId,stepId,status){var idx,step,isInner,statuses={};step=steps.find(function(el){return el.unique_id==stepId}),isInner=isInnerStep(step),isInner&&(stepId=getStepId(drugstoreId,stepId)),idx=drugstoresStepsStatuses.findIndex(function(el){return el.drugstore==drugstoreId&&el.campaign==campaignId}),idx>-1?drugstoresStepsStatuses[idx].statuses[stepId]=status:(statuses[stepId]=status,drugstoresStepsStatuses.push({drugstore:drugstoreId,campaign:campaignId,statuses:statuses}))}function setStepProperties(status,step){var stepProperties=checkStepStatus(status);stepProperties&&(step.status=status,step.readOnly=stepProperties.readOnly,step.color=stepProperties.color,step.icon_color=step.icon+"-"+stepProperties.color,status!=statusInDates&&step.isStepStart&&(step.isStepStart=!1),status!=statusInDates&&(step.isWarningStep=!1))}function setCloseStepButton(step){isInnerStep(step)&&step.pages&&step.pages.length&&(step.pages[step.pages.length-1].needCloseStep=!0)}function getDrugstoresStepsStatuses(drugstoreId,campaignId){return drugstoreId||campaignId?drugstoresStepsStatuses.find(function(el){var result;return drugstoreId&&campaignId?result=el.drugstore==drugstoreId&&el.campaign==campaignId:drugstoreId?result=el.drugstore==drugstoreId:campaignId&&(result=el.campaign==campaignId),result}):drugstoresStepsStatuses}function getCampaignsStatus(){return campaignsStatus}function checkStepStatus(status,isStepStart,isStepWarning){var color,readOnly,specColor=[];switch(status){case statusNotInDates:color="grey";break;case statusInDates:color="green";break;case"in_progress":color="yellow";break;case"completed":color="marine";break;case"rejected":color="red";break;case"drugstore_not_compliant":color="black"}return isStepStart&&specColor.push("lightgreen"),isStepWarning&&specColor.push("greenwarning"),readOnly=!(status==statusInDates||"rejected"==status||"drugstore_not_compliant"==status),{readOnly:readOnly,color:color,specColor:specColor}}function setPageReadOnly(isDisabled){for(var step,steps=getSteps(),i=0,len=steps.length;i<len;i++)step=steps[i],step.readOnly=isDisabled}function selectStepColor(stepName,color,callback){return(""!==stepName||""===color)&&(""===stepName&&""===color&&($sessionStorage.stepFilter=null),callback())}function selectOnlyColor(color,callback){return""===color&&($sessionStorage.stepFilter=null),callback()}var steps=[],definition=null,drugstoresStepsStatuses=[],campaignProgressInfo={},campaignsStatus={},campaignsSteps={},statusNotInDates="not_within_dates_or_blocked",statusInDates="within_dates_and_unblocked";return{init:init,initStepsStatusesByDrugstore:initStepsStatusesByDrugstore,loadStepsStatuses:loadStepsStatuses,checkDrugstoreBlockProperty:checkDrugstoreBlockProperty,getSteps:getSteps,getStepId:getStepId,getPages:getPages,pageFilterByType:pageFilterByType,isInnerStep:isInnerStep,isFirstStep:isFirstStep,isFinRepStep:isFinRepStep,isServiceControlStep:isServiceControlStep,getAdditionalInfo:getAdditionalInfo,getVisibility:getVisibility,isWithinDates:isWithinDates,getDrugstoreSteps:getDrugstoreSteps,getDrugstoreStepsForFinRep:getDrugstoreStepsForFinRep,addOneStepNotPaidCampaign:addOneStepNotPaidCampaign,getCampaignIcon:getCampaignIcon,getNetworkHelper:getNetworkHelper,getServices:getServices,getServicesGroups:getServicesGroups,getDrugsGroups:getDrugsGroups,getDrugStoresGroups:getDrugStoresGroups,getLimitCycleByCurrentMonth:getLimitCycleByCurrentMonth,visibility:visibility,isBlocked:isBlocked,getStepStatus:getStepStatus,setStepStatus:setStepStatus,setStepProperties:setStepProperties,setCloseStepButton:setCloseStepButton,checkStepStatus:checkStepStatus,setStepsStatuses:setStepsStatuses,getStepsStatuses:getStepsStatuses,getDrugstoresStepsStatuses:getDrugstoresStepsStatuses,getCampaignsStatus:getCampaignsStatus,setPageReadOnly:setPageReadOnly,selectStepColor:selectStepColor,selectOnlyColor:selectOnlyColor,setColorStepCounter:setColorStepCounter,setStepColorInfo:setStepColorInfo,isWarningStep:isWarningStep}}angular.module("app.core").factory("stepsService",stepsService),stepsService.$inject=["dataservice","campaignsDataservice","$sessionStorage","STEP_IN_DATES","STEP_IS_FINISHING_IN_DAYS","STEP_ADD_MONTH_TO_END_CYCLE"]}(),angular.module("app.core").run(["$templateCache",function($templateCache){$templateCache.put("app/auth/auth.html",'<div>\n    <div class="row" ui-view></div>\n</div>\n'),$templateCache.put("app/auth/auth.login-helpdesk.modal.html",'<div class="ui modal" id="helpdesk">\n\n    <i class="close icon"></i>\n\n    <form class="ui form" id="helpdesk_form" name="helpdeskForm">\n        <div class="content">\n            <div class="ui basic segment">\n                <div class="ui error message" style="display: block" ng-show="vm.sendError">\n                    <i class="close icon"></i>\n                    <div class="header">\n                        There was some errors with your message sending: {{vm.errMsg}}\n                    </div>\n                </div>\n                <div class="two fields">\n                    <div class="field" ng-class="{error: vm.helpdeskFormSubmitted && !vm.helpdeskMessage.username}">\n                        <div class="ui left icon big input">\n                            <input type="text" id="username" ng-model="vm.helpdeskMessage.username" placeholder="{{\'USERNAME\' | translate}}" required>\n                            <i class="user deepblue icon"></i>\n                        </div>\n                    </div>\n                    <div class="field" ng-class="{error: vm.helpdeskFormSubmitted && !vm.helpdeskMessage.email}">\n                        <div class="ui left icon big input">\n                            <input type="email" id="email" ng-model="vm.helpdeskMessage.email" placeholder="{{\'EMAIL\' | translate}}" required>\n                            <i class="mail deepblue icon"></i>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="two fields">\n                    <div class="field" ng-class="{error: vm.helpdeskFormSubmitted && !vm.helpdeskMessage.phone}">\n                        <div class="ui left icon big input">\n                            <input type="text" id="phone" ng-model="vm.helpdeskMessage.phone" placeholder="{{\'PHONE\' | translate}}" required>\n                            <i class="call deepblue icon"></i>\n                        </div>\n                    </div>\n                    <div class="field" ng-class="{error: vm.helpdeskFormSubmitted && !vm.helpdeskMessage.company}">\n                        <div class="ui left icon big input">\n                            <input type="text" id="company" ng-model="vm.helpdeskMessage.company" placeholder="{{\'COMPANY\' | translate}}" required>\n                            <i class="building deepblue icon"></i>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="field" ng-class="{error: vm.helpdeskFormSubmitted && !vm.helpdeskMessage.message}">\n                    <div class="ui left icon big input input-textarea">\n                        <textarea placeholder="{{\'MESSAGE\' | translate}}" ng-model="vm.helpdeskMessage.message" class="input-textarea" required></textarea>\n                        <i class="write deepblue icon"></i>\n                    </div>\n                </div>\n\n            </div>\n            <div class="ui">\n                <div class="ui grid">\n                    <div class="ui two wide column"></div>\n                    <div class="ui six wide column center aligned">\n                        <button class="ui pale left icon big button" ng-click="vm.hideHelpdeskModal()">\n                            <i class="cancel icon"></i>\n                            {{\'CANCEL\' | translate}}\n                        </button>\n                    </div>\n                    <div class="ui six wide column center aligned">\n                        <button class="ui navy left icon big button" ng-click="vm.sendHelpdeskMessage(helpdeskForm.$valid)">\n                            <i class="send icon"></i>\n                            {{\'SEND\' | translate}}\n                        </button>\n                    </div>\n                    <div class="ui two wide column"></div>\n                </div>\n            </div>\n        </div>\n    </form>\n\n\n    <div class="ui navy icon message center aligned">\n        <div class="content">\n            <div class="header">\n                <i class="call sign icon"></i> {{\'HELP\' | translate}}: 22 251 00 11\n            </div>\n        </div>\n    </div>\n\n    <br clear="all">\n\n</div>\n'),
$templateCache.put("app/auth/auth.login.html",'<div id="container" class="ui segment main container container-main">\n\n    <div class="ui main container">\n\n        <div class="ui center aligned basic segment" id="logo-area">\n            <img src="assets/img/tenant-logo/multicolor-logo.png" alt="TEVA" style="max-width: 50%">\n        </div>\n\n        <div class="ui grid">\n\n\n            <div class="ui four wide column"></div>\n            <div class="ui eight wide column">\n\n\n                <form class="ui form">\n\n                    <div class="ui basic segment">\n\n                        <h4 class="ui header">{{\'WELCOME_LOGIN\' | translate}}</h4>\n\n                        <div class="ui error message" style="display: block" ng-cloak ng-show="vm.loginError">\n                            <i class="close icon" ng-click="vm.hideLoginError()"></i>\n                            <div class="header">\n                                {{vm.loginErrMsg | translate}}\n                            </div>\n                        </div>\n\n                        <div class="ui fluid large input required field">\n                            <div class="ui left fluid input">\n                                <input type="email" name="email" ng-model="vm.email" required>\n                            </div>\n                        </div>\n\n                        <div class="ui fluid large input required field">\n                            <div class="ui left fluid input">\n                                <input type="password" name="password" ng-model="vm.password" required>\n                            </div>\n                        </div>\n\n                    </div>\n\n                    <div class="ui basic segment">\n                        <div class="ui two column grid">\n\n                            <div class="column">\n                                <img src="assets/img/icons/design/helpdesk.jpg" alt="Help Desk" id="helpdeskCall" ng-click="vm.showHelpdeskModal()" class="clickable">\n                            </div>\n\n                            <div class="column right aligned">\n                                <button class="ui submit big button" ng-disabled="vm.lockForm" ng-click="vm.login()">\n                                    <i class="sign in icon" ng-hide="vm.lockForm"></i>\n                                    <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n                                    {{\'LOGIN\' | translate}}\n                                </button>\n\n                                <div class="ui basic divider"></div>\n\n                                <p>\n                                    <a href="" ng-click="vm.showPasswordResetModal()" class="a increased">{{\'REMIND_PASS\'\n                                        | translate}}</a>\n                                </p>\n                            </div>\n\n                        </div>\n                    </div>\n\n                </form>\n\n            </div>\n            <div class="ui four wide column"></div>\n\n        </div>\n    </div>\n</div>\n\n<div id="footer-bar" class="ui fixed bottom main menu">\n    <div class="ui basic center aligned segment" id="footer-bar-main">\n        <!-- <img src="assets/img/logo/logo_3angle.jpg" alt="3angle"> -->\n    </div>\n</div>\n\n<ng-include src="\'app/auth/auth.login-helpdesk.modal.html\'"></ng-include>\n<ng-include src="\'app/auth/auth.password-reset.modal.html\'"></ng-include>\n\n<img src="assets/img/logo/logo_footer.jpg" alt="3dom" id="logo-principal">\n'),$templateCache.put("app/auth/auth.password-reset.modal.html",'<div class="ui modal" id="password-reset">\n\n    <i class="close icon"></i>\n\n    <form class="ui form" id="password-reset_form" name="passwordResetForm">\n        <div class="content">\n            <div class="ui basic segment">\n\n                <h4 class="ui header">{{\'WELCOME_RESET_PASSWORD\' | translate}}</h4>\n\n                <div class="ui error message" style="display: block" ng-show="vm.resetPasswordError">\n                    <i class="close icon"></i>\n                    <div class="header">\n                        {{vm.resetPasswordErrMsg}}\n                    </div>\n                </div>\n\n                <div class="ui success message" style="display: block" ng-show="vm.sentPassword">\n                    <!--<i class="close icon"></i>-->\n                    <div class="header">\n                        {{\'SENT_NEW_PASS\' | translate}}\n                    </div>\n                </div>\n\n                <div class="field">\n                    <div class="ui icon big input">\n                        <input type="email" id="email" ng-model="vm.passwordResetMessage.email" placeholder="{{\'EMAIL\' | translate}}" required>\n                        <i class="mail deepblue icon"></i>\n                    </div>\n                </div>\n\n            </div>\n            <div class="ui">\n                <div class="ui grid" ng-show="vm.passwordResetFormSubmitted">\n                    <div class="ui wide column center aligned">\n                        <button class="ui navy icon big button" ng-click="vm.hidePasswordResetModal(passwordResetForm.$valid)">\n                            <i class="cancel icon"></i>\n                            {{\'CLOSE\' | translate}}\n                        </button>\n                    </div>\n                </div>\n\n                <div class="ui grid" ng-show="!vm.passwordResetFormSubmitted">\n                    <div class="ui two wide column"></div>\n                    <div class="ui six wide column center aligned">\n                        <button class="ui pale left icon big button" ng-click="vm.hidePasswordResetModal()">\n                            <i class="cancel icon"></i>\n                            {{\'CANCEL\' | translate}}\n                        </button>\n                    </div>\n                    <div class="ui six wide column center aligned">\n                        <button class="ui navy left icon big button" ng-click="vm.sendPasswordResetMessage(passwordResetForm.$valid)">\n                            <i class="send icon"></i>\n                            {{\'SEND\' | translate}}\n                        </button>\n                    </div>\n                    <div class="ui two wide column"></div>\n                </div>\n            </div>\n        </div>\n    </form>\n    <br clear="all">\n</div>\n'),$templateCache.put("app/auth/auth.register.html",""),$templateCache.put("app/campaigns/campaigns.html","<div ui-view></div>\n"),$templateCache.put("app/clients/clients.html","<div ui-view></div>\n"),$templateCache.put("app/dashboard/dashboard.html","<div ui-view></div>\n"),$templateCache.put("app/dashboard/dashboard.main.html",'<div id="container" class="ui segment main container">\n    <!--h1 class="ui ribbon label breadcrumb"><div class="active section">Dashboard</div></h1-->\n\n    <div id="dashboard" class="ui basic segment main container">\n\n        <div class="ui four column padded grid">\n\n            <div ng-repeat="menuItem in vm.menuItems" class="teal column" ng-class="menuItem.icon">\n                <div class="ui center aligned basic segment">\n                    <h2><a ui-sref="{{menuItem.state}}"><i class="building outline icon"></i></a></h2>\n                    <p><a ui-sref="{{menuItem.state}}" class="dashboard-link">{{menuItem.label}}</a></p>\n                </div>\n            </div>\n\n        </div>\n\n    </div>\n</div>\n'),$templateCache.put("app/detailing/detailing.html","<div ui-view></div>\n"),$templateCache.put("app/gazetki/gazetki.html","<div ui-view></div>\n"),$templateCache.put("app/layout/404.html",'<div class="masthead error segment">\n    <div class="container">\n        <h1 class="ui dividing header">\n            {{\'THAT_HAPPENS_NOT_TO_BE_A_PAGE\' | translate}}\n        </h1>\n\n        <p>{{\'REWIND_AND_TRY_ANOTHER_ONE\' | translate}}</p>\n    </div>\n</div>\n'),$templateCache.put("app/layout/calendar.modal.html",'<atl-modal-form-dialog modal-id="\'addEventModal\'" modal-title="\'ADD_EVENT\' | translate" on-save="vm.saveCalendarEvent()" show-delete="\'false\'">\n  <div class="ui grid">\n\n    <div class="five wide column">\n      <div class="field">\n        <label>{{\'START_DATE\' | translate}}</label>\n        <input type="date" name="startDate" ng-model="vm.note.date_start">\n      </div>\n    </div>\n\n    <div class="three wide column">\n      <div class="field">\n        <label>{{\'START_TIME\' | translate}}</label>\n        <input type="time" name="startDateTime" ng-model="vm.note.time_start">\n      </div>\n    </div>\n\n\n    <div class="five wide column">\n      <div class="field">\n        <label>{{\'END_DATE\' | translate}}</label>\n        <input type="date" name="endDate" ng-model="vm.note.date_end">\n      </div>\n    </div>\n\n    <div class="three wide column">\n      <div class="field">\n        <label>{{\'END_TIME\' | translate}}</label>\n        <input type="time" name="endDateTime" ng-model="vm.note.time_end">\n      </div>\n    </div>\n\n  </div>\n\n  <div class="ui grid">\n\n    <div class="ui three wide column left aligned">\n      <div class="ui checkbox">\n        <input type="checkbox" name="allDayNote" id="all_day_check" ng-model="vm.note.allDay">\n        <label for="all_day_check">{{\'ALL_DAY\' | translate}}</label>\n      </div>\n    </div>\n\n    <!--<div class="ui two wide column right aligned">\n      <div class="ui checkbox">\n        <input type="checkbox" name="repeatNote" id="repeat_check" ng-model="vm.note.repeat">\n        <label for="repeat_check">Repeat</label>\n      </div>\n    </div>\n\n    <div class="ui eleven wide column left aligned" ng-if="vm.note.repeat">\n      <div class="ui checkbox" ng-repeat="day in vm.week_days" ng-if="vm.note.repeat">\n        <input type="checkbox" id="{{day.name}}_name" ng-model="day.selected">\n        <label for="{{day.name}}_name">{{day.name}}</label>\n      </div>\n    </div>-->\n\n  </div>\n\n  <div class="ui grid">\n\n    <div class="ui sixteen fourteen wide column">\n      <div class="field">\n        <label>{{\'TITLE\' | translate}}</label>\n        <input type="text" name="title" ng-model="vm.note.title">\n      </div>\n\n      <div class="field">\n        <label>{{\'DESCRIPTION\' | translate}}</label>\n        <textarea name="desc" ng-model="vm.note.description"></textarea>\n      </div>\n    </div>\n  </div>\n</atl-modal-form-dialog>'),$templateCache.put("app/layout/layout.header.html",'<div id="header-bar" class="ui fixed main menu">\n  <div id="header" class="ui center aligned grid">\n\n    <div class="ui one wide left aligned column" id="backlink">\n      <a ng-click="vm.back()" ng-show="vm.previousState"><img src="assets/img/icons/design/back2.png" alt="Back"></a>\n    </div>\n\n    <div class="ui five wide left aligned column">\n      <p id="bread-crumbs">\n        <span><i class="big refresh icon clickable" ng-click="vm.refresh()"></i></span>\n        <span ui-sref="{{vm.headerLinks.dashboard.state}}"> Główna <i class="icon angle right increased" ng-show="$root.breadcrumbTitle != \'\'"></i> </span>\n        <span ng-show="$root.breadcrumbParentTitle != \'\' && $root.breadcrumbParentState != \'\'" ng-click="vm.go($root.breadcrumbParentState)"> {{$root.breadcrumbParentTitle}} <i class="icon angle right increased"></i> </span>\n        <span ng-show="$root.breadcrumbTitle != \'\'"> {{$root.breadcrumbTitle | limitTo: 12}} </span>\n        &nbsp;\n        <span ng-show="$root.breadcrumbTitle != \'\'"><i class="icon {{vm.starClass}} star clickable" ng-click="vm.showBookmark()"></i></span>\n      </p>\n    </div>\n\n    <div class="ui three wide column">\n      <a ui-sref="{{vm.headerLinks.dashboard.state}}"><img src="assets/img/logo/logo_white.png" alt="3dom" id="logo_3dom"></a>\n    </div>\n\n    <div class="ui six wide right aligned column">\n      <div id="person_3dom_link">\n        <span ui-sref="{{vm.headerLinks.profile.state}}" class="clickable" id="person_3dom_link_name" ng-class="{person_3dom_link_name_labelled:vm.todo_count > 0}">\n          {{vm.principalName}}\n        </span>\n\t\t\n\t\t<sup class="ui red circular label" id="person_3dom_link_todo" ng-if="vm.todo_count > 0">{{vm.todo_count}}</sup>\n\n        <a ui-sref="{{vm.headerLinks.profile.state}}" class="clickable">\n          <img src="assets/img/icons/design/user.png" id="person_3dom" align="middle" ui-sref="{{vm.headerLinks.profile.state}}">\n        </a>\n        <a class="ui button transparent accented compact" ng-click="vm.logout()"><i class="sign out big icon"></i></a>\n      </div>\n    </div>\n\n    <div class="ui one wide right aligned column" id="notatki">\n      <a href="" ng-click="vm.showAddEvent()"><img src="assets/img/icons/design/notes.png" alt="Notatki"></a>\n    </div>\n\n  </div>\n</div>\n<atl-modal-form-dialog modal-id="\'editBookmarkModal\'" modal-title="\'EDIT_BOOKMARKS\' | translate" on-save="vm.saveBookmark()" show-delete="\'true\'" on-delete="vm.deleteBookmark()">\n  <div class="fields">\n    <label>Nazwa</label>\n    <input type="text" name="titlePage" value="{{vm.currentPage[vm.url]}}" ng-model="vm.currentPage[vm.url]">\n  </div>\n</atl-modal-form-dialog>\n<ng-include src="\'app/layout/calendar.modal.html\'"></ng-include>\n<atl-notifier></atl-notifier>\n'),$templateCache.put("app/layout/layout.navigation.html",'<div class="ui fixed bottom main menu">\n    <div id="footer" class="ui eight column center aligned grid">\n        <!--<div class="ui statistic menu-item-all" ng-class="{\'menu-item-selected\': vm.isActive(menuItem)}">-->\n\n        <div class="column" ng-repeat="menuItem in vm.menuItems">\n            <div class="ui statistic menu-item-all" ui-sref-active="\'menu-item-selected\'">\n                <a ui-sref="{{menuItem.state}}" ng-if="menuItem.children.length==0">\n                    <div>\n                        <i class="menu-item icon" ng-class="menuItem.icon"></i>\n                    </div>\n                    <div class="label menu-label">\n                        {{menuItem.label}}\n                    </div>\n                    <div class="floating ui red circular label" ng-if="menuItem.name == \'Messages\' && $root.recentMessages > 0" ng-bind-html="$root.recentMessages"></div>\n                    <div class="floating ui red circular label" ng-if="menuItem.name == \'Help\' && $root.recentHelp > 0" ng-bind-html="$root.recentHelp"></div>\n                </a>\n                <atl-dropdown class="ui upward combo bottom right pointing dropdown" direction="upward" ng-if="menuItem.children.length!==0" ng-if="menuItem.children.length!==0">\n                    <a style="text-align: center">\n                        <div><i class="menu-item icon" ng-class="menuItem.icon"></i></div>\n                        <div class="label menu-label">{{menuItem.label}}</div>\n                    </a>\n                    <div class="menu">\n                        <div class="item" ng-repeat="mymenu in menuItem.children">\n                            <a ui-sref="{{mymenu.state}}" class="header" style="color:#333">{{mymenu.label}}</a>\n                        </div>\n                    </div>\n                </atl-dropdown>\n            </div>\n        </div>\n    </div>\n</div>\n'),$templateCache.put("app/layout/presentation.pdf-viewer.html",'<div id="container" class="ui segment main container">\n    <div class="ui center aligned grid">\n\n        <div class="ui sixteen wide center aligned column">\n            {{loading}}\n            <canvas id="pdf-canvas" class="rotate0"></canvas>\n        </div>\n\n    </div>\n    <div class="ui three column center aligned grid">\n        <div class="left aligned column">\n            <form class="ui form">\n                <div class="inline field">\n                    <label>{{\'SLIDERSHOW_DELAY\' | translate}}</label>\n                    <select ng-model="slideshowInterval" class="ui dropdown">\n\t\t\t\t\t\t<option value="5" selected="selected">5 {{\'SECONDS\' | translate}}</option>\n                        <option value="10">10 {{\'SECONDS\' | translate}}</option>\n                        <option value="15">15 {{\'SECONDS\' | translate}}</option>\n                        <option value="30">30 {{\'SECONDS\' | translate}}</option>\n                        <option value="60">1 {{\'MINUTE\' | translate}}</option>\n                    </select>\n                </div>\n            </form>\n        </div>\n\n        <div class="column">\n            <div class="ui basic segment">\n                <button type="button" ng-click="goPrevious()" class="ui circular icon navy button">\n                    <i class="icon backward"></i>\n                </button>\n                <button type="button" ng-click="toggleSlideshow()" class="ui big circular icon navy button">\n                    <i class="icon play" ng-class="{play: !play, pause: play}"></i>\n                </button>\n                <button type="button" ng-click="goNext()" class="ui circular icon navy button">\n                    <i class="icon forward"></i>\n                </button>\n            </div>\n        </div>\n\n        <div class="right aligned column">\n            <div class="ui basic segment">\n                <a ng-if="vm._drugstoreId" ui-sref="detailing.afterPresentation({id: vm._id, presentationId: vm._presentationId, drugstoreId: vm._drugstoreId})" class="ui circular icon basic button">\n                    <i class="icon close"></i>\n                </a>\n                <a ng-if="!vm._drugstoreId" ui-sref="detailing.previewFilms({id: vm._id})" class="ui circular icon basic button">\n                    <i class="icon close"></i>\n                </a>\n            </div>\n        </div>\n    </div>\n\n</div>\n'),$templateCache.put("app/layout/shell.html",'<layout-header></layout-header>\n\n<div id="general-shell">\n    <div id="general-shell-content" ui-view class="shuffle-animation"></div>\n</div>\n\n<layout-navigation></layout-navigation>\n'),$templateCache.put("app/messaging/messages.html","<div ui-view></div>\n"),$templateCache.put("app/profile/profile.html","<div ui-view></div>\n"),$templateCache.put("app/widgets/atl.listSlider.html",'<div id="{{listId}}" class="list-slider">\n  <div class="arrow-left" ng-click="scrollPrev($event)" ng-style="{visibility:arrowsVisibility}">\n    <i class="large chevron left icon"></i>\n  </div>\n  <div class="h-scrollable {{classList}}" ng-model="hScroll" ng-style="{\'width\':hScroll.width, \'height\':hScroll.height}">\n    <div class="slider">\n      <div ng-transclude></div>\n    </div>\n  </div>\n  <div class="arrow-right" ng-click="scrollNext($event)" ng-style="{visibility:arrowsVisibility}">\n    <i class="large chevron right icon"></i>\n  </div>\n</div>'),$templateCache.put("app/widgets/atl.modal.attention.form.html",'<div class="ui modal" id="{{modalId}}">\n    <i class="close icon" ng-click="hideModal()"></i>\n\n\t<form class="ui form" name="modalDialogForm" novalidate ng-submit="hideModal()">\n\n    <div class="content">\n        <div class="ui basic segment">\n            <h3 class="data-header-info"><i class="icon edit"></i> {{modalTitle}}</h3>\n            <span ng-transclude></span>\n        </div>\n\n        <div class="ui actions" ng-hide="showAction === false">\n        <div class="ui grid">\n          <div class="ui sixteen wide column center aligned">\n            <div class="ui left icon navy large button spaced" ng-click="hideModal()">\n              OK\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\t</form>\n</div>'),$templateCache.put("app/widgets/atl.modal.confirm.dialog.html",'<div class="ui modal" id="{{modalId}}">\n    <i class="close icon" ng-click="hideModal()"></i>\n\n    <form class="ui form">\n      <div class="content">\n\n        <div class="ui red inverted segment">\n          <p><i class="warning sign icon"></i> {{modalTitle}}</p>\n        </div>\n\n        <div class="ui basic segment">\n          <span ng-transclude></span>\n        </div>\n\n        <div class="ui actions">\n          <div class="ui grid">\n            <div class="ui sixteen wide column center aligned">\n              <div class="ui left icon large negative cancel button spaced">\n                <i class="cancel icon"></i>\n                Odrzuć\n              </div>\n              <button type="submit" ng-disabled="lockForm || okDisabled" class="ui navy left icon large ok button spaced" ng-click="confirm()">\n                <i class="checkmark icon"></i>\n                Zatwierdź\n              </button>\n            </div>\n          </div>\n        </div>\n\n      </div>\n    </form>\n\n</div>\n'),$templateCache.put("app/widgets/atl.modal.form.dialog.html",'<div class="ui modal" id="{{modalId}}">\n    <i class="close icon" ng-click="hideModal()"></i>\n\n  <form class="ui form" name="modalDialogForm" novalidate ng-submit="modalDialogForm.$valid && save()">\n\n    <div class="content">\n\n      <div class="ui basic segment">\n\n        <h3 class="data-header-info"><i class="icon edit"></i> {{modalTitle}}</h3>\n\n        <span ng-transclude></span>\n\n      </div>\n\n      <div class="ui actions" ng-hide="showAction === false">\n        <div class="ui grid">\n          <div class="ui sixteen wide column center aligned">\n            <div class="ui left icon negative large button spaced" ng-click="hideModal()">\n              <i class="cancel icon"></i>\n              Anuluj\n            </div>\n            <div class="ui left icon negative large button spaced" ng-if="showDelete==\'true\'" ng-click="delete()">\n              <i class="trash icon"></i>\n              Usuń\n            </div>\n            <button type="submit" ng-disabled="!modalDialogForm.$valid || lockForm" class="ui navy left icon large button spaced">\n              <i class="checkmark icon"></i>\n              Zapisz\n            </button>\n          </div>\n        </div>\n      </div>\n\n    </div>\n  </form>\n\n</div>'),$templateCache.put("app/widgets/ui-dropdown-selection.html",'<div class="html">\n    <div class="ui selection dropdown" tabindex="0">\n        <input type="hidden" name="selector" ng-model="selectorValue">\n        <i class="dropdown icon"></i>\n\n        <div class="default text">{{}}</div>\n        <div class="menu transition hidden" tabindex="-1">\n            <div ng-repeat="item in items" class="item" data-value="{{item.value}}">{{item.name}}</div>\n        </div>\n    </div>\n    <!--<div class="ui top attached label">Example</div>-->\n</div>\n'),$templateCache.put("app/widgets/ui-modal-dialog.html",'<div class="ui modal" ng-transclude></div>\n'),$templateCache.put("app/campaigns/list/campaigns.filter.html",'<div id="container" class="ui segment main container">\n\n  <div class="basic segment ui grid">\n    <div class="ten wide column left aligned">\n     <div ng-if="vm.campaigns.length">\n      <atl-list-slider display-number="5" start-index="{{vm.campaigns.length > 5 ? vm.indexCampaign : 0}}" list-id="listCampaignButtons" class-list="compact ui tiny buttons campaigns-select-buttons">\n        <div ng-repeat="campaign in vm.campaigns" class="ui button c_active {{vm.activeColor[campaign.id]}} list-slider-item" ng-click="vm.filterByCampaign(campaign.id)" ng-class="\'btn_\'+campaign.icon">\n          <i class="c_icon"></i> {{campaign.identifier}}\n        </div>\n      </atl-list-slider>\n     </div>\n    </div>\n    <div class="six wide column right aligned">\n      <div class="ui form" ng-if="vm.isManager">\n        <select ng-change="vm.changeStaff()" ng-model="vm.selectedStaff" class="ui dropdown">\n          <option value="">{{\'SELECT_REP\' | translate}}</option>\n          <option value="{{key}}" ng-repeat="(key, value) in vm.listStaff | selectedJobDuties:vm.userData" ng-selected="key == vm.selectedStaff">{{value.staff_info.firstName}} {{value.staff_info.lastName}} ({{value.job.shortname}})</option>\n        </select>\n      </div>\n      <div ng-if="!vm.isManager && vm.budget">\n        <div class="ui grid" ng-repeat="budget in vm.budget">\n          <div class="ui four wide column right aligned">\n            <img src="assets/img/icons/campaigns/budget.png">\n          </div>\n\n          <div class="ui twelve wide column">\n\n            <div class="ui progress teal">\n              <div class="bar" style="width:{{budget.progress > 100 ? 100 : budget.progress || 0}}%"></div>\n              <div class="progress-text">\n\n                <div class="ui two columns grid">\n                  <div class="ui column">\n                    {{budget.name}} {{budget.progress}}%\n                  </div>\n                  <div class="ui column right aligned">\n                    {{budget.actual_budget | number :2}} / {{budget.currency || \'PLN\'}}\n                  </div>\n                </div>\n\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n  </div>\n\n  <div class="ui main container">\n    <div class="ui segment silver campaign-item" ng-if="vm.activeCampaign">\n\n      <div class="ui grid">\n        <div class="ui sexteen wide column right aligned">\n          <p>{{\'DURATION\' | translate}}: <b>{{vm.activeCampaign.date_start | date:\'dd.MM.yyyy\'}} &mdash; {{vm.activeCampaign.date_end | date:\'dd.MM.yyyy\'}}</b></p>\n        </div>\n      </div>\n\n      <div class="ui two column grid">\n        <div class="column">\n\n          <div class="ui progress" ng-click="vm.selectCampaign(vm.campaignId)">\n            <div class="bar" style="width:{{vm.progressCampaign > 100 ? 100 : vm.progressCampaign || 0}}%"></div>\n            <div class="title"><p class="lead"><a href="">{{vm.activeCampaign.name | uppercase}} &mdash; {{vm.progressCampaign || 0}}%</a></p></div>\n          </div>\n\n          <div class="ui container">\n            <p>{{vm.activeCampaign.description}}</p>\n          </div>\n\n        </div>\n\n        <div class="column left aligned">\n          <div class="ui two column left aligned grid">\n            <div class="ui one wide column"></div>\n            <div class="ui fifteen wide column left aligned">\n              <div class="ui equal width left aligned grid">\n                <div class="column" ng-repeat="step in vm.activeCampaign.steps">\n                  <div class="step_button" ng-click="vm.selectCampaignStep(campaign.id, $index+1)">\n                    <span ng-if="step.icon" class="step_icon_button"><img ng-src="assets/img/icons/campaigns/step-icons/{{step.icon}}-blue.jpg" title="{{step.identifier}}"></span>\n                    <span ng-if="!step.icon" class="step_text_button">{{step.identifier}}</span>\n                    <span class="floating ui red circular tiny label" ng-if="vm.activeCampaign[\'count_\'+step.type]>-1 && !vm.isManager">{{vm.activeCampaign[\'count_\'+step.type] || 0}}</span>\n                  </div>\n                  <br><nobr><small>{{step.date_start | date:\'dd.MM\'}}&ndash;{{step.date_end | date:\'dd.MM\'}}</small></nobr>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="ui left top attached icon orange big label" ng-class="vm.activeCampaign.icon" ng-click="vm.selectCampaign(vm.campaignId)">\n        <i class="c_icon"></i>\n        {{vm.activeCampaign.identifier}}\n\n        <span class="campaign-identifier-apteka" ng-if="!vm.isManager">\n\t\t\t<img src="assets/img/icons/campaigns/campaign-icons/apteka-blue.png">\n\t\t\t<span class="floating ui red circular tiny label" ng-hide="vm.hideCounters(vm.activeCampaign)">{{vm.activeCampaign.count_progress1 || 0}}</span>\n\t\t</span>\n\n        <span class="campaign-identifier-apteka-ok" ng-if="!vm.isManager">\n\t\t\t<img src="assets/img/icons/campaigns/campaign-icons/apteka-ok.png">\n\t\t\t<span class="floating ui red circular tiny label" ng-hide="vm.hideCounters(vm.activeCampaign)">{{vm.activeCampaign.count_progress2 || 0}}</span>\n\t\t</span>\n\n      </div>\n\n    </div>\n  </div>\n\n</div>'),$templateCache.put("app/campaigns/list/campaigns.list.html",'<div id="container" class="ui segment main container">\n\n  <div class="basic segment ui grid">\n    <div class="ten wide column left aligned">\n     <div ng-if="vm.campaignsCopy.length">\n      <atl-list-slider display-number="5" list-id="listCampaignButtons" class-list="compact tiny ui buttons campaigns-select-buttons">\n        <div class="ui icon button c_active list-slider-item" ng-repeat="campaign in vm.campaignsCopy" ng-click="vm.filterByCampaign(campaign.id)" ng-class="\'btn_\'+campaign.icon">\n          <i class="c_icon"></i> {{campaign.identifier}}\n        </div>\n      </atl-list-slider>\n     </div>\n    </div>\n    <div class="six wide column right aligned">\n      <div class="ui form" ng-if="vm.isManager">\n        <select ng-change="vm.changeStaff()" ng-model="vm.selectedStaff" class="ui dropdown">\n          <option value="">{{\'SELECT_REP\' | translate}}</option>\n          <option value="{{key}}" ng-repeat="(key, value) in vm.listStaff | selectedJobDuties:vm.userData">{{value.staff_info.firstName}} {{value.staff_info.lastName}} ({{value.job.shortname}})</option>\n        </select>\n      </div>\n      <div ng-if="!vm.isManager && vm.budget">\n        <div class="ui grid" ng-repeat="budget in vm.budget">\n          <div class="ui four wide column right aligned">\n            <img src="assets/img/icons/campaigns/budget.png">\n          </div>\n\n          <div class="ui twelve wide column">\n\n            <div class="ui progress teal">\n              <div class="bar" style="width:{{budget.progress > 100 ? 100 : budget.progress || 0}}%"></div>\n              <div class="progress-text">\n\n                <div class="ui two columns grid">\n                  <div class="ui column">\n                    {{budget.name}} {{budget.progress}}%\n                  </div>\n                  <div class="ui column right aligned">\n                    {{budget.actual_budget | number :2}} / {{budget.currency || \'PLN\'}}\n                  </div>\n                </div>\n\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="ui main container">\n    <div class="ui segment silver campaign-item" ng-repeat="campaign in vm.campaigns | orderBy:\'id\'">\n\n      <div class="ui grid">\n        <div class="ui sexteen wide column right aligned">\n          <p>{{\'DURATION\' | translate}}: <b>{{campaign.date_start | date:\'dd.MM.yyyy\'}} &mdash; {{campaign.date_end | date:\'dd.MM.yyyy\'}}</b></p>\n        </div>\n      </div>\n\n      <div class="ui two column grid">\n        <div class="column">\n\n          <div class="ui progress" ng-click="vm.selectCampaign(campaign.id)">\n            <div class="bar" style="width:{{vm.progressCampaigns[campaign.id] > 100 ? 100 : vm.progressCampaigns[campaign.id] || 0}}%"></div>\n            <div class="title"><p class="lead"><a href="">{{campaign.name | uppercase}} &mdash; {{vm.progressCampaigns[campaign.id] || 0}}%</a></p></div>\n          </div>\n\n          <div class="ui container">\n            <p>{{campaign.description}}</p>\n          </div>\n\n        </div>\n\n        <div class="column left aligned">\n          <div class="ui two column left aligned grid">\n            <div class="ui one wide column"></div>\n            <div class="ui fifteen wide column left aligned">\n              <div class="ui equal width left aligned grid">\n                <div class="column" ng-repeat="step in campaign.steps">\n                  <div class="step_button" ng-click="vm.selectCampaignStep(campaign.id, $index+1)">\n                    <span ng-if="step.icon" class="step_icon_button"><img ng-src="assets/img/icons/campaigns/step-icons/{{step.icon}}-blue.jpg" title="{{step.identifier}}"></span>\n                    <span ng-if="!step.icon" class="step_text_button">{{step.identifier}}</span>\n                    <span class="floating ui red circular tiny label" ng-if="campaign[\'count_\'+step.type]>-1 && !vm.isManager">{{campaign[\'count_\'+step.type] || 0}}</span>\n                  </div>\n                  <br><nobr><small>{{step.date_start | date:\'dd.MM\'}}&ndash;{{step.date_end | date:\'dd.MM\'}}</small></nobr>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="ui left top attached icon orange big label campaign-identifier-label" ng-class="campaign.icon" ng-click="vm.selectCampaign(campaign.id)">\n        <i class="c_icon"></i>\n        {{campaign.identifier}}\n\n\t\t<span class="campaign-identifier-apteka" ng-if="!vm.isManager">\n\t\t\t<img src="assets/img/icons/campaigns/campaign-icons/apteka-blue.png">\n\t\t\t<span class="floating ui red circular tiny label" ng-hide="vm.hideCounters(campaign)">{{campaign.count_progress1 || 0}}</span>\n\t\t</span>\n\n    <span class="campaign-identifier-apteka-ok" ng-if="!vm.isManager">\n\t\t\t<img src="assets/img/icons/campaigns/campaign-icons/apteka-ok.png">\n\t\t\t<span class="floating ui red circular tiny label" ng-hide="vm.hideCounters(campaign)">{{campaign.count_progress2 || 0}}</span>\n\t\t</span>\n\n      </div>\n\n    </div>\n  </div>\n\n</div>'),
$templateCache.put("app/campaigns/pages/campaigns.pages.html",'<div id="container" class="ui segment main container container-left-spaced">\n\n\n\t<div id="campaign-step-leftboard">\n\n\t\t<span class="ui icon yellow large button right floated bottom-spaced" ng-class="vm.icon" ng-click="vm.selectCampaign(vm.campaignId)"><i class="c_icon"></i> {{::vm.campaign.identifier}}</span>\n\n\t\t<div class="step_button ui basic segment megacollapsed megacollapsedmargin bottom-padded right floated right aligned bottom-spaced" ng-class="{\'step_start\': vm.step.isStepStart}">\n\t\t\t<span ng-if="vm.step.icon" class="step_icon_button"><img ng-src="assets/img/icons/campaigns/step-icons/{{vm.step.icon_color}}.jpg" title="{{::vm.step.identifier}}"></span>\n\t\t\t<span ng-if="!vm.step.icon" class="step_text_button">{{::vm.step.identifier}}</span>\n      <!--<div class="floating ui red circular label" ng-if="vm.step.isWarningStep" ng-class="{\'step_warning\': vm.step.isWarningStep}">{{vm.step.isWarningStep}}</div>-->\n      <div class="ui red right corner label step_warning" ng-if="vm.step.isWarningStep">\n        <span>{{vm.step.isWarningStep}}</span>\n      </div>\n\t\t</div>\n\t\t<br clear="all">\n\n\t\t<span class="ui icon blue inverted button right floated bottom-spaced campaign_icon_button" ng-if="vm.drugstore.drugstores_network_id > 0" ng-click="vm.showDrugstoresList()">\n          {{::vm.networkHelper}}\n    </span>\n\n    <br clear="all">\n    <span class="ui icon inverted button right floated bottom-spaced campaign_icon_button" ng-class="{\'red\': vm.offlineMode, \'green\': !vm.offlineMode}" ng-click="vm.actionsAfterOffline()" ng-if="vm.isSetOfflineMode">\n      <i class="signal icon"></i>\n    </span>\n\n\t</div>\n\n\n  <div class="ui tertiary center aligned segment collapsed campaign-step-info-block-area">\n    <div class="ui grid">\n\n      <div class="five wide column left aligned campaign-step-info-block">\n\n        <span class="campaign-header-icons">\n            \n            <span ng-click="vm.showStaffList()" class="campaign-header-icon">\n              <img src="assets/img/icons/campaigns/pages/user.png">\n              <sup>{{vm.staffForDrugstore.length}}</sup>\n            </span>\n            \n            <span ng-click="vm.showDrugstoresList()" class="campaign-header-icon">\n              <img ng-src="assets/img/icons/design/{{vm.netWorkIcon}}">\n              <sup>{{vm.listDrugstores.length}}</sup>\n            </span>\n\n            <span class="campaign-header-icon" ng-if="vm.portalRegistered">\n              <img src="assets/img/icons/design/drugstore_registered.png">\n            </span>\n\n            <span class="campaign-header-icon" ng-if="vm.isExistsNotRegistered">\n              <img src="assets/img/icons/design/drugstore_registered_black.png">\n            </span>\n\n      </span></div>\n      \n      <div class="four wide column left aligned campaign-step-info-block">\n\n          <span class="campaign-header-text">\n              <span ng-click="vm.selectDrugstore(vm.drugstore.id)" class="clickable">{{::vm.drugstore.name}} <i class="red warning sign icon" ng-if="vm.hasWarningSign"></i></span>\n              <span class="step_name">{{vm.step.name}}</span>\n          </span>\n\n      </div>\n\n      <div class="seven wide column right aligned">\n        <div class="ui tiny buttons" style="white-space: nowrap">\n\t\t\t    <span ng-repeat="step in vm.steps">\n\t\t\t      <div class="ui marine button" ui-sref="campaigns.steps.pages({stepIndex: $index+1, pageIndex: 1})" ng-click="vm.selectStep($index)" ng-class="{\'disabled\': step.disabled, \'current-step\': step.unique_id == vm.step.unique_id}">\n\t\t\t        {{::step.identifier}}\n\t\t\t      </div>\n\t\t\t      <div class="or" data-text="&rarr;" ng-if="!$last"></div>\n\t\t\t    </span>\n\t\t    </div>\n      </div>\n\n    </div>\n\n  </div>\n\n  <div class="ui steps {{vm.numberColumns}}">\n    <a id="step_page_{{$index}}" ui-sref="campaigns.steps.pages({stepIndex: vm.stepIndex+1, pageIndex: $index+1})" ng-click="vm.selectPage($index)" ng-repeat="page in vm.templates track by $index" class="step {{vm.template.directive}}" ng-class="{active: vm.template == vm.templates[$index]}">{{page.realName || page.title}}</a>\n  </div>\n\n  <div id="step-container" ng-if="vm.template">\n\n    <ng-include src="vm.template.url"></ng-include>\n\n  </div>\n\n</div>\n<ng-include src="\'app/clients/mainInfo/clients.staff.modals.html\'"></ng-include>\n<ng-include src="\'app/clients/mainInfo/clients.listDrugstores.modals.html\'"></ng-include>\n<ng-include src="\'app/clients/card/clients.offlineActions.modals.html\'"></ng-include>\n'),$templateCache.put("app/campaigns/main/campaigns.main.html",'<div id="container" class="ui segment main container">\n<h1 class="ui ribbon label breadcrumb">\n  <div class="active section">{{\'CAMPAIGN\' | translate}}: {{::vm.campaign.name}}</div>\n</h1>\n\n<div class="ui basic megacollapsed segment">\n  <div class="ui grid">\n\n    <div class="ui six wide column">\n      <p>\n\t\t\t\t<span class="ui icon yellow large button left floated more-spaced" ng-class="vm.campaign.icon" id="campaign-identifier">\n\t\t\t\t\t<i class="c_icon"></i>\n\t\t\t\t\t{{::vm.campaign.identifier}}\n\t\t\t\t</span>\n        <b class="more-increased">{{::vm.campaign.name}}</b>\n        <br>\n        <small>{{\'IT_REMAINS\' | translate}}: <span class="lightblue">{{vm.campaignDaysBeforeEnd}} dni</span></small>\n      </p>\n    </div>\n\n    <div class="ui four wide column center aligned">\n      <div class="ui-knob">\n        <atl-knob knob-data="vm.percentDays" knob-change-value="vm.campaignDaysBeforeEnd" width="150" height="150" display-previous="true" read-only="true"></atl-knob>\n        <p>{{\'DAYS_LEFT\' | translate}}</p>\n      </div>\n    </div>\n\n    <div class="ui six wide column">\n\n      <div class="ui grid" ng-if="vm.campaign.visibility.campaign_sell_in == \'true\'">\n\n        <div class="ui four wide column right aligned">\n          <img src="assets/img/icons/campaigns/sell-in.png">\n        </div>\n\n        <div class="ui twelve wide column">\n\n          <div class="ui progress teal">\n            <div class="bar" style="width:{{vm.sellInProgress > 100 ? 100 : vm.sellInProgress || 0}}%"></div>\n            <div class="progress-text">\n\n              <div class="ui two columns grid">\n                <div class="ui column">\n                  {{\'SHOPPING\' | translate}} {{vm.sellInProgress}}%\n                </div>\n                <div class="ui column right aligned">\n                  {{vm.sellInEarns | number :2}} / {{vm.signIn || \'PLN\'}}\n                </div>\n              </div>\n\n            </div>\n          </div>\n\n        </div>\n\n      </div>\n\n      <div class="ui grid" ng-if="vm.campaign.visibility.campaign_sell_out == \'true\'">\n\n        <div class="ui four wide column right aligned">\n          <img src="assets/img/icons/campaigns/sell-out.png">\n        </div>\n\n        <div class="ui twelve wide column">\n\n          <div class="ui progress teal">\n            <div class="bar" style="width:{{vm.sellOutProgress > 100 ? 100 : vm.sellOutProgress || 0}}%"></div>\n            <div class="progress-text">\n\n              <div class="ui two columns grid">\n                <div class="ui column">\n                  {{\'SALE\' | translate}} {{vm.sellOutProgress}}%\n                </div>\n                <div class="ui column right aligned">\n                  {{vm.sellOutEarns | number :2}} / {{vm.signOut || \'PLN\'}}\n                </div>\n              </div>\n\n            </div>\n          </div>\n\n        </div>\n\n      </div>\n\n      <div class="ui basic megacollapsed segment" ng-if="!vm.isManager && vm.campaign.budget_item">\n        <div class="ui grid" ng-repeat="budget in vm.budget">\n          <div class="ui four wide column right aligned">\n            <img src="assets/img/icons/campaigns/budget.png">\n          </div>\n\n          <div class="ui twelve wide column">\n\n            <div class="ui progress teal">\n              <div class="bar" style="width:{{budget.progress > 100 ? 100 : budget.progress || 0}}%"></div>\n              <div class="progress-text">\n\n                <div class="ui two columns grid">\n                  <div class="ui column">\n                    {{::budget.name}} {{::budget.progress}}%\n                  </div>\n                  <div class="ui column right aligned">\n                    {{::budget.actual_budget | number :2}} / {{::budget.currency || \'PLN\'}}\n                  </div>\n                </div>\n\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n\n<div class="ui center aligned grid" style="margin-bottom: 15px !important">\n\n  <div class="ui eight wide column left aligned">\n        <span class="campaign-inner-counter-apteka campaign-inner-counter-apteka-first" ng-if="!vm.isManager">\n            <img src="assets/img/icons/campaigns/campaign-icons/apteka-blue.png">\n            <span class="floating ui red circular tiny label" ng-hide="vm.hideCounters">{{vm.campaign.count_progress1 || 0}}</span>\n        </span>\n\n        <span class="campaign-inner-counter-apteka campaign-inner-counter-apteka-ok" ng-if="!vm.isManager">\n            <img src="assets/img/icons/campaigns/campaign-icons/apteka-ok.png">\n            <span class="floating ui red circular tiny label" ng-hide="vm.hideCounters">{{vm.campaign.count_progress2 || 0}}</span>\n        </span>\n  </div>\n\n  <div class="ui eight wide column right aligned">\n\n    <!-- rainbow filters -->\n    <div class="ui buttons" ng-class="{\'inactive\':vm.selectedStep==\'\' && !vm.not_paid_campaign}" style="white-space: nowrap" ng-if="vm.drugstores.length">\n      <div class="ui compact button button-with-label {{color}}" data="{{color}}" ng-class="{\'current-color\':color==vm.selectedColor}" ng-repeat="color in vm.stepColors" ng-click="vm.selectColor(vm.selectedStep, color)">\n        \n        <span ng-if="!vm.not_paid_campaign">\n            <small ng-if="vm.colorStepCounter[vm.selectedStep][color]" ng-class="{\'exclamation\':color==\'greenwarning\'}">{{vm.colorStepCounter[vm.selectedStep][color]}}</small>\n            <small ng-if="!vm.colorStepCounter[vm.selectedStep][color] && color == \'greenwarning\'" class="exclamation">!</small>\n            <small ng-if="!vm.colorStepCounter[vm.selectedStep][color] && color != \'greenwarning\'">&nbsp;</small>\n        </span>\n\n        <span ng-if="vm.not_paid_campaign">\n            <small ng-if="vm.colorStepCounter[\'all\'][color]" ng-class="{\'exclamation\':color==\'greenwarning\'}">{{vm.colorStepCounter[\'all\'][color]}}</small>\n            <small ng-if="!vm.colorStepCounter[\'all\'][color] && color == \'greenwarning\'" class="exclamation">!</small>\n            <small ng-if="!vm.colorStepCounter[\'all\'][color] && color != \'greenwarning\'">&nbsp;</small>\n        </span>\n        \n        <small ng-if="vm.stepColorLabels[color]" class="label-in-button">{{vm.stepColorLabels[color] | translate}}</small>\n      </div>\n      <div class="ui compact button white" data="white" ng-click="vm.selectColor(\'\', \'\')" style="color:#777!important">\n        <small>&times;</small>\n      </div>\n    </div>\n\n  </div>\n\n</div>\n\n<div class="ui main container" atl-infinite-scroll="vm.loadMore()" container-to-scroll="general-shell">\n  <div class="ui grid">\n\n    <div class="ui twelve wide column">\n      <button type="button" class="ui small button {{vm.colorRights.visit}}" ng-click="vm.filterByRights(\'my\')">\n        Moje Apteki\n      </button>\n      <button type="button" class="ui small button drugstores-filtration drugstores-filtration-drugstore {{vm.colorRights.management}}" ng-click="vm.filterByRights(\'observed\')">\n        Do obserwacji\n      </button>\n      <button type="button" class="ui small button drugstores-filtration drugstores-filtration-camera {{vm.colorRights.colleague}}" ng-click="vm.filterByRights(\'colleague\')">\n        Dla kolegów\n      </button>\n\n        <span class="ui left icon input dynsearch">\n          <input type="text" placeholder="{{\'DYNAMIC_SEARCH\' | translate}}" id="dynsearch" ng-model="vm.searchText" ng-model-options="{debounce: 500}">\n          <i class="search icon"></i>\n        </span>\n    </div>\n\n    <div class="ui four wide column right aligned">\n      <div class="ui form" ng-if="vm.isManager">\n        <select ng-change="vm.changeStaff()" ng-model="vm.selectedStaff" class="ui dropdown">\n          <option value="">{{\'SELECT_REP\' | translate}}</option>\n          <option value="{{key}}" ng-repeat="(key, value) in vm.listStaff | selectedJobDuties:vm.userData" ng-selected="key == vm.selectedStaff">\n            {{value.staff_info.firstName}} {{value.staff_info.lastName}} ({{value.job.shortname}})\n          </option>\n        </select>\n      </div>\n      <div></div>\n    </div>\n\n\n  </div>\n  <table class="ui table celled striped sortable listView">\n    <thead>\n    <tr>\n      <th></th>\n      <th ng-if="vm.isManager" class="more_narrow">{{\'REP\' | translate}}</th>\n      <th class="cell_identifier" ng-click="vm.changeSorting(\'identifier\')" ng-class="vm.sortingClass(\'identifier\')">{{\'ID\' | translate}}</th>\n      <th ng-click="vm.changeSorting(\'name\')" ng-class="vm.sortingClass(\'name\')">{{\'NAME\' | translate}}</th>\n      <th ng-click="vm.changeSorting([\'drugstores_network.name\', \'drugstores_network.id\', \'-negotiation_point\'])" ng-class="vm.sortingClass([\'drugstores_network.name\', \'drugstores_network.id\', \'-negotiation_point\'])">{{\'DRUGSTORES_NETWORK\' | translate}}\n      </th>\n      <th ng-click="vm.changeSorting(\'cityName\')" ng-class="vm.sortingClass(\'cityName\')">{{\'ADDRESS\' | translate}}</th>\n      <th valign="bottom" class="cell_date title_wrap" ng-click="vm.changeSorting(\'campaignDateEnd\')" ng-class="vm.sortingClass(\'campaignDateEnd\')">{{\'PROPOSAL_END_DATE\' | translate}}</th>\n      <th>\n\n        <div class="ui small buttons" style="white-space: nowrap" ng-if="!vm.not_paid_campaign">\n            <span ng-repeat="step in vm.campaign.steps">\n            <div class="ui inline tiny button step_title" style="float: none;display: inline-block" ng-class="{\'current-step\':step.identifier==vm.selectedStep}" ng-click="vm.setStepIdentifier(step.identifier)">\n              <div>{{::step.identifier}}</div>\n            </div>\n            </span>\n        </div>\n\n      </th>\n      <th class="cell_icon" ng-if="vm.not_paid_campaign"></th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr ng-repeat="drugstore in (filteredItems = (vm.drugstores | searchDrugstore: vm.searchText: vm.searchArrFields))\n          | orderBy:vm.sort.column:vm.sort.descending\n          | selectedStepColor:vm.selectedStep:vm.selectedColor\n          | limitTo: vm.pagingLimit\n          track by drugstore.id" ng-class="{\'negative\': drugstore.isBlocked}" ng-click="vm.selectDrugstore(drugstore.id, null, $event)">\n      <td>\n        <div class="icon-container cell_icon">\n          <img ng-src="assets/img/icons/design/{{drugstore.netWorkIcon}}">\n          <i class="red large warning sign icon icon-nested" ng-if="vm.hasWarningSign(drugstore)"></i>\n        </div>\n      </td>\n      <td class="cell_staff" ng-if="vm.isManager" ng-click="$event.stopPropagation();">\n        <nobr>\n            <span ng-init="$last">\n              <atl-dropdown class="ui compact dropdown">\n                <div class="text">\n                  <img src="assets/img/icons/campaigns/pages/user.png" class="ui avatar image">\n                  <span ng-if="vm.listDrugstores[drugstore.id].staff.length">{{vm.listDrugstores[drugstore.id].staff.length}}</span>\n                </div>\n                <i class="dropdown icon"></i>\n                <div class="menu" ng-if="vm.listDrugstores[drugstore.id].staff.length">\n                  <div class="header" ng-repeat="staff in vm.listDrugstores[drugstore.id].staff">\n                    <span ng-class="{\'lightblue\':vm.isJobDutiesSignatureVisit(staff)}">\n                      {{::staff.name}}\n                    </span>\n                  </div>\n                </div>\n              </atl-dropdown>\n            </span>\n        </nobr>\n      </td>\n      <td>{{::drugstore.identifier}}</td>\n      <td>\n        <div class="cell_name more_narrow">{{::drugstore.name}}</div>\n      </td>\n      <td>\n        <div class="text_overflow more_narrow" ng-click="$event.stopPropagation();" data-content="{{::drugstore.drugstores_network.name}}" atl-popup>{{::drugstore.drugstores_network.name}}</div>\n      </td>\n      <td>\n        <div class="cell_address more_narrow">{{::drugstore.addressLine1}}<br>{{::drugstore.zip}} {{::drugstore.cityName}}</div>\n      </td>\n      <td>{{::drugstore.campaignDateEnd | date:\'dd.MM.yyyy\'}}</td>\n\n      <td>\n        <div class="steps_container">\n          <nobr>\n            <div ng-if="!vm.not_paid_campaign">\n              <div ng-repeat="step in vm.campaign.steps" class="step_button step_icon_base">\n                <div ng-if="step.icon" class="step_icon_button">\n                  <img ng-if="vm.stepColorInfo[drugstore.id][step.identifier]" ng-src="assets/img/icons/campaigns/step-icons/{{vm.stepColorInfo[drugstore.id][step.identifier]}}.jpg" title="{{::step.identifier}}">\n                  <img ng-if="!vm.stepColorInfo[drugstore.id][step.identifier]" ng-src="assets/img/icons/campaigns/step-icons/{{step.icon}}-grey.jpg" title="{{::step.identifier}}">\n                </div>\n                <div ng-if="!step.icon" class="step_text_button">{{::step.identifier}}</div>\n              </div>\n\n              <div ng-repeat="step in drugstore.steps" class="step_button step_button_in_drugstore step_button_with_date" style="left: {{$index*49}}px" ng-click="vm.selectDrugstore(drugstore.id, step, $event)" ng-if="!step.disabled &&\n                 (vm.selectedStep == step.identifier && (vm.selectedColor == step.color || step.specColor.length && step.specColor.indexOf(vm.selectedColor)>-1 || vm.selectedColor  == \'white\') || !vm.selectedStep && !vm.selectedColor)">\n                <div ng-if="step.icon" class="step_icon_button" ng-class="{\'step_start\': step.isStepStart}">\n                  <img ng-src="assets/img/icons/campaigns/step-icons/{{::step.icon_color}}.jpg" title="{{::step.identifier}}">\n                  <!--<div class="floating ui red circular label step_warning_circular">{{step.isWarningStep}}</div>-->\n                  <div class="ui red right corner label step_warning" ng-if="step.isWarningStep">\n                    <span>{{step.isWarningStep}}</span>\n                  </div>\n                  <span class="step-date">{{::step.date_start | date:\'dd.MM\'}}&ndash;{{::step.date_end | date:\'dd.MM\'}}</span>\n                </div>\n                <div ng-if="!step.icon" class="step_text_button">{{::step.identifier}}</div>\n              </div>\n            </div>\n\n            <div ng-if="vm.not_paid_campaign" ng-click="$event.stopPropagation();">\n              <atl-list-slider list-index="{{$index}}" ng-model="vm.listSlider" display-number="5" start-index="0" list-id="listCampaignButtons_{{$index}}" target-id="{{drugstore.id}}">\n\n                <div ng-repeat="step in drugstore.steps" class="step_button step_button_with_date list-slider-item item-small" ng-click="vm.selectDrugstore(drugstore.id, step, $event)" ng-if="!step.disabled && ((vm.selectedColor == step.color || step.specColor.length && step.specColor.indexOf(vm.selectedColor)>-1 || vm.selectedColor  == \'white\') || !vm.selectedStep && !vm.selectedColor)">\n                  <div ng-if="step.icon" class="step_icon_button list_slider" ng-class="{\'step_start\': step.isStepStart}">\n                    <img ng-src="assets/img/icons/campaigns/step-icons/{{::step.icon_color}}.jpg" title="{{::step.identifier}}">\n                    <!--<div class="floating ui red circular label step_warning_circular">{{step.isWarningStep}}</div>-->\n                    <div class="ui red right corner label step_warning" ng-if="step.isWarningStep">\n                      <span>{{step.isWarningStep}}</span>\n                    </div>\n                    <span class="step-date list-date">{{::step.date_start | date:\'dd.MM\'}}&ndash;{{::step.date_end | date:\'dd.MM\'}}</span>\n                  </div>\n                  <div ng-if="!step.icon" class="step_text_button list_slider">{{::step.identifier}}</div>\n                </div>\n\n              </atl-list-slider>\n            </div>\n          </nobr>\n        </div>\n      </td>\n      <td class="no-left-border" ng-if="vm.not_paid_campaign">\n        <div class="cell_icon">\n          <!--<i class="caret right icon"></i>-->\n          <a class="compact ui tiny icon green button" ng-click="$event.stopPropagation();vm.confirmCloneStep(drugstore)">\n            <i class="plus icon"></i>\n          </a>\n        </div>\n      </td>\n    </tr>\n    </tbody>\n  </table>\n\n</div>\n</div>\n<ng-include src="\'app/campaigns/main/campaigns.notPaid.modals.html\'"></ng-include>\n'),$templateCache.put("app/campaigns/main/campaigns.notPaid.modals.html","<atl-modal-confirm-dialog modal-id=\"'confirmAddStep'\" modal-title=\"'MESSAGE_CONFIRMATION' | translate\" on-confirm=\"vm.cloneStep()\">\n  {{'CONFIRM_ADD_STEP' | translate}}\n</atl-modal-confirm-dialog>\n<atl-modal-attention-form modal-id=\"'banOnCloning'\" show-action=\"false\" modal-title=\"'MESSAGE_ATTENTION' | translate\">\n  <p>{{'WARNING_CAN_NOT_CLONE_STEP' | translate}}.</p>\n</atl-modal-attention-form>\n<atl-modal-attention-form modal-id=\"'banOnCloningByRights'\" show-action=\"false\" modal-title=\"'MESSAGE_ATTENTION' | translate\">\n  <p>{{'NOT_RIGHTS_FOR_EDIT' | translate}}.</p>\n</atl-modal-attention-form>\n<atl-modal-attention-form modal-id=\"'banOnCloningByDate'\" show-action=\"false\" modal-title=\"'MESSAGE_ATTENTION' | translate\">\n  <p>{{'WARNING_DATE_GREATER_CAMPAIGN_DATE_END' | translate}}.</p>\n</atl-modal-attention-form>"),$templateCache.put("app/clients/additionalInfo/clients.additionalInfo.html",'<div id="container" class="ui segment main container">\n  <div>\n\n    <h1 class="h1">{{vm.drugstore.name}} — {{\'ADITIONAL_INFORMATION\' | translate}}</h1>\n\n    <div class="ui basic segment padded">\n\n      <table class="ui most basic table">\n        <tr ng-repeat="property in vm.properties">\n          <td class="collapsing">{{property.name}}</td>\n          <td>\n\n            <label ng-if="property.type == \'boolean\' && vm.drugstore.metadata[property.id]">\n              {{ vm.drugstore.metadata[property.id] == 1 ? (\'YES\' | translate) : (\'NO\' | translate) }}\n            </label>\n\n            <label ng-if="property.type == \'number\'">\n              {{vm.drugstore.metadata[property.id]}}\n            </label>\n\n            <label ng-if="property.type == \'string\'">\n              {{vm.drugstore.metadata[property.id]}}\n            </label>\n\n            <label ng-if="property.type == \'list\'">\n              <span ng-repeat="value in property.values">\n                <span ng-if="value.id == vm.drugstore.metadata[property.id]">{{value.value}}</span>\n              </span>\n            </label>\n\n          </td>\n        </tr>\n      </table>\n\n      <!-- <div class="ui bottom right attached icon massive transparent label"><a ng-click="vm.editAdditionalInfo(vm.drugstore.id)"><i class="pencil icon"></i></a></div> -->\n\n    </div>\n\n  </div>\n\n\n</div>'),$templateCache.put("app/clients/additionalInfo/clients.additionalInfoEdit.html",'<div id="container" class="ui segment main container">\n  <!-- <form class="ui form"\n        name="drugstoreAdditionalForm"\n        novalidate\n        ng-submit="drugstoreAdditionalForm.$valid && vm.saveAdditionalInfo()">\n\n    <div>\n\n        <h1 class="h1">{{vm.drugstore.name}} — {{\'EDITING_ADITIONAL_INFORMATION\' | translate}}</h1>\n\n        <div class="ui basic segment padded">\n          <table class="ui most basic table">\n            <tr ng-repeat = "property in vm.properties">\n              <td class="collapsing">{{property.name}}</td>\n              <td>\n\n                <label ng-if="property.type == \'boolean\'">\n                  <div class="ui toggle checkbox">\n                    <input id="negotiationPoint" type="checkbox" ng-model="vm.drugstore.metadata[property.id]">\n                    <label for="negotiationPoint"></label>\n                  </div>\n                </label>\n\n                <label ng-if="property.type == \'number\'">\n                  <input type="number" name="number_{{property.id}}" ng-model="vm.drugstore.metadata[property.id]">\n                </label>\n\n                <label ng-if="property.type == \'string\'">\n                  <input type="text" name="string_{{property.id}}" ng-model="vm.drugstore.metadata[property.id]">\n                </label>\n\n                <label ng-if="property.type == \'list\'">\n                  <label ng-repeat="value in property.values">\n                    <input type="radio" name="list_{{property.id}}" ng-model="$parent.vm.drugstore.metadata[property.id]" ng-value = "value.id"> {{value.value}}\n                  </label>\n                </label>\n\n              </td>\n            </tr>\n          </table>\n        </div>\n\n    </div>\n\n    <div class="ui divider"></div>\n    <div class="ui three column center aligned grid">\n\n      <div class="column">\n        <div class="ui large pale button" ng-click="vm.cancelAdditionalInfoSave()">\n          <i class="icon cancel"></i>\n          {{\'CANCEL\' | translate}}\n        </div>\n      </div>\n\n\t  <div class="column">\n        <button type="submit" class="ui navy large button">\n          <i class="save icon"></i>\n          {{\'SAVE\' | translate}}\n        </button>\n      </div>\n\n    </div>\n  </form> -->\n</div>'),$templateCache.put("app/clients/card/clients.card.html",'<div id="container" class="ui segment main container">\n  <div>\n    <div class="ui grid">\n\n      <div class="ui four wide column">\n\n        <div class="ui segment silver center aligned">\n          <label ng-if="vm.isManager" class="no-space" ng-click="vm.showStaffPhotos()">\n            <div class="ui fluid image" ng-if="!vm.hideBlankPhoto">\n              <img src="assets/img/tmp/apteka.jpg" class="card_drugstore_photo">\n            </div>\n            <div ng-if="vm.hideBlankPhoto && $index==vm.photoIndex" ng-click="vm.toggleImage()" class="ui fluid image slide_photos" ng-repeat="photo in vm.drugstore.photos">\n              <div class="ui red left corner label" ng-if="photo.photo_date_invalid">\n                <i class="white warning sign icon"></i>\n              </div>\n              <span class="photo_info">\n                <span class="ui white big label">{{photo.firstName}} {{photo.lastName}}</span>\n              </span>\n              <img id="follow_img_{{$index}}" ng-src="{{vm.path_img}}{{photo.filename}}" class="card_drugstore_photo">\n            </div>\n          </label>\n\n          <label ng-if="!vm.isManager" for="takePictureDrugstore" class="no-space">\n            <div class="ui image" ng-class="{\'fluid\':!vm.drugstore.picture.src}">\n              <div class="ui red ribbon label" ng-if="vm.photo_date_invalid || vm.photo_rejected">\n                <i class="white warning sign icon"></i>\n                <span ng-if="vm.photo_date_invalid">{{\'OLD_DATE_PHOTO\' | translate}}</span>\n                <span ng-if="vm.photo_rejected">{{\'PHOTO_REJECTED\' | translate}}</span>\n              </div>\n              <img ng-hide="vm.drugstore.picture.src" src="assets/img/tmp/apteka.jpg" class="card_drugstore_photo">\n              <img ng-if="vm.drugstore.picture.src" ng-src="{{vm.drugstore.picture.src}}" class="card_drugstore_photo">\n            </div>\n            <input type="hidden" name="pictureDrugstore" ng-model="vm.drugstore.picture">\n            <input type="file" capture="camera" accept="image/*" id="takePictureDrugstore" style="display:none" onchange="angular.element(this).scope().loadPhoto(this)">\n          </label>\n          <div class="ui bottom right attached icon label" ng-if="vm.drugstore.buttonSave" ng-attr-title="{{\'SAVE\' | translate}}">\n            <a class="ui marine small icon button" ng-click="vm.drugstoreImageUpload()"><i class="save icon"></i></a>\n          </div>\n        </div>\n\n        <!--<div class="ui segment silver" id="staff-activity-link">\n          <span ng-click="vm.showStaffActivity()">{{\'ACTIVITY_STAFF\' | translate}}</span>\n        </div>-->\n\n      </div>\n\n      <div class="ui twelve wide column">\n\n        <div class="ui segment silver collapsed">\n          <div class="ui grid">\n            \n            <div class="five wide column left aligned campaign-step-info-block">\n                \n                <span class="campaign-header-icons">\n\t\t\t      \n                  <span ng-click="vm.showStaffList()" class="campaign-header-icon">\n                    <img src="assets/img/icons/campaigns/pages/user.png">\n                    <sup>{{vm.staffForDrugstore.length}}</sup>\n                  </span>\n\n\t\t\t            <span ng-click="vm.showDrugstoresList()" class="campaign-header-icon">\n                    <img ng-src="assets/img/icons/design/{{vm.netWorkIcon}}">\n                    <sup>{{vm.countNetDrugstores}}</sup>\n                  </span>\n\n                  <span class="campaign-header-icon" ng-if="vm.portalRegistered">\n                    <img src="assets/img/icons/design/drugstore_registered.png">\n                  </span>\n\n                  <span class="campaign-header-icon" ng-if="vm.isExistsNotRegistered">\n                    <img src="assets/img/icons/design/drugstore_registered_black.png">\n                  </span>\n                </span>\n\n            </div>\n\n            <div class="seven wide column left aligned campaign-step-info-block">\n\n              <span class="campaign-header-text">\n                  <span ng-click="vm.showMainInfo(vm.drugstore.id)" class="expressive">{{::vm.drugstore.name}}</span>\n                  <i class="red warning sign icon" ng-if="vm.hasWarningSign"></i>\n              </span>\n\n            </div>\n\n            <div class="ui four wide right aligned column">\n              <button type="button" class="ui navy button" ng-if="vm.isDrugstoreConference" ng-click="vm.conference()">\n                Conference\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div class="ui two column grid">\n\n          <div class="column">\n            <div class="ui segment silver large-text">\n              <div>\n                {{\'ID\' | translate}}: <span class="lightblue">{{::vm.drugstore.identifier}}</span>\n                <br>{{::vm.drugstore.address.address_line_1}}\n                <br>{{::vm.drugstore.address.zip}} {{::vm.drugstore.address.city.name}}\n                <br>{{\'PHONE\' | translate}}: {{::vm.drugstore.address.phone}}\n                <br>{{::vm.drugstore.email}}\n                <br>{{\'NIP\' | translate}}: <span class="lightblue">{{::vm.drugstore.NIP}}</span>\n              </div>\n\n              <div class="ui bottom right attached icon label"><a ng-click="vm.showMainInfo(vm.drugstore.id)"><i class="unhide icon"></i></a></div>\n            </div>\n          </div>\n\n          <div class="column">\n            <div class="ui segment silver large-text">\n              <div ng-repeat="property in vm.properties">\n                <div class="ui two column grid">\n                  <div class="ten wide column">\n                    <label>{{::property.name}}:</label>\n                  </div>\n                  <div class="six wide left aligned column">\n                    <label ng-if="property.type == \'boolean\' && vm.drugstore.metadata[property.id]">\n                      {{ vm.drugstore.metadata[property.id] == 1 ? (\'YES\' | translate) : (\'NO\' | translate) }}\n                    </label>\n                    <label ng-if="property.type == \'number\'">\n                      {{::vm.drugstore.metadata[property.id]}}\n                    </label>\n                    <label ng-if="property.type == \'string\'">\n                      {{::vm.drugstore.metadata[property.id]}}\n                    </label>\n                    <label ng-if="property.type == \'list\'">\n                      <span ng-repeat="value in property.values">\n                        <span ng-if="value.id == vm.drugstore.metadata[property.id]">{{::value.value}}</span>\n                      </span>\n                    </label>\n                  </div>\n                </div>\n              </div>\n              <div class="ui bottom right attached icon label">\n                <a ng-click="vm.showAdditionalInfo(vm.drugstore.id)"><i class="unhide icon"></i></a>\n              </div>\n            </div>\n\n          </div>\n\n        </div>\n\n      </div>\n    </div>\n\n\n  </div>\n\n\n  <atl-accordion>\n    <div class="title active">\n      <i class="dropdown icon"></i>\n      {{\'ACTUAL_CAMPAIGN\' | translate}}\n    </div>\n    <div class="content active">\n      <div class="ui main container">\n        <div class="ui segment silver campaign-item" ng-repeat="campaign in vm.campaigns | orderBy:\'id\' track by campaign.id">\n\n          <div class="ui grid">\n            <div class="ui sexteen wide column right aligned">\n              <p>{{\'DURATION_OF\' | translate}} <b>{{::(campaign.date_start | date:\'dd.MM.yyyy\')}} &mdash; {{::(campaign.date_end |\n                date:\'dd.MM.yyyy\')}}</b></p>\n            </div>\n          </div>\n\n          <div class="ui two column grid">\n            <div class="seven wide column">\n\n              <div class="ui progress" ng-click="vm.selectCampaignStep(campaign)">\n                <div class="bar" style="width:{{campaign.progress > 100 ? 100 : campaign.progress || 0}}%"></div>\n                <div class="title"><p class="lead"><a href="">{{::(campaign.name | uppercase)}} &mdash; {{campaign.progress || 0}}%</a></p></div>\n              </div>\n\n              <p>{{::campaign.description}}</p>\n\n            </div>\n\n            <div class="nine wide column left aligned">\n              <div class="ui grid">\n\n                <div class="twelve wide column left aligned">\n\n                  <div class="ui equal width left aligned grid" ng-if="!campaign.not_paid_campaign || (campaign.not_paid_campaign && campaign.steps.length<=5)">\n                    <div class="ui one wide column" ng-repeat="step in campaign.steps" ng-if="!step.disabled">\n\n                      <div class="step_button" ng-click="vm.selectCampaignStep(campaign, step.identifier)">\n                        <span ng-if="step.icon" class="step_icon_button" ng-class="{\'step_start\': step.isStepStart}">\n                          <img ng-src="assets/img/icons/campaigns/step-icons/{{::step.icon_color}}.jpg" title="{{step.identifier}}">\n                          <!--<div class="floating ui red circular label" ng-if="step.isWarningStep" ng-class="{\'step_warning\': step.isWarningStep}">{{step.isWarningStep}}</div>-->\n                          <div class="ui red right corner label step_warning" ng-if="step.isWarningStep">\n                            <span>{{step.isWarningStep}}</span>\n                          </div>\n                        </span>\n                        <span ng-if="!step.icon" class="step_text_button">{{::step.identifier}}</span>\n                      </div>\n\n                      <br>\n                      <nobr>\n                        <small>{{::(step.date_start | date:\'dd.MM\')}}&ndash;{{::(step.date_end | date:\'dd.MM\')}}</small>\n                      </nobr>\n\n                    </div>\n                  </div>\n\n                  <div ng-if="campaign.not_paid_campaign && campaign.steps.length > 5">\n                    <atl-list-slider display-number="6" list-id="listCampaignButtons_{{$index}}" target-id="{{campaign.id}}">\n\n                      <div ng-repeat="step in campaign.steps" ng-if="!step.disabled" class="step_button step_button_with_date list-slider-item item-small" ng-click="vm.selectCampaignStep(campaign, step.identifier)">\n                        <div ng-if="step.icon" class="step_icon_button list_slider" ng-class="{\'step_start\': step.isStepStart}">\n                          <img ng-src="assets/img/icons/campaigns/step-icons/{{::step.icon_color}}.jpg" title="{{::step.identifier}}">\n                          <!--<div class="floating ui red circular label step_warning_circular">{{step.isWarningStep}}</div>-->\n                          <div class="ui red right corner label step_warning" ng-if="step.isWarningStep">\n                            <span>{{step.isWarningStep}}</span>\n                          </div>\n                          <span class="step-date list-date">{{::step.date_start | date:\'dd.MM\'}}&ndash;{{::step.date_end | date:\'dd.MM\'}}</span>\n                        </div>\n                        <div ng-if="!step.icon" class="step_text_button list_slider">{{::step.identifier}}</div>\n                      </div>\n\n                    </atl-list-slider>\n                  </div>\n                </div>\n\n                <div class="three wide column left aligned">\n                  <div class="ui two column grid">\n                    <div class="column right aligned">\n                      <span class="compact ui icon green button" ng-if="campaign.not_paid_campaign" ng-click="$event.stopPropagation();vm.confirmCloneStep(campaign)">\n                          <i class="plus icon"></i>\n                        </span>\n                    </div>\n\n                    <div class="column right aligned">\n                      <span class="compact ui icon inverted button" ng-click="vm.showConfirmSetMode(campaign)" ng-class="{\'red\': vm.offlineMode[vm.drugstoreId][campaign.id], \'green\': !vm.offlineMode[vm.drugstoreId][campaign.id]}" ng-if="vm.isSetOfflineMode">\n                        <i class="signal icon"></i>\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n          </div>\n\n          <div class="ui left top attached icon orange big label" ng-class="campaign.icon" ng-click="vm.selectCampaign(campaign.id)">\n            <i class="c_icon"></i>\n            {{::campaign.identifier}}\n          </div>\n\n          <!--<div class="ui right bottom attached icon">\n\n          </div>-->\n\n        </div>\n\n      </div>\n\n    </div>\n    <div class="title">\n      <i class="dropdown icon"></i>\n      {{\'HISTORY\' | translate}}\n    </div>\n    <div class="content">\n\n      <div class="ui main container">\n        <div class="ui segment silver campaign-item" ng-repeat="campaign in vm.campaignsHistory | orderBy:\'id\' track by campaign.id">\n\n          <div class="ui grid">\n            <div class="ui sexteen wide column right aligned">\n              <p>{{\'DURATION_OF\' | translate}}: <b>{{campaign.date_start | date:\'dd.MM.yyyy\'}} &mdash; {{campaign.date_end | date:\'dd.MM.yyyy\'}}</b></p>\n            </div>\n          </div>\n\n          <div class="ui two column grid">\n            <div class="seven wide column">\n\n              <div class="ui progress" ng-click="vm.selectCampaign(campaign.id)">\n                <div class="bar" style="width:{{campaign.progress > 100 ? 100 : campaign.progress || 0}}%"></div>\n                <div class="title"><p class="lead"><a href="">{{campaign.name | uppercase}} &mdash; {{campaign.progress || 0}}%</a></p></div>\n              </div>\n\n              <p>{{::campaign.description}}</p>\n\n            </div>\n\n            <div class="nine wide column left aligned">\n              <div class="ui two column grid">\n                <div class="ui one wide column"></div>\n                <div class="ui fifteen wide column left aligned">\n                  <div class="ui equal width left aligned grid">\n                    <div class="ui one wide column" ng-repeat="step in campaign.steps">\n                      <div class="step_button" ng-click="vm.selectCampaignStep(campaign, step.identifier, step.disabled)">\n                        <span ng-if="step.icon" class="step_icon_button"><img ng-src="assets/img/icons/campaigns/step-icons/{{::step.icon_color}}.jpg" title="{{step.identifier}}"></span>\n                        <span ng-if="!step.icon" class="step_text_button">{{step.identifier}}</span>\n                      </div>\n\n                      <br>\n                      <nobr>\n                        <small>{{step.date_start | date:\'dd.MM\'}}&ndash;{{step.date_end | date:\'dd.MM\'}}</small>\n                      </nobr>\n\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n          </div>\n\n          <div class="ui left top attached icon orange big label" ng-class="campaign.icon" ng-click="vm.selectCampaign(campaign.id)">\n            <i class="c_icon"></i>\n            {{::campaign.identifier}}\n          </div>\n\n        </div>\n\n      </div>\n    </div>\n  </atl-accordion>\n</div>\n<ng-include src="\'app/clients/mainInfo/clients.staff.modals.html\'"></ng-include>\n<ng-include src="\'app/clients/mainInfo/clients.listDrugstores.modals.html\'"></ng-include>\n<ng-include src="\'app/clients/card/clients.offlineActions.modals.html\'"></ng-include>\n<ng-include src="\'app/campaigns/main/campaigns.notPaid.modals.html\'"></ng-include>\n<atl-modal-confirm-dialog modal-id="\'confirmOfflineMode\'" modal-title="\'CONFIRM_OFFLINE_MODE\' | translate" on-confirm="vm.setMode()">\n  Chcesz pracować w trybie offline, jesteś pewien?\n</atl-modal-confirm-dialog>\n'),
$templateCache.put("app/clients/card/clients.offlineActions.modals.html",'<atl-modal-form-dialog modal-id="\'actionsAfterOffline\'" show-action="false" modal-title="\'DONE_IN_OFFLINE_MODE\' | translate">\n  <div class="ui basic megacollapsed segment" style="height: 300px; overflow: auto">\n    <table class="ui table striped sortable listView">\n      <thead>\n      <tr>\n        <th>{{\'ACTION_NAME\' | translate}}</th>\n        <th>{{\'PAGE\' | translate}}</th>\n        <!--\n        <th></th>\n        <th></th>\n        -->\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="action in vm.actionAfterOffline[vm.drugstoreId][vm.campaignId]">\n        <td>{{action.name}}</td>\n        <td>{{action.title}}</td>\n        <!--\n        <td>\n          <button type="button" class="ui navy button" ng-disabled="!vm.isVisit || vm.pageReadOnly" ng-click="vm.todoAction(action);$event.stopPropagation();">\n            <i class="save icon"></i>\n            {{action.name}}\n          </button>\n        </td>\n        <td class="one wide">\n          <button type="button" class="ui icon red inverted small button" ng-click="vm.removeOfflineAction(action.actionType);$event.stopPropagation();">\n            <i class="remove icon"></i>\n          </button>\n        </td>\n        -->\n      </tr>\n      </tbody>\n    </table>\n    <div class="ui right aligned basic segment">\n      <button class="ui marine button" ng-click="vm.executeOfflineAction()" ng-disabled="vm.lockForm">Akceptuj</button>\n    </div>\n  </div>\n</atl-modal-form-dialog>'),$templateCache.put("app/clients/conference/clients.conference.html",'<div id="container" class="ui segment main container">\n  <h1 class="h1">\n    {{vm.drugstore.name}} — {{\'INVITATION_TO_CONFERENCE\'}}\n  </h1>\n  <!-- SELECT Conference -->\n  <div class="ui basic segment">\n    <div class="ui top attached center aligned label">\n      <div class="{{vm.messageClass}}">\n        <b>{{vm.message}}</b>\n      </div>\n    </div>\n    <div class="ui three column grid">\n      <div class="row">\n        <div class="ui four wide column">\n          <atl-dropdown class="ui floating dropdown labeled icon button">\n            <i class="filter icon"></i>\n            <span class="text">{{\'SELECT_CONFERENCE\' | translate}}</span>\n            <div class="menu">\n              <div class="ui icon search input">\n                <i class="search icon"></i>\n                <input type="text" placeholder="{{\'SEARCH_TAGS\' | translate}}">\n              </div>\n              <div class="item" ng-repeat="conference in vm.conferences" ng-click="vm.selectConference(conference)">\n                <div class="ui {{conference.color}} empty circular label"></div>\n                {{conference.name}}\n              </div>\n            </div>\n          </atl-dropdown>\n        </div>\n        <div class="ui four wide column" ng-style="{\'visibility\': vm.conference ? \'visible\':\'hidden\'}">\n          <label><b>{{\'TOPIC\' | translate}}:</b></label>\n          <div>{{vm.conference.topic}}</div>\n        </div>\n        <div class="ui eight wide column" ng-style="{\'visibility\': vm.conference ? \'visible\':\'hidden\'}">\n          <label><b>{{\'DESCRIPTION\' | translate}}:</b></label>\n          <div>{{vm.conference.description}}</div>\n        </div>\n      </div>\n\n      <div class="row" ng-style="{\'visibility\': vm.conference ? \'visible\':\'hidden\'}">\n        <div class="ui four wide column">\n          <div class="ui form">\n            <div class="field">\n              <select ng-options="city as city.name for city in vm.conference.cities" ng-model="vm.city" ng-change="vm.changeCity(city)" class="ui dropdown">\n                <option value="" selected="selected">{{\'SELECT_CITY\' | translate}}</option>\n              </select>\n            </div>\n          </div>\n        </div>\n        <div class="ui four wide column">\n          <div class="ui form">\n            <div class="field">\n              <select ng-options="date as date.period  for date in vm.city_dates" ng-model="vm.date" ng-change="vm.changeDate()" class="ui dropdown">\n                <option value="" selected="selected">{{\'SELECT_DATE\' | translate}}</option>\n                <!--<option ng-value="{{date}}" ng-repeat="date in vm.city_dates">{{date.date_start | date:\'dd.MM.yyyy\'}} - {{date.date_end | date:\'dd.MM.yyyy\'}}</option>-->\n              </select>\n            </div>\n          </div>\n        </div>\n        <div class="ui eight wide column">\n          <div class="ui three column grid">\n            <div class="column">1 {{\'BED\' | translate}}: <b> {{vm.one_bed_rooms_quantity || 0}}</b></div>\n            <div class="column">pozostał: <b>{{vm.date.count_one_bed_rooms}}</b></div>\n            <div class="column">najechać: <b>{{vm.date.overrun_one_rooms}}</b></div>\n          </div>\n          <div class="ui three column grid">\n            <div class="column">2 {{\'BEDS\' | translate}}: <b> {{vm.two_bed_rooms_quantity || 0}}</b></div>\n            <div class="column">pozostał: <b>{{vm.date.count_two_bed_rooms}}</b></div>\n            <div class="column">najechać: <b>{{vm.date.overrun_two_rooms}}</b></div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n  </div>\n\n  <div class="ui form">\n\n    <div class="ui basic segment">\n      <table class="ui basic table">\n        <thead>\n        <tr>\n          <th>{{\'PARTICIPATES\' | translate}}</th>\n          <th class="four wide">{{\'ROOM\' | translate}}</th>\n          <th>{{\'INCLUDE\' | translate}}</th>\n          <!--\n          <th>Date</th>\n          <th>City</th>\n          <th>Hotel</th>\n          -->\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-repeat="person in vm.date.staff | orderBy:\'last_name\':false">\n          <td><b><i class="icon green desktop"></i> {{person.first_name}} {{person.last_name}}</b></td>\n          <td>\n            <select ng-model="person.number_beds" class="ui dropdown" ng-change="vm.personSelectedRoom(person)">\n              <option value="">{{\'SELECT_ROOM\' | translate}}</option>\n              <option value="1" ng-selected="person.number_beds == 1">1 {{\'BED\' | translate}}</option>\n              <option value="2" ng-selected="person.number_beds == 2">2 {{\'BEDS\' | translate}}</option>\n            </select>\n          </td>\n          <td>\n            <div class="ui toggle checkbox">\n              <input id="check_{{$index}}" type="checkbox" ng-checked="person.selected" ng-model="person.selected" ng-change="vm.togglePerson(person)">\n              <label for="check_{{$index}}"></label>\n            </div>\n          </td>\n        </tr>\n        </tbody>\n        <tfoot ng-if="vm.date.staff.length">\n        <tr class="active">\n          <td><b>{{\'COMMON_SETTINGS\' | translate}}</b></td>\n          <td>\n            <select ng-model="vm.allSelectedRoom" ng-change="vm.toggleAllSelectedRoom()" class="ui dropdown">\n              <option value="">{{\'SELECT_ROOM\' | translate}}</option>\n              <option value="1">1 {{\'BED\' | translate}}</option>\n              <option value="2">2 {{\'BEDS\' | translate}}</option>\n            </select>\n          </td>\n          <td>\n            <div class="ui toggle checkbox">\n              <input id="checkAll" type="checkbox" ng-checked="vm.allSelected" ng-model="vm.allSelected" ng-change="vm.togglePersonsSelected()">\n              <label for="checkAll"></label>\n            </div>\n          </td>\n        </tr>\n        </tfoot>\n      </table>\n    </div>\n\n  </div>\n  <div class="ui center aligned basic segment">\n    <div class="ui two column center aligned grid">\n      <div class="column">\n        <button type="button" class="ui navy large button" ng-click="vm.placement()" ng-disabled="vm.disabled || !vm.date.staff.length || vm.lockForm">\n          <i class="hotel icon"></i>\n          {{\'PLACEMENT\' | translate}}\n        </button>\n      </div>\n      <div class="column">\n        <button type="button" class="ui large navy button" ng-click="vm.generateInvitation()" ng-disabled="vm.disabled || vm.lockForm">\n          <i class="send icon" ng-hide="vm.lockForm"></i>\n          <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n          {{\'GENERATE_INVITATIONS\' | translate}}\n        </button>\n      </div>\n    </div>\n  </div>\n</div>\n<atl-modal-form-dialog modal-id="\'showPlacement\'" modal-title="\'PLACEMENT\' | translate" class="fullscreen" show-action="false">\n  <div class="ui basic megacollapsed segment" style="height: 750px;overflow:hidden">\n    <div class="ui basic megacollapsed segment" style="height: 690px;overflow-x:hidden;overflow-y: auto">\n      <div class="ui grid">\n\n        <div class="three wide column">\n          <div class="ui segment" ng-drop="true" ng-drop-success="vm.onDropCompletePerson($data, $event)">\n            <div class="ui segment green" ng-repeat="person in vm.personsTemp | orderBy:\'last_name\':false" ng-drag="true" ng-drag-data="person">\n              <div><b>{{person.first_name}} {{person.last_name}}</b></div>\n            </div>\n          </div>\n        </div>\n\n        <div class="twelve wide column">\n\n          <div class="ui supercollapsed segment">\n\n            <atl-accordion>\n              <div class="title active">\n                <i class="dropdown icon"></i>\n                One bed rooms <i class="user icon"></i>\n              </div>\n              <div class="content active">\n\n                <div class="ui grid">\n                  <div class="four wide column" ng-repeat="n in [] | range:vm.one_bed_rooms_quantity">\n\n                    <div class="ui segment green" ng-drop="true" ng-drop-success="vm.onDropComplete($data, $event, 1, n, 0)">\n\n                      <div class="ui segment green drag-person" ng-repeat="person in vm.personsDropped | filter: {number_room:n+1, number_bed: 1, number_beds: 1}" ng-drag="true" ng-drag-data="person">\n                        <div>\n                          <b>{{person.first_name}} {{person.last_name}}</b>\n                        </div>\n                      </div>\n\n                    </div>\n\n                  </div>\n                </div>\n\n              </div>\n\n              <div class="title">\n                <i class="dropdown icon"></i>\n                Two bed rooms <i class="user icon"></i><i class="user icon"></i>\n              </div>\n              <div class="content">\n                <div class="ui grid">\n                  <div class="four wide column" ng-repeat="n in [] | range:vm.two_bed_rooms_quantity">\n                    <div class="ui segments">\n\n                      <div class="ui segment blue" ng-repeat="j in [] | range:2" ng-drop="true" ng-drop-success="vm.onDropComplete($data, $event, 2, n, j)">\n\n                        <div class="ui segment green drag-person" ng-repeat="person in vm.personsDropped | filter: {number_room:n+1, number_bed: j+1, number_beds: 2}" ng-drag="true" ng-drag-data="person">\n                          <div>\n                            <b>{{person.first_name}} {{person.last_name}}</b>\n                          </div>\n                        </div>\n                      </div>\n\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </atl-accordion>\n          </div>\n\n        </div>\n\n\n      </div>\n\n    </div>\n    <div class="ui basic megacollapsed center aligned segment">\n\n      <div class="ui two column center aligned grid">\n        <div class="column">\n          <button type="button" class="ui navy large button" ng-click="vm.cancelPlacement()" ng-disabled="vm.disabled || !vm.date.staff.length">\n            <i class="save icon"></i>\n            {{\'CANCEL\' | translate}}\n          </button>\n        </div>\n        <div class="column">\n          <button type="button" class="ui large navy button" ng-click="vm.savePlacement()" ng-disabled="vm.disabled">\n            <i class="mail icon"></i>\n            {{\'SAVE\' | translate}}\n          </button>\n        </div>\n      </div>\n\n    </div>\n\n  </div>\n</atl-modal-form-dialog>'),$templateCache.put("app/clients/list/clients.filter.html",'<div id="container" class="ui segment main container">\n  <h1 class="ui ribbon label breadcrumb"><div class="active section">{{\'CLIENT_LIST\' | translate}}</div></h1>\n\n  <div class="ui center aligned grid" style="margin-bottom: 15px !important">\n\n    <div class="ui eight wide column left aligned">\n      <!-- <label>Campaigns:</label> -->\n      <div class="ui left floated basiс megacollapsed segment no-border" ng-if="vm.campaigns.length">\n        <atl-list-slider display-number="5" start-index="{{vm.campaigns.length > 5 ? vm.indexCampaign : 0}}" list-id="listCampaignButtons" class-list="compact ui tiny buttons campaigns-select-buttons">\n          <div ng-repeat="campaign in vm.campaigns" class="ui icon button c_active {{vm.activeColor[campaign.id]}} list-slider-item" ng-click="vm.filterByCampaign(campaign.id)" ng-class="\'btn_\'+campaign.icon">\n            <i class="c_icon"></i> {{campaign.identifier}}\n          </div>\n        </atl-list-slider>\n      </div>\n    </div>\n\n    <div class="ui eight wide column right aligned">\n\n        <div class="ui buttons" ng-class="{\'inactive\':vm.selectedStep==\'\' && !vm.not_paid_campaign}" style="white-space: nowrap" ng-if="vm.drugstores.length">\n          <div class="ui compact button button-with-label {{color}}" data="{{color}}" ng-class="{\'current-color\':color==vm.selectedColor}" ng-repeat="color in vm.stepColors" ng-click="vm.selectColor(vm.selectedStep, color)">\n            \n            <span ng-if="!vm.not_paid_campaign">\n                <small ng-if="vm.colorStepCounter[vm.selectedStep][color]" ng-class="{\'exclamation\':color==\'greenwarning\'}">{{vm.colorStepCounter[vm.selectedStep][color]}}</small>\n                <small ng-if="!vm.colorStepCounter[vm.selectedStep][color] && color == \'greenwarning\'" class="exclamation">!</small>\n                <small ng-if="!vm.colorStepCounter[vm.selectedStep][color] && color != \'greenwarning\'">&nbsp;</small>\n            </span>\n\n            <span ng-if="vm.not_paid_campaign">\n                <small ng-if="vm.colorStepCounter[\'all\'][color]" ng-class="{\'exclamation\':color==\'greenwarning\'}">{{vm.colorStepCounter[\'all\'][color]}}</small>\n                <small ng-if="!vm.colorStepCounter[\'all\'][color] && color == \'greenwarning\'" class="exclamation">!</small>\n                <small ng-if="!vm.colorStepCounter[\'all\'][color] && color != \'greenwarning\'">&nbsp;</small>\n            </span>\n            \n            <small ng-if="vm.stepColorLabels[color]" class="label-in-button">{{vm.stepColorLabels[color] | translate}}</small>\n          </div>\n          <div class="ui compact button white" data="white" ng-click="vm.selectColor(\'\', \'\')" style="color:#777!important">\n            <small>&times;</small>\n          </div>\n         </div>\n\n    </div>\n\n  </div>\n\n\n\n  <div class="ui main container" atl-infinite-scroll="vm.loadMore()" container-to-scroll="general-shell">\n    \n    <div class="ui grid">\n    \n        <div class="ui twelve wide column left aligned">\n          <button type="button" class="ui small button {{vm.activeColorRights.visit}}" ng-click="vm.filterByRights(\'my\')">\n            Moje Apteki\n          </button>\n          <button type="button" class="ui small button drugstores-filtration drugstores-filtration-drugstore {{vm.activeColorRights.management}}" ng-click="vm.filterByRights(\'observed\')">\n            Do obserwacji\n          </button>\n          <button type="button" class="ui small button drugstores-filtration drugstores-filtration-camera {{vm.activeColorRights.colleague}}" ng-click="vm.filterByRights(\'colleague\')">\n            Dla kolegów\n          </button>\n\n          <span class="ui left icon input">\n            <input type="text" placeholder="{{\'DYNAMIC_SEARCH\' | translate}}" id="dynsearch" ng-model="vm.searchText">\n            <i class="search icon"></i>\n          </span>\n\n        </div>\n\n        <div class="ui four wide column right aligned">\n          <div class="ui form" ng-if="vm.isManager">\n            <select ng-change="vm.changeStaff()" ng-model="vm.selectedStaff" class="ui fluid search dropdown">\n              <option value="">{{\'SELECT_REP\' | translate}}</option>\n              <option value="{{key}}" ng-repeat="(key, value) in vm.listStaff | selectedJobDuties:vm.userData" ng-selected="key == vm.selectedStaff">{{value.staff_info.firstName}} {{value.staff_info.lastName}} ({{value.job.shortname}})</option>\n            </select>\n          </div>\n        </div>\n\n    </div>\n\n\n    <table class="ui table celled striped sortable listView">\n      <thead>\n      <tr>\n        <th></th>\n        <th ng-if="vm.isManager" class="more_narrow">{{\'REP\' | translate}}</th>\n        <th class="cell_identifier" ng-click="vm.changeSorting(\'identifier\')" ng-class="vm.sortingClass(\'identifier\')">{{\'ID\' | translate}}</th>\n        <th ng-click="vm.changeSorting(\'name\')" ng-class="vm.sortingClass(\'name\')">{{\'NAME\' | translate}}</th>\n        <th ng-click="vm.changeSorting([\'drugstores_network.name\', \'drugstores_network.id\', \'-negotiation_point\'])" ng-class="vm.sortingClass([\'drugstores_network.name\', \'drugstores_network.id\', \'-negotiation_point\'])">{{\'DRUGSTORES_NETWORK\' | translate}}</th>\n        <th ng-click="vm.changeSorting(\'address.city.name\')" ng-class="vm.sortingClass(\'address.city.name\')">{{\'ADDRESS\' | translate}}</th>\n        <th valign="bottom" class="cell_date title_wrap" ng-click="vm.changeSorting(\'campaignDateEnd\')" ng-class="vm.sortingClass(\'campaignDateEnd\')">{{\'END_DATE\' | translate}}</th>\n        <th>\n          \n          <div class="ui small buttons" style="white-space: nowrap" ng-if="!vm.not_paid_campaign">\n            <span ng-repeat="step in vm.activeCampaign.steps">\n            <div class="ui inline tiny button step_title" style="float: none;display: inline-block" ng-class="{\'current-step\':step.identifier==vm.selectedStep}" ng-click="vm.setStepIdentifier(step.identifier)">\n              <div>{{::step.identifier}}</div>\n            </div>\n            </span>\n          </div>\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="drugstore in (filteredItems = (vm.drugstores | searchDrugstore: vm.searchText: vm.searchArrFields))\n          | orderBy:vm.sort.column:vm.sort.descending\n          | filter: vm.searchText\n          | selectedStepColor:vm.selectedStep:vm.selectedColor\n          | limitTo: vm.pagingLimit\n          track by drugstore.id" ng-class="{\'negative\': drugstore.isBlocked}" ng-click="vm.selectDrugstore(drugstore.id)">\n        <td>\n          <div class="icon-container cell_icon">\n            <img src="assets/img/icons/design/drugstore_network_global_negotiation_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type == \'central\' && drugstore.negotiation_point && drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_network_global_negotiation_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type == \'central\' && drugstore.negotiation_point && !drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_network_global_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type == \'central\' && !drugstore.negotiation_point && drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_network_local_negotiation_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type != \'central\' && drugstore.negotiation_point && drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_network_local_negotiation_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type != \'central\' && drugstore.negotiation_point && !drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_network_local_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type != \'central\' && !drugstore.negotiation_point && drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_individual.png" align="baseline" ng-if="!drugstore.drugstores_network_id">\n            \n            <i class="red large warning sign icon icon-nested" ng-if="vm.hasWarningSign(drugstore)"></i>\n          </div>\n        </td>\n        <td class="cell_staff" ng-if="vm.isManager" ng-click="$event.stopPropagation();">\n          <nobr>\n            <span ng-init="$last">\n              <atl-dropdown class="ui compact dropdown">\n                <div class="text">\n                  <img src="assets/img/icons/campaigns/pages/user.png" class="ui avatar image">\n                  <span ng-if="vm.listDrugstores[drugstore.id].staff.length">{{vm.listDrugstores[drugstore.id].staff.length}}</span>\n                </div>\n                <i class="dropdown icon"></i>\n                <div class="menu" ng-if="vm.listDrugstores[drugstore.id].staff.length">\n                  <div class="header" ng-repeat="staff in vm.listDrugstores[drugstore.id].staff">\n                    <span ng-class="{\'lightblue\':vm.isJobDutiesSignatureVisit(staff)}">\n                      {{::staff.name}}\n                    </span>\n                  </div>\n                </div>\n              </atl-dropdown>\n            </span>\n          </nobr>\n        </td>\n        <td>{{::drugstore.identifier}}</td>\n        <td>\n          <div class="cell_name more_narrow">{{::drugstore.name}}</div>\n        </td>\n        <td>\n          <div class="text_overflow more_narrow" ng-click="$event.stopPropagation();" data-content="{{::drugstore.drugstores_network.name}}" atl-popup>{{::drugstore.drugstores_network.name}}</div>\n        </td>\n        <td>\n          <div class="cell_address more_narrow">{{::drugstore.addressLine1}}<br>{{::drugstore.address.zip}} {{::drugstore.cityName}}</div>\n        </td>\n        <td>{{::drugstore.campaignDateEnd | date:\'dd.MM.yyyy\'}}</td>\n        <td>\n          <div class="steps_container">\n          <nobr>\n            <div ng-if="!vm.not_paid_campaign">\n              <div ng-repeat="step in vm.activeCampaign.steps" class="step_button step_icon_base">\n                <div ng-if="step.icon" class="step_icon_button">\n                  <img ng-if="vm.stepColorInfo[drugstore.id][step.identifier]" ng-src="assets/img/icons/campaigns/step-icons/{{vm.stepColorInfo[drugstore.id][step.identifier]}}.jpg" title="{{::step.identifier}}">\n                  <img ng-if="!vm.stepColorInfo[drugstore.id][step.identifier]" ng-src="assets/img/icons/campaigns/step-icons/{{step.icon}}-grey.jpg" title="{{::step.identifier}}">\n                </div>\n                <div ng-if="!step.icon" class="step_text_button">{{step.identifier}}</div>\n              </div>\n\n              <div ng-repeat="step in drugstore.steps" class="step_button step_button_in_drugstore step_button_with_date" style="left: {{$index*49}}px" ng-click="vm.selectDrugstoreStep(drugstore.id, step.identifier, step.disabled, $event)" ng-if="!step.disabled &&\n                 (vm.selectedStep == step.identifier && (vm.selectedColor == step.color || step.specColor.length && step.specColor.indexOf(vm.selectedColor)>-1 || vm.selectedColor  == \'white\') || !vm.selectedStep && !vm.selectedColor)">\n                <div ng-if="step.icon" class="step_icon_button" ng-class="{\'step_start\': step.isStepStart}">\n                  <img ng-src="assets/img/icons/campaigns/step-icons/{{::step.icon_color}}.jpg" title="{{::step.identifier}}">\n                  <!--<div class="floating ui red circular label" ng-if="step.isWarningStep" ng-class="{\'step_warning\': step.isWarningStep}">{{step.isWarningStep}}</div>-->\n                  <div class="ui red right corner label step_warning" ng-if="step.isWarningStep">\n                    <span>{{step.isWarningStep}}</span>\n                  </div>\n                  <span class="step-date">{{step.date_start | date:\'dd.MM\'}}&ndash;{{step.date_end | date:\'dd.MM\'}}</span>\n                </div>\n                <div ng-if="!step.icon" class="step_text_button">{{::step.identifier}}</div>\n              </div>\n            </div>\n\n            <div ng-if="vm.not_paid_campaign" ng-click="$event.stopPropagation();">\n              <atl-list-slider display-number="5" start-index="{{drugstore.steps.length > 5 ? drugstore.steps.length-1 : 0}}" list-id="listCampaignButtons_{{$index}}" target-id="{{drugstore.id}}">\n\n                <div ng-repeat="step in drugstore.steps" class="step_button step_button_with_date list-slider-item item-small" ng-click="vm.selectDrugstoreStep(drugstore.id, step.identifier, step.disabled, $event)" ng-if="!step.disabled && ((vm.selectedColor == step.color || step.specColor.length && step.specColor.indexOf(vm.selectedColor)>-1 || vm.selectedColor  == \'white\') || !vm.selectedStep && !vm.selectedColor)">\n                  <div ng-if="step.icon" class="step_icon_button list_slider" ng-class="{\'step_start\': step.isStepStart}">\n                    <img ng-src="assets/img/icons/campaigns/step-icons/{{::step.icon_color}}.jpg" title="{{::step.identifier}}">\n                    <!--<div class="floating ui red circular label step_warning_circular">{{step.isWarningStep}}</div>-->\n                    <div class="ui red right corner label step_warning" ng-if="step.isWarningStep">\n                      <span>{{step.isWarningStep}}</span>\n                    </div>\n                    <span class="step-date list-date">{{::step.date_start | date:\'dd.MM\'}}&ndash;{{::step.date_end | date:\'dd.MM\'}}</span>\n                  </div>\n                  <div ng-if="!step.icon" class="step_text_button list_slider">{{::step.identifier}}</div>\n                </div>\n\n              </atl-list-slider>\n            </div>\n          </nobr>\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n\n  </div>\n</div>'),$templateCache.put("app/clients/list/clients.list.html",'<div id="container" class="ui segment main container">\n  <h1 class="ui ribbon label breadcrumb"><div class="active section">{{\'CLIENT_LIST\' | translate}}</div></h1>\n\n  <div class="ui center aligned grid" style="margin-bottom: 15px !important">\n\n    <div class="ui eight wide column right aligned">\n      <div ng-if="vm.campaigns.length">\n        <atl-list-slider list-index="0" display-number="5" list-id="listCampaignButtons" class-list="compact ui tiny buttons campaigns-select-buttons">\n          <div class="ui icon button c_active list-slider-item campaign_state_{{vm.states.overall[campaign.id]}}" id="campaignRight_{{$index}}" ng-repeat="campaign in vm.campaigns track by campaign.id" ng-click="vm.filterByCampaign(campaign.id)" ng-class="\'btn_\'+campaign.icon">\n            <i class="c_icon"></i> {{::campaign.identifier}}\n          </div>\n        </atl-list-slider>\n      </div>\n    </div>\n\n    <div class="ui eight wide column right aligned">\n    </div>\n\n  </div>\n\n  <div class="ui main container" atl-infinite-scroll="vm.loadMore()" container-to-scroll="general-shell">\n\n    <div class="ui grid">\n\n      <div class="ui twelve wide column left aligned">\n        <button type="button" class="ui small button {{vm.colorRights.visit}}" ng-click="vm.filterByRights(\'my\')">\n          Moje Apteki\n        </button>\n        <button type="button" class="ui small button drugstores-filtration drugstores-filtration-drugstore {{vm.colorRights.management}}" ng-click="vm.filterByRights(\'observed\')">\n          Do obserwacji\n        </button>\n        <button type="button" class="ui small button drugstores-filtration drugstores-filtration-camera {{vm.colorRights.colleague}}" ng-click="vm.filterByRights(\'colleague\')">\n          Dla kolegów\n        </button>\n\n          <span class="ui left icon input dynsearch">\n            <input type="text" placeholder="{{\'DYNAMIC_SEARCH\' | translate}}" id="dynsearch" ng-model="vm.searchText" ng-model-options="{debounce: 500}">\n            <i class="search icon"></i>\n          </span>\n      </div>\n\n      <div class="ui four wide column right aligned">\n        <div class="ui form" ng-if="vm.isManager">\n          <select ng-change="vm.changeStaff()" ng-model="vm.selectedStaff" class="ui dropdown">\n            <option value="">{{\'SELECT_REP\' | translate}}</option>\n            <option value="{{key}}" ng-repeat="(key, value) in vm.listStaff | selectedJobDuties:vm.userData" ng-selected="key == vm.selectedStaff">{{value.staff_info.firstName}} {{value.staff_info.lastName}} ({{value.job.shortname}})</option>\n          </select>\n        </div>\n      </div>\n\n    </div>\n\n    <table class="ui table celled striped sortable listView">\n      <thead>\n      <tr>\n        <th></th>\n        <th ng-if="vm.isManager" class="more_narrow">{{\'REP\' | translate}}</th>\n        <th class="cell_identifier" ng-click="vm.changeSorting(\'identifier\')" ng-class="vm.sortingClass(\'identifier\')">{{\'ID\' | translate}}</th>\n        <th ng-click="vm.changeSorting(\'name\')" ng-class="vm.sortingClass(\'name\')">{{\'NAME\' | translate}}</th>\n        <th ng-click="vm.changeSorting([\'drugstores_network_name\', \'drugstores_network_id\', \'-negotiation_point\'])" ng-class="vm.sortingClass([\'drugstores_network_name\', \'drugstores_network_id\', \'-negotiation_point\'])">{{\'DRUGSTORES_NETWORK\' | translate}}</th>\n        <th ng-click="vm.changeSorting(\'address.city.name\')" ng-class="vm.sortingClass(\'address.city.name\')">{{\'ADDRESS\' | translate}}</th>\n        <th>\n          <div ng-if="vm.campaigns.length">\n            <atl-list-slider list-index="0" display-number="{{vm.isManager ? 4 : 5}}" list-id="listCampaignButtonsOrder">\n              <div class="compact ui tiny icon button button-in-th c_active btn_{{campaign.icon}} list-slider-item campaign_state_{{vm.states.overall[campaign.id]}}" id="campaignSort_{{$index}}" ng-repeat="campaign in vm.campaigns track by campaign.id" ng-click="vm.changeSortingCampaigns(campaign)" ng-class="(campaign.id == vm.sortingCampaign.id ? \'orange\' : \'white\')">\n                <i class="c_icon"></i> {{::campaign.identifier}}\n              </div>\n            </atl-list-slider>\n          </div>\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="drugstore in (filteredItems = (vm.drugstores | searchDrugstore: vm.searchText: vm.searchArrFields))\n          | orderBy:vm.sort.column:vm.sort.descending\n          | sortingCampaigns:vm.sortingCampaign\n          | limitTo: vm.pagingLimit\n          track by drugstore.id" ng-click="vm.selectDrugstore(drugstore.id)">\n        <td>\n          <div class="icon-container cell_icon">\n            <img src="assets/img/icons/design/drugstore_network_global_negotiation_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network_type == \'central\' && drugstore.negotiation_point && drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_network_global_negotiation_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network_type == \'central\' && drugstore.negotiation_point && !drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_network_global_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network_type == \'central\' && !drugstore.negotiation_point && drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_network_local_negotiation_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network_type != \'central\' && drugstore.negotiation_point && drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_network_local_negotiation_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network_type != \'central\' && drugstore.negotiation_point && !drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_network_local_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network_type != \'central\' && !drugstore.negotiation_point && drugstore.selling_point">\n            <img src="assets/img/icons/design/drugstore_individual.png" align="baseline" ng-if="!drugstore.drugstores_network_id">\n\n            <i class="red large warning sign icon icon-nested" ng-if="vm.hasWarningSign(drugstore)"></i>\n          </div>\n        </td>\n        <td class="cell_staff" ng-if="vm.isManager" ng-click="$event.stopPropagation();">\n          <nobr>\n            <div ng-init="$last">\n              <atl-dropdown class="ui compact dropdown">\n                <div class="text">\n                  <img src="assets/img/icons/campaigns/pages/user.png" class="ui avatar image">\n                  <span ng-if="vm.listDrugstores[drugstore.id].staff.length">{{vm.listDrugstores[drugstore.id].staff.length}}</span>\n                </div>\n                <i class="dropdown icon"></i>\n                <div class="menu" ng-if="vm.listDrugstores[drugstore.id].staff.length">\n                  <div class="header" ng-repeat="staff in vm.listDrugstores[drugstore.id].staff">\n                    <span ng-class="{\'lightblue\':vm.isJobDutiesSignatureVisit(staff)}">\n                      {{::staff.name}}\n                    </span>\n                  </div>\n                </div>\n              </atl-dropdown>\n            </div>\n          </nobr>\n        </td>\n        <td>{{::drugstore.identifier}}</td>\n        <td>\n          <div class="cell_name more_narrow">{{::drugstore.name}}</div>\n        </td>\n        <td>\n          <div class="text_overflow more_narrow" ng-click="$event.stopPropagation();" data-content="{{::drugstore.drugstores_network_name}}" atl-popup>{{::drugstore.drugstores_network_name}}</div>\n        </td>\n        <td>\n          <div class="cell_address more_narrow">{{::drugstore.address.address_line_1}}<br>{{::drugstore.address.zip}} {{::drugstore.address.city_name}}</div>\n        </td>\n        <td ng-click="$event.stopPropagation();">\n          <div ng-if="drugstore.campaign_ids.length">\n            <atl-list-slider list-index="{{$index}}" ng-model="vm.listSlider" display-number="{{vm.isManager ? 4 : 5}}" list-id="drugstoreCampaigns_{{$index}}" class-list="">\n              <nobr>\n                <div class="compact ui tiny icon usual button button-in-th btn_{{campaign.icon}} button-with-warning list-slider-item" id="drugstoreCampaign_{{$index}}" ng-class="vm.applyClass(drugstore.id, campaign.id)" ng-repeat="campaign in (filteredCampaigns = (vm.campaigns | filterDrugstoreCampaigns: drugstore.campaign_ids))| orderBy:id track by campaign.id" ng-click="vm.selectCampaign(campaign.id)">\n                  <i class="c_icon"></i> {{::campaign.identifier}}\n                  <div class="ui red right corner label step_warning" ng-if="campaign.hasWarningStep">\n                    <span>!</span>\n                  </div>\n                </div>\n              </nobr>\n            </atl-list-slider>\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n\n  </div>\n</div>'),
$templateCache.put("app/clients/mainInfo/clients.listDrugstores.modals.html",'<atl-modal-form-dialog modal-id="\'networkDrugstoresList\'" show-action="false" modal-title="\'DRUGSTORES_LIST\' | translate">\n  <div class="ui basic megacollapsed segment" style="height: 300px; overflow: auto">\n    <table class="ui table striped sortable listView">\n      <thead>\n      <tr>\n        <th>{{\'ID\' | translate}}</th>\n        <th>{{\'NAME\' | translate}}</th>\n        <th>{{\'CITY\' | translate}}</th>\n        <th>{{\'ZIP\' | translate}}</th>\n        <th>{{\'STREET\' | translate}}</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="pharmacy in vm.netDrugstores" ng-click="vm.selectDrugstore(pharmacy.id)" ng-if="!pharmacy.isHide">\n        <td ng-class="{\'lightblue\':vm.isNegotiationPoint(pharmacy)}">{{::pharmacy.identifier}}</td>\n        <td ng-class="{\'lightblue\':vm.isNegotiationPoint(pharmacy)}">{{::pharmacy.name}}</td>\n        <td>{{::pharmacy.address.city.name}}</td>\n        <td>{{::pharmacy.address.zip}}</td>\n        <td>{{::pharmacy.address.address_line_1}}</td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</atl-modal-form-dialog>'),$templateCache.put("app/clients/mainInfo/clients.mainInfo.html",'<div id="container" class="ui segment main container">\n\n    <h1 class="h1">\n      <span class="campaign-header-icons">\n\t\t\t  <span ng-click="vm.showStaffList()">\n          <img src="assets/img/icons/campaigns/pages/user.png">\n          <sup>{{vm.staffForDrugstore.length}}</sup>\n        </span>\n\t\t\t  <span ng-click="vm.showDrugstoresList()">\n          <img ng-src="assets/img/icons/design/{{vm.netWorkIcon}}">\n          <sup>{{vm.netDrugstores.length}}</sup>\n        </span>\n\t  \t</span>\n      <span class="campaign-header-text">\n        <span class="portal_registered" ng-if="vm.portalRegistered">\n          <img src="assets/img/icons/design/drugstore_registered.png">\n        </span>\n        <span class="portal_registered" ng-if="vm.isExistsNotRegistered">\n          <img src="assets/img/icons/design/drugstore_registered_black.png">\n        </span>\n        <span>{{vm.drugstore.name}} — {{\'GENERAL_INFORMATION\' | translate}}</span>\n      </span>\n    </h1>\n\n    <div class="ui basic segment">\n\n      <table class="ui most basic table">\n        <tr>\n          <td class="collapsing">{{\'ID\' | translate}}:</td>\n          <td><strong>{{vm.drugstore.identifier}}</strong></td>\n          <td class="collapsing">{{\'NIP\' | translate}}:</td>\n          <td><strong>{{vm.drugstore.NIP}}</strong></td>\n        </tr>\n\n        <tr>\n          <td class="collapsing cell-pale">Nazwa Firmy:</td>\n          <td class="cell-pale"><strong>{{vm.drugstore.fullname | uppercase}}</strong></td>\n          <td class="collapsing cell-marine">{{\'TITLE\' | translate}}:</td>\n          <td class="cell-marine"><strong>{{vm.drugstore.name | uppercase}}</strong></td>\n        </tr>\n\n        <tr>\n          <td class="collapsing cell-pale">Adres Firmy 1:</td>\n          <td class="cell-pale"><strong>{{vm.drugstore.juridical_address.address_line_1}}</strong></td>\n          <td class="collapsing cell-marine">{{\'ADDRESS_LINE\' | translate}} 1:</td>\n          <td class="cell-marine"><strong>{{vm.drugstore.address.address_line_1}}</strong></td>\n        </tr>\n\n        <tr>\n          <td class="collapsing cell-pale">Adres Firmy 2:</td>\n          <td class="cell-pale"><strong>{{vm.drugstore.juridical_address.address_line_2}}</strong></td>\n          <td class="collapsing cell-marine">{{\'ADDRESS_LINE\' | translate}} 2:</td>\n          <td class="cell-marine"><strong>{{vm.drugstore.address.address_line_2}}</strong></td>\n        </tr>\n\n        <tr>\n          <td class="collapsing cell-pale">KRS:</td>\n          <td class="cell-pale"><strong>{{vm.drugstore.krs != \'0000000000\' ? vm.drugstore.krs : \'\'}}</strong></td>\n          <td class="collapsing cell-marine">Regon:</td>\n          <td class="cell-marine"><strong>{{vm.drugstore.regon}}</strong></td>\n        </tr>\n\n        <tr>\n          <td class="collapsing cell-pale">Miasto Firmy:</td>\n          <td class="cell-pale"><strong>{{vm.drugstore.juridical_address.city.name}}</strong></td>\n          <td class="collapsing cell-marine">{{\'CITY\' | translate}}:</td>\n          <td class="cell-marine"><strong>{{vm.drugstore.address.city.name}}</strong></td>\n        </tr>\n\n        <tr>\n          <td class="collapsing cell-pale">Kod Firmy:</td>\n          <td class="cell-pale"><strong>{{vm.drugstore.juridical_address.zip}}</strong></td>\n          <td class="collapsing cell-marine">{{\'ZIP\' | translate}}:</td>\n          <td class="cell-marine"><strong>{{vm.drugstore.address.zip}}</strong></td>\n        </tr>\n\n        <tr>\n          <td class="collapsing">{{\'EMAIL\' | translate}}:</td>\n          <td><a href="mailto:{{vm.drugstore.email}}">{{vm.drugstore.email}}</a></td>\n          <td class="collapsing">{{\'PHONE\' | translate}}:</td>\n          <td><strong>{{vm.drugstore.address.phone}}</strong></td>\n        </tr>\n\n        <!-- <tr>\n                 regon, centrala\n              </tr> -->\n\n        <tr>\n          <td class="collapsing">{{\'NEGOTIATION_POINT\' | translate}}:</td>\n          <td><strong>{{ vm.drugstore.negotiation_point === true ? (\'YES\' | translate) : (\'NO\' | translate) }}</strong></td>\n          <td class="collapsing">{{\'SELLING_POINT\' | translate}}:</td>\n          <td><strong>{{ vm.drugstore.selling_point === true ? (\'YES\' | translate) : (\'NO\' | translate) }}</strong></td>\n        </tr>\n\n        <tr>\n          <td class="collapsing">{{\'DRUGSTORES_NETWORK\' | translate}}:</td>\n          <td><strong>{{vm.drugstore.drugstores_network.name}}</strong></td>\n          <td class="collapsing">{{\'CATEGORY\' | translate}}:</td>\n          <td><strong>{{vm.drugstore.category.name}}</strong></td>\n        </tr>\n\n        <tr>\n          <td class="collapsing">{{\'NUMBER_OF_SELLING_POINT\' | translate}}:</td>\n          <td><strong>{{vm.drugstore.selling_points_number}}</strong></td>\n          <td></td>\n          <td></td>\n        </tr>\n\n        <!-- <tr>\n            <td class="collapsing">{{\'COUNTRY\' | translate}}:</td>\n            <td><strong>{{vm.drugstore.address.country.name}}</strong></td>\n            <td></td>\n            <td></td>\n        </tr> -->\n      </table>\n\n        <div class="ui bottom right attached icon massive transparent label"><a ng-click="vm.editMainInfo(vm.drugstore.id)"><i class="pencil icon"></i></a></div>\n\n    </div>\n\n\n    <ng-include src="\'app/clients/mainInfo/clients.mainInfo.staff.html\'"></ng-include>\n\n\t<br clear="all">\n\t<br clear="all">\n\n\n    <!--div class="ui three column center aligned grid">\n        <div class="column">\n            <div class="ui large button"\n                 ng-class="{disabled: vm.drugstore.frame_conract_signed}"\n                 ng-click="vm.showConfirmFrameContractSigningModalWindow()">\n                <i class="icon checkmark"></i>\n                {{\'CONFIRM_FRAME_CONTRACT_SIGNING\' | translate}}\n            </div>\n        </div>\n        <div class="column">\n            <div class="ui large button"\n                 ng-class="{disabled: !vm.drugstore.frame_contract_id}"\n                 ng-click="vm.showFrameContractPrintWindow(vm.drugstore.frame_contract_id)">\n                <i class="icon print"></i>\n                {{\'FRAME_CONTRACT_PRINT\' | translate}}\n            </div>\n        </div>\n        <div class="column">\n            <div class="ui navy large button"\n                 ng-click="vm.showOrUploadScannedContract()">\n                <i ng-if="!vm.drugstore.signed_conract_uploaded"\n                   class="upload icon"></i>\n                <i ng-if="vm.drugstore.signed_conract_uploaded"\n                   class="icon barcode"></i>\n                <span ng-if="!vm.drugstore.signed_conract_uploaded">{{\'UPLOAD_SCANNED_FRAME_CONTRACT\' | translate}}</span>\n                <span ng-if="vm.drugstore.signed_conract_uploaded">{{\'VIEW_SCANNED_FRAME_CONTRACT\' | translate}}</span>\n            </div>\n        </div>\n    </div-->\n\n    <ui-modal-dialog title="Confirm Contract Signing" visible="showConfirmFrameContractSigningModal">\n        <i class="close icon"></i>\n\n        <div class="header">\n            {{\'CONFIRM_CONTRACT_SIGNED_UP\' | translate}}\n        </div>\n        <div class="content">\n            <p>{{\'CONFIRM_CONTRACT_SIGNED_BY_DRUGSTORE\' | translate}}</p>\n        </div>\n        <div class="actions">\n            <div class="ui black deny button" ng-click="vm.hideConfirmFrameContractSigningModalWindow()">\n                {{\'CANCEL\' | translate}}\n            </div>\n            <div class="ui positive right labeled icon button" ng-click="vm.signFrameContract()">\n                {{\'OK\' | translate}}\n                <i class="checkmark icon"></i>\n            </div>\n        </div>\n    </ui-modal-dialog>\n\n    <ui-modal-dialog title="Print Frame Contract" visible="showFrameContractPrintModal">\n        <i class="close icon"></i>\n\n        <div class="header">\n            {{\'PRINT_FRAME_CONTRACT\' | translate}}\n        </div>\n        <div class="image content">\n            <!--<embed id="print-frame-contract-content"-->\n            <!--ng-src="{{vm.printFrameContractContent}}"-->\n            <!--style="width: 619px; height: 875px;"></embed>-->\n            <!--<object id="print-frame-contract-content"-->\n                    <!--style="width: 619px; height: 875px;"-->\n                    <!--type="application/pdf"-->\n                    <!--data="{{vm.printFrameContractContent}}">-->\n                <!--<p>No PDF to display.</p>-->\n            <!--</object>-->\n            <div class="ui medium image">\n                <div id="print-frame-contract-content" style="height: 640px; width: 480px; overflow: auto"></div>\n            </div>\n        </div>\n        <div class="actions">\n            <div class="ui black deny button" ng-click="vm.hideFrameContractPrintWindow()">\n                {{\'CANCEL\' | translate}}\n            </div>\n            <div class="ui positive right labeled icon button" ng-click="vm.printFrameContract()">\n                {{\'PRINT_FRAME_CONTRACT\' | translate}}\n                <i class="checkmark icon"></i>\n            </div>\n        </div>\n    </ui-modal-dialog>\n\n    <ui-modal-dialog title="Upload Signed Contract Scan" visible="showUploadSignedContractModal" id="scanned-contract-file-form-modal">\n        <i class="close icon"></i>\n\n        <div class="header">\n            {{\'UPLOAD_SIGNED_CONTRACT_SCAN\' | translate}}\n        </div>\n        <div class="content">\n            <form class="ui form">\n                <div class="ui visible message">\n                    <p>{{\'TYPE_FILE_TO_UPLOAD\' | translate}}</p>\n                </div>s\n                <div class="field">\n                    <div class="ui action input">\n                        <input type="file" id="scanned-contract-file" name="scanned-contract-file" onchange="angular.element(this).scope().onSelectScannedContractFile(this)" style="display: none">\n                        <input type="text" ng-model="vm.scannedContractFilename" name="scanned-contract-filename" placeholder="{{\'SELECT\' | translate}}">\n                        <button class="ui button" ng-click="vm.selectScannedContractFile()">\n                            {{\'SELECT_FILE\' | translate}}\n                        </button>\n                    </div>\n                </div>\n            </form>\n\n        </div>\n        <div class="actions">\n            <div class="ui black deny button" ng-click="vm.hideUploadSignedContractModal()">\n                {{\'CANCEL\' | translate}}\n            </div>\n            <div class="ui positive right labeled icon button" ng-class="{disabled: !vm.isScannedContractFileReadyToUpload}" ng-click="vm.uploadScannedContract()">\n                {{\'UPLOAD_FRAME_CONTRACT\' | translate}}\n                <i class="checkmark icon"></i>\n            </div>\n        </div>\n    </ui-modal-dialog>\n\n    <ui-modal-dialog title="View Signed Contract Scan" visible="showViewSignedContractModal">\n        <i class="close icon"></i>\n\n        <div class="header">\n            {{\'VIEW_SIGNED_CONTRACT_SCAN\' | translate}}\n        </div>\n        <div class="image content">\n            <div class="ui medium image">\n                <img ng-src="{{vm.getSignedContractScanPath()}}">\n            </div>\n            <div class="description">\n                <div class="ui header">{{vm.drugstore.signed_contract.name}}</div>\n                <p></p>\n            </div>\n        </div>\n        <div class="actions">\n            <div class="ui black deny button" ng-click="vm.hideUploadSignedContractModal()">\n                {{\'CLOSE\' | translate}}\n            </div>\n        </div>\n    </ui-modal-dialog>\n\n</div>\n\n<ng-include src="\'app/clients/mainInfo/clients.staff.modals.html\'"></ng-include>\n<ng-include src="\'app/clients/mainInfo/clients.listDrugstores.modals.html\'"></ng-include>\n'),$templateCache.put("app/clients/mainInfo/clients.mainInfo.staff.html",'<div class="ui main container">\n\n    <div class="ui basic data-header data-header-people">\n        <div class="ui column grid">\n            <div class="column">\n                <h3>{{vm.page && vm.page.properties[\'ds_employees_table\'].label || (\'EMPLOYEES\' | translate)}}</h3>\n            </div>\n        </div>\n    </div>\n\n\n    <table class="ui table celled striped sortable listView">\n        <thead>\n        <tr>\n            <th>{{\'NAME\' | translate}}</th>\n            <th class="ascending">{{\'LAST_NAME\' | translate}}</th>\n            <th>{{\'JOB_TITLE\' | translate}}</th>\n            <th>{{\'EMAIL\' | translate}}</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-repeat="person in vm.drugstore.drugstores_staff | filter: vm.isStaff | orderBy:\'last_name\':false">\n            <td>{{person.first_name}}</td>\n            <td>{{person.last_name}}</td>\n            <td>{{person.jobTitleName}}</td>\n            <td><a href="mailto:{{person.email}}">{{person.email}}</a></td>\n        </tr>\n        </tbody>\n    </table>\n\n    <!--div class="ui divider"></div>\n    <div class="ui three column center aligned grid">\n        <div class="column">\n            <div class="ui large button">\n                <i class="icon checkmark"></i>\n                Confirm Frame Contract Signing\n            </div>\n        </div>\n        <div class="column">\n            <div class="ui large button">\n                <i class="icon print"></i>\n                Frame Contract Print\n            </div>\n        </div>\n        <div class="column">\n            <div class="ui primary large button">\n                <i class="icon barcode"></i>\n                View Scanned Frame Contract\n            </div>\n        </div>\n    </div-->\n\n</div>'),$templateCache.put("app/clients/mainInfo/clients.mainInfoEdit.html",'<div id="container" class="ui segment main container">\n\n<form class="ui form" name="drugstoreForm" novalidate ng-submit="drugstoreForm.$valid && vm.showContractAnnexWindow()">\n\n<h1 class="h1" ng-if="vm.editDrugstore">\n  <span class="campaign-header-icons">\n    <span ng-click="vm.showStaffList()">\n      <img src="assets/img/icons/campaigns/pages/user.png">\n      <sup>{{vm.staffForDrugstore.length}}</sup>\n    </span>\n    <span ng-click="vm.showDrugstoresList()">\n      <img ng-src="assets/img/icons/design/{{vm.netWorkIcon}}">\n      <sup>{{vm.netDrugstores.length}}</sup>\n    </span>\n  </span>\n  <span class="campaign-header-text">\n    <span class="portal_registered" ng-if="vm.portalRegistered">\n      <img src="assets/img/icons/design/drugstore_registered.png">\n    </span>\n    <span class="portal_registered" ng-if="vm.existsUnRegister">\n      <img src="assets/img/icons/design/drugstore_registered_black.png">\n    </span>\n    <span>{{vm.drugstore.name}} — {{\'GENERAL_INFORMATION\' | translate}}</span>\n  </span>\n</h1>\n\n<h1 class="h1" ng-if="!vm.editDrugstore">{{\'CREATE_DRUGSTORE\' | translate}} - {{\'GENERAL_INFORMATION\' | translate}}</h1>\n\n<!--<div class="ui yellow icon message" ng-if="vm.changedFields.length">\n    <i class="flag icon"></i>\n\n    <div class="content">\n        <div class="header">\n            {{\'INFO\' | translate}}\n        </div>\n        <p>{{\'YOU_CHANGED\' | translate}} {{vm.changedFields.join(\', \')}}. {{\'APPROPRIATE_WILL_SEND\'}}\n            {{vm.drugstore.email}}.</p>\n\n        <p>{{\'ANNEX_NEEDS_TO_BE_CONFIRMED\' | translate}}</p>\n    </div>\n</div>-->\n\n\n<div class="ui basic segment">\n  <table class="ui most basic table">\n    <tr ng-if="vm.drugstore">\n      <td class="collapsing">{{\'TITLE\' | translate}}:</td>\n      <td>\n        <input type="text" name="name" ng-change="vm.onChangeField(\'name\')" ng-model="vm.drugstore.name">\n      </td>\n      <td class="collapsing">{{\'EMAIL\' | translate}}:</td>\n      <td ng-attr-colspan="{{vm.getEmailColspan()}}">\n        <input type="email" name="email" ng-trim="true" atl-lower-case ng-disabled="vm.parent.offlineMode || vm.isUnRegisterButtonVisible()" ng-attr-readonly="{{vm.isEmailReadonly()}}" ng-change="vm.onChangeEmail(drugstoreForm.email.$valid)" ng-model="vm.drugstore.email">\n      </td>\n      <td ng-if="vm.isButtonVisible()">\n        <button class="ui icon button" ng-if="vm.isRegisterButtonVisible()" ng-disabled="vm.lockRegisterAtPortal || vm.parent.offlineMode" type="button">\n          <i class="add user icon" ng-click="vm.showRegisterAtPortalWindow()"></i>\n        </button>\n        <button class="ui icon button" ng-if="vm.existsUnRegister" ng-disabled="vm.parent.offlineMode" type="button">\n          <i class="ban icon" ng-click="vm.showUnregisterAtPortalWindow()"></i>\n        </button>\n      </td>\n    </tr>\n    <tr>\n      <td class="collapsing">{{\'ADDRESS_LINE\' | translate}} 1:</td>\n      <td>\n        <input type="text" name="name" ng-change="vm.onChangeField(\'address line 1\')" ng-model="vm.drugstore.address.address_line_1">\n      </td>\n      <td class="collapsing">{{\'ADDRESS_LINE\' | translate}} 2:</td>\n      <td colspan="2">\n        <input type="text" name="name" ng-change="vm.onChangeField(\'address line 2\')" ng-model="vm.drugstore.address.address_line_2">\n      </td>\n    </tr>\n    <tr>\n      <td class="collapsing">City:</td>\n      <td>\n        <input type="text" name="city_name" ng-model="vm.drugstore.address.city.name" readonly="readonly">\n        <!--<select ng-model="vm.drugstore.address.city.id"\n                ng-change="vm.onChangeField(\'city\')"\n                ng-options="city.id as city.name for city in vm.cities | orderBy:\'name\'"\n                required class="ui dropdown">\n\n          </select>-->\n      </td>\n      <td class="collapsing">{{\'PHONE\' | translate}}:</td>\n      <td colspan="2">\n        <input type="text" name="name" ng-change="vm.onChangeField(\'phone\')" ng-model="vm.drugstore.address.phone">\n      </td>\n    </tr>\n    <tr>\n      <td class="collapsing">{{\'COUNTRY\' | translate}}:</td>\n      <td>\n        <input type="text" name="name" ng-model="vm.drugstore.address.country.name" ng-change="vm.onChangeField(\'country\')" readonly="readonly">\n        <input type="hidden" name="name" ng-model="vm.drugstore.address.region.id" readonly="readonly">\n      </td>\n      <td class="collapsing">{{\'ZIP\' | translate}}:</td>\n      <td colspan="2">\n        <input type="text" name="name" ng-change="vm.onChangeField(\'ZIP\')" ng-model="vm.drugstore.address.zip">\n      </td>\n    </tr>\n  </table>\n</div>\n\n<ng-include src="\'app/clients/mainInfo/clients.mainInfoEdit.staff.html\'" ng-if="vm.editDrugstore"></ng-include>\n\n<br clear="all">\n<br clear="all">\n\n<div class="ui three column center aligned grid">\n\n  <div class="column">\n    <div class="ui large pale button" ng-click="vm.cancelDrugstoreSave()">\n      <i class="cancel icon"></i>\n      {{\'CANCEL\' | translate}}\n    </div>\n  </div>\n\n  <div class="column">\n    <button type="submit" class="ui navy large button">\n      <i class="save icon"></i>\n      {{\'SAVE\' | translate}}\n    </button>\n  </div>\n\n</div>\n</form>\n\n</div>\n\n<ng-include src="\'app/clients/mainInfo/clients.mainInfoEdit.staff.modals.html\'" ng-if="vm.editDrugstore"></ng-include>\n\n<ng-include src="\'app/clients/mainInfo/clients.mainInfoEdit.modals.html\'" ng-if="vm.editDrugstore"></ng-include>\n\n<ui-modal-dialog title="" visible="showContractAnnexModalWindow">\n  <i class="close icon"></i>\n\n  <div class="header">\n    {{\'SIGN_CONTRACT_ANNEX\' | translate}}\n  </div>\n\n  <div class="ui yellow icon message">\n    <i class="flag icon"></i>\n\n    <div class="content">\n      <div class="header">\n        {{\'INFO\' | translate}}\n      </div>\n      <p>{{\'YOU_CHANGED\'}} {{vm.changedFields.join(\', \')}}. {{\'APPROPRIATE_WILL_SEND\' | translate}}\n        {{vm.drugstore.email}}.</p>\n\n      <p>{{\'ANNEX_NEEDS_TO_BE_CONFIRMED\' | translate}}</p>\n    </div>\n  </div>\n\n  <div class="image content">\n    <div class="ui medium image">\n      <div id="print_preview" style="height: 640px; width: 480px; overflow: auto"></div>\n    </div>\n    <div class="description">\n      <div class="ui header">{{vm.drugstore.signed_contract.name}}</div>\n      <p></p>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="ui positive right labeled icon button" ng-click="vm.onFormSubmit()">\n      {{\'CONFIRM_CHANGES_AND_SIGN_CONTRACT_ANNEX\' | translate}}\n      <i class="checkmark icon"></i>\n    </div>\n    <div class="ui black deny button" ng-click="vm.hideContractAnnexWindow()">\n      {{\'CLOSE\' | translate}}\n    </div>\n  </div>\n</ui-modal-dialog>\n<ng-include src="\'app/clients/mainInfo/clients.staff.modals.html\'"></ng-include>\n<ng-include src="\'app/clients/mainInfo/clients.listDrugstores.modals.html\'"></ng-include>\n'),$templateCache.put("app/clients/mainInfo/clients.mainInfoEdit.modals.html","<atl-modal-confirm-dialog modal-id=\"'confirm_register_drugstore_at_portal_modal'\" modal-title=\"'CONFIRM_DRUGSTORE_REGISTRATION' | translate\" on-confirm=\"vm.registerAtPortal()\">\n\n    <p>{{'CONFIRM_DRUGSTORE_REGISTRATION_1' | translate}} {{vm.drugstore.parent_drugstore?vm.drugstore.parent_drugstore.email:vm.drugstore.email}} {{'CONFIRM_DRUGSTORE_REGISTRATION_2' | translate}}</p>\n\n    <br>\n\n    <!--<p ng-if=\"vm.changedFields.indexOf('email')>-1\">Please save changes you have made to drugstore data.</p>-->\n\n</atl-modal-confirm-dialog>\n\n<atl-modal-confirm-dialog modal-id=\"'confirm_unregister_drugstore_at_portal_modal'\" modal-title=\"'CONFIRM_DRUGSTORE_EMAIL_REMOVAL' | translate\" on-confirm=\"vm.unregisterAtPortal()\">\n\n    <p>Link rejestracyjny został wysłany na adresse e-mail {{vm.drugstore.parent_drugstore?vm.drugstore.parent_drugstore.email:vm.drugstore.email}}</p>\n\n    <br>\n\n    <p>Czy jesteś pewny, że chcesz przerwać proces rejestracyjny Apteki?</p>\n\n</atl-modal-confirm-dialog>\n\n<atl-modal-confirm-dialog modal-id=\"'confirm_email_change_modal_main'\" modal-title=\"'CONFIRM_DRUGSTORE_EMAIL_CHANGE' | translate\" on-confirm=\"vm.saveDrugstore()\">\n\n    <p>Zmiana adresu e-maila w tej aptece spowoduje zmianę adresu e-mail we wszystkich Aptekach z Rodziny Aptek.</p>\n\n    <br>\n\n    <p>Czy jesteś pewny swojej decyzji?</p>\n\n</atl-modal-confirm-dialog>\n\n<atl-modal-confirm-dialog modal-id=\"'confirm_email_change_modal'\" modal-title=\"'CONFIRM_DRUGSTORE_EMAIL_CHANGE' | translate\" on-confirm=\"vm.saveDrugstore()\">\n\n  <p>You can't change entered email address. Change it in drugstore {{vm.drugstore.parent_drugstore.name}} (NIP: {{vm.drugstore.parent_drugstore.NIP}}).</p>\n\n  <br>\n</atl-modal-confirm-dialog>\n\n<atl-modal-attention-form modal-id=\"'email_used_in_unregistered_drugstore_modal'\" modal-title=\"'DRUGSTORE_EMAIL_CHANGE_UNAVAILABLE' | translate\">\n\n    <p>Ten adres e-mail została już przypisany aptece {{vm.existentAccount.drugstore.name}} (NIP: {{vm.existentAccount.drugstore.NIP}}).</p>\n\n    <p>Niestety proces jej rejestracji w Portalu Klienta nie został dokończony. Aby móc dodać kolejną aptekę pod wybrany e-mail, należy najpierw dokończ rozpoczęty proces rejestracji Apteki.</p>\n\n    <p>Jeśli nie chcesz przyłączyć Apteki do Rodziny Aptek użyj innego adresu e-mail.</p>\n\n    <br>\n</atl-modal-attention-form>\n\n<atl-modal-attention-form modal-id=\"'unable_to_unregister_drugstore_at_portal_warning_modal'\" modal-title=\"'REGISTRATION_REMOVAL_UNAVAILABLE' | translate\">\n\n    <p>Nie można anulować rejestracji z powodu wygenerowanych zleceń.</p>\n\n    <p>Skontaktuj się z HelpDesk.</p>\n\n</atl-modal-attention-form>\n\n<atl-modal-confirm-dialog modal-id=\"'confirm_attach_to_group_modal'\" modal-title=\"'ADD_DRUGSTORE_TO_DRUGSTORES_FAMILY' | translate\" on-confirm=\"vm.saveDrugstore()\">\n\n    <p>{{'CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_1' | translate}} {{vm.existentAccount.drugstore.name}} (NIP: {{vm.existentAccount.drugstore.NIP}}).</p>\n\n    <br>\n\n    <p>{{'CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_2' | translate}}</p>\n\n    <br>\n\n    <p>{{'CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_3' | translate}}</p>\n\n</atl-modal-confirm-dialog>\n"),$templateCache.put("app/clients/mainInfo/clients.mainInfoEdit.staff.html",'<div class="ui main container">\n\n    <div class="ui basic segment supercollapsed megacollapsedmargin data-header data-header-people">\n        <div class="ui two column grid">\n            <div class="column">\n                <h3>{{\'EMPLOYEES\' | translate}}</h3>\n            </div>\n            <div class="column right aligned">\n                <h4><label>{{\'ADD\' | translate}}</label> <a class="ui marine large circular label" ng-click="vm.showEditPersonModal()">+</a></h4>\n            </div>\n        </div>\n    </div>\n\n    <table class="ui table celled striped sortable listView">\n        <thead>\n        <tr>\n            <th>{{\'NAME\' | translate}}</th>\n            <th class="ascending">{{\'LAST_NAME\' | translate}}</th>\n            <th>{{\'JOB_TITLE\' | translate}}</th>\n            <th>{{\'EMAIL\' | translate}}</th>\n            <!--<th class="collapsing">{{\'REGISTER\' | translate}}</th>-->\n            <th class="collapsing">{{\'EDIT\' | translate}}</th>\n            <th class="collapsing">{{\'DELETE\' | translate}}</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-repeat="person in vm.drugstore.drugstores_staff | filter: vm.isStaff | orderBy:\'last_name\':false">\n            <td>{{person.first_name}}</td>\n            <td>{{person.last_name}}</td>\n            <td>{{person.jobTitleName}}</td>\n            <td><a href="mailto:{{person.email}}">{{person.email}}</a></td>\n            <td class="collapsing">\n                <div class="ui icon button">\n                    <i class="edit icon" ng-click="vm.showEditPersonModal(person)"></i>\n                </div>\n            </td>\n            <td class="collapsing">\n                <div class="ui icon button">\n                    <i class="remove user icon" ng-click="vm.showRemovePersonModal(person)"></i>\n                </div>\n            </td>\n        </tr>\n        </tbody>\n    </table>\n\n</div>'),$templateCache.put("app/clients/mainInfo/clients.mainInfoEdit.staff.modals.html",'<!-- Modal Windows -->\n<atl-modal-confirm-dialog modal-id="\'removePersonModal\'" modal-title="\'CONFIRM_REMOVAL\' | translate" on-confirm="vm.removePerson()">\n\n  {{\'CONFIRM_REMOVING_USER\' | translate}}\n\n</atl-modal-confirm-dialog>\n\n\n<atl-modal-form-dialog modal-id="\'editPersonModal\'" modal-title="\'EDITING_USER_DATA\' | translate" on-save="vm.savePerson()">\n  <div class="ui segment" style="height: 330px; overflow: auto">\n    <div class="fields">\n      <div class="ui five wide field">\n        <label>{{\'NAME\' | translate}}</label>\n        <input type="text" name="firstName" ng-model="vm.personTemp.first_name" required autocomplete="off">\n      </div>\n      <div class="ui five wide field">\n        <label>{{\'LAST_NAME\' | translate}}</label>\n        <input type="text" name="lastName" ng-model="vm.personTemp.last_name" required autocomplete="off">\n      </div>\n      <div class="ui five wide field">\n        <label>{{\'EMAIL\' | translate}}</label>\n        <input type="text" name="email" ng-model="vm.personTemp.email" required autocomplete="off">\n      </div>\n    </div>\n    <div class="fields">\n      <div class="ui five wide field">\n        <label>{{\'JOB_TITLE\' | translate}}</label>\n        <input type="hidden" ng-model="vm.personTemp.job_title_id" required>\n        <!--<input type="number" name="profession_number" ng-model="vm.personTemp.profession_number">-->\n        <select name="job_title" ng-model="vm.personTemp.job_title_id" required class="ui dropdown">\n          <option value="" ng-selected="!vm.personTemp.job_title_id">\n            {{\'CHOOSE_JOB_TITLE\' | translate}}\n          </option>\n          <option ng-repeat="job_title in vm.staffJobTitles" ng-selected="job_title.id == vm.personTemp.job_title_id" value="{{job_title.id}}">\n            {{job_title.title}}\n          </option>\n        </select>\n      </div>\n      <div class="ui five wide field">\n        <label>{{\'PROFESSION_NUMBER\' | translate}}</label>\n        <input type="number" name="profession_number" required ng-model="vm.personTemp.profession_number">\n      </div>\n    </div>\n\n    <div class="fields">\n      <div class="ui five wide field">\n        <label>{{\'ADDRESS_LINE\' | translate}} 1</label>\n        <input type="text" name="address_line_1" ng-model="vm.personTemp.address.address_line_1" autocomplete="off">\n      </div>\n      <div class="ui five wide field">\n        <label>{{\'ADDRESS_LINE\' | translate}} 2</label>\n        <input type="text" name="address_line_2" ng-model="vm.personTemp.address.address_line_2" autocomplete="off">\n      </div>\n      <div class="ui five wide field">\n        <label>{{\'PHONE\' | translate}}</label>\n        <input type="text" name="phone" ng-model="vm.personTemp.address.phone" autocomplete="off">\n      </div>\n    </div>\n\n    <div class="fields">\n      <div class="ui five wide field">\n        <label>{{\'CITY\' | translate}}</label>\n        <input type="text" name="city_name" ng-model="vm.drugstore.address.city.name" readonly="readonly">\n        <!--\n        <select ng-model="vm.personTemp.address.city_id" required class="ui dropdown">\n          <option ng-repeat="city in vm.cities"\n                  ng-selected="city.id == vm.personTemp.address.city_id"\n                  value="{{city.id}}">\n            {{city.name}}\n          </option>\n        </select>\n        -->\n      </div>\n      <div class="ui five wide field">\n        <label>{{\'ZIP\' | translate}}</label>\n        <input type="text" name="zip" ng-model="vm.personTemp.address.zip" autocomplete="off">\n      </div>\n    </div>\n  </div>\n</atl-modal-form-dialog>'),$templateCache.put("app/clients/mainInfo/clients.staff.modals.html",'<atl-modal-form-dialog modal-id="\'staffForDrugstore\'" show-action="false" modal-title="\'REPS\' | translate">\n  <div class="ui basic megacollapsed segment" style="height: 300px; overflow: auto">\n    <table class="ui table striped sortable listView">\n      <thead>\n      <tr>\n        <!--th></th-->\n        <th>{{\'LAST_NAME\' | translate}}</th>\n        <th>{{\'JOB_TITLE\' | translate}}</th>\n        <th>{{\'EMAIL\' | translate}}</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="staff in vm.staffForDrugstore">\n        <!--th><div ng-if="staff.iSManager" class="ui field"><input type="radio" name="choiceWhomToWrite" ng-model="vm.managerToWrite"></div></th-->\n        <td ng-class="{\'lightblue\':vm.isJobDutiesSignatureVisit(staff)}">{{staff.name}}</td>\n        <td ng-class="{\'lightblue\':vm.isJobDutiesSignatureVisit(staff)}">{{staff.job.shortname}}</td>\n        <td>{{staff.staff_info.email}}</td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</atl-modal-form-dialog>\n'),
$templateCache.put("app/detailing/after-presentation/detailing.after-presentation.html",'<div id="container" class="ui segment main container">\n\n    <h1 class="ui ribbon label breadcrumb">\n        <div class="active section">{{\'DETAILING\' | translate}}</div>\n    </h1>\n\n    <div class="ui basic megacollapsed segment center aligned grid">\n        <div class="ui four wide column left aligned">\n            <div class="ui top attached tertiary segment no-border center aligned" ng-click="vm.replayPdfPresentation()">\n                <p>\n                    <button class="ui big circular icon navy white button">\n                        <i class="icon play"></i>\n                    </button>\n                </p>\n                <p>{{\'REPLAY_PDF\' | translate}}</p>\n            </div>\n            <div class="ui bottom attached navy segment no-border">\n                <p>{{vm.presentation.points}} {{\'POINTS_FOR_PRESENTATION\' | translate}}</p>\n            </div>\n        </div>\n        <div class="ui four wide column center aligned">\n            <div class="ui-knob">\n                <atl-knob knob-data="25" width="150" height="150" display-previous="true" read-only="true" fg-color="#a44575"></atl-knob>\n                <p>pkt</p>\n            </div>\n        </div>\n        <div class="ui eight wide column">\n            <div class="ui center aligned column">\n                <div class="ui horizontal list">\n                    <div class="item item-gift" ng-repeat="gift in vm.detailingGifts.list" ng-show="gift.quantity > 0">\n                        <div class="ui segment button drag-object" ng-class="gift.color">\n                            <div class="content">\n                                <div class="img">\n                                    <img ng-if="gift.image" ng-src="{{gift.image}}" id="photo_{{$index}}" alt="photo">\n                                    <i ng-if="!gift.image" class="gift big icon"></i>\n                                </div>\n                                <div class="header" style="font-size: smaller">{{gift.name}}</div>\n                                <div class="ui two column grid small-text">\n                                    <small class="column center aligned">{{gift.points}}<i ng-if="gift.points">p</i>\n                                    </small>\n                                    <small class="column center aligned">{{gift.quantity}}</small>\n                                </div>\n                            </div>\n                            <div ng-drag="true" ng-drag-data="gift" ng-drag="true" ng-drag-data="gift" ng-drag-start="gift.onDragStart($data, $event)" ng-drag-stop="gift.onDragEnd($data, $event)"></div>\n                            <div class="ui floating circular label clickable" ng-click="vm.showGiftInfo(gift)"><i class="icon info"></i></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- <div class="ui divider"></div> -->\n\n            <div class="ui two column grid" ng-show="vm.isStaffRowSelected()">\n                <div class="column">\n                    <small>0</small>\n                </div>\n                <div class="column right aligned">\n                    <small>{{vm.totalPoints}}</small>\n                </div>\n            </div>\n\n            <div class="ui small progress teal" ng-show="vm.isStaffRowSelected()">\n                <div class="bar" style="width: {{vm.getSelectedStaffProgressPercents()}}%">\n                    <div class="progress">{{vm.getSelectedStaffProgressPercents()}} %</div>\n                </div>\n                <div class="label">{{\'POINTS_FOR_GIFT\' | translate}}</div>\n            </div>\n\n        </div>\n\n    </div>\n\n\n    <div class="ui main container">\n\n        <div class="ui basic data-header data-header-people">\n            <div class="ui column grid">\n                <div class="column">\n                    <h3>{{\'EMPLOYEES\' | translate}}</h3>\n                </div>\n            </div>\n        </div>\n\n        <table class="ui table celled striped sortable">\n            <thead>\n            <tr>\n                <th></th>\n                <th>{{\'SEEN_PRESENTATION\' | translate}}</th>\n                <th>{{\'POINTS\' | translate}}</th>\n                <th>{{\'SPENT_POINTS\' | translate}}</th>\n                <th>{{\'AVAILABLE_POINTS\' | translate}}</th>\n                <th>{{\'GIFTS\' | translate}}</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="staff in vm.staff" ng-class="{active: vm.isStaffRowSelected(staff.id)}">\n                <td ng-click="vm.selectStaff(staff.id)">\n                    <b>\n                        <!-- <i class="icon green desktop"></i> -->\n                        {{staff.first_name}} {{staff.last_name}}\n                    </b>\n                </td>\n                <td>\n                    <div class="ui toggle checkbox" ng-class="{disabled: vm.disableSwitch(staff.id)}">\n                        <input id="seen_the_presentation_{{staff.id}}" type="checkbox" ng-disabled="vm.disableSwitch(staff.id)" ng-change="vm.onSeenPresentationToggle(staff.id)" ng-model="vm.seenThePresentation[staff.id]">\n                        <label for="seen_the_presentation_{{staff.id}}">&nbsp;</label>\n                    </div>\n                </td>\n                <td>\n                    {{vm.points[staff.id] || \'0\'}}\n                </td>\n                <td>\n                    {{vm.getSpentPoints(staff.id) || \'0\'}}\n                </td>\n                <td>\n                    {{(vm.points[staff.id] || 0) - (vm.spentPoints[staff.id] || 0)}}\n                </td>\n                <td ng-drop="true" ng-drop-success="vm.detailingGifts.onDropComplete($data, $event, vm.progress, staff.id)">\n                    <div class="ui small disabled label" ng-class="gift.color" ng-repeat="gift in vm.progress.issued[staff.id]">\n                        <i ng-if="gift.amountIssued == 1" class="icon gift" style="margin: 0"></i>\n                        <i ng-if="gift.amountIssued > 1" class="asterisk link icon" style="margin: 0"></i>\n                        <span ng-if="gift.amountIssued > 1">{{gift.amountIssued}}</span>\n                    </div>\n                    <div class="ui small label" ng-class="gift.color" data-ng-drag="true" ng-drag-data="gift" ng-drag-stop="vm.detailingGifts.onDroppedDragEnd($data, $event, vm.progress, staff.id)" ng-repeat="gift in vm.progress.dropped[staff.id]">\n                        <i ng-if="gift.amountDropped == 1" class="icon gift" style="margin: 0"></i>\n                        <i ng-if="gift.amountDropped > 1" class="asterisk link icon" style="margin: 0"></i>\n                        <span ng-if="gift.amountDropped > 1">{{gift.amountDropped}}</span>\n                    </div>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n\n\n        <div class="ui basic segment center aligned">\n            {{\'TO_GIVE_ON\' | translate}} {{vm.now() | date:\'dd.MM\'}}:\n            &nbsp;\n            <div class="ui small label" ng-class="gift.color" ng-repeat="gift in vm.progress.giftsToGive">\n                <i ng-if="gift.amountDropped == 1" class="icon gift" style="margin: 0"></i>\n                <i ng-if="gift.amountDropped > 1" class="asterisk link icon" style="margin: 0"></i>\n                <span ng-if="gift.amountDropped > 1">{{gift.amountDropped}}</span>\n            </div>\n            &nbsp;\n\n            <div class="ui violette icon button" ng-click="vm.giftsGive()">\n                <i class="icon gift"></i>\n                {{\'GIVE_PRESENTS\' | translate}}\n            </div>\n\n        </div>\n\n        <div class="ui divider"></div>\n\n        <div class="ui center aligned basic segment">\n            <div class="ui three column center aligned grid">\n\n                <div class="column">\n                    <div class="ui large pale button" ng-click="vm.cancelSavingChanges()">\n                        <i class="cancel icon"></i>\n                        {{\'CANCEL\' | translate}}\n                    </div>\n                </div>\n\n                <div class="column">\n                    <button type="submit" class="ui navy large button" ng-click="vm.saveProgress()">\n                        <i class="save icon"></i>\n                        {{\'SAVE\' | translate}}\n                    </button>\n                </div>\n\n                <div class="column">\n                    <div class="ui large navy button" ng-if="!vm.spreadsheetFilename" ng-click="vm.exportDataToExcel()">\n                        <i class="file excel outline icon"></i>\n                        {{\'EXPORT_TO_EXCEL\' | translate}}\n                    </div>\n                    <a class="ui large navy button" ng-if="vm.spreadsheetFilename" ng-href="{{vm.getSpreadsheetPath()}}" download>\n                        <i class="file excel outline icon"></i>\n                        {{\'SAVE_SPREADSHEET\' | translate}}\n                    </a>\n                </div>\n\n            </div>\n        </div>\n\n\n    </div>\n</div>\n\n\n<atl-modal-form-dialog modal-id="\'showGift\'" show-action="false" modal-title="\'GIFT\' | translate">\n    <div class="ui grid" style="height:430px; overflow: auto">\n        <div class="column center aligned">\n            <div class="ui items">\n\n                <div class="item">\n                    <div class="ui one column center aligned grid">\n\n                        <div class="column">\n                            <img ng-src="{{vm.showGift.image}}" style="max-height:200px">\n                        </div>\n\n                        <div class="column">\n\n                            <div class="header">{{vm.showGift.name}}</div>\n\n                            <div class="description">\n                                <p>{{vm.showGift.description}}</p>\n                            </div>\n\n                            <div class="extra">\n                                <div class="ui grid center aligned gift-props">\n                                    <div class="ui four wide column">\n                                        {{\'MARK\' | translate}}: <span class="ui label">{{vm.showGift.mark}}</span>\n                                    </div>\n                                    <div class="ui four wide column">\n                                        {{\'PRICE\' | translate}}: <span class="ui circular label">{{vm.showGift.price}}</span>\n                                        {{vm.showGift.currency}}\n                                    </div>\n                                    <div class="ui four wide column" ng-if="vm.showGift.points">\n                                        {{\'POINTS\' | translate}}: <span class="ui circular label">{{vm.showGift.points}}</span> p\n                                    </div>\n                                    <div class="ui four wide column" ng-if="vm.showGift.points">\n                                        {{\'AMOUNT\' | translate}}: <span class="ui circular label">{{vm.showGift.amount}}</span>\n                                    </div>\n                                </div>\n                            </div>\n\n                        </div>\n\n                    </div>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</atl-modal-form-dialog>'),$templateCache.put("app/detailing/list/detailing.list.html",'<div id="container" class="ui segment main container">\n\n    <div class="basic segment ui three column right aligned grid">\n        <div class="column right aligned">\n            <!-- <label>Campaigns:</label> -->\n            <div class="compact ui tiny buttons campaigns-select-buttons">\n                <div class="ui icon button c_active" ng-repeat="detailing in vm.detailings.list()" ng-click="vm.filterByCampaign(detailing.id)" ng-class="\'btn_\'+detailing.icon">\n                        <i class="c_icon"></i> {{detailing.identifier}}\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="ui main container">\n        <div class="ui segment silver campaign-item" ng-repeat="detailing in vm.detailings.list() | orderBy:\'id\'" ng-click="vm.selectDetailing(detailing.id)">\n\n            <div class="ui grid">\n                <div class="ui sexteen wide column right aligned">\n                    <p>\n                        <!--Okres trwania: -->\n                        <b>{{detailing.date_start | date:\'dd.MM\'}} &mdash; {{detailing.date_end | date:\'dd.MM\'}}</b>\n                        <!-- (pozostalo <b>16 z 40</b> dni)-->\n                    </p>\n                </div>\n            </div>\n\n            <div class="ui two column grid">\n                <div class="column">\n\n                    <div class="ui progress">\n                        <div class="bar" style="width: {{vm.getCycleProgressPercents(detailing.id)}}%"></div>\n                        <div class="title"><a href="">{{\'CURRENT_CYCLE_DETAILING\' | translate}}</a> &mdash; {{vm.getCurrentCyclePoints()}}/{{vm.getCurrentCycleTotalPoints()}}</div>\n                    </div>\n\n                    <div class="ui progress">\n                        <div class="bar" style="width: {{vm.getProgressPercents(detailing.id)}}%"></div>\n                        <div class="title"><a href="">{{\'TOTAL_DETAILING\' | translate}}</a> &mdash; {{detailing.progress.current_points}}/{{detailing.progress.total_points}}</div>\n                    </div>\n\n                    <div class="ui container">\n                        <p>{{detailing.description}}</p>\n                    </div>\n\n                </div>\n\n                <div class="column right aligned">\n\n                    <div class="ui five column center aligned grid">\n\n                        <div class="column"></div>\n                        <div class="column" ng-repeat="step in detailing.steps">\n                            <p>\n                                <a>\n                                    <img ng-src="assets/img/icons/pages/{{$index + 1}}.jpg">\n                                </a>\n                            </p>\n\n                            <p>{{step.date_start | date:\'dd.MM\'}} &ndash; {{step.date_end | date:\'dd.MM\'}}</p>\n\n                        </div>\n                    </div>\n\n                </div>\n            </div>\n\n\t\t\t<div class="ui left top attached icon orange big label" ng-class="detailing.icon">\n\t\t\t\t<i class="c_icon"></i>\n\t\t\t\t{{detailing.identifier}}\n\t\t\t</div>\n\n        </div>\n    </div>\n\n</div>'),$templateCache.put("app/detailing/main/detailing.main.html",'<div id="container" class="ui segment main container">\n\n    <h1 class="ui ribbon label breadcrumb">\n        <div class="active section">{{\'DETAILING\' | translate}}</div>\n    </h1>\n\n    <div class="ui basic segment grid megacollapsed">\n\n\t\t<div class="ui six wide column">\n            <div class="ui grid">\n                <div class="ui fourteen wide column">\n\n\t\t\t\t\t<div class="ui progress teal">\n\t\t\t\t\t  <div class="bar" style="width: {{vm.progress.getProgressPercents()}}%"></div>\n\t\t\t\t\t  <div class="progress-text">\n\n\t\t\t\t\t\t<div class="ui two columns grid">\n\t\t\t\t\t\t  <div class="ui column">\n\t\t\t\t\t\t\t{{\'CURRENT_CYCLE_DETAILING\' | translate}} {{vm.progress.getCurrentCycleProgressPercents()}}%\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t  <div class="ui column right aligned">\n\t\t\t\t\t\t\t{{vm.progress.getCurrentCyclePoints()}} / {{vm.progress.getCurrentCycleTotalPoints()}}\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\n                </div>\n                <div class="ui two wide column"></div>\n            </div>\n\n            <div class="ui grid">\n\n                <div class="ui fourteen wide column">\n\n\t\t\t\t\t<div class="ui progress teal">\n\t\t\t\t\t  <div class="bar" style="width: {{vm.progress.getProgressPercents()}}%"></div>\n\t\t\t\t\t  <div class="progress-text">\n\n\t\t\t\t\t\t<div class="ui two columns grid">\n\t\t\t\t\t\t  <div class="ui column">\n\t\t\t\t\t\t\t{{\'TOTAL_DETAILING\' | translate}} {{vm.progress.getProgressPercents()}}%\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t  <div class="ui column right aligned">\n\t\t\t\t\t\t\t{{vm.progress.current_points}} / {{vm.progress.total_points}}\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\n                </div>\n                <div class="ui two wide column"></div>\n\n            </div>\n        </div>\n\n\n        <div class="ui four wide column center aligned">\n            <div class="ui four wide column center aligned">\n                <div class="ui-knob">\n                    <atl-knob width="150" height="150" knob-data="30" display-previous="true" read-only="true">\n                    </atl-knob>\n                    <p>% / {{\'DAYS\' | translate}}</p>\n                </div>\n            </div>\n        </div>\n\n        <div class="ui six wide column right aligned">\n            \n\t\t\t<div class="ui grid">\n                <div class="ui four wide column"></div>\n                <div class="ui twelve wide column">\n\t\t\t\t\t<div class="ui fluid compact violet large button">{{\'YOUR_NEXT_DETAILING\' | translate}}</div>\n                </div>\n            </div>\n\n            <div class="ui grid">\n                <div class="ui four wide column"></div>\n                <div class="ui twelve wide column">\n                    <div class="ui fluid compact yellow large button"><i class="student icon"></i> {{\'BASE_OF_DETAILING\' | translate}}</div>\n                </div>\n            </div>\n\n        </div>\n\n    </div>\n\n    <div class="basic segment ui center aligned grid">\n\n        <div class="ui eight wide column left aligned">\n            <div class="ui left icon input dynsearch">\n\t\t\t  <input type="text" placeholder="{{\'DYNAMIC_SEARCH\' | translate}}" id="dynsearch" ng-model="vm.searchText">\n\t\t\t  <i class="search icon"></i>\n\t\t    </div>\n\t\t\t<div class="ui icon navy button left-padded" ng-click="vm.changeView()">\n              <i class="sidebar icon"></i>\n            </div>\n        </div>\n\n        <div class="ui eight wide column right aligned">\n            <a ui-sref="detailing.previewFilms({id: vm._id})" class="ui navy button">{{\'PREVIEW_FILMS\' | translate}}</a>\n        </div>\n\n    </div>\n\n    <div class="ui main container">\n        <table class="ui table celled striped sortable listView" ng-hide="vm.listView">\n            <thead>\n            <tr>\n                <th></th>\n                <th>{{\'ID\' | translate}}</th>\n                <th>{{\'NAME\' | translate}}</th>\n                <th>{{\'CITY\' | translate}}</th>\n                <th>{{\'CODE\' | translate}}</th>\n                <th>{{\'STREET\' | translate}}</th>\n                <th colspan="3">\n                    <div ng-repeat="cycle in vm.progress.stats.cycles" class="ui compact button white">{{cycle.month}}/{{cycle.year}}</div>\n                </th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="drugstore in vm.detailing.drugstores | orderBy:\'name\'">\n                <td><i class="big file text outline icon"></i></td>\n                <td>{{drugstore.identifier}}</td>\n                <td>{{drugstore.name}}</td>\n                <td>{{drugstore.address.city.name}}</td>\n                <td>{{drugstore.address.zip}}</td>\n                <td>{{drugstore.address.address_line_1}}</td>\n                <td>\n\t\t\t\t\t<div ng-repeat="cycle in vm.progress.stats.cycles" class="ui compact button navy" ng-class="vm.progress.getCycleColor(drugstore, cycle)">\n\t\t\t\t\t\t{{cycle.month}}/{{cycle.year}}<br>{{vm.progress.getCycleProgress(drugstore, cycle)}}\n\t\t\t\t\t</div>\n                </td>\n\t\t\t\t<td class="no-left-border">\n\t\t\t\t\t<div class="ui inline field">\n\t\t\t\t\t\t<select ng-model="vm.presentationIds[drugstore.id]" class="ui dropdown">\n\t\t\t\t\t\t\t<option ng-repeat="presentation in vm.detailing.presentations" value="{{presentation.id}}">{{presentation.name}}</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui inline field">\n\t\t\t\t\t\t<div class="compact ui icon button" ng-click="vm.showPresentation(vm.presentationIds[drugstore.id], drugstore.id)">\n\t\t\t\t\t\t\t <i class="icon file pdf outline"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t\t<td class="no-left-border">\n\t\t\t\t\t<div class="four wide column right aligned">\n\t\t\t\t\t  <i class="caret right icon"></i>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div class="ui segment listView" ng-show="vm.listView">\n            <div class="ui segment" ng-repeat="drugstore in vm.detailing.drugstores | orderBy:\'name\'">\n                <h4>\n                    <i class="big file text outline icon"></i>\n                    <a href="#">\n                        {{drugstore.name}}\n                    </a>\n                    <b>{{\'ID\' | translate}}</b>: {{drugstore.id}}</h4>\n\n                <p>\n                    <b>{{\'ADDRESS\' | translate}}</b>:\n                    {{drugstore.address.address_line_1}};\n                    <b>{{\'CODE\' | translate}}</b>: {{drugstore.address.zip}};\n                    <b>{{\'CITY\' | translate}}</b>:\n                    {{drugstore.address.city.name}}.</p>\n\n                <div class="ui basic megacollapsed segment">\n                    <div ng-repeat="cycle in vm.progress.stats.cycles" class="ui compact button navy" ng-class="vm.progress.getCycleColor(drugstore, cycle)">\n\t\t\t\t\t\t{{cycle.month}}/{{cycle.year}}<br>{{vm.progress.getCycleProgress(drugstore, cycle)}}\n\t\t\t\t\t</div>\n                </div>\n\n            </div>\n\n        </div>\n\n    </div>\n</div>'),$templateCache.put("app/detailing/presentation/detailing.presentation.html",'<ng-pdf template-url="app/layout/presentation.pdf-viewer.html" scale="page-fit"></ng-pdf>\n'),$templateCache.put("app/detailing/preview-films/detailing.preview-films.html",'<div id="container" class="ui segment main container">\n\n    <h1 class="ui ribbon label breadcrumb">\n        <div class="active section">{{\'DETAILING_PREVIEW_FILMS\' | translate}}</div>\n    </h1>\n\n    <div class="ui main container" ng-repeat="detailing in vm.detailings">\n\n        <div class="ui segment blue inverted">\n            <div class="ui three column grid">\n                <div class="column">\n                    <h3>{{\'CAMPAIGN\' | translate}}: {{detailing.name}}</h3>\n                </div>\n                <div class="column center aligned">\n                    {{detailing.date_start}} &mdash; {{detailing.date_end}}\n                </div>\n                <div class="column right aligned">\n                    {{\'TOTAL_POINTS\' | translate}}: {{detailing.progress.total_points}}\n                </div>\n            </div>\n        </div>\n\n        <table class="ui basic table">\n            <thead>\n            <tr>\n                <th>{{\'TITLE\' | translate}}</th>\n                <th>{{\'START_DATE\' | translate}}</th>\n                <th>{{\'END_DATE\' | translate}}</th>\n                <th>{{\'POINTS\' | translate}}</th>\n                <th>{{\'ACTION\' | translate}}</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="presentation in detailing.presentations">\n                <td>{{presentation.name}}</td>\n                <td>{{detailing.date_start}}</td>\n                <td>{{detailing.date_end}}</td>\n                <td>{{presentation.points}}</td>\n                <td>\n                    <div class="ui two column grid">\n                        <div class="column">\n                            <div class="ui mini circular icon button" ng-click="vm.playPdf(presentation.id)">\n                                <i class="icon play"></i>\n                            </div>\n                            <small>{{\'PLAY_PDF\' | translate}}</small>\n                        </div>\n                        <div class="column">\n                            <!--<div class="ui mini circular icon button">-->\n                            <!--<i class="icon play"></i>-->\n                            <!--</div>-->\n                            <!--<small>Play PPT</small>-->\n                        </div>\n                    </div>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n\n    </div>\n</div>\n'),$templateCache.put("app/gazetki/generator/gazetki.generator.html",'<div id="container" class="ui segment main container">\n    <div class="ui grid">\n        <div class="ui four wide column">\n            <!-- Choose Background -->\n\n            <div class="ui basic segment tertiary side-collapsed bottom-collapsed">\n\n                <div class="ui basic segment center aligned overflown-75">\n\n                    <div class="img" ng-repeat="bgImg in vm.gazetka.pages[vm.currentPage].backgrounds">\n                        <img class="clickable" ng-if="bgImg.name" ng-src="{{vm.gazetkaBackgroundsPath + bgImg.name}}" style="width: 120px" ng-click="vm.changeBackground(bgImg.id)">\n                    </div>\n\n\t\t\t\t\t<!--<div style="width: 120px; height: 180px; background: #fff; cursur: pointer; margin: 10px auto;" ng-click="vm.removeBackground()"></div>-->\n\n                    <div class="ui basic segment collapsed center aligned">\n\n                        <div class="ui toggle checkbox">\n                            <input type="checkbox" ng-model="vm.gazetka.price" name="example" id="checkbox-7658">\n                            <label for="checkbox-7658"><small>{{\'INCLUDE_PICE\' | translate}}</small></label>\n                        </div>\n\n                    </div>\n                </div>\n\n                <div class="ui yellow button fluid" ng-click="vm.preview()">\n                    <i class="icon unhide"></i>\n                    {{\'PREVIEW\' | translate}}\n                </div>\n\n            </div>\n\n            <!-- / Choose Background -->\n        </div>\n\n        <div class="ui six wide column">\n            <!-- Builder Preview -->\n\n            <div class="ui segment gazetka-background" ng-if="vm.backgroundUrl" style="background-image: url(\'{{vm.backgroundUrl}}\'); background-repeat: no-repeat; background-size: 100% 100%">\n\n                <form class="ui form ajaxForm" id="1095991920" enctype="multipart/form-data">\n\n                    <div class="ui grid">\n                        <div class="ui ten wide column">\n\n                            <div>\n                                <select name="haslo" id="haslo" ng-model="vm.gazetka.haslo" class="ui dropdown required" required>\n                                    <option ng-repeat="haslo in vm.haslo" value="{{haslo.id}}" ng-selected="vm.gazetka.haslo == haslo.id">\n                                        {{haslo.text}}\n                                    </option>\n                                </select>\n                            </div>\n                            <div class="ui-date-input">\n                                <input type="date" ng-model="vm.gazetka.date" name="shipping[date]" placeholder="date">\n                            </div>\n                        </div>\n\n                        <div class="ui six wide column center aligned">\n                            <img width="100" id="logo-preview" ng-if="vm.logo[vm.gazetka.logo].name" ng-src="{{vm.logoPath + vm.logo[vm.gazetka.logo].name}}" alt="logo">\n\n                            <div class="extra content">\n                                <div class="ui top left attached label image-slide" ng-click="vm.prevLogo(vm.logo[vm.gazetka.logo].id)">\n                                    <i class="caret left icon"></i></div>\n                                <div class="ui top right attached label image-slide" ng-click="vm.nextLogo(vm.logo[vm.gazetka.logo].id)">\n                                    <i class="caret right icon"></i></div>\n                            </div>\n                        </div>\n\n                    </div>\n\n\n                    <div class="ui basic segment gazetki-graphical-sample">\n                        <ng-include src="vm.templates[vm.gazetka.pages[vm.currentPage].graphicalSample - 1]"></ng-include>\n                    </div>\n\n                </form>\n\n            </div>\n\n            <div class="ui grid">\n                <div class="ui four wide column left aligned">\n                    <i class="icon large caret left clickable" ng-click="vm.prevPage()"></i>\n                </div>\n                <div class="ui eight wide column center aligned">\n                    {{\'PAGE\' | translate}} {{vm.currentPage+1}} of {{vm.gazetka.pages.length}}\n                </div>\n                <div class="ui four wide column right aligned">\n                    <i class="icon large caret right clickable" ng-click="vm.nextPage()"></i>\n                </div>\n            </div>\n\n            <!-- / Builder Preview -->\n        </div>\n        <div class="ui six wide column">\n            <!-- Address, List and Button -->\n\n\n            <div class="ui basic segment tertiary side-collapsed bottom-collapsed">\n\n                <div class="ui basic segment overflown-75">\n\n                    <div class="ui inline form">\n                        <label>{{\'PRINTING\' | translate}}</label>\n                        <input type="range" min="{{vm.gazetka.printing.min}}" max="{{vm.gazetka.printing.max}}" step="100" ng-model="vm.gazetka.printing.current" class="ui-range">\n                        <span class="three wide field right aligned" ng-bind="vm.gazetka.printing.current"></span>\n                    </div>\n\n                    <h5>{{\'SELECT_ADDRESSER\' | translate}}</h5>\n\n                    <div class="ui basic segment">\n                        <div class="ui inline form">\n                            <select name="haslo" id="addresser" ng-model="vm.gazetka.addresser" ng-change="vm.changeAddresser()" class="ui dropdown required">\n                                <option value="1">{{\'MAIN_OFFICE\' | translate}}</option>\n                                <option value="2">{{\'DRUGSTORE\' | translate}}</option>\n                                <option value="3">{{\'REPRESENTANT\' | translate}}</option>\n                            </select>\n                        </div>\n                    </div>\n\n                    <h5 ng-show="vm.gazetka.addresser !== \'3\'">{{\'SEND_TO_DRUGSTORE\' | translate}}</h5>\n\n                    <table class="ui striped table" ng-show="vm.gazetka.addresser !== \'3\'">\n                        <tr ng-repeat="drugstore in vm.gazetka.drugstoresList | orderBy:\'name\'">\n                            <td>\n                                <div class="ui toggle checkbox">\n                                    <input type="checkbox" ng-click="vm.selectDrugstore(drugstore.id)" ng-checked="vm.gazetka.drugstores.indexOf(drugstore.id) !== -1" name="example" id="drugstore-{{drugstore.id}}">\n                                    <label for="drugstore-{{drugstore.id}}">\n                                        {{drugstore.name}}\n                                        {{drugstore.identifier}}\n                                    </label>\n                                </div>\n                            </td>\n                        </tr>\n                    </table>\n\n                    <div ng-show="vm.gazetka.addresser">\n                        <div class="ui fluid mini input">\n                            <label><b>{{\'DELIVERY_ADDRESS\' | translate}}</b></label>\n                            <textarea style="resize: none" ng-model="vm.gazetka.address" cols="30" rows="2" readonly="readonly"></textarea>\n                        </div>\n                        <br clear="all">\n                    </div>\n\n                </div>\n\n\n                <div class="three ui buttons simple">\n\n                    <div class="ui yellow button" ng-click="vm.cancelGazetkaSave()">\n                        <i class="icon cancel"></i>\n                        {{\'CANCEL\' | translate}}\n                    </div>\n\n                    <div class="ui navy button" ng-click="vm.store()">\n                        <i class="icon save"></i>\n                        {{\'SAVE\' | translate}}\n                    </div>\n\n                    <div class="ui violette button modal-call" ng-click="vm.send()">\n                        <i class="icon send"></i>\n                        {{\'SEND\' | translate}}\n                    </div>\n\n                </div>\n\n\n            </div>\n\n            <!-- / Address, List and Button -->\n        </div>\n    </div>\n</div>\n\n\n<!-- Preview Gazetka -->\n<atl-modal-form-dialog modal-id="\'previewModalForm\'" modal-title="\'\'">\n\n    <div class="ui compact icon large button side-attached-nav left-attached-nav" ng-click="vm.prevPreviewPage()"><i class="icon caret left"></i></div>\n    <div class="ui compact icon large button side-attached-nav right-attached-nav" ng-click="vm.nextPreviewPage()"><i class="icon caret right"></i></div>\n\n    <div class="ui grid">\n        <div class="ui column">\n            <div class="ui basic segment gazetki-graphical-sample gazetki-graphical-preview">\n                <div class="ui gazetka-background center aligned" style="background: url(\'{{vm.prewiewBackgroundUrl}}\') no-repeat;background-size: 100% 100%">\n\n                    <div class="ui">\n                        <div class="ui two column grid center aligned">\n                            <div class="column slogan-and-date">\n                                <h3>{{vm.haslo[vm.gazetka.haslo].text}}</h3>\n\n                                <p>{{vm.gazetka.date | date:\'longDate\'}}</p>\n                            </div>\n                            <div class="column">\n                                <img width="80 " id="logo-preview" ng-if="vm.logo[vm.gazetka.logo].name" ng-src="{{vm.logoPath + vm.logo[vm.gazetka.logo].name}}" alt="logo">\n                            </div>\n                        </div>\n                    </div>\n\n                    <ng-include src="vm.previewTemplates[vm.gazetka.pages[vm.currentPreviewPage].graphicalSample - 1]"></ng-include>\n\n                    <div class="ui basic segment small-segment">&nbsp;</div>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</atl-modal-form-dialog>'),
$templateCache.put("app/gazetki/list/gazetki.filter.html",'<div id="container" class="ui segment main container">\n  <h1 class="ui ribbon label breadcrumb"><div class="active section">{{\'GAZETKI_LIST\' | translate}}</div></h1>\n\n  <div class="basic segment ui center aligned grid">\n\n    <div class="ui six wide column left aligned">\n      <div class="ui left icon input">\n        <input type="text" placeholder="{{\'DYNAMIC_SEARCH\' | translate}}" id="dynsearch" ng-model="vm.searchText">\n        <i class="search icon"></i>\n      </div>\n      <!--<div class="ui icon navy button left-padded" ng-click="vm.changeView()">-->\n        <!--<i class="sidebar icon"></i>-->\n      <!--</div>-->\n    </div>\n\n\n    <div class="ui eight wide column right aligned">\n      <!-- <label>Campaigns:</label> -->\n      <div class="ui right floated basiс megacollapsed segment no-border" ng-if="vm.campaigns.length">\n        <atl-list-slider display-number="5" start-index="{{vm.indexCampaign}}" list-id="listCampaignButtons" class-list="compact ui tiny buttons campaigns-select-buttons">\n          <div ng-repeat="campaign in vm.campaigns" class="ui icon button c_active {{vm.activeColor[campaign.id]}} list-slider-item" ng-click="vm.filterByCampaign(campaign.id)" ng-class="\'btn_\'+campaign.icon">\n            <i class="c_icon"></i> {{campaign.identifier}}\n          </div>\n        </atl-list-slider>\n      </div>\n    </div>\n\n  </div>\n\n\n\n  <div class="ui main container" atl-infinite-scroll="vm.loadMore()" container-to-scroll="general-shell">\n    <table class="ui table celled striped sortable listView">\n      <thead>\n      <tr>\n        <th class="one wide"></th>\n        <th class="one wide" ng-click="vm.changeSorting(\'identifier\')" ng-class="vm.sortingClass(\'identifier\')">{{\'ID\' | translate}}</th>\n        <th class="three wide" ng-click="vm.changeSorting(\'staff\')" ng-class="vm.sortingClass(\'staff\')" ng-if="vm.isManager">{{\'REP\' | translate}}</th>\n        <th class="three wide" ng-click="vm.changeSorting(\'name\')" ng-class="vm.sortingClass(\'name\')">{{\'NAME\' | translate}}</th>\n        <th class="two wide" ng-click="vm.changeSorting([\'drugstores_network.name\', \'drugstores_network.id\', \'-negotiation_point\'])" ng-class="vm.sortingClass([\'drugstores_network.name\', \'drugstores_network.id\', \'-negotiation_point\'])">{{\'DRUGSTORES_NETWORK\' | translate}}</th>\n        <th class="two wide" ng-click="vm.changeSorting(\'address.city.name\')" ng-class="vm.sortingClass(\'address.city.name\')">{{\'ADDRESS\' | translate}}</th>\n        <th></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="drugstore in (filteredItems = (vm.drugstores | searchDrugstore: vm.searchText: vm.searchArrFields))\n          | orderBy:vm.sort.column:vm.sort.descending\n          | filter: vm.searchText\n          | selectedStepColor:vm.selectedStep:vm.selectedColor\n          | limitTo: vm.pagingLimit\n          track by drugstore.id" ng-class="{\'negative\': drugstore.isBlocked}" ng-click="vm.selectDrugstore(drugstore.id)">\n        <td>\n          <img src="assets/img/icons/design/drugstore_network_global_negotiation_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type == \'central\' && drugstore.negotiation_point && drugstore.selling_point">\n          <img src="assets/img/icons/design/drugstore_network_global_negotiation_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type == \'central\' && drugstore.negotiation_point && !drugstore.selling_point">\n          <img src="assets/img/icons/design/drugstore_network_global_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type == \'central\' && !drugstore.negotiation_point && drugstore.selling_point">\n          <img src="assets/img/icons/design/drugstore_network_local_negotiation_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type != \'central\' && drugstore.negotiation_point && drugstore.selling_point">\n          <img src="assets/img/icons/design/drugstore_network_local_negotiation_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type != \'central\' && drugstore.negotiation_point && !drugstore.selling_point">\n          <img src="assets/img/icons/design/drugstore_network_local_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type != \'central\' && !drugstore.negotiation_point && drugstore.selling_point">\n          <img src="assets/img/icons/design/drugstore_individual.png" align="baseline" ng-if="!drugstore.drugstores_network_id">\n        </td>\n        <td>{{::drugstore.identifier}}</td>\n        <td ng-if="vm.isManager">\n          <div ng-repeat="staff in vm.listDrugstores[drugstore.id].staff">\n            <span style="display:none">{{drugstore.staff = vm.listDrugstores[drugstore.id].staff}}</span>\n            <span ng-if="staff.staff_id != vm.userData.id">{{staff.name}}</span>\n          </div>\n        </td>\n        <td>\n          {{::drugstore.name}}\n        </td>\n        <td>{{::drugstore.drugstores_network.name}}</td>\n        <td>{{::drugstore.addressLine1}}<br>{{::drugstore.zip}} {{::drugstore.cityName}}</td>\n        <td ng-click="$event.stopPropagation();">\n          <!--<div class="ui segment" ng-hide="vm.campaignId == -1">-->\n          <nobr>\n            <div class="clickable" ng-class="{\'ui disabled gazetki-disabled-btn-total button\' : !vm.campaign.gazetka_definition_id}" ng-click="vm.selectGazetki(drugstore.campaignId, drugstore.id)">\n              <img src="assets/img/icons/pages/gazetki.jpg">\n            </div>\n          </nobr>\n          <!--</div>-->\n        </td>\n      </tr>\n      </tbody>\n    </table>\n\n  </div>\n</div>'),$templateCache.put("app/gazetki/list/gazetki.list.html",'<div id="container" class="ui segment main container">\n    <h1 class="ui ribbon label breadcrumb"><div class="active section">{{\'GAZETKI_LIST\' | translate}}</div></h1>\n\n    <div class="basic segment ui center aligned grid">\n\n        <div class="ui six wide column left aligned">\n            <div class="ui left icon input dynsearch">\n                <input type="text" placeholder="{{\'DYNAMIC_SEARCH\' | translate}}" id="dynsearch" ng-model="vm.searchText" ng-model-options="{debounce: 500}">\n                <i class="search icon"></i>\n            </div>\n\n            <!--<div class="ui icon navy button left-padded" ng-click="vm.changeView()">-->\n                <!--<i class="sidebar icon"></i>-->\n            <!--</div>-->\n        </div>\n\n        <div class="ui eight wide column right aligned">\n            <div class="ui right floated basiс megacollapsed segment no-border" ng-if="vm.campaigns.length">\n                <atl-list-slider display-number="5" list-id="listCampaignButtons" class-list="compact ui tiny buttons campaigns-select-buttons">\n                    <div class="ui icon button c_active list-slider-item" id="campaignRight_{{$index}}" ng-repeat="campaign in vm.campaigns track by campaign.id" ng-click="vm.filterByCampaign(campaign.id)" ng-class="\'btn_\'+campaign.icon">\n                        <i class="c_icon"></i> {{::campaign.identifier}}\n                    </div>\n                </atl-list-slider>\n            </div>\n        </div>\n    </div>\n\n    <div class="ui main container" atl-infinite-scroll="vm.loadMore()" container-to-scroll="general-shell">\n        <table class="ui table celled striped sortable listView">\n            <thead>\n            <tr>\n                <th class="one wide"></th>\n                <th class="one wide" ng-click="vm.changeSorting(\'identifier\')" ng-class="vm.sortingClass(\'identifier\')">{{\'ID\' | translate}}</th>\n                <th class="three wide" ng-click="vm.changeSorting(\'staff\')" ng-class="vm.sortingClass(\'staff\')" ng-if="vm.isManager">{{\'REP\' | translate}}</th>\n                <th class="three wide" ng-click="vm.changeSorting(\'name\')" ng-class="vm.sortingClass(\'name\')">{{\'NAME\' | translate}}</th>\n                <th class="two wide" ng-click="vm.changeSorting([\'drugstores_network.name\', \'drugstores_network.id\', \'-negotiation_point\'])" ng-class="vm.sortingClass([\'drugstores_network.name\', \'drugstores_network.id\', \'-negotiation_point\'])">{{\'DRUGSTORES_NETWORK\' | translate}}</th>\n                <th class="two wide" ng-click="vm.changeSorting(\'address.city.name\')" ng-class="vm.sortingClass(\'address.city.name\')">{{\'ADDRESS\' | translate}}</th>\n                <!--<th></th>-->\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="drugstore in (filteredItems = (vm.drugstores | searchDrugstore: vm.searchText: vm.searchArrFields))\n          | orderBy:vm.sort.column:vm.sort.descending\n          | sortingCampaigns:vm.sortingCampaign\n          | limitTo: vm.pagingLimit\n          track by drugstore.id" ng-click="vm.selectDrugstore(drugstore.id)">\n                <td>\n                    <img src="assets/img/icons/design/drugstore_network_global_negotiation_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type == \'central\' && drugstore.negotiation_point && drugstore.selling_point">\n                    <img src="assets/img/icons/design/drugstore_network_global_negotiation_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type == \'central\' && drugstore.negotiation_point && !drugstore.selling_point">\n                    <img src="assets/img/icons/design/drugstore_network_global_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type == \'central\' && !drugstore.negotiation_point && drugstore.selling_point">\n                    <img src="assets/img/icons/design/drugstore_network_local_negotiation_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type != \'central\' && drugstore.negotiation_point && drugstore.selling_point">\n                    <img src="assets/img/icons/design/drugstore_network_local_negotiation_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type != \'central\' && drugstore.negotiation_point && !drugstore.selling_point">\n                    <img src="assets/img/icons/design/drugstore_network_local_selling_point.png" align="baseline" ng-if="drugstore.drugstores_network_id && drugstore.drugstores_network.type != \'central\' && !drugstore.negotiation_point && drugstore.selling_point">\n                    <img src="assets/img/icons/design/drugstore_individual.png" align="baseline" ng-if="!drugstore.drugstores_network_id">\n                </td>\n                <td>{{::drugstore.identifier}}</td>\n                <td ng-if="vm.isManager">\n                    <div ng-repeat="staff in vm.listDrugstores[drugstore.id].staff">\n                        <span ng-if="staff.staff_id != vm.userData.id">{{::staff.name}}</span>\n                    </div>\n                </td>\n                <td>\n                    {{::drugstore.name}}\n                </td>\n                <td>{{::drugstore.drugstores_network.name}}</td>\n                <td>{{::drugstore.address.address_line_1}}<br>{{::drugstore.address.city.name}}</td>\n                <!--<td ng-click="$event.stopPropagation();">-->\n                    <!--<div class="ui segment" ng-hide="vm.selectedCampaign == -1">-->\n                        <!--<div class="clickable"-->\n                             <!--ng-click="vm.selectGazetki(drugstore.campaignId, drugstore.id)">-->\n                            <!--<img src="assets/img/icons/pages/gazetki.jpg">-->\n                        <!--</div>-->\n                    <!--</div>-->\n                <!--</td>-->\n            </tr>\n            </tbody>\n        </table>\n\n    </div>\n</div>'),$templateCache.put("app/gazetki/templates/tlo1_3moduly.html",'<!--<div class="ui link cards gazetka-background center aligned container"-->\n<!--style="background-image: url(\'{{(vm.gazetka.backgrounds[vm.currentPage] !== undefined ? (vm.imagesPath + \'background/\' + vm.gazetka.pages[vm.currentPage].backgrounds[vm.gazetka.backgrounds[vm.currentPage]].name) : \'\')}}\')">-->\n<!--top-->\n\n<div class="ui grid gazetki-layout-sample-3">\n\t <div class="ui grid">\n\t\t<div class="ui sixteen wide column bottom-collapsed">\n\t\t\t<div class="ui segment short-segment">\n\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[0].price}}\n\t\t\t</div>\n\t\t\t\t<div class="ui two column grid">\n\t\t\t\t\t<div class="ui bottom aligned column">\n\t\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].header}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].subheader}}</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].description}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui column">\n\t\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].image.name}}" alt="no image">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[0].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[0].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="ui grid">\n\t\t<div class="ui eight wide column">\n\t\t\t<div class="ui segment">\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[1].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[1].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[1].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ui eight wide column">\n\t\t\t<div class="ui segment">\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[2].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[2].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[2].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'),$templateCache.put("app/gazetki/templates/tlo1_4moduly.html",'<!--<div class="ui link cards gazetka-background center aligned container"-->\n<!--style="background-image: url(\'{{(vm.gazetka.backgrounds[vm.currentPage] !== undefined ? (vm.imagesPath + \'background/\' + vm.gazetka.pages[vm.currentPage].backgrounds[vm.gazetka.backgrounds[vm.currentPage]].name) : \'\')}}\')">-->\n<!--top-->\n\n<div class="ui grid gazetki-layout-sample-4">\n    <div class="ui grid">\n\t\t<div class="ui eight wide column bottom-collapsed">\n\t\t\t<div class="ui segment">\n\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[0].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[0].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[0].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class="ui eight wide column bottom-collapsed">\n\t\t\t<div class="ui segment">\n\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[1].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[1].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[1].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="ui eight wide column">\n\t\t\t<div class="ui segment">\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[2].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[2].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[2].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ui eight wide column">\n\t\t\t<div class="ui segment">\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[3].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[3].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[3].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n</div>\n'),$templateCache.put("app/gazetki/templates/tlo1_5moduly.html",'<!--<div class="ui link cards gazetka-background center aligned container"-->\n<!--style="background-image: url(\'{{(vm.gazetka.backgrounds[vm.currentPage] !== undefined ? (vm.imagesPath + \'background/\' + vm.gazetka.pages[vm.currentPage].backgrounds[vm.gazetka.backgrounds[vm.currentPage]].name) : \'\')}}\')">-->\n<!--top-->\n\n<!--<div class="ui three column divided grid gazetka-background"-->\n<!--style="background-image: url(\'{{(vm.gazetka.backgrounds[vm.currentPage] !== undefined ? (vm.imagesPath + \'background/\' + vm.gazetka.pages[vm.currentPage].backgrounds[vm.gazetka.backgrounds[vm.currentPage]].name) : \'\')}}\')">-->\n<!--<div class="stretched row">-->\n<!--<div class="column">-->\n<!--<div class="ui segment">-->\n<!--<div class="image">-->\n<!--<img ng-if="vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].image.name"-->\n<!--ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].image.name}}"-->\n<!--alt="no image"/>-->\n<!--</div>-->\n<!--<div class="content">-->\n<!--<div class="header">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].header}}-->\n<!--</div>-->\n<!--<div class="meta gazetka-price" ng-show="vm.gazetka.price">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[0].price}}-->\n<!--</div>-->\n<!--<div class="meta subheader">-->\n<!--<a>{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].subheader}}</a>-->\n<!--</div>-->\n<!--<div class="description">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].description}}-->\n<!--</div>-->\n<!--</div>-->\n<!--<div class="extra content">-->\n<!--<div class="ui bottom left attached label"-->\n<!--ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[0].id)">-->\n<!--<i class="caret left icon"></i></div>-->\n<!--<div class="ui bottom right attached label"-->\n<!--ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[0].id)">-->\n<!--<i class="caret right icon"></i></div>-->\n<!--</div>-->\n<!--</div>-->\n\n<!--<div class="ui segment">-->\n<!--<div class="image">-->\n<!--<img ng-if="vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].image.name"-->\n<!--ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].image.name}}"-->\n<!--alt="no image"/>-->\n<!--</div>-->\n<!--<div class="content">-->\n<!--<div class="header">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].header}}-->\n<!--</div>-->\n<!--<div class="meta gazetka-price" ng-show="vm.gazetka.price">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[3].price}}-->\n<!--</div>-->\n<!--<div class="meta subheader">-->\n<!--<a>{{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].subheader}}</a>-->\n<!--</div>-->\n<!--<div class="description">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].description}}-->\n<!--</div>-->\n<!--</div>-->\n<!--<div class="extra content">-->\n<!--<div class="ui bottom left attached label"-->\n<!--ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[3].id)">-->\n<!--<i class="caret left icon"></i></div>-->\n<!--<div class="ui bottom right attached label"-->\n<!--ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[3].id)">-->\n<!--<i class="caret right icon"></i></div>-->\n<!--</div>-->\n<!--</div>-->\n<!--</div>-->\n<!--<div class="column">-->\n<!--<div class="ui segment">-->\n<!--<div class="image">-->\n<!--<img ng-if="vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].image.name"-->\n<!--ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].image.name}}"-->\n<!--alt="no image"/>-->\n<!--</div>-->\n<!--<div class="content">-->\n<!--<div class="header">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].header}}-->\n<!--</div>-->\n<!--<div class="meta gazetka-price" ng-show="vm.gazetka.price">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[2].price}}-->\n<!--</div>-->\n<!--<div class="meta subheader">-->\n<!--<a>{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].subheader}}</a>-->\n<!--</div>-->\n<!--<div class="description">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].description}}-->\n<!--</div>-->\n<!--</div>-->\n<!--<div class="extra content">-->\n<!--<div class="ui bottom left attached label"-->\n<!--ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[2].id)">-->\n<!--<i class="caret left icon"></i></div>-->\n<!--<div class="ui bottom right attached label"-->\n<!--ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[2].id)">-->\n<!--<i class="caret right icon"></i></div>-->\n<!--</div>-->\n<!--</div>-->\n<!--<div class="ui segment">-->\n<!--<div class="image">-->\n<!--<img ng-if="vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].image.name"-->\n<!--ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].image.name}}"-->\n<!--alt="no image"/>-->\n<!--</div>-->\n<!--<div class="content">-->\n<!--<div class="header">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].header}}-->\n<!--</div>-->\n<!--<div class="meta gazetka-price" ng-show="vm.gazetka.price">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[4].price}}-->\n<!--</div>-->\n<!--<div class="meta subheader">-->\n<!--<a>{{vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].subheader}}</a>-->\n<!--</div>-->\n<!--<div class="description">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].description}}-->\n<!--</div>-->\n<!--</div>-->\n<!--<div class="extra content">-->\n<!--<div class="ui bottom left attached label"-->\n<!--ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[4].id)">-->\n<!--<i class="caret left icon"></i></div>-->\n<!--<div class="ui bottom right attached label"-->\n<!--ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[4].id)">-->\n<!--<i class="caret right icon"></i></div>-->\n<!--</div>-->\n<!--</div>-->\n<!--</div>-->\n<!--<div class="column">-->\n<!--<div class="ui segment">-->\n<!--<div class="image">-->\n<!--<img ng-if="vm.gazetka.pages[vm.currentPage].units[5].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[5].id]].image.name"-->\n<!--ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[5].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[5].id]].image.name}}"-->\n<!--alt="no image"/>-->\n<!--</div>-->\n<!--<div class="content">-->\n<!--<div class="header">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[5].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[5].id]].header}}-->\n<!--</div>-->\n<!--<div class="meta gazetka-price" ng-show="vm.gazetka.price">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[5].price}}-->\n<!--</div>-->\n<!--<div class="meta subheader">-->\n<!--<a>{{vm.gazetka.pages[vm.currentPage].units[5].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[5].id]].subheader}}</a>-->\n<!--</div>-->\n<!--<div class="description">-->\n<!--{{vm.gazetka.pages[vm.currentPage].units[5].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[5].id]].description}}-->\n<!--</div>-->\n<!--</div>-->\n<!--<div class="extra content">-->\n<!--<div class="ui bottom left attached label"-->\n<!--ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[5].id)">-->\n<!--<i class="caret left icon"></i></div>-->\n<!--<div class="ui bottom right attached label"-->\n<!--ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[5].id)">-->\n<!--<i class="caret right icon"></i></div>-->\n<!--</div>-->\n<!--</div>-->\n<!--</div>-->\n<!--</div>-->\n<!--</div>-->\n\n<div class="ui three column grid gazetki-layout-sample-5">\n\n    <div class="column">\n\n        <div class="ui segment">\n            <div class="image">\n                <img ng-if="vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].image.name}}" alt="no image">\n            </div>\n            <div class="content">\n                <div class="header">\n                    {{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].header}}\n                </div>\n                <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                    {{vm.gazetka.pages[vm.currentPage].units[0].price}}\n                </div>\n                <div class="meta subheader">\n                    <a>{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].subheader}}</a>\n                </div>\n                <div class="description">\n                    {{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].description}}\n                </div>\n            </div>\n            <div class="extra content">\n                <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[0].id)">\n                    <i class="caret left icon"></i></div>\n                <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[0].id)">\n                    <i class="caret right icon"></i></div>\n            </div>\n        </div>\n\n        <div class="ui segment">\n            <div class="image">\n                <img ng-if="vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].image.name}}" alt="no image">\n            </div>\n            <div class="content">\n                <div class="header">\n                    {{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].header}}\n                </div>\n                <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                    {{vm.gazetka.pages[vm.currentPage].units[2].price}}\n                </div>\n                <div class="meta subheader">\n                    <a>{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].subheader}}</a>\n                </div>\n                <div class="description">\n                    {{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].description}}\n                </div>\n            </div>\n            <div class="extra content">\n                <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[2].id)">\n                    <i class="caret left icon"></i></div>\n                <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[2].id)">\n                    <i class="caret right icon"></i></div>\n            </div>\n        </div>\n\n\n    </div>\n    <div class="ui column">\n\n        <div class="ui segment">\n            <div class="image">\n                <img ng-if="vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].image.name}}" alt="no image">\n            </div>\n            <div class="content">\n                <div class="header">\n                    {{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].header}}\n                </div>\n                <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                    {{vm.gazetka.pages[vm.currentPage].units[1].price}}\n                </div>\n                <div class="meta subheader">\n                    <a>{{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].subheader}}</a>\n                </div>\n                <div class="description">\n                    {{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].description}}\n                </div>\n            </div>\n            <div class="extra content">\n                <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[1].id)">\n                    <i class="caret left icon"></i></div>\n                <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[1].id)">\n                    <i class="caret right icon"></i></div>\n            </div>\n        </div>\n\n        <div class="ui segment">\n            <div class="image">\n                <img ng-if="vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].image.name}}" alt="no image">\n            </div>\n            <div class="content">\n                <div class="header">\n                    {{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].header}}\n                </div>\n                <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                    {{vm.gazetka.pages[vm.currentPage].units[3].price}}\n                </div>\n                <div class="meta subheader">\n                    <a>{{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].subheader}}</a>\n                </div>\n                <div class="description">\n                    {{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].description}}\n                </div>\n            </div>\n            <div class="extra content">\n                <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[3].id)">\n                    <i class="caret left icon"></i></div>\n                <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[3].id)">\n                    <i class="caret right icon"></i></div>\n            </div>\n        </div>\n\n    </div>\n    <div class="column">\n\n        <div class="ui segment toll-segment">\n            <div class="image">\n                <img ng-if="vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].image.name}}" alt="no image">\n            </div>\n            <div class="content">\n                <div class="header">\n                    {{vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].header}}\n                </div>\n                <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                    {{vm.gazetka.pages[vm.currentPage].units[4].price}}\n                </div>\n                <div class="meta subheader">\n                    <a>{{vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].subheader}}</a>\n                </div>\n                <div class="description">\n                    {{vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].description}}\n                </div>\n            </div>\n            <div class="extra content">\n                <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[4].id)">\n                    <i class="caret left icon"></i></div>\n                <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[4].id)">\n                    <i class="caret right icon"></i></div>\n            </div>\n        </div>\n\n    </div>\n\n</div>'),
$templateCache.put("app/gazetki/templates/tlo1_6moduly.html",'<!--<div class="ui link cards gazetka-background center aligned container"-->\n<!--style="background-image: url(\'{{(vm.gazetka.backgrounds[vm.currentPage] !== undefined ? (vm.imagesPath + \'background/\' + vm.gazetka.pages[vm.currentPage].backgrounds[vm.gazetka.backgrounds[vm.currentPage]].name) : \'\')}}\')">-->\n<!--top-->\n\n<div class="ui grid gazetki-layout-sample-6">\n    <div class="ui grid">\n\n        <div class="ui eight wide column bottom-collapsed">\n            <div class="ui segment">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPage].units[0].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPage].units[0].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[0].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[0].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[0].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n        </div>\n        <div class="ui eight wide column bottom-collapsed">\n            <div class="ui segment">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPage].units[1].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPage].units[1].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[1].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[1].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[1].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n        </div>\n        <div class="ui eight wide column bottom-collapsed">\n            <div class="ui segment">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPage].units[2].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPage].units[2].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[2].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[2].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[2].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n        </div>\n        <div class="ui eight wide column bottom-collapsed">\n            <div class="ui segment">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPage].units[3].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPage].units[3].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[3].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[3].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[3].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n        </div>\n        <div class="ui eight wide column">\n            <div class="ui segment">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPage].units[4].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPage].units[4].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[4].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[4].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[4].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n        </div>\n        <div class="ui eight wide column">\n            <div class="ui segment">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPage].units[5].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[5].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPage].units[5].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[5].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPage].units[5].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[5].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPage].units[5].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPage].units[5].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[5].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPage].units[5].layouts[vm.currentLayouts[vm.currentPage][vm.gazetka.pages[vm.currentPage].units[5].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPage].units[5].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPage].units[5].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n        </div>\n\n\n    </div>\n</div>\n'),$templateCache.put("app/messaging/messages/messages.view.html",'<div id="container" class="ui segment main container">\n    <div class="ui main container" ng-class="{\'page-messages\':vm.category==\'internal\',\'page-help\':vm.category==\'support\'}">\n\n        <div class="ui two column grid">\n            <div class="column"></div>\n            <div class="column right aligned">\n                <div class="ui top attached right compact tabular menu message-menu">\n                    <a class="item" ng-class="{active:vm.tab==\'inbox\'}" ng-click="vm.switchTab(\'inbox\')">\n                        {{\'INBOX\' | translate}}\n                    </a>\n                    <a class="item" ng-class="{active:vm.tab==\'outbox\'}" ng-click="vm.switchTab(\'outbox\')">\n                        {{\'SENT\' | translate}}\n                    </a>\n                    <a class="item" ng-class="{active:vm.tab==\'trash\'}" ng-click="vm.switchTab(\'trash\')">\n                        {{\'TRASH\' | translate}}\n                    </a>\n                </div>\n            </div>\n        </div>\n\n        <div class="ui bottom attached segment collapsed navy message-navigator">\n            <div class="ui three column grid center aligned">\n                <!--<div class="ui column grid center aligned"-->\n                <!--ng-class="{three:vm.category==\'internal\',four:vm.category==\'support\'}">-->\n                <div class="column left aligned">\n                    <div class="ui grey tiny button" ng-click="vm.toggleSelection()">\n                        <i class="checkmark box icon"></i>\n                        {{\'ALL\' | translate}}\n                    </div>\n                    <div class="ui grey tiny button" ng-hide="vm.tab==\'trash\'" ng-click="vm.deleteMessages()">\n                        <i class="trash outline icon"></i>\n                        {{\'DELETE\' | translate}}\n                    </div>\n                    <div class="ui grey tiny button" ng-click="vm.toggleSortingOrder()">\n                        {{\'DATE\' | translate}}&nbsp;\n                        <i class="caret icon" style="margin-right: 0" ng-class="{down:vm.sortingOrder==\'-created_at\',up:vm.sortingOrder==\'created_at\'}"></i>\n                    </div>\n                </div>\n                <div class="column left aligned">\n                    <div class="ui left icon small input">\n                        <input type="text" placeholder="{{\'DYNAMIC_SEARCH\' | translate}}" ng-model="vm.messagesFilter" id="msgfilter">\n                        <i class="search icon"></i>\n                    </div>\n                </div>\n                <div class="column right aligned message-buttons">\n                    <div class="ui yellow small left icon button" ng-hide="vm.showComposeMessageSegment" ng-click="vm.composeEmail()">\n                        <i class="pencil icon"></i>\n                        {{\'NEW_MESSAGE\' | translate}}\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="ui basic segment tertiary supercollapsed" ng-show="vm.showMessagesListSegment" id="messages-list-segment">\n            <div class="ui divided grid">\n                <div class="ui five wide column" id="message-list">\n                    <div class="ui relaxed divided list">\n                        <div ng-repeat="msg in vm.messages | filter: vm.matchesFilter | orderBy:vm.sortingOrder" class="item msgBlock msgBlock-{{msg.sender.first_name}}{{msg.sender.last_name}} msgBlock-{{msg.sender.job_title}}">\n                            <div class="right floated content">\n                                <button class="circular ui icon button" ng-class="{grey: !msg.selected, teal: msg.selected}" ng-click="msg.selected = !msg.selected">\n                                    <i class="icon" ng-class="{minus: !msg.selected, checkmark: msg.selected}"></i>\n                                </button>\n                            </div>\n                            <i class="large inverted middle aligned icon" ng-class="{mail:!msg.is_read}" ng-style="{color:vm.category==\'internal\'?\'#118ba3\':\'#e37826\'}"></i>\n                            <div class="content" ng-click="vm.selectMessage(msg.id)">\n                                <a class="header">{{msg.subject}}</a>\n                                <div class="description" ng-if="vm.tab!=\'outbox\'">{{\'FROM\' | translate}}: {{msg.sender.first_name}}\n                                    {{msg.sender.last_name}}\n                                </div>\n\t\t\t\t\t\t\t\t<div class="description" ng-if="vm.tab==\'outbox\'">{{\'TO\' | translate}}: {{vm.tos[msg.to]}}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="ui eleven wide column">\n                    <div class="ui fluid card" style="border-radius: 0" ng-if="vm.selected">\n                        <div class="content">\n                            <div class="header quotMsgTitle">{{vm.selected.subject}}</div>\n                            <div class="meta quotMsgMeta" ng-if="vm.tab!=\'outbox\'">{{\'FROM\' | translate}}:\n                                {{vm.selected.sender.first_name}}\n                                {{vm.selected.sender.last_name}}\n                                {{vm.selected.updated_at | date:\'dd.MM.yy HH:mm\'}}\n                            </div>\n\t\t\t\t\t\t\t<div class="meta quotMsgMeta" ng-if="vm.tab==\'outbox\'">{{\'TO\' | translate}}:\n                                {{vm.tos[vm.selected.to]}}\n                                {{vm.selected.updated_at | date:\'dd.MM.yy HH:mm\'}}\n                            </div>\n                            <div class="description">\n                                <compile-html data-content="vm.selected.message" id="selected-message">\n                                </compile-html>\n                            </div>\n                        </div>\n                        <div class="extra content">\n                            <div class="ui label" ng-repeat="attachment in vm.selected.attachedFiles">\n                                <i class="attach icon"></i>\n                                <!-- <a href="{{attachment.path}}"\n                                   download> -->\n\t\t\t\t\t\t\t\t<span class="clickable" ng-click="vm.showAttachmentModal(attachment.path)">\n                                    {{attachment.filename}}\n                                </span>\n                            </div>\n                        </div>\n                        <div class="extra content" ng-if="vm.tab==\'inbox\' && vm.selected.sender_category == \'representant\'">\n                            <button class="ui labeled icon grey basic button" ng-click="vm.fastReply()">\n                                <i class="reply icon"></i>\n                                {{\'FAST_REPLY\' | translate}}\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="ui basic segment tertiary supercollapsed" ng-show="vm.showComposeMessageSegment" id="compose-message-segment">\n            <form class="ui form" id="smart-form-edit-document-template" class="smart-form" name="composeMessageForm" ng-submit="composeMessageForm.$valid && vm.onFormSubmit()">\n                <div class="ui divider" ng-if="!vm.isReply"></div>\n                <div class="ui labeled icon input" ng-if="!vm.isReply">\n                    <span class="ui label">{{\'TO\' | translate}}:</span>\n                    <select name="addressee" multiple="multiple" class="ui fluid search multiple dropdown" ng-options="addressee.id as addressee.name for addressee in vm.addressees" ng-model="vm.composeMessage.to"></select>\n                </div>\n                <div class="ui divider"></div>\n                <div class="ui labeled icon input">\n                    <div class="ui label">\n                        {{\'SUBJECT\' | translate}}:\n                    </div>\n                    <input type="text" ng-model="vm.composeMessage.subject">\n                    <!-- <i class="warning circular icon"></i> -->\n                </div>\n                <div class="ui divider"></div>\n                <div class="field">\n                    <div class="ui input">\n                        <textarea placeholder="{{\'MESSAGE\' | translate}}" ng-model="vm.composeMessage.text"></textarea>\n                    </div>\n                </div>\n                <div class="ui divider"></div>\n                <div class="field">\n                    <div class="ui input">\n                        <input type="file" name="attachment" id="attachment" onchange="angular.element(this).scope().loadFile(this)" multiple="multiple">\n                    </div>\n                </div>\n                <div class="ui divider"></div>\n                <button type="button" ng-click="vm.closeComposeEmailForm()" class="ui icon pale button">\n                    <i class="icon cancel"></i>\n                    {{\'CANCEL\' | translate}}\n                </button>\n                <button type="submit" class="ui icon navy button">\n                    <i class="icon send"></i>\n                    {{\'SEND\' | translate}}\n                </button>\n                <div class="ui divider"></div>\n            </form>\n        </div>\n    </div>\n</div>\n\n<ng-include src="\'app/messaging/modals/confirm-proposal-acceptance.modal-window.html\'"></ng-include>\n<ng-include src="\'app/messaging/modals/confirm-proposal-rejection.modal-window.html\'"></ng-include>\n<ng-include src="\'app/messaging/modals/confirm-final-report-acceptance.modal-window.html\'"></ng-include>\n<ng-include src="\'app/messaging/modals/confirm-final-report-rejection.modal-window.html\'"></ng-include>\n\n\n\n<atl-modal-attention-form modal-id="\'showAttachmentModal\'" modal-title="\'ATTACHMENT\' | translate">\n    <div class="ui basic segment center aligned">\n\n\t\t<p><img ng-src="{{vm.attachmentPath}}" style="height: 300px"></p>\n\n\t\t<p><a href="{{vm.attachmentPath}}" download>{{\'DOWNLOAD\' | translate}}</a></p>\n\n\t</div>\n</atl-modal-attention-form>'),$templateCache.put("app/messaging/modals/confirm-final-report-acceptance.modal-window.html",'<atl-modal-form-dialog modal-id="\'confirmFinalReportAcceptance\'" show-action="true" show-delete="false" on-save="vm.acceptFinalReport()" modal-title="\'CONFIRM_REPORT_ACCEPTANCE\' | translate">\n    <div class="ui basic megacollapsed segment" style="height: 300px; overflow: auto">\n        <p>{{\'GOING_TO_ACCEPT_REPORT\' | translate}}</p>\n        <p>{{\'ARE_YOU_SURE\' | translate}}</p>\n    </div>\n</atl-modal-form-dialog>\n'),$templateCache.put("app/messaging/modals/confirm-final-report-rejection.modal-window.html",'<atl-modal-form-dialog modal-id="\'confirmFinalReportRejection\'" show-action="true" show-delete="false" on-save="vm.rejectFinalReport()" modal-title="\'CONFIRM_REPORT_REJECTION\' | translate">\n    <div class="ui basic megacollapsed segment" style="height: 300px; overflow: auto">\n        <p>{{\'GOING_TO_REJECT_REPORT\' | translate}}</p>\n        <p>{{\'ARE_YOU_SURE\' | translate}}</p>\n        <div class="field">\n            <label>{{\'REJECT_REASON\' | translate}}:</label>\n            <textarea ng-model="vm.rejectionReason"></textarea>\n        </div>\n    </div>\n</atl-modal-form-dialog>\n'),$templateCache.put("app/messaging/modals/confirm-proposal-acceptance.modal-window.html",'<atl-modal-form-dialog modal-id="\'confirmProposalAcceptance\'" show-action="true" show-delete="false" on-save="vm.acceptProposal()" modal-title="\'CONFIRM_PROPOSAL_ACCEPTANCE\' | translate">\n    <div class="ui basic megacollapsed segment" style="height: 300px; overflow: auto">\n        <p>{{\'GOING_TO_ACCEPT_PROPOSAL\' | translate}}</p>\n        <p>{{\'ARE_YOU_SURE\' | translate}}</p>\n    </div>\n</atl-modal-form-dialog>\n'),$templateCache.put("app/messaging/modals/confirm-proposal-rejection.modal-window.html",'<atl-modal-form-dialog modal-id="\'confirmProposalRejection\'" show-action="true" show-delete="false" on-save="vm.rejectProposal()" modal-title="\'CONFIRM_PROPOSAL_REJECTION\' | translate">\n    <div class="ui basic megacollapsed segment" style="height: 300px; overflow: auto">\n        <p>{{\'GOING_TO_REJECT_PROPOSAL\' | translate}}</p>\n        <p>{{\'ARE_YOU_SURE\' | translate}}</p>\n        <div class="field">\n            <label>{{\'REJECT_REASON\' | translate}}:</label>\n            <textarea ng-model="vm.rejectionReason"></textarea>\n        </div>\n    </div>\n</atl-modal-form-dialog>\n'),$templateCache.put("app/profile/calendar/profile.calendar.html",'<div id="container" class="ui segment main container">\n\n    <div id="profile-calendar" class="ui main container">\n\n      <div class="ui grid">\n\n        <div class="ui sixteen wide column center aligned">\n          <div ui-calendar="vm.uiConfig.calendar || {height: 650}" ng-model="vm.eventSources" calendar="profileCalendar"></div>\n        </div>\n\n        <!-- <div class="ui two wide column left aligned">\n        </div> -->\n\n      </div>\n\n      <div class="ui divider"></div>\n\n    </div>\n</div>\n\n<ng-include src="\'app/profile/calendar/profile.calendar.modal.html\'"></ng-include>\n\n<!-- Modal Windows -->\n<atl-modal-confirm-dialog modal-id="\'removeEventModal\'" modal-title="\'CONFIRM_REMOVAL\' | translate" on-confirm="vm.removeEvent()">\n  {{\'CONFIRM_REMOVE_EVENT\' | translate}}\n</atl-modal-confirm-dialog>\n<atl-modal-confirm-dialog modal-id="\'saveChangedEventModal\'" modal-title="\'CONFIRM_SAVING_DATA\' | translate" on-confirm="vm.saveEvent()">\n  {{\'CONFIRM_SAVE_EVENT\' | translate}}\n</atl-modal-confirm-dialog>'),$templateCache.put("app/profile/calendar/profile.calendar.modal.html",'<atl-modal-form-dialog modal-id="\'showNote\'" modal-title="\'ADD_EVENT\' | translate" on-save="vm.saveEvent()" show-delete="\'true\'" on-delete="vm.showRemoveEventModal()">\n  <div class="ui grid">\n\n    <div class="five wide column">\n      <div class="field">\n        <label>{{\'START_DATE\' | translate}}</label>\n        <input type="date" name="startDateEvent" ng-model="vm.note.date_start">\n      </div>\n    </div>\n\n    <div class="three wide column">\n      <div class="field">\n        <label>{{\'START_TIME\' | translate}}</label>\n        <input type="time" name="startDateTimeEvent" ng-model="vm.note.time_start">\n      </div>\n    </div>\n\n\n    <div class="five wide column">\n      <div class="field">\n        <label>{{\'END_DATE\' | translate}}</label>\n        <input type="date" name="endDateEvent" ng-model="vm.note.date_end">\n      </div>\n    </div>\n\n    <div class="three wide column">\n      <div class="field">\n        <label>{{\'END_TIME\' | translate}}</label>\n        <input type="time" name="endDateTimeEvent" ng-model="vm.note.time_end">\n      </div>\n    </div>\n\n  </div>\n\n  <div class="ui grid">\n\n    <div class="ui three wide column left aligned">\n      <div class="ui checkbox">\n        <input type="checkbox" name="allDayEvent" id="all_day_checkbox" ng-model="vm.note.allDay">\n        <label for="all_day_checkbox"><nobr>{{\'ALL_DAY\' | translate}}</nobr></label>\n      </div>\n    </div>\n\n    <div class="ui two wide column right aligned">\n      <div class="ui checkbox">\n        <input type="checkbox" name="repeatEvent" id="repeat_checkbox" ng-model="vm.note.repeat">\n        <label for="repeat_checkbox">{{\'REPEAT\' | translate}}</label>\n      </div>\n    </div>\n\n    <div class="ui eleven wide column left aligned" ng-if="vm.note.repeat">\n      <div class="ui checkbox" ng-repeat="day in vm.week_days" ng-if="vm.note.repeat">\n        <input type="checkbox" id="{{day.name}}" ng-model="day.selected">\n        <label for="{{day.name}}">{{day.name}}</label>\n      </div>\n    </div>\n\n  </div>\n\n  <div class="ui grid">\n\n    <div class="ui sixteen wide column">\n      <div class="field">\n        <label>{{\'TITLE\' | translate}}</label>\n        <input type="text" name="titleEvent" ng-model="vm.note.title">\n      </div>\n\n      <div class="field">\n        <label>{{\'DESCRIPTION\' | translate}}</label>\n        <textarea name="descEvent" ng-model="vm.note.description"></textarea>\n      </div>\n    </div>\n  </div>\n</atl-modal-form-dialog>'),$templateCache.put("app/profile/coaching/profile.coaching.html",'<div id="container" class="ui segment main container" ng-if="!vm.waiting">\n\n  <div class="ui warning message" ng-if="vm.noCoaching">\n    <div class="header">\n      {{\'NO_COACHING\' | translate}}\n    </div>\n  </div>\n\n  <div ng-if="!vm.isManager && !vm.noCoaching">\n    <div class="ui main container">\n\n      <div class="ui grid">\n        <div class="ui ten wide column">\n          <div class="ui basic segment" ng-if="vm.currentSession">\n            <div class="ui burak fluid button">\n              <i class="university icon"></i>\n              {{\'YOUR_GOALS\' | translate}}: <b>{{vm.currentSession.staff_params.operational_goal}}</b>\n            </div>\n          </div>\n        </div>\n        <div class="ui six wide column">\n          <div class="ui basic segment">\n            <atl-dropdown class="ui fluid selection dropdown">\n              <input type="hidden" name="user">\n              <i class="dropdown icon"></i>\n              <div class="default text" ng-if="vm.currentSession">{{vm.currentSession.name}} {{vm.currentSession.date | date:\'dd.MM.yyyy\'}}</div>\n              <div class="menu">\n                <div class="item" ng-click="vm.changeRepSession(session.unique_id)" ng-repeat="session in vm.readySessions" data-value="{{session.name}} {{session.date | date:\'dd.MM.yyyy\'}}">\n                  <div>{{session.name}} {{session.date | date:\'dd.MM.yyyy\'}}</div>\n                </div>\n              </div>\n            </atl-dropdown>\n          </div>\n        </div>\n      </div>\n\n      <div class="ui basic megacollapsedmargin supercollapsed segment">\n        <atl-tabs>\n          <a class="item" ng-class="{\'active\': vm.activeTab == \'chart\'}" data-tab="chart" ng-click="vm.goTab(\'chart\')">{{\'CHART\' | translate}}</a>\n          <a class="item" ng-class="{\'active\': vm.activeTab == \'staff\'}" data-tab="table" ng-click="vm.goTab(\'staff\')">{{\'TABLE\' | translate}}</a>\n        </atl-tabs>\n        <div class="ui bottom attached tab segment tab-area" ng-class="{\'active\': vm.activeTab == \'chart\'}" data-tab="chart">\n          <h2>{{\'CHART\' | translate}}</h2>\n          <div class="ui basic megacollapsed segment">\n            <div class="ui grid">\n\n              <div class="twelve wide column">\n                <div class="ui bottom attached segment">\n                  <nvd3 options="chartOptions" data="chartData"></nvd3>\n                </div>\n              </div>\n\n              <div class="four wide right aligned column">\n                <div class="ui basic left aligned megacollapsed segment">\n                  <div class="ui grid">\n                    <div class="ten wide column">\n                      <h4>{{vm.currentSession.name}}</h4>\n                    </div>\n                    <div class="six wide right aligned column" ng-if="vm.currentSession.avgRating">\n                      <a class="ui orange circular label">{{vm.currentSession.avgRating}}</a>\n                    </div>\n                  </div>\n\n\n                  <div class="ui basic left aligned megacollapsed segment coaching-menu-column">\n                    <div class="ui button-menu list">\n                      \n                      <h4>{{\'SESSIONS\' | translate}}</h4>\n\n                      <!-- <div class="item"><a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.session.all}" ng-click="vm.repStatsFilter(\'sessions\', [])">Wszystko</a></div> -->\n                      \n                      <div class="item" ng-repeat="repSession in vm.readySessions">\n                        <a class="ui fluid compact button" ng-class="{\'orange\':vm.repStats.sessions.indexOf(repSession.unique_id)>-1}" ng-click="vm.repStatsFilter(\'sessions\', repSession.unique_id, repSession.name)">\n                          <span ng-if="repSession.name">{{repSession.name}}</span>\n                          <span ng-if="!repSession.name">{{\'SESSION\' | translate}} {{$index+1}}</span>\n                        </a>\n                      </div>\n\n                      <div ng-if="vm.repStats.sessions.length>0">\n                          \n                          <h4>Schemat kroków</h4>\n                          <div class="item" ng-repeat="step in vm.steps"><a class="ui fluid compact button" ng-class="{\'orange\':vm.repStats.steps.indexOf($index) > -1}" ng-click="vm.repStatsFilter(\'steps\', $index, step.label)">{{\'STEP\' | translate}} {{$index+1}}</a></div>\n\n                          <br>\n                          <a class="ui fluid compact button" ng-click="vm.changeRepSession(vm.currentSession.unique_id)">\n                            {{\'SESSIONS\' | translate}}\n                          </a>\n\n                      </div>\n\n                    </div>\n                  </div>\n\n\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="ui bottom attached tab segment tab-area" ng-class="{\'active\': vm.activeTab == \'staff\'}" data-tab="table">\n          <h2>{{\'TABLE\' | translate}}</h2>\n          <div class="ui basic megacollapsed segment">\n            <table class="ui table celled striped sortable">\n              <thead>\n              <tr>\n                <th class="four wide">{{\'SESSION\' | translate}}</th>\n                <th ng-repeat="stepLabel in vm.rep.chartData[vm.currentSession.unique_id].labels">\n                  <span ng-if="stepLabel">{{stepLabel}}</span>\n                </th>\n              </tr>\n              </thead>\n              <tbody>\n              <tr ng-repeat="session in vm.readySessions" ng-click="vm.selectSession(session.id, session.staff_params.staff_id)">\n                <td>\n                  {{session.name}}\n                </td>\n                <td ng-repeat="stepRating in vm.rep.chartData[session.unique_id].data track by $index">\n                  <span>{{stepRating}}</span>\n                </td>\n              </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n\n\n  <div ng-if="vm.isManager && !vm.noCoaching">\n\n    <!-- table / chart presentaion -->\n    <div class="ui basic segment">\n      <atl-tabs>\n        <a class="item" ng-class="{\'active\': vm.activeTab == \'chart\'}" data-tab="chart" ng-click="vm.goTab(\'chart\')">{{\'CHART\' | translate}}</a>\n        <a class="item" ng-class="{\'active\': vm.activeTab == \'staff\'}" data-tab="table" ng-click="vm.goTab(\'staff\')">{{\'TABLE\' | translate}}</a>\n      </atl-tabs>\n      <div class="ui bottom attached tab segment tab-area" ng-class="{\'active\': vm.activeTab == \'chart\'}" data-tab="chart">\n        <h2>{{\'CHART\' | translate}}</h2>\n        <div class="ui basic megacollapsed segment">\n          <div class="ui grid">\n\n            <div class="twelve wide column">\n              <div class="ui bottom attached segment">\n                <nvd3 options="chartOptions" data="chartData"></nvd3>\n              </div>\n            </div>\n\n            <div class="four wide right aligned column">\n              <div class="ui basic left aligned megacollapsed segment coaching-menu-column">\n                <div class="ui button-menu list">\n                  <h4>{{\'SESSION\' | translate}}</h4>\n                  <div class="item"><a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.session.ctd}" ng-click="vm.activeSessionFilter(\'ctd\')">CTD</a></div>\n                  <div class="item"><a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.session.ytd}" ng-click="vm.activeSessionFilter(\'ytd\')">YTD</a></div>\n                  <div class="item"><a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.session.m12}" ng-click="vm.activeSessionFilter(\'m12\')">12M</a></div>\n                  <div class="item"><a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.session.m6}" ng-click="vm.activeSessionFilter(\'m6\')">6M</a></div>\n                  <div class="item"><a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.session.all}" ng-click="vm.activeSessionFilter(\'all\')">Wszystko</a></div>\n                  \n                  <div class="item" ng-repeat="rksSession in vm.sessions">\n                    <a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.session.ids.indexOf(rksSession.id)>-1}" ng-click="vm.activeSessionFilter(\'ids\', rksSession.id)">\n                      <span ng-if="rksSession.name">{{rksSession.name}}</span>\n                      <span ng-if="!rksSession.name">{{\'SESSION\' | translate}} {{$index+1}}</span>\n                    </a>\n                  </div>\n\n                  <h4>Schemat kroków</h4>\n                  <div class="item"><a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.step.all}" ng-click="vm.activeStepFilter(\'all\')">Wszystkie kroki</a></div>\n                  <div class="item" ng-repeat="step in vm.steps"><a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.step.ids.indexOf($index) > -1}" ng-click="vm.activeStepFilter(\'ids\', $index)">{{step.label}}</a></div>\n                  <!--\n                  <div class="item"><a class="ui fluid compact button">Przygotowanie do wizyty</a></div>\n                  <div class="item"><a class="ui fluid compact button">Krok 1</a></div>\n                  <div class="item"><a class="ui fluid compact button">Krok 2</a></div>\n                  <div class="item"><a class="ui fluid compact button">Krok 3</a></div>\n                  -->\n                  <h4>Personel</h4>\n                  <!--<div class="item"><a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.staff.all}" ng-click="vm.activeStaffFilter(\'all\')">Wszystko</a></div>-->\n                  <div class="item" ng-repeat="rep in vm.reps | orderBy: rep.id">\n                    <a class="ui fluid compact button" ng-class="{\'orange\':vm.activeFilter.staff.ids.indexOf(rep.id) > -1}" ng-click="vm.activeStaffFilter(\'ids\', rep.id)">{{rep.name}}</a>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n      </div>\n      <div class="ui bottom attached tab segment for-export tab-area" ng-class="{\'active\': vm.activeTab == \'staff\'}" data-tab="table">\n        <h2>{{\'TABLE\' | translate}}</h2>\n        <table class="ui table celled striped sortable">\n          <thead>\n          <tr>\n            <th class="six wide">{{\'REPRESENTATIVES\' | translate}}</th>\n            <th>{{\'SESSIONS\' | translate}}</th>\n          </tr>\n          </thead>\n          <tbody>\n          <tr ng-repeat="rep in vm.reps" ng-if="rep.id != -1">\n            <td>\n              <div class="ui grid">\n                <div class="thirteen wide column">\n                  {{rep.name}}\n                </div>\n                <div class="two wide right aligned column" ng-if="rep.sessions.length">\n                  <a class="compact ui tiny icon green button" ng-click="vm.cloneSession(rep.id)">\n                    <i class="plus icon"></i>\n                  </a>\n                </div>\n              </div>\n            </td>\n            <td>\n              <a class="compact ui tiny usual button" ng-class="{\'marine\':session.status == 3}" ng-repeat="session in rep.sessions" ng-click="vm.selectSession(session.id, rep.id)">\n                <span ng-if="session.status == 3 && session.updated_at">{{session.updated_at | date:\'dd.MM.yyyy\'}}</span>\n                <span ng-if="session.status != 3 && session.name">{{session.name}}</span>\n                <span ng-if="session.status != 3 && !session.name">{{\'SESSION\' | translate}} {{$index+1}}</span>\n              </a>\n            </td>\n          </tr>\n          </tbody>\n        </table>\n      </div>\n\n    </div>\n\n  </div>\n\n\n</div>\n'),
$templateCache.put("app/profile/main/profile.main.html",'<div id="container" class="ui segment main container">\n\n    <!-- <div class="ui main container"> -->\n    <div id="dashboard" class="ui basic segment main container">\n\n        <!-- <div class="ui four column grid"> -->\n        <div class="ui padded grid">\n\n            <div class="ui twelve wide teal column profile-info">\n                <div class="ui center aligned basic segment">\n\n                    <table class="ui most basic table special-padded">\n                        <tr>\n                            <td class="collapsing">{{\'NAME\' | translate}}:</td>\n                            <td><b>{{vm.principal.identifier}}</b></td>\n                        </tr>\n                        <tr>\n                            <td>{{\'JOB_TITLE\' | translate}}:</td>\n                            <td><b>{{vm.principal.job_title}}</b></td>\n                        </tr>\n                        <tr>\n                            <td>{{\'EMAIL\' | translate}}:</td>\n                            <td><a href="mailto:{{vm.principal.email}}">{{vm.principal.email}}</a></td>\n                        </tr>\n                        <tr>\n                            <td>{{\'REGION\' | translate}}:</td>\n                            <td><b>{{vm.principal.address.region.code}}</b></td>\n                        </tr>\n                        <tr>\n                            <td>{{\'ADDRESS\' | translate}}:</td>\n                            <td><b>{{vm.principal.address.address_line_1}}</b></td>\n                        </tr>\n                    </table>\n                </div>\n                <span class="ui left aligned bottom attached" style="position: absolute; color:#b7bcc3">\n                  <small>Version {{vm.version_number}}</small>\n                </span>\n            </div>\n\n            <div class="ui four wide teal column profile-portrait">\n                <img ng-if="!vm.photo" src="assets/img/tmp/portrait.jpg" alt="{{vm.principal.identifier}}">\n                <img ng-if="vm.photo" ng-src="{{vm.photo}}" alt="{{vm.principal.identifier}}">\n            </div>\n\n            <div class="ui four wide teal column profile-calendar">\n                <div class="ui center aligned basic segment">\n                    <div class="ui statistic">\n                        <h2><i class="calendar icon"></i></h2>\n                        <p><a ui-sref="profile.calendar" class="dashboard-link">{{\'CALENDAR\' | translate}}</a></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class="ui four wide teal column profile-dictionary" ng-if="vm.isManager">\n                <div class="ui center aligned basic segment">\n                    <div class="ui statistic">\n                        <h2><i class="edit icon"></i></h2>\n                        <p><a ui-sref="profile.todo" class="dashboard-link">{{\'TODO\' | translate}}</a></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class="ui four wide teal column profile-coaching" ng-if="vm.coaching_visible">\n                <div class="ui center aligned basic segment">\n                    <div class="ui statistic">\n                        <h2><i class="university icon"></i></h2>\n                        <p><a ui-sref="profile.coaching" class="dashboard-link">{{\'COACHING\' | translate}}</a></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class="ui four wide teal column profile-dictionary" ng-if="vm.dictionary_visible">\n                <div class="ui center aligned basic segment">\n                    <div class="ui statistic">\n                        <h2><i class="book icon"></i></h2>\n                        <p><a href="" class="dashboard-link">{{\'DICTIONARY\' | translate}}</a></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class="ui four wide teal column profile-password">\n                <div class="ui center aligned basic segment">\n                    <div class="ui statistic">\n                        <h2><i class="unlock icon"></i></h2>\n                        <p><a href="" ng-click="vm.showModalPassword()" class="dashboard-link">{{\'CHANGE_PASS\' | translate}}</a></p>\n                    </div>\n                </div>\n            </div>\n\n\n        </div>\n\n        <br clear="all">\n        <br clear="all">\n\n\n    </div>\n</div>\n<atl-modal-form-dialog modal-id="\'editPassword\'" modal-title="\'CHANGE_PASS\' | translate" on-save="vm.changePassword()">\n\n    <div class="two fields">\n        <div class="field">\n            <label>{{\'EMAIL\' | translate}}</label>\n            <input type="text" name="email" ng-model="vm.auth.email">\n        </div>\n        <div class="field">\n            <label>{{\'OLD_PASS\' | translate}}</label>\n            <input type="password" name="oldPWD" ng-model="vm.auth.oldPWD">\n        </div>\n    </div>\n\n    <div class="two fields">\n        <div class="field">\n            <label>{{\'NEW_PASS\' | translate}}</label>\n            <input type="password" name="newPWD" ng-model="vm.auth.newPWD">\n        </div>\n        <div class="field">\n            <label>{{\'CONFIRM_PASS\' | translate}}</label>\n            <input type="password" name="confirmPWD" ng-model="vm.auth.confirmPWD">\n        </div>\n    </div>\n\n</atl-modal-form-dialog>'),$templateCache.put("app/profile/sessions/profile.session.edit.html",'<div id="container" class="ui segment main container">\n\n    <form class="ui form" id="1095991920" enctype="multipart/form-data">\n\n        <div class="ui grid">\n            <div class="six wide column left aligned">\n                <div class="input">\n                    <input type="date" ng-model="vm.session.date" name="shipping[date]" placeholder="date">\n                </div>\n\n                <div class="ui basic segment">\n                    <button class="ui yellow button" ng-click="vm.addStep()">\n                        <i class="icon plus"></i>\n                        {{\'STEP\' | translate}}\n                    </button>\n                </div>\n\n                <div class="ui basic segment" ng-repeat="step in vm.session.step track by $index">\n                    <button class="ui button" ng-click="vm.openStep($index)">\n                        {{\'STEP\' | translate}} {{$index + 1}}\n                    </button>\n                    <button class="ui button yellow" ng-show="!(step.text.length > 0)" ng-click="vm.addSubStep($index)">\n                        <i class="icon plus"></i>\n                        {{\'SUB_STEP\' | translate}}\n                    </button>\n\n                    <button class="ui button negative" style="padding-left: 18px; padding-right: 7px" ng-click="vm.deleteStep($index)">\n                        <i class="icon cancel"></i>\n                    </button>\n\n                    <div class="ui basic collapsed segment" ng-repeat="subStep in vm.session.step[$index].subStep track by $index">\n                        <button class="ui button" ng-click="vm.openStep($parent.$index, $index)">\n                            {{\'SUB_STEP\' | translate}} {{$index + 1}}\n                        </button>\n\n                        <button class="ui button negative" style="padding-left: 18px; padding-right: 7px" ng-click="vm.deleteSubStep($parent.$index, $index)">\n                            <i class="icon cancel"></i>\n                        </button>\n                    </div>\n                </div>\n\n            </div>\n            <div class="ten wide column">\n                <div class="field" ng-show="vm.stepIsOpen || vm.subStepIsOpen">\n                    <label>{{\'QUESTION\' | translate}}</label>\n                    <textarea class="step-textarea" ng-show="vm.stepIsOpen" ng-model="vm.session.step[vm.currentStep].text"></textarea>\n                    <textarea class="substep-textarea" ng-show="vm.subStepIsOpen" ng-model="vm.session.step[vm.currentStep].subStep[vm.currentSubStep].text"></textarea>\n                </div>\n\n                <div class="large ui negative button" ng-click="vm.back()">\n                    <i class="icon cancel"></i>\n                    {{\'CANCEL\' | translate}}\n                </div>\n                <div class="large ui positive button" ng-click="vm.store()">\n                    <i class="icon checkmark"></i>\n                    {{\'SAVE\' | translate}}\n                </div>\n            </div>\n        </div>\n    </form>\n\n\n\n\n<div class="ui divider"></div>\n<a class="large ui burak button" ui-sref="profile.coaching">\n\tCoaching\n</a>\n\n\n</div>'),$templateCache.put("app/profile/sessions/profile.session.html",'<div id="container" class="ui segment main container">\n\n  <h1 class="ui ribbon label breadcrumb">\n    <div class="active section">Session</div>\n  </h1>\n\n  <form name="sessionForm" novalidate ng-submit="sessionForm.$valid">\n\n    <div class="ui main container">\n\n      <!--<div class="ui basic segment" ng-if="!vm.isManager">\n        <div class="ui inline form">\n          <select name="haslo" id="session" ng-model="vm.currentSession"\n                  ng-change="vm.changeSession()" class="ui dropdown required">\n            <option ng-repeat="session in vm.repSessions" value="{{$index}}">\n              {{\'SESSION\' | translate}} {{$index + 1}}\n            </option>\n          </select>\n        </div>\n      </div>-->\n\n      <div class="ui basic megacollapsed segment">\n        <div class="ui segments">\n          <div class="ui segment marine">\n            <div class="ui grid">\n              <div class="twelve wide column">\n                {{\'COACHING_CHART\' | translate}}, {{vm.session.name}} &mdash; {{vm.session.staff.firstName}} {{vm.session.staff.lastName}}\n              </div>\n            </div>\n          </div>\n          <div class="ui basic collapsed attached segment" ng-if="vm.status != 3">\n\n              <!-- goals & textareas -->\n              <div class="two wide column" ng-if="!vm.waiting">\n                <table class="ui most basic table">\n                  <tr ng-if="vm.status != 3">\n                    <td class="collapsing">\n                      <label for="coachingGoalSession"><b>{{\'COACHING_GOALS\' | translate}}</b></label>\n                    </td>\n                    <td>\n                      <div class="ui form">\n                        <div class="field" ng-class="{\'error\': sessionForm[\'coachingGoalSession\'].$invalid}">\n                          <textarea name="coachingGoalSession" id="coachingGoalSession" required ng-model="vm.session.staff.coaching_goal" class="short" placeholder="{{\'COACHING_GOALS\' | translate}}"></textarea>\n                        </div>\n                      </div>\n                    </td>\n                  </tr>\n                </table>\n              </div>\n              <!-- / goal textareas -->\n\n          </div>\n          <div class="ui basic megacollapsed attached segment">\n            <div class="ui attached tertiary collapsed segment segment-heading">\n              <div class="ui dark grid">\n                <div class="fourteen wide left aligned column">\n                  <span ng-if="vm.session.staff.coaching_goal"><span ng-if="vm.session.date">{{vm.session.date | date:\'dd.MM.yyyy\'}}</span> <span>{{\'COACHING_GOALS\' | translate}}: {{vm.session.staff.coaching_goal}}</span></span>\n                  <i class="ui info circular small grey icon label" ng-if="vm.session.description" data-title="{{\'SESSION_DESCRIPTION\' | translate}}" data-content="{{vm.session.description}}" data-variation="wide" atl-popup></i>\n                </div>\n                <div class="two wide right aligned column">\n                  <a class="ui green circular big label">{{vm.session.avgRating}}</a>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class="ui basic megacollapsed attached segment" ng-repeat="step in vm.session.step">\n            <div class="ui attached tertiary collapsed segment segment-heading">\n              <div class="ui grid">\n                <div class="twelve wide column">\n                  <span ng-if="step.text !=\'\'">\n                    {{step.text}} <i ng-if="step.text_description" class="ui info circular small grey icon label" data-title="{{step.text}}" data-content="{{step.text_description}}" atl-popup></i>\n                  </span>\n                  <span ng-if="step.text ==\'\'">\n                    {{\'STEP\' | translate}} {{$index + 1}} <i ng-if="step.text_description" class="ui info circular small grey icon label" data-title="{{step.text}}" data-content="{{step.text_description}}" atl-popup></i>\n                  </span>\n                </div>\n                <div class="four wide right aligned column">\n                  <a class="ui orange circular big label">{{step.avgRating}}</a>\n                </div>\n              </div>\n            </div>\n            <div class="ui attached segment">\n              <div class="ui grid" ng-repeat="subStep in step.sub_step">\n                <div class="six wide column">\n                  <div class="ui basic segment">\n                    <b>{{subStep.text}}</b>\n                    <i class="ui info circular small grey icon label" ng-if="subStep.text_description" data-title="{{subStep.text}}" data-content="{{subStep.text_description}}" atl-popup></i>\n                  </div>\n                </div>\n                <div class="ten wide column">\n                  <ionslider field="subStep" name="subStepRating" type="single" min="0" max="4" from="{{subStep.rating}}" grid="true" from-fixed="{{!vm.isManager || (vm.isManager && vm.status == 3)}}" postfix="" values="{{vm.valuesSlider}}" on-change="vm.changeSlider" step="1"></ionslider>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div class="ui basic collapsed attached segment">\n\n        <!-- goals & textareas -->\n          <div class="two wide column" ng-if="!vm.waiting">\n            <table class="ui most basic table">\n              <tr>\n                <td class="collapsing">\n                  <label for="goalsSession"><b>{{\'GOALS\' | translate}}</b></label>\n                </td>\n                <td>\n                  <div ng-if="!vm.isManager || (vm.isManager && vm.status == 3)">\n                    {{vm.session.staff.operational_goal}}\n                  </div>\n                  <div class="ui form" ng-if="vm.isManager && vm.status != 3">\n                    <div class="field" ng-class="{\'error\': sessionForm[\'goalsSession\'].$invalid}">\n                      <textarea name="goalsSession" id="goalsSession" required ng-model="vm.session.staff.operational_goal" class="short" placeholder="{{\'GOALS\' | translate}}"></textarea>\n                    </div>\n                  </div>\n                </td>\n              </tr>\n              <tr>\n                <td class="collapsing">\n                  <label for="totalSession"><b>{{\'TOTAL\' | translate}}</b></label>\n                </td>\n                <td>\n                  <div ng-if="!vm.isManager || (vm.isManager && vm.status == 3)">\n                    {{vm.session.staff.total}}\n                  </div>\n                  <div class="ui form" ng-if="vm.isManager && vm.status != 3">\n                    <div class="field" ng-class="{\'error\': sessionForm[\'totalSession\'].$invalid}">\n                      <textarea name="totalSession" id="totalSession" required ng-model="vm.session.staff.total" class="short" placeholder="{{\'TOTAL\' | translate}}"></textarea>\n                    </div>\n                  </div>\n                </td>\n              </tr>\n            </table>\n          </div>\n          <!-- / goal textareas -->\n\n    </div>\n\n\n\n\n    <div class="ui center aligned basic segment">\n\n      <div class="ui three column center aligned grid">\n\n        <!--<div class="column">\n          <a class="large ui burak button" ui-sref="profile.coaching" ng-if="vm.isManager">\n            <i class="arrow left icon"></i>\n            Coaching\n          </a>\n        </div>-->\n\n        <!--<div class="column">\n          <div class="ui large pale button" ng-click="vm.back()">\n            <i class="cancel icon"></i>\n            {{\'CANCEL\' | translate}}\n          </div>\n        </div>-->\n\n        <div class="column">\n          <button type="button" class="ui large navy button" ng-click="vm.store()" ng-disabled="vm.lockForm || !sessionForm.$valid || vm.status == 3">\n            <i class="save icon" ng-hide="vm.lockForm"></i>\n            <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n            {{\'SAVE\' | translate}}\n          </button>\n        </div>\n\n        <div class="column" ng-if="vm.isManager || vm.status == 3">\n          <button type="button" class="ui large navy button" ng-disabled="vm.lockForm || !sessionForm.$valid || vm.status == 3 || vm.zeroRatingSteps === true" ng-click="vm.sendToRep()">\n            <i class="icon send" ng-hide="vm.lockForm"></i>\n            <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n            {{\'SEND_TO_REP\' | translate}}\n          </button>\n        </div>\n\n        <!--<div class="column" ng-if="!vm.isManager">\n          <button type="button"\n                  class="ui large navy button"\n                  ng-disabled="vm.lockForm"\n                  ng-click="vm.sendToRKS()">\n            <i class="icon send" ng-hide="vm.lockForm"></i>\n            <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n            {{\'SEND_TO_RKS\' | translate}}\n          </button>\n        </div>-->\n\n      </div>\n    </div>\n  </form>\n\n</div>'),$templateCache.put("app/profile/todo/profile.todo.html",'<div id="container" class="ui segment main container">\n\n <div class="ui tertiary segment collapsed">\n  <div class="ui grid">\n   <div class="ten wide column left aligned">\n    <h2>{{\'TODO\' | translate}}</h2>\n   </div>\n   <div class="six wide column right aligned">\n\n      <div class="compact ui tiny buttons">\n        <div class="ui button" ng-click="vm.selectAction(\'service_control\')" ng-class="{\'marine\':vm.todoPict.service_control == \'todo_service_control_icon_marine.png\'}">\n          <img ng-src="assets/img/icons/campaigns/{{vm.todoPict.service_control}}">\n        </div>\n        <div class="ui button" ng-click="vm.selectAction(\'proposal\')" ng-class="{\'marine\':vm.todoPict.proposal == \'todo_proposal_icon_marine.png\'}">\n          <img src="assets/img/icons/campaigns/{{vm.todoPict.proposal}}">\n        </div>\n      </div>\n\n   </div>\n  </div>\n </div>\n\n  <div class="ui main container">\n\n    <table class="ui table celled striped sortable listView">\n      <thead>\n      <tr>\n        <th class="one wide" ng-click="vm.changeSorting(\'todoDate\')" ng-class="vm.sortingClass(\'todoDate\')">Data</th>\n        <th class="one wide" ng-click="vm.changeSorting(\'campaignName\')" ng-class="vm.sortingClass(\'campaignName\')">{{\'CAMPAIGN\' | translate}}</th>\n        <th class="four wide" ng-click="vm.changeSorting(\'drugstore.drugstoreName\')" ng-class="vm.sortingClass(\'drugstore.drugstoreName\')">{{\'DRUGSTORE\' | translate}}</th>\n        <th class="one wide" ng-click="vm.changeSorting(\'drugstore.drugstoreIdentifier\')" ng-class="vm.sortingClass(\'drugstore.drugstoreIdentifier\')">ID</th>\n        <th class="three wide" ng-click="vm.changeSorting(\'drugstore.address.city.name\')" ng-class="vm.sortingClass(\'drugstore.address.city.name\')">Adres</th>\n        <th class="two wide" ng-click="vm.changeSorting(\'staffName\')" ng-class="vm.sortingClass(\'staffName\')">{{\'REP\' | translate}}</th>\n        <!--<th>{{\'ACTION_TYPE\' | translate}}</th>-->\n        <th class="two wide"></th>\n        <th class="one wide" ng-click="vm.changeSorting(\'action_type\')" ng-class="vm.sortingClass(\'action_type\')"></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="list in vm.todoData | selectedAction: vm.selectedAction | orderBy:vm.sort.column:vm.sort.descending" ng-class="{\'positive\': list.not_paid_campaign}">\n        <td>{{list.todoDate | date:\'dd.MM.yyyy\'}}</td>\n        <td>{{list.campaignName}}</td>\n        <td>{{list.drugstore.drugstoreName}}</td>\n        <td>{{list.drugstore.drugstoreIdentifier}}</td>\n        <td>{{list.drugstore.address.city.name}}<br>{{list.drugstore.address.address_line_1}}</td>\n        <td>{{list.staffName}}</td>\n        <!--<td>{{list.action_type}}</td>-->\n        <td>\n          <button ng-if="list.action_type == \'service_control\'" class="ui small icon navy button" ng-click="vm.showAllPhotos(list)" ng-disabled="vm.lockForm">\n            <i class="checkmark icon"></i> {{\'ACCEPT\' | translate}}\n          </button>\n          <button ng-if="list.action_type == \'proposal\'" class="ui small icon navy button" ng-click="vm.showConfirmationProposalWindow(list)" ng-disabled="vm.lockForm">\n            <i class="checkmark icon"></i> {{\'ACCEPT\' | translate}}\n          </button>\n        </td>\n        <td>\n          <span ng-if="list.action_type == \'service_control\'"><img src="assets/img/icons/campaigns/todo_service_control.png"></span>\n          <span ng-if="list.action_type == \'proposal\'"><img src="assets/img/icons/campaigns/todo_proposal.png"></span>\n          <span style="display:none">drugstore_id={{list.drugstore_id}} campaign_id={{list.campaign_id}} rks_id={{list.rks_id}} rep_id={{list.rep_id}}</span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n\n  <atl-modal-form-dialog modal-id="\'proposalAcceptance\'" show-action="false" modal-title="\'CONFIRM\' | translate">\n    <div class="ui basic supercollapsed segment" style="height:500px;overflow-y:auto">\n      <div class="ui left aligned basic segment">\n        <h3>{{vm.messageProposal}}</h3>\n        <div class="ui two column grid">\n          <div class="ui four wide column">\n            {{\'CAMPAIGN_DATE\' | translate}}:\n          </div>\n          <div class="ui twelve wide column">\n            <strong>{{vm.period.campaign_start | date:\'dd.MM.yyyy\'}} &mdash; {{vm.period.campaign_end | date:\'dd.MM.yyyy\'}}</strong>\n          </div>\n        </div>\n        <table class="ui most basic table" style="font-size: small">\n          <thead>\n          <tr>\n            <th>{{\'CAMPAIGN_DATE\' | translate}}</th>\n            <th ng-if="vm.progress.multi == \'multi\'">{{\'CYCLE_DATE\' | translate}}</th>\n            <th ng-if="vm.progress.multi == \'multi\'">{{\'CYCLE_DURATION\' | translate}}</th>\n          </tr>\n          </thead>\n          <tbody>\n          <tr>\n            <td>{{vm.period.campaign_start | date:\'dd.MM.yyyy\'}} &mdash; {{vm.period.campaign_end | date:\'dd.MM.yyyy\'}}</td>\n            <td ng-if="vm.progress.multi == \'multi\'">\n              {{vm.period.cycle_start | date:\'dd.MM.yyyy\'}} &mdash; {{vm.period.cycle_end | date:\'dd.MM.yyyy\'}}\n            </td>\n            <td ng-if="vm.progress.multi == \'multi\'">\n              {{vm.progress.cycle_number}}\n            </td>\n          </tr>\n          </tbody>\n        </table>\n        <div class="ui divider"></div>\n        <table class="ui most basic table" style="font-size: small" ng-if="vm.drugstoreNetworks">\n          <thead>\n          <tr>\n            <th>{{\'NAME\' | translate}}</th>\n            <th>{{\'CITY\' | translate}}</th>\n            <th>{{\'STREET\' | translate}}</th>\n          </tr>\n          </thead>\n          <tbody>\n          <tr ng-repeat="pharmacy in vm.drugstoreNetworks">\n            <td>{{::pharmacy.drugstoreName}}</td>\n            <td>{{::pharmacy.address.city.name}}</td>\n            <td>{{::pharmacy.address.address_line_1}}</td>\n          </tr>\n          </tbody>\n        </table>\n        <div class="ui divider" ng-if="vm.drugstoreNetworks"></div>\n        <table class="ui most basic table">\n          <tr>\n            <td>Zlecenie:</td>\n            <td><strong>{{vm.contractId}}</strong></td>\n          </tr>\n          <tr>\n            <td>Kampania:</td>\n            <td><strong>{{vm.campaignName}}</strong></td>\n          </tr>\n          <tr>\n            <td>Apteka:</td>\n            <td><strong>{{vm.drugstoreName}}</strong></td>\n          </tr>\n          <tr>\n            <td>Adres:</td>\n            <td><strong>{{vm.drugstoreAddress}}</strong></td>\n          </tr>\n          <tr>\n            <td>NIP:</td>\n            <td><strong>{{vm.drugstoreNIP}}</strong></td>\n          </tr>\n        </table>\n      </div>\n      <div class="ui left aligned basic segment">\n        <h3>{{\'PROPOSAL\' | translate}}:</h3>\n        <table class="ui most basic table">\n          <tr ng-if="vm.newAgreedPotential.sellIn || vm.newAgreedPotential.sellOut">\n            <td>{{\'POTENTIAL\' | translate}}</td>\n            <td class="right aligned">\n              <span ng-if="vm.newAgreedPotential.sellIn>=0">\n                {{vm.newAgreedPotential.sellIn * vm.multiplier | number : 2}}\n              </span>\n              <span ng-if="vm.newAgreedPotential.sellOut>=0">\n               / {{vm.newAgreedPotential.sellOut * vm.multiplier | number : 2}}\n              </span>\n            </td>\n          </tr>\n          <tr ng-if="vm.fixedAmount">\n            <td>{{\'BONUS\' | translate}}</td>\n            <td class="right aligned">{{vm.fixedAmount * vm.multiplier | number : 2}}</td>\n          </tr>\n          <tr ng-if="vm.variesAmount || vm.variesAmountPoints">\n            <td>{{\'AMOUNT_VARIES\' | translate}}</td>\n            <td class="right aligned">{{vm.variesAmount | number : 2}} / {{vm.variesAmountPoints}} P</td>\n          </tr>\n          <tr ng-repeat="service in vm.services" ng-if="service.include">\n            <td>{{service.title}}</td>\n            <td class="right aligned">\n              <span ng-if="service.earned!=0">{{service.earned * service.multiplier * service.cycleValue | number : 2}}</span></td>\n          </tr>\n          <tr>\n            <td colspan="2" class="bottom-bordered"></td>\n          </tr>\n          <tr>\n            <td>{{\'TOTAL_SUM\' | translate}}</td>\n            <td class="right aligned">{{vm.total | number : 2}} <span style="display:none">/ {{vm.variesAmountPoints}} P</span></td>\n          </tr>\n        </table>\n      </div>\n    </div>\n    <div class="ui center aligned basic segment">\n      <button class="negative ui button" ng-click="vm.showRejectConfirmationWindow()">Odrzuć</button>\n      <button class="ui marine button" ng-click="vm.showAcceptConfirmationWindow()">Zaakceptuj</button>\n    </div>\n  </atl-modal-form-dialog>\n\n  <atl-modal-form-dialog modal-id="\'showAcceptPhotos\'" show-action="false" modal-title="\'ACCEPT_PHOTO\' | translate">\n    <h3>{{vm.campaignName}} &mdash; {{vm.drugstoreName}}:</h3>\n    <div class="ui basic supercollapsed segment" style="height:550px;overflow-y:auto" ng-show="vm.isZoom">\n      <div class="photo-zoom-centered">\n        <span ng-if="vm.imgDate" class="photo_date">\n          <span class="ui white big label">{{vm.imgDate}}</span>\n        </span>\n        <img ng-src="{{vm.imgFileZoom}}" ng-click="vm.hideZoom($event)" class="zoom-img-scale img-rotatable" ng-class="vm.imgRotateClass">\n        <div class="right_button"><button class="ui icon marine button" ng-click="vm.rotatePict()"><i class="repeat icon"></i></button></div>\n      </div>\n    </div>\n\n    <div class="ui basic supercollapsed segment" style="height:550px;overflow-y:auto" ng-hide="vm.isZoom">\n\n      <div class="ui three column grid" ng-if="!vm.hide_drugstore_photo && vm.imageProps.drugstore_image.id">\n        <div class="column"></div>\n        <div class="center aligned column">\n          <div class="service-img-photo-holder" ng-class="{\'red\': vm.imageProps.drugstore_image.old_date || !vm.imageProps.drugstore_image.selectedToAccept}">\n            <span class="service_photo_date">\n              <span ng-if="vm.imageProps.definition.drugstore_originalDate" class="ui white small label">\n                <b>{{vm.imageProps.definition.drugstore_originalDate}}</b>\n              </span>\n            </span>\n            <img ng-src="{{vm.path_img}}{{vm.imageProps.drugstore_image.filename}}" style="max-height:100%" class="img-rotatable" ng-class="vm.imageProps.drugstore_image.rotateClass" id="img_drugstore_{{vm.imageProps.drugstore_image.id}}" ng-click="vm.setZoomPicture(vm.imageProps, \'drugstore\')">\n          </div>\n          <div class="service-img-checkbox-holder">\n            <div class="ui toggle checkbox">\n              <input id="check_drugstore_image" type="checkbox" ng-checked="vm.imageProps.drugstore_image.selectedToAccept" ng-model="vm.imageProps.drugstore_image.selectedToAccept" ng-init="vm.imageProps.drugstore_image.selectedToAccept = true" ng-disabled="">\n              <label for="check_drugstore_image"></label>\n            </div>\n          </div>\n        </div>\n        <div class="column"></div>\n      </div>\n\n      <div class="ui grid">\n        <div class="center aligned three column row">\n          <div class="column ui tertiary segment collapsed"><b>{{\'SERVICES\' | translate}}</b></div>\n          <div class="column ui tertiary segment collapsed"><b>{{\'SHELF\' | translate}}</b></div>\n          <div class="column ui tertiary segment collapsed"><b>{{\'ENVIRONMENT\' | translate}}</b></div>\n        </div>\n      </div>\n      <div class="ui basic supercollapsed segment" ng-repeat="step in vm.currentDataServiceControl">\n        <div class="ui basic supercollapsed segment" ng-repeat="service in step.group">\n          <div class="ui three column grid">\n            <div class="column">\n              <div class="service-img-photo-holder">\n                <h3>{{service.definition ? service.definition.title : \'no\'}}</h3>\n              </div>\n            </div>\n\n            <div class="center aligned column">\n              <div ng-if="service.shelf_image">\n                <div ng-if="service.shelf_image.filename" class="service-img-photo-holder" ng-class="{\'green\': service.shelf_image.selectedToAccept && service.definition.shelf_agreed == 1, \'yellow\': service.shelf_image.selectedToAccept && service.definition.shelf_agreed != 1, \'red\': !service.definition.shelf_agreed || !service.shelf_image.selectedToAccept}">\n                  <span class="service_photo_date">\n                    <span ng-if="service.definition.shelf_originalDate" class="ui white small label">\n                      <b>{{service.definition.shelf_originalDate}}</b></span>\n                  </span>\n                  <img ng-src="{{vm.path_img}}{{service.shelf_image.filename}}" style="max-height:100%" class="img-rotatable" ng-class="service.shelf_image.rotateClass" id="img_shelf{{step.key}}_{{$index}}" ng-click="vm.setZoomPicture(service, \'shelf\')">\n                </div>\n                <div ng-hide="service.shelf_image.filename" class="service-img-photo-holder"><span class="negative-text">No photo</span></div>\n                <!--<div ng-if="service.definition.shelf_originalDate" class="service-img-photo-data">\n                  {{service.definition.shelf_originalDate}}\n                </div>-->\n                <div class="service-img-checkbox-holder">\n                  <div class="ui toggle checkbox">\n                    <input id="check_shelf{{step.key}}_{{$index}}" type="checkbox" ng-click="vm.checkReject(service)" ng-checked="service.shelf_image.selectedToAccept" ng-model="service.shelf_image.selectedToAccept" ng-init="service.shelf_image.selectedToAccept = true" ng-disabled="!service.definition.shelf_control || service.definition.shelf_agreed == 1">\n                    <label for="check_shelf{{step.key}}_{{$index}}"></label>\n                  </div>\n                  <!--={{service.definition.debug || \'no\'}}=-->\n                </div>\n              </div>\n              <div ng-hide="service.shelf_image"><b>{{\'NOT_INCLUDE\' | translate}}</b></div>\n            </div>\n\n            <div class="center aligned column">\n              <div ng-if="service.env_image">\n                <div ng-if="service.env_image.filename" class="service-img-photo-holder" ng-class="{\'green\': service.env_image.selectedToAccept && service.definition.env_agreed == 1, \'yellow\': service.env_image.selectedToAccept && service.definition.env_agreed != 1, \'red\': !service.definition.env_agreed || !service.env_image.selectedToAccept}">\n                  <span class="service_photo_date">\n                    <span ng-if="service.definition.env_originalDate" class="ui white small label">\n                      <b>{{service.definition.env_originalDate}}</b>\n                    </span>\n                  </span>\n                  <img ng-src="{{vm.path_img}}{{service.env_image.filename}}" style="max-height:100%" class="img-rotatable" ng-class="service.env_image.rotateClass" id="img_env{{step.key}}_{{$index}}" ng-click="vm.setZoomPicture(service, \'env\')">\n                </div>\n                <div ng-hide="service.env_image.filename" class="service-img-photo-holder"><span class="negative-text">No photo</span></div>\n\n                <!--<div ng-if="service.definition.env_originalDate" class="service-img-photo-data">\n                  {{service.definition.env_originalDate}}\n                </div>-->\n\n                <div class="service-img-checkbox-holder">\n                  <div class="ui toggle checkbox">\n                    <input id="check_env{{step.key}}_{{$index}}" type="checkbox" ng-click="vm.checkReject(service)" ng-checked="service.env_image.selectedToAccept" ng-model="service.env_image.selectedToAccept" ng-init="service.env_image.selectedToAccept = true" ng-disabled="!service.definition.env_control || service.definition.env_agreed == 1">\n                    <label for="check_env{{step.key}}_{{$index}}"></label>\n                  </div>\n                  <!--={{service.definition.debug || \'no\'}}=-->\n                </div>\n              </div>\n              <div ng-hide="service.env_image"><b>{{\'NOT_INCLUDE\' | translate}}</b></div>\n            </div>\n          </div>\n        </div>\n        <div class="ui divider"></div>\n\n      </div>\n      <div class="ui basic megacollapsed segment" ng-if="vm.isReject">\n        <div class="field">\n          <label>{{\'REJECT_REASON\' | translate}}:</label>\n          <textarea ng-model="vm.messageToStaff" rows="2"></textarea>\n        </div>\n      </div>\n    </div>\n    <div class="ui grid">\n      <div class="center aligned column">\n        <!-- <div><label>Agreed</label></div><br> -->\n        <button class="ui marine button" ng-click="vm.showConfirmAgreed()">\n          {{\'SEND\' | translate}}\n        </button>\n        <!--<div class="ui large buttons simple">\n          <button class="ui green button" ng-click="vm.setRksAllAgreed(true)">Confirm</button>\n          <div class="or"></div>\n          <button class="ui red button" ng-click="vm.setRksAllAgreed(false)">Reject</button>\n        </div>-->\n      </div>\n    </div>\n  </atl-modal-form-dialog>\n  <atl-modal-confirm-dialog modal-id="\'confirmRksAgreed\'" modal-title="\'CONFIRM_CONTROL\' | translate" on-confirm="vm.setRksAllAgreed();vm.saveServiceControl()">\n    Czy jesteś pewien swojej decyzji?\n  </atl-modal-confirm-dialog>\n  <ng-include src="\'app/messaging/modals/confirm-proposal-acceptance.modal-window.html\'"></ng-include>\n  <ng-include src="\'app/messaging/modals/confirm-proposal-rejection.modal-window.html\'"></ng-include>\n\n</div>'),
$templateCache.put("app/__modules/budgeting/budgets/budgets.html","<div ui-view></div>\n"),$templateCache.put("app/campaigns/pages/templates/campaigns.argsForClient.html",'<div ng-controller="CampaignsArgsForClientController as vm">\n\n<div class="ui two column left aligned grid">\n  <div class="left aligned column">\n    {{\'PERIOD\' | translate}}: <b>{{vm.parent.period.start | date:\'dd.MM.yyyy\'}} — {{vm.parent.period.end | date:\'dd.MM.yyyy\'}}</b>\n  </div>\n  <div class="right aligned column" ng-if="vm.messageSelling">\n    <div class="{{vm.messageSellingClass}}">\n      <b>{{vm.messageSelling}}</b>\n    </div>\n  </div>\n</div>\n<div class="ui divider"></div>\n\n<div class="ui grid">\n\n  <div class="row">\n    <div class="ui four wide column center aligned"></div>\n    <div class="ui twelve wide column center aligned">\n      <div class="ui three column grid">\n        <div class="column">\n          {{\'SEL_IN_EARNINGS\' | translate}}: {{vm.totalSellIn * vm.multiplier | number : 2 || 0.00}} / {{vm.totalSellInPoints * vm.multiplier | number : 0 || 0}} P\n        </div>\n        <div class="column">\n          {{\'SEL_IN_EARNINGS\' | translate}}: {{vm.totalSellOut * vm.multiplier | number : 2 || 0.00}} / {{vm.totalSellOutPoints * vm.multiplier | number : 0 || 0}} P\n        </div>\n        <div class="column">\n          {{\'TOTAL_EARNINGS\' | translate}}: {{vm.totalSellArgs * vm.multiplier | number : 2 || 0.00}} / {{vm.totalSellArgsPoints * vm.multiplier | number : 0  || 0}} P\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="row">\n    <div class="ui four wide column center aligned">\n      <div class="ui-knob">\n        <atl-knob knob-data="vm.percentDays" knob-change-value="vm.campaignDaysBeforeEnd" width="150" height="150" read-only="true" display-previous="true"></atl-knob>\n        <p>{{\'DAYS_LEFT\' | translate}}</p>\n      </div>\n      <br><br>\n      <div class="ui-knob ui-knob-small" ng-if="vm.campaign.campaign_scale == \'multi\'">\n        <atl-knob knob-data="vm.cyclePercentDays" knob-change-value="vm.cycleDaysBeforeEnd" width="75" height="75" display-previous="true" read-only="true" fg-color="#a44575"></atl-knob>\n        <p>{{\'DAYS_LEFT\' | translate}}</p>\n      </div>\n    </div>\n\n    <div class="ui twelve wide column">\n      <div class="ui basic megacollapsed attached segment" ng-repeat="group in vm.groupBy">\n\n        <div class="ui center aligned attached tertiary collapsed segment segment-heading">{{group.name}}</div>\n\n        <div class="ui attached segment">\n          <div class="ui grid" ng-if="group.sellIn.visible">\n\n            <div class="ui four wide column right aligned">\n              <div class="ui basic segment">\n                <img src="assets/img/icons/campaigns/sell-in.png">\n                <br>\n                <b class="lightblue small-header">{{\'SELL_IN\' | translate}}</b>\n              </div>\n            </div>\n\n            <div class="ui eight wide column">\n              <div ng-class="{\'read-only-content\':vm.step.readOnly || vm.pageReadOnly}">\n                <ionslider field="group" name="sellIn" type="{{group.sellIn.type}}" min="{{group.sellIn.startMultiple}}" max="{{group.sellIn.endMultiple}}" from="{{group.sellIn.from}}" grid="true" from-fixed="{{vm.step.readOnly || vm.pageReadOnly}}" postfix="{{\'%\'}}" values="{{group.sellIn.values.valsMultiple}}" on-change="vm.changeArgsSlider" step="1"></ionslider>\n              </div>\n            </div>\n            <div class="ui four wide column left aligned top-padded">\n              <div class="ui basic segment">\n                <b>{{group.sellIn.money  * vm.multiplier  | number : group.sellOut.sign != \'P\' ? 2 : 0 }} {{group.sellIn.sign}}</b>\n              </div>\n            </div>\n\n          </div>\n\n          <div class="ui grid" ng-if="group.sellOut.visible">\n\n            <div class="ui four wide column right aligned">\n              <div class="ui basic segment">\n                <img src="assets/img/icons/campaigns/sell-out.png">\n                <br>\n                <b class="lightblue small-header">Sell Out</b>\n              </div>\n            </div>\n\n            <div class="ui eight wide column">\n              <div ng-class="{\'read-only-content\':vm.step.readOnly || vm.pageReadOnly}">\n                <ionslider field="group" name="sellOut" type="{{group.sellOut.type}}" min="{{group.sellOut.startMultiple}}" max="{{group.sellOut.endMultiple}}" from="{{group.sellOut.from}}" postfix="{{\'%\'}}" values="{{group.sellOut.values.valsMultiple}}" grid="true" from-fixed="{{vm.step.readOnly || vm.pageReadOnly}}" on-change="vm.changeArgsSlider" step="1"></ionslider>\n              </div>\n\n            </div>\n            <div class="ui four wide column left aligned top-padded">\n              <div class="ui basic segment">\n                <b>{{group.sellOut.money * vm.multiplier | number : group.sellOut.sign != \'P\' ? 2 : 0}} {{group.sellOut.sign}}</b>\n              </div>\n            </div>\n\n          </div>\n        </div>\n\n      </div>\n\n    </div>\n  </div>\n\n  <div class="row">\n    <div class="ui four wide column center aligned"></div>\n    <div class="ui twelve wide column center aligned">\n      <div class="ui three column grid">\n        <div class="column">\n          {{\'SELL_IN\' | translate}}: {{vm.totalSellInVaries * vm.multiplier | number : 2 || 0.00}} / {{vm.totalSellInVariesPoints * vm.multiplier | number : 0 || 0}} P\n        </div>\n        <div class="column">\n          {{\'SELL_OUT\' | translate}}: {{vm.totalSellOutVaries * vm.multiplier | number : 2 || 0.00}} / {{vm.totalSellOutVariesPoints * vm.multiplier | number : 0 || 0}} P\n        </div>\n        <div class="column">\n          {{totalAmount=vm.getArgsVariesAmount();""}}\n          {{\'TOTAL_VARIES\' | translate}}: {{totalAmount.total * vm.multiplier | number : 2 || 0.00}} / {{totalAmount.totalPoints * vm.multiplier | number : 0 || 0}} P\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="row" ng-if="vm.loading">\n\n    <div class="ui middle aligned four wide column center">\n      <br>\n      <div class="ui-knob" ng-if="(vm.dominant == \'sellIn\' && vm.giftsDropped.length) || (vm.dominant == \'sellOut\' && vm.giftsArgs.length)">\n        <atl-knob id="knobGifts" knob-data="vm.percentPoints" width="150" height="150" read-only="true" display-previous="true"></atl-knob>\n        <p>% / {{\'POINTS\' | translate}}</p>\n      </div>\n    </div>\n\n    <div class="ui twelve wide column">\n      <div ng-if="vm.dominant == \'sellIn\' && vm.giftsDropped.length">\n        <div class="ui center aligned attached tertiary collapsed segment segment-heading">Gifts</div>\n        <div class="ui grid attached segment">\n          <div class="one column row">\n            <div class="ui column">\n              <div class="ui basic segment">\n                <div ng-if="totalAmount.totalPoints * vm.multiplier - vm.reservePoints >= 0" class="positive-text">\n                  <span>{{\'RESERVED\' | translate}} <b>{{vm.reservePoints}}</b> points</span><br>\n                  <span>{{\'YOU_HAVE_ENOUGH_POINTS\' | translate}} ({{totalAmount.totalPoints * vm.multiplier | number:0}}) {{\'TO_GET_THE_RESERVED_GIFT\' | translate}}</span>\n                </div>\n                <div ng-if="totalAmount.totalPoints * vm.multiplier - vm.reservePoints < 0" class="negative-text">\n                  <div>\n                    <span>{{\'YOU_HAVE_ENOUGH_POINTS\' | translate}} {{\'TO_GET_THE_RESERVED_GIFT\' | translate}}</span><br>\n                    <span>{{\'YOU_HAVE_TO_COLLECT\' | translate}} {{vm.reservePoints}} {{\'POINTS\'}}</span><br>\n                    <!--<span ng-if="vm.maxEarnedPoints">{{vm.messageNegative}} to get the reserved gift</span>-->\n                  </div>\n                </div><br>\n                <div class="ui horizontal list">\n                  <div class="item item-gift" ng-repeat="obj in vm.giftsDropped">\n                    <div class="ui segment {{obj.color}} button drag-object">\n                      <div class="content">\n                        <div class="img">\n                          <img ng-if="obj.image" ng-src="{{obj.image}}" id="photo_{{$index}}" alt="photo">\n                          <i ng-hide="obj.image" class="gift big icon"></i>\n                        </div>\n                        <div class="header" style="font-size: smaller">{{obj.name}}</div>\n                        <div class="ui two column grid small-text"><small class="column center aligned">{{obj.points}}<i ng-if="obj.points">p</i></small><small class="column center aligned">{{obj.amountDropped}}</small></div>\n                      </div>\n                      <div ng-drag="true" ng-drag-data="obj" ng-drag="true" ng-drag-data="obj" ng-drag-start="vm.onDragStart($data,$event)" ng-drag-stop="vm.onDragEnd($data,$event)"></div>\n                      <div class="ui floating circular label clickable" ng-click="vm.showGiftInfo(obj)"><i class="icon info"></i></div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n          </div>\n        </div>\n\n      </div>\n\n      <div ng-if="vm.dominant == \'sellOut\' && vm.giftsArgs.length">\n\n        <div class="ui center aligned attached tertiary collapsed segment segment-heading">{{\'GIFTS\' |translate}}</div>\n        <div class="ui grid attached segment">\n          <div class="one column row">\n            <div class="ui column">\n              <div class="ui basic segment">\n                <div ng-if="totalAmount.totalPoints * vm.multiplier > 0" class="positive-text">\n                  <span>{{\'YOU_HAVE_ENOUGH_POINTS\' | translate}} ({{totalAmount.totalPoints * vm.multiplier | number:0}}) {{\'TO_GET_GIFT\' | translate}}</span>\n                </div>\n                <div ng-if="!totalAmount.totalPoints * vm.multiplier" class="negative-text">\n                  <div>\n                    <span>{{\'YOU_HAVE_NOT_ENOUGH_POINTS\' | translate}} {{\'TO_GET_THE_RESERVED_GIFT\' | translate}}</span><br>\n                    <!--<span>You have to collect {{vm.reservePoints}} points</span><br>\n                    <span ng-if="vm.messageNegative">{{vm.messageNegative}} to get the reserved gift</span>-->\n                  </div>\n                </div><br>\n                <div class="ui horizontal list">\n                  <div class="item item-gift" ng-repeat="obj in vm.giftsArgs">\n                    <div class="ui segment {{obj.color}} button drag-object">\n                      <div class="content">\n                        <div class="img">\n                          <img ng-if="obj.image" ng-src="{{obj.image}}" id="photo_{{$index}}" alt="photo">\n                          <i ng-hide="obj.image" class="gift big icon"></i>\n                        </div>\n                        <div class="header" style="font-size: smaller">{{obj.name}}</div>\n                        <div class="ui two column grid small-text"><small class="column center aligned">{{obj.points}}<i ng-if="obj.points">p</i></small><small class="column center aligned">{{obj.amount}}</small></div>\n                      </div>\n                      <div ng-drag="true" ng-drag-data="obj" ng-drag="true" ng-drag-data="obj" ng-drag-start="vm.onDragStart($data,$event)" ng-drag-stop="vm.onDragEnd($data,$event)"></div>\n                      <div class="ui floating circular label clickable" ng-click="vm.showGiftInfo(obj)"><i class="icon info"></i></div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n          </div>\n        </div>\n\n      </div>\n\n    </div>\n\n  </div>\n\n\n</div>\n\n\n<!--<div class="ui positive message">\n  <div class="ui grid">\n    <div class="ui four wide column right aligned">Total: </div>\n    <div class="ui four wide column right aligned">\n      sell In potential: {{vm.totalPotentialSellIn * vm.multiplier | number : 2}}\n    </div>\n    <div class="ui four wide column right aligned">\n      sell Out potential: {{vm.totalPotentialSellOut * vm.multiplier | number : 2}}\n    </div>\n    <div class="ui four wide column right aligned">\n      potential: {{vm.totalPotential * vm.multiplier | number : 2}}\n    </div>\n\n  </div>\n  <div class="ui grid">\n    <div class="ui four wide column right aligned">TO DO:</div>\n    <div class="ui four wide column right aligned">\n      sell In: {{vm.toDoSellIn | number : 0 || 0}} %\n    </div>\n    <div class="ui four wide column right aligned">\n      sell Out: {{vm.toDoSellOut | number : 0 || 0}} %\n    </div>\n    <div class="ui four wide column right aligned">\n      total: {{vm.toDo | number : 0 || 0}} %\n    </div>\n  </div>\n</div>-->\n\n\n<div class="ui center aligned basic segment">\n  <div class="ui two column center aligned grid">\n    <div class="column">\n      <div class="ui large pale button">\n        <i class="cancel icon"></i>\n        Cancel\n      </div>\n    </div>\n    <div class="column">\n      <button type="submit" class="ui navy large button" disabled="disabled">\n        <i class="save icon"></i>\n        {{\'SAVE\' | translate}}\n      </button>\n    </div>\n  </div>\n</div>\n\n\n\n\n\n\n\n\n<atl-modal-form-dialog modal-id="\'showGift\'" show-action="false" modal-title="\'GIFT\' | translate">\n  <div class="ui grid" style="height:430px; overflow: auto">\n    <div class="column center aligned">\n      <div class="ui items">\n\n        <div class="item">\n          <div class="ui one column center aligned grid">\n\n            <div class="column">\n              <img ng-src="{{vm.showGift.image}}" style="max-height:200px">\n            </div>\n\n            <div class="column">\n\n              <div class="header">{{vm.showGift.name}}</div>\n\n              <div class="description">\n                <p>{{vm.showGift.description}}</p>\n              </div>\n\n              <div class="extra">\n                <div class="ui grid center aligned gift-props">\n                  <div class="ui four wide column">\n                    {{\'MARK\' | translate}}: <span class="ui label">{{vm.showGift.mark}}</span>\n                  </div>\n                  <div class="ui four wide column">\n                    {{\'PRICE\' | translate}}: <span class="ui circular label">{{vm.showGift.price}}</span> {{vm.showGift.currency}}\n                  </div>\n                  <div class="ui four wide column" ng-if="vm.showGift.points">\n                    {{\'POINTS\' | translate}}: <span class="ui circular label">{{vm.showGift.points}}</span> p\n                  </div>\n                  <div class="ui four wide column" ng-if="vm.showGift.points">\n                    {{\'AMOUNT\' | translate}}: <span class="ui circular label">{{vm.showGift.amount}}</span>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n</atl-modal-form-dialog>\n</div>'),$templateCache.put("app/campaigns/pages/templates/campaigns.argsForClientGift.html",'<div class="ui segment">\n\n    <div class="ui four column right aligned grid">\n        <div class="column">\n        </div>\n        <div class="column">\n        </div>\n        <div class="column">\n          {{\'TOTAL_EARNINGS\' | translate}}: {{vm.totalSellArgs * vm.multiplier || 0.00}} / {{vm.totalSellArgsPoints * vm.multiplier || 0}} P\n        </div>\n        <div class="column">\n            <p>{{\'PERIOD\' | translate}}: <b>{{vm.step.date_start | date:\'dd.MM.yyyy\'}} — {{vm.step.date_end | date:\'dd.MM.yyyy\'}}</b></p>\n        </div>\n    </div>\n\n</div>\n\n\n<div class="ui segment grid">\n\n    <div class="ui four wide column center aligned">\n\n        <div class="ui-knob">\n            <!--<input type="text" value="30%" class="dial">-->\n            <atl-knob knob-data="vm.percentDays" width="150" height="150" read-only="true" display-previous="true"></atl-knob>\n            <p>% / {{\'DAYS\' | translate}}</p>\n        </div>\n\n    </div>\n\n\n    <div class="ui twelve wide column">\n\n        <div class="ui two column grid segment">\n\n          <div class="ui column" ng-repeat="group in vm.groupBy">\n\n            <h3 class="ui center aligned header">{{group.name}}</h3>\n\n            <div class="ui grid" ng-if="group.sellIn.visible">\n\n              <div class="ui four wide column right aligned">\n                <div class="ui basic segment">\n                  <b>{{\'SELL_IN\' | translate}}</b>\n                </div>\n              </div>\n\n              <div class="ui eight wide column">\n                <div>\n                  <ionslider field="group" name="sellIn" type="{{group.sellIn.type}}" min="{{group.sellIn.startValue}}" max="{{group.sellIn.endValue}}" from="{{group.sellIn.from}}" grid="true" postfix="{{group.sellIn.showPercent ? \'%\' : \'\'}}" values="{{group.sellIn.values.vals}}" on-change="vm.changeArgsSlider" step="1"></ionslider>\n                </div>\n              </div>\n              <div class="ui four wide column left aligned">\n                <div class="ui basic segment">\n                  <b>{{group.sellIn.money * vm.multiplier | number : group.sellIn.sign != \'P\' ? 2 : 0}} {{group.sellIn.sign}}</b>\n                </div>\n              </div>\n\n            </div>\n\n            <div class="ui grid" ng-if="group.sellOut.visible">\n\n              <div class="ui four wide column right aligned">\n                <div class="ui basic segment">\n                  <b>{{\'SEL_OUT\' | translate}}</b>\n                </div>\n              </div>\n\n              <div class="ui eight wide column">\n                <div>\n                  <ionslider field="group" name="sellOut" type="{{group.sellOut.type}}" min="{{group.sellOut.startValue}}" max="{{group.sellOut.endValue}}" from="{{group.sellOut.from}}" postfix="{{group.sellOut.showPercent ? \'%\' : \'\'}}" values="{{group.sellOut.values.vals}}" grid="true" on-change="vm.changeArgsSlider" step="1"></ionslider>\n                </div>\n\n              </div>\n              <div class="ui four wide column left aligned">\n                <div class="ui basic segment">\n                  <b>{{group.sellOut.money * vm.multiplier | number : group.sellOut.sign != \'P\' ? 2 : 0}} {{group.sellOut.sign}}</b>\n                </div>\n              </div>\n\n            </div>\n\n          </div>\n\n        </div>\n\n\n    </div>\n\n</div>\n<div class="ui segment grid">\n\n  <div class="ui four wide column right aligned">\n    {{totalAmount=vm.getArgsVariesAmount();""}}\n    {{\'TOTAL_VARIES\' | translate}}: {{totalAmount.total * vm.multiplier | number : 2 || 0.00}} / {{totalAmount.totalPoints * vm.multiplier || 0}} P\n  </div>\n</div>\n\n<div class="ui segment usual">\n    <div class="ui top left attached label">Gifts</div>\n    <div class="ui basic segment">\n      <p ng-if="vm.reserveArgsPoints">{{\'RESERVED\' | translate}} {{\'POINTS\' | translate}} <b>{{vm.reserveArgsPoints}}</b> {{\'POINTS\' | translate}}</p>\n      <p ng-if="vm.earnedPoints - vm.reserveArgsPoints >0">{{\'YOU_HAVE_ENOUGH_POINTS\' | translate}} ({{vm.earnedPoints}}) {{\'TO_GET_THE_RESERVED_GIFT\' | translate}}</p>\n      <p ng-if="vm.earnedPoints - vm.reserveArgsPoints <0">{{\'YOU_HAVE_NOT_ENOUGH_POINTS\' | translate}} {{\'TO_GET_THE_RESERVED_GIFT\' | translate}}</p>\n\n      <div class="ui center aligned column">\n        <div class="ui horizontal list">\n          <div class="item" ng-repeat="obj in vm.giftsDropped">\n            <div class="ui segment {{obj.color}} button drag-object">\n              <div class="content">\n                <div class="img">\n                  <img ng-if="obj.image" ng-src="{{obj.image}}" id="photo_{{$index}}" alt="photo">\n                  <i ng-hide="obj.image" class="gift big icon"></i>\n                </div>\n                <div class="header" style="font-size:smaller">{{obj.name}}</div>\n                <div class="ui two column grid"><span class="column left aligned" ng-if="obj.points">{{obj.points}}p</span><span class="column right aligned">{{obj.amount}}</span></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n</div>\n\n\n\n\n<div class="ui center aligned basic segment">\n  <div class="ui three column center aligned grid">\n    <div class="column">\n      <div class="ui large pale button">\n        <i class="cancel icon"></i>\n        {{\'CANCEL\' | translate}}\n      </div>\n    </div>\n    <div class="column">\n      <button type="submit" class="ui navy large button" ng-disabled="{{!vm.parent.isVisit}}">\n        <i class="save icon"></i>\n        {{\'SAVE\' | translate}}\n      </button>\n    </div>\n    <div class="column">\n      <div class="ui large inverted blue button" ng-click="vm.setArgsGifts(false)">\n        <a href=""><i class="icon arrow left"></i> {{\'PREVIOUS\' | translate}}</a>\n      </div>\n    </div>\n  </div>\n</div>\n\n\n<!-- <div class="ui segment two column grid">\n\n    <div class="ui column">\n\n        <div class="large ui positive button">\n            <i class="icon checkmark"></i>\n            Save\n        </div>\n\n        <div class="large ui negative button">\n            <i class="icon cancel"></i>\n            Cancel\n        </div>\n\n    </div>\n\n    <div class="ui right aligned column">\n\n        <div class="large ui inverted blue button" ng-click="vm.setArgsGifts(false)">\n            <a href=""><i class="icon arrow left"></i> Previous</a>\n        </div>\n\n    </div>\n\n</div> -->\n'),$templateCache.put("app/campaigns/pages/templates/campaigns.conferenceInvitation.html",'<div ng-controller="CampaignsConferenceInvitationController as vm">\n\n<h2>{{\'CONFERENCE\' | translate}}: Hepatil</h2>\n\n<form class="ui form" name="invitationForm" novalidate ng-submit="invitationForm.$valid">\n<table class="ui basic table">\n    <thead>\n    <tr>\n        <th></th>\n        <th>{{\'PARTICIPATES\' | translate}}</th>\n        <th>{{\'DATE\' | translate}}</th>\n        <th>{{\'CITY\' | translate}}</th>\n        <th>{{\'HOTEL\' | translate}}</th>\n        <th>{{\'ROOM\' | translate}}</th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr ng-repeat="person in vm.drugstore.drugstores_staff">\n        <td><b><i class="icon green desktop"></i> {{person.first_name}} {{person.last_name}}</b></td>\n        <td>\n            <div class="ui toggle checkbox">\n                <input id="check_{{$index}}" type="checkbox">\n                <label for="check_{{$index}}"></label>\n            </div>\n        </td>\n        <td>\n            <input type="date">\n        </td>\n        <td>\n            <select class="ui dropdown">\n                <option value="{{city.id}}" ng-repeat="city in vm.cities">{{city.name}}</option>\n            </select>\n        </td>\n        <td>\n            <div class="ui toggle checkbox">\n                <input id="check2_{{$index}}" type="checkbox">\n                <label for="check2_{{$index}}"></label>\n            </div>\n        </td>\n        <td>\n            <select class="ui dropdown">\n                <option selected="selected">1 {{\'BED\' | translate}}</option>\n                <option>2 {{\'BEDS\' | translate}}</option>\n            </select>\n        </td>\n    </tr>\n    </tbody>\n    <tfoot>\n    <tr class="active">\n        <td><b>{{\'COMMON_SETTINGS\' | translate}}</b></td>\n        <td>\n            <div class="ui toggle checkbox">\n                <input type="checkbox" checked="checked">\n                <label></label>\n            </div>\n        </td>\n        <td>\n            <input type="date">\n        </td>\n        <td>\n            <select class="ui dropdown">\n                <option value="{{city.id}}" ng-repeat="city in vm.cities">{{city.name}}</option>\n            </select>\n        </td>\n        <td>\n            <div class="ui toggle checkbox">\n                <input type="checkbox" checked="checked">\n                <label></label>\n            </div>\n        </td>\n        <td>\n            <select class="ui dropdown">\n                <option selected="selected">1 {{\'BED\' | translate}}</option>\n                <option>2 {{\'BEDS\' | translate}}</option>\n            </select>\n        </td>\n    </tr>\n    </tfoot>\n</table>\n\n\n<table class="ui basic table">\n    <tbody>\n    <tr>\n        <td><b>{{\'CHOOSE_ROOM\' | translate}}:</b></td>\n        <td>\n            <input type="date">\n        </td>\n        <td>\n            <select class="ui dropdown">\n                <option ng-repeat="city in vm.cities">{{city.name}}</option>\n            </select>\n        </td>\n        <td>\n\n        </td>\n        <td>\n            1 {{\'BED\' | translate}}: <b>4</b>\n        </td>\n        <td>\n            2 {{\'BEDS\' | translate}}: <b>2</b>\n        </td>\n    </tr>\n    </tbody>\n</table>\n</form>\n\n<div class="ui divider"></div>\n\n\n\n\n<div class="ui center aligned basic segment">\n  <div class="ui three column center aligned grid">\n\t<div class="column">\n\t  <div class="ui large pale button">\n\t\t<i class="cancel icon"></i>\n\t\t{{\'CANCEL\' | translate}}\n\t  </div>\n\t</div>\n\t<div class="column">\n\t  <button type="submit" class="ui navy large button" ng-disabled="{{!vm.parent.isVisit}}">\n\t\t<i class="save icon"></i>\n\t\t{{\'SAVE\' | translate}}\n\t  </button>\n\t</div>\n\t<div class="column">\n\t  <div class="ui large navy button" ng-disabled="{{!vm.parent.isVisit}}">\n\t\t<i class="mail icon"></i>\n\t\t{{\'GENERATE_INVITATIONS\' | translate}}\n\t  </div>\n\t</div>\n  </div>\n</div>\n\n\n\n<!-- <div class="ui segment two column grid">\n\n    <div class="ui column">\n\n        <div class="large ui positive button">\n            <i class="icon checkmark"></i>\n            Save\n        </div>\n\n        <div class="large ui negative button">\n            <i class="icon cancel"></i>\n            Cancel\n        </div>\n\n    </div>\n\n    <div class="ui right aligned column">\n\n        <div class="large ui icon inverted blue button">\n            <a href=""><i class="icon mail"></i> Generate Invitations</a>\n        </div>\n\n    </div>\n\n</div> -->\n\n\n\n</div>'),$templateCache.put("app/campaigns/pages/templates/campaigns.drugstoresList.html",'<div ng-controller="CampaignsDrugstoresListController as vm">\n\n    <table class="ui table striped sortable listView">\n      <thead>\n      <tr>\n        <th></th>\n        <th>{{\'ID\' | translate}}</th>\n        <th>{{\'NAME\' | translate}}</th>\n        <th>{{\'CITY\' | translate}}</th>\n        <th>{{\'ZIP\' | translate}}</th>\n        <th>{{\'STREET\' | translate}}</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="drugstore in vm.drugstores | orderBy:\'name\'" ng-hide="vm.removeDrugstores && vm.removeDrugstores.indexOf(drugstore.id) > -1">\n        <td>\n          <input type="checkbox" ng-disabled="{{!vm.parent.isVisit || drugstore.negotiation_point}}" name="select-drugstore" ng-checked="drugstore.checked" ng-disabled="drugstore.disabled" ng-model="drugstore.checked" ng-change="vm.selectedDrugstoresList()">\n        </td>\n        <td ng-class="{\'lightblue\':vm.isNegotiationPoint(drugstore)}">{{drugstore.identifier}}</td>\n        <td ng-class="{\'lightblue\':vm.isNegotiationPoint(drugstore)}">{{drugstore.name}}</td>\n        <td>{{drugstore.cityName}}</td>\n        <td>{{drugstore.zip}}</td>\n        <td>{{drugstore.addressLine1}}</td>\n      </tr>\n      </tbody>\n    </table>\n\n\n\n\n<div class="ui center aligned basic segment">\n  <div class="ui two column center aligned grid">\n\t<div class="column">\n\t  <div class="ui large pale button">\n\t\t<i class="cancel icon"></i>\n\t\t{{\'CANCEL\' | translate}}\n\t  </div>\n\t</div>\n\t<div class="column">\n\t  <button type="submit" class="ui navy large button" ng-click="vm.detachDrugstoresConfirm()" ng-disabled="vm.lockForm || !vm.parent.isVisit ||  vm.step.readOnly">\n      <i class="save icon" ng-hide="vm.lockForm"></i>\n      <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n\t\t  {{\'SAVE\' | translate}}\n\t  </button>\n\t</div>\n  </div>\n</div>\n\n\n\n\n  <!-- <div class="ui segment two column grid">\n\n    <div class="ui column">\n\n      <button type="submit" class="large ui positive button" ng-click="vm.detachDrugstoresConfirm()">\n        <i class="icon checkmark"></i>\n        Save\n      </button>\n\n      <div class="large ui negative button">\n        <i class="icon cancel"></i>\n        Cancel\n      </div>\n\n    </div>\n\n    <div class="ui right aligned column">\n\n      <div class="large ui inverted blue button" ng-click = "vm.parent.prevGo()">\n        <i class="icon arrow left"></i> Previous\n      </div>\n\n      <div class="large ui inverted blue button" ng-click = "vm.parent.nextGo()">\n        <i class="icon arrow right"></i> Next\n      </div>\n\n    </div>\n\n  </div> -->\n\n\n<!-- <div class="ui segment two column grid">\n\n    <div class="ui column">\n\n        <button type="submit" class="large ui positive button" ng-click="vm.saveSelectedDrugstores()">\n            <i class="icon checkmark"></i>\n            Save\n        </button>\n\n        <div class="large ui negative button">\n            <i class="icon cancel"></i>\n            Cancel\n        </div>\n\n    </div>\n\n    <div class="ui right aligned column">\n\n        <div class="large ui inverted blue button" ng-click = "vm.parent.prevGo()">\n            <i class="icon arrow left"></i> Previous\n        </div>\n\n        <div class="large ui inverted blue button" ng-click = "vm.parent.nextGo()">\n            <i class="icon arrow right"></i> Next\n        </div>\n\n    </div>\n</div> -->\n\n  <!-- Modal Windows -->\n  <atl-modal-confirm-dialog modal-id="\'detachDrugstoresList\'" modal-title="\'PLEASE_CONFIRM\' | translate" on-confirm="vm.saveSelectedDrugstores()">\n\n    {{\'CONFIRM_DESPACH_DRUGSTORES\' | translate}}\n\n  </atl-modal-confirm-dialog>\n</div>\n'),$templateCache.put("app/campaigns/pages/templates/campaigns.finalReport.html",'<div ng-controller="CampaignsFinalReportController as vm">\n<form class="ui form" name="sellingFormFinRep" novalidate ng-submit="sellingFormFinRep.$valid && vm.saveSelling()">\n\n  <div class="ui basic segment collapsed">\n    <div class="ui three column left aligned grid">\n      <div class="left aligned column">\n        <p>{{\'PERIOD\' | translate}}: <b>{{vm.finalReportPeriod.start | date:\'dd.MM.yyyy\' }} — {{vm.finalReportPeriod.end | date:\'dd.MM.yyyy\'}}</b></p>\n      </div>\n      <div class="center aligned column">\n        <div ng-if="vm.messageSelling" class="{{vm.messageSellingClass}}">\n          <b>{{vm.messageSelling | translate}}</b><br>\n          <span ng-if="vm.addMessageSelling">{{vm.addMessageSelling}}</span>\n        </div>\n        <div ng-if="vm.showDebugMessage">\n          step status: <b>{{vm.step.status}}</b><br>\n          {{vm.step.debug}}<br>\n          <!--\n          step readonly: <b>{{vm.step.readOnly}}</b><br>\n          page readonly: <b>{{vm.pageReadOnly}}</b><br>\n          offlineMode: <b>{{vm.parent.offlineMode}}</b><br>\n          is Generated: <b>{{vm.isGenerated}}</b><br>\n          -->\n          <!--<b>ng-disabled="vm.lockForm || !vm.parent.isSignature || vm.step.readOnly || vm.pageReadOnly || vm.parent.offlineMode"</b>-->\n        </div>\n      </div>\n      <div class="right aligned column" ng-if="vm.column.btn_photo.visible">\n        <div class="ui marine button">\n          <label for="uploadFormFile"><i class="download icon"></i>\n            <input type="hidden" name="uploadFormFileId">\n            <input type="file" capture="camera" accept="image/*" id="uploadFormFile" style="display:none">\n            {{vm.column.btn_photo.label}}\n          </label>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="ui three column left aligned grid" ng-if="vm.dataFromKamSoftMkSh">\n    <div class="left aligned six wide column">\n      <div class="ui left floated compact menu no-border">\n        <button type="button" class="ui marine button" ng-click="vm.parent.getKamSoftDataDailyMarketShareReports([vm.parent.period.start, vm.parent.period.now])" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n          <i class="download icon"></i>\n          {{\'GET_MARKET_SHARE\' | translate}}\n        </button>\n      </div>\n      <div class="ui left floated compact menu no-border">\n        <span class="campaign-inner-counter-apteka">\n\t\t\t    <img src="assets/img/icons/campaigns/campaign-icons/apteka-orchid-smaller.png">\n\t\t\t    <span class="floating ui teal circular tiny label">{{vm.parent.counterKamsoftDrugstores}}</span>\n\t\t    </span>\n      </div>\n    </div>\n    <div class="center aligned six wide column"></div>\n    <div class="right aligned four wide column"></div>\n  </div>\n\n  <div class="ui three column left aligned grid" ng-if="vm.dataFromKamSoft">\n    <div class="left aligned four wide column">\n      <button type="button" class="ui marine button" ng-click="vm.parent.showBarCodeScanner()" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n        <i class="edit icon"></i>\n        QR Code\n      </button>\n    </div>\n\n    <div class="center aligned eight wide column">\n      <div class="ui two column left aligned grid">\n        <div class="left aligned nine wide column">\n          <button type="button" class="ui green button" ng-class="{\'orange\': vm.canEditData}" ng-click="vm.editKamSoftData()" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n            <i class="edit icon"></i>\n            Edit KAM Soft data\n          </button>\n        </div>\n        <div class="left aligned seven wide column">\n          <div class="ui buttons">\n            <div class="ui left icon compact button" ng-class="{\'green\': vm.kamSoftPicture && vm.kamSoftPicture.src, \'pale\': vm.parent.lockForm}">\n              <label for="takePictureKam" class="no-space"><i class="camera icon"></i>\n                <input type="hidden" name="kamPicture" ng-model="vm.kamSoftPicture">\n                <input type="file" capture="camera" accept="image/*" id="takePictureKam" style="display:none" onchange="angular.element(this).scope().$parent.loadPhoto(this, angular.element(this).scope().vm.kamSoftPicture)" ng-disabled="vm.lockForm || !vm.canEditData">\n                Photo\n              </label>\n            </div>\n            <div class="ui compact button grayb" ng-class="{\'pale\': vm.parent.lockForm}" ng-click="vm.showKamSoftPicture()"><i class="unhide icon"></i></div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="right aligned four wide column">\n      <!--\n      <button type="button" class="ui marine button" ng-click="vm.parent.getKamSoftData()" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n        <i class="download icon"></i>\n        Get KAM Soft data\n      </button>\n      -->\n    </div>\n\n  </div>\n  <br>\n\n  <div class="ui center aligned attached tertiary collapsed segment segment-heading" ng-if="vm.proposalContractName">\n    {{vm.proposalContractName}}\n  </div>\n\n  <div class="ui left aligned megacollapsed tertiary segment" ng-if="vm.column[\'sellIn\'].visibility || vm.column[\'sellOut\'].visibility">\n    <atl-accordion>\n      <div class="title active left-padded">\n        <i class="dropdown icon"></i>\n        <span>{{\'DRUGS_GROUPS\' | translate}}</span>\n      </div>\n      <div class="content active">\n        <table class="ui striped table">\n          <thead>\n          <tr>\n            <th class="one wide">Group</th>\n            <th class="six wide">{{\'NAME\' | translate}}</th>\n            <th ng-if="vm.column[\'sellIn\'].visibility">{{vm.column[\'sellIn\'].label}}</th>\n            <th ng-if="vm.column[\'sellOut\'].visibility">{{vm.column[\'sellOut\'].label}}</th>\n            <th ng-if="vm.column[\'stock\'].visibility">{{vm.column[\'stock\'].label}}</th>\n          </tr>\n          </thead>\n          <tbody ng-repeat="group in vm.groupBy">\n          <tr ng-repeat="drug in group.groups">\n            <td rowspan="{{group.groups.length}}" ng-if="$index == 0"><div class="ui blue ribbon label">{{group.name}}</div></td>\n            <td>{{drug.name}}</td>\n            <td ng-if="vm.column[\'sellIn\'].visibility"><input type="number" step="1" value="0" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || !vm.canEditData" ng-model="drug.sellIn" ng-change="vm.changeSellField(group, drug, \'sellIn\')" ng-style="vm.selling_style"></td>\n            <td ng-if="vm.column[\'sellOut\'].visibility"><input type="number" step="1" value="0" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || !vm.canEditData" ng-model="drug.sellOut" ng-change="vm.changeSellField(group, drug, \'sellOut\')" ng-style="vm.selling_style"></td>\n            <td ng-if="vm.column[\'stock\'].visibility"><input type="number" step="1" value="0" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || !vm.canEditData" ng-model="drug.stock" ng-change="vm.changeSellField(group, drug, \'stock\')"></td>\n          </tr>\n          </tbody>\n          <tbody>\n          <tr class="warning">\n            <td></td>\n            <td><b>{{\'TOTAL_MONEY\' | translate}}</b></td>\n            <td ng-if="vm.column[\'sellIn\'].visibility"><input type="text" value="{{vm.sellInTotal || 0 | number:2}}" readonly="readonly"></td>\n            <td ng-if="vm.column[\'sellOut\'].visibility"><input type="text" value="{{vm.sellOutTotal || 0 | number:2}}" readonly="readonly"></td>\n            <td ng-if="vm.column[\'stock\'].visibility"><input type="text" value="{{vm.stockTotal || 0 | number:2}}" readonly="readonly"></td>\n          </tr>\n          </tbody>\n        </table>\n      </div>\n    </atl-accordion>\n  </div>\n\n  <!-- Progress Bars -->\n  <div ng-if="vm.column[\'sellIn\'].visibility || vm.column[\'sellOut\'].visibility">\n\n    <div class="ui basic megacollapsed attached segment" ng-repeat="group in vm.groupBy">\n\n      <div class="ui center aligned attached tertiary collapsed segment segment-heading">{{group.name}}</div>\n\n      <!-- progressbar content div -->\n      <div class="ui attached segment">\n\n        <div class="ui grid" ng-if="vm.properties[group.id].sellIn.visible">\n\n          <div class="ui three wide column center aligned">\n            <div class="ui basic segment">\n              <img src="assets/img/icons/campaigns/sell-in.png">\n              <br>\n              <b class="lightblue small-header">{{\'SELL_IN\' | translate}}</b>\n            </div>\n          </div>\n\n          <div class="ui ten wide column">\n            <div class="ui two column grid">\n              <div class="column">\n                <small>0%</small>\n              </div>\n              <div class="column right aligned">\n                <small>100%</small>\n              </div>\n            </div>\n\n            <div class="ui small progress teal">\n              <div class="bar" style="width:{{group.sellInPointsProgress}}%">\n                <div class="progress">{{group.sellInRealPointsProgress}}%</div>\n              </div>\n              <div class="for-small-bar" ng-if="group.sellInHundredsNumber">\n                <div class="bar small-bar" ng-repeat="n in [] | range:group.sellInHundredsNumber" style="width:{{group.sellInRealPointsProgress-100 * (n+1) >100 ? 100 : group.sellInRealPointsProgress-100 * (n+1)}}%; background: #{{vm.colors[n]}} !important">\n                </div>\n              </div>\n              <div class="mark light" style="left:{{group.sellInMinPercent}}%"><small class="mark-text">{{group.sellInMinPercent}}%</small></div>\n              <div class="label">{{item.name}}</div>\n            </div>\n          </div>\n\n          <div class="ui three wide column">\n            <div class="ui basic segment" ng-if="vm.properties[group.id].earned_visibility.sellIn">\n              <b>{{group.sellInMoney * vm.multiplier | number : group.sellInSign != \'P\' ? 2 : 0 || 0.00}} {{group.sellInSign}}</b>\n            </div>\n          </div>\n\n        </div>\n\n        <div class="ui grid" ng-if="vm.properties[group.id].sellOut.visible">\n\n          <div class="ui three wide column center aligned">\n            <div class="ui basic segment">\n              <img src="assets/img/icons/campaigns/sell-out.png">\n              <br>\n              <b class="lightblue small-header">{{\'SELL_OUT\' | translate}}</b>\n            </div>\n          </div>\n\n          <div class="ui ten wide column">\n\n            <div class="ui two column grid">\n              <div class="column">\n                <small>0%</small>\n              </div>\n              <div class="column right aligned">\n                <small>100%</small>\n              </div>\n            </div>\n\n            <div class="ui small progress teal">\n              <div class="bar" style="width:{{group.sellOutPointsProgress}}%">\n                <div class="progress">{{group.sellOutRealPointsProgress}}%</div>\n              </div>\n              <div class="for-small-bar" ng-if="group.sellOutHundredsNumber">\n                <div class="bar small-bar" ng-repeat="n in [] | range:group.sellOutHundredsNumber" style="width:{{group.sellOutRealPointsProgress-100 * (n+1) >100 ? 100 : group.sellOutRealPointsProgress-100 * (n+1)}}%; background: #{{vm.colors[n]}} !important">\n                </div>\n              </div>\n              <div class="mark light" style="left:{{group.sellOutMinPercent}}%"><small class="mark-text">{{group.sellOutMinPercent}}%</small></div>\n              <div class="label">{{item.name}}</div>\n            </div>\n\n          </div>\n          <div class="ui three wide column">\n            <div class="ui basic segment" ng-if="vm.properties[group.id].earned_visibility.sellOut && !vm.dataFromKamSoftMkSh">\n              <b>{{group.sellOutMoney * vm.multiplier | number : group.sellOutSign != \'P\' ? 2 : 0 || 0.00}} {{group.sellOutSign}}</b>\n            </div>\n          </div>\n\n        </div>\n\n        <div class="ui grid" ng-if="vm.dataFromKamSoftMkSh">\n          <div class="ui three wide column center aligned">\n            <div class="ui basic segment">\n              <img src="assets/img/icons/campaigns/market-share.png">\n              <br>\n              <b class="lightblue small-header">Market Share</b>\n            </div>\n          </div>\n\n          <div class="ui ten wide column">\n            <div class="ui two column grid">\n              <div class="column">\n                <small>0%</small>\n              </div>\n              <div class="column right aligned">\n                <small>100%</small>\n              </div>\n            </div>\n\n            <div class="ui small progress teal">\n              <div class="bar" style="width:{{group.mkShPointsProgress}}%">\n                <div class="progress">{{group.mkShPointsProgress}}%</div>\n              </div>\n              <div class="mark red" style="left:{{group.sellOutMkSh}}%"><small class="mark-text">{{group.sellOutMkSh}}</small></div>\n              <div class="label"></div>\n            </div>\n          </div>\n\n          <div class="ui three wide column">\n            <div class="ui basic segment" ng-if="vm.properties[group.id].earned_visibility.sellOut">\n              <b>{{group.sellOutMoney * vm.multiplier | number : group.sellOutSign != \'P\' ? 2 : 0 || 0.00}} {{group.sellOutSign}}</b>\n            </div>\n          </div>\n\n        </div>\n\n      </div>\n    </div>\n\n    <div class="ui basic megacollapsed attached segment" ng-if="vm.dataFromKamSoftMkSh">\n      <div class="ui grid">\n        <div class="ui sixteen wide column">\n          <nvd3 options="options" data="chartData"></nvd3>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n  <!--- Gifts ---->\n  <div class="ui segment usual" ng-if="vm.gifts.length && (vm.column[\'sellIn\'].visibility || vm.column[\'sellOut\'].visibility)">\n\n    <div class="ui one column grid">\n      <div class="ui column basic segment collapsed">\n        <div class="ui center aligned tertiary collapsed segment segment-heading">{{\'GIFTS\' | translate}}</div>\n        <div class="ui basic segment">\n\n          <div class="ui divided grid">\n            <div class="ui sixteen wide column">\n              <div>{{\'RESERVED\' | translate}} {{\'POINTS\' | translate}} <b>{{vm.reservePoints}}</b> {{\'POINTS\' | translate}}</div>\n              <div ng-if="vm.reservePoints && (vm.variesAmountPoints * vm.multiplier - vm.reservePoints) >=0" class="positive-text">{{\'YOU_HAVE_ENOUGH_POINTS\' | translate}} ({{vm.variesAmountPoints * vm.multiplier}}) {{\'TO_GET_THE_RESERVED_GIFT\' | translate}}</div>\n              <div ng-if="vm.variesAmountPoints * vm.multiplier - vm.reservePoints <0" class="negative-text">{{\'YOU_HAVE_NOT_ENOUGH_POINTS\' | translate}} {{\'TO_GET_THE_RESERVED_GIFT\' | translate}}</div>\n            </div>\n            <div class="ui six wide column" ng-if="vm.parent.listDrugstores.length>1">\n              <div class="fluid ui navy button">\n                <i class="forward mail icon"></i>\n                {{\'MESSAGE_PRIZES_TO_CENTRAL\' | translate}}\n              </div>\n              <br>\n              <div class="fluid ui navy button" ng-click="vm.giftsDistribution()">\n                <i class="random icon"></i>\n                {{\'DISPOSES_AWARDS\' | translate}}\n              </div>\n            </div>\n\n            <div class="ui ten wide left aligned column">\n\n              <div class="ui horizontal list" ng-if="vm.dominant == \'sellIn\'">\n                <div class="item item-gift" ng-repeat="obj in vm.giftsDropped">\n                  <div class="ui segment {{obj.color}} button drag-object">\n                    <div class="content">\n                      <div class="img">\n                        <img ng-if="obj.image" ng-src="{{obj.image}}" id="photo1_{{$index}}" alt="photo">\n                        <i ng-hide="obj.image" class="gift big icon"></i>\n                      </div>\n                      <div class="header" style="font-size: smaller">{{obj.name}}</div>\n                      <div class="ui two column grid small-text"><small class="column center aligned">{{obj.points}}<i ng-if="obj.points">p</i></small><small class="column center aligned">{{obj.amountDropped}}</small></div>\n                    </div>\n                    <div ng-drag="true" ng-drag-data="obj" ng-drag="true" ng-drag-data="obj" ng-drag-start="vm.onDragStart($data,$event)" ng-drag-stop="vm.onDragEnd($data,$event)"></div>\n                    <div class="ui floating circular label clickable" ng-click="vm.showGiftInfo(obj)"><i class="icon info"></i></div>\n                  </div>\n                </div>\n              </div>\n\n              <div class="ui horizontal list" ng-if="vm.dominant == \'sellOut\'">\n                <div class="item item-gift" ng-repeat="obj in vm.gifts">\n                  <div class="ui segment {{obj.color}} button drag-object">\n                    <div class="content">\n                      <div class="img">\n                        <img ng-if="obj.image" ng-src="{{obj.image}}" id="photo2_{{$index}}" alt="photo">\n                        <i ng-hide="obj.image" class="gift big icon"></i>\n                      </div>\n                      <div class="header" style="font-size: smaller">{{obj.name}}</div>\n                      <div class="ui two column grid small-text"><small class="column center aligned">{{obj.points}}<i ng-if="obj.points">p</i></small><small class="column center aligned">{{obj.amount}}</small></div>\n                    </div>\n                    <div ng-drag="true" ng-drag-data="obj" ng-drag="true" ng-drag-data="obj" ng-drag-start="vm.onDragStart($data,$event)" ng-drag-stop="vm.onDragEnd($data,$event)"></div>\n                    <div class="ui floating circular label clickable" ng-click="vm.showGiftInfo(obj)"><i class="icon info"></i></div>\n                  </div>\n                </div>\n              </div>\n\n              <div class="ui segment" ng-if="vm.bagVisibility && vm.dominant == \'sellOut\'" ng-drop="true" ng-drop-success="vm.onDropComplete($data,$event)">\n                <div class="ui top left attached label">{{\'BAG_WITH_GIFTD\' | translate}} <span class="positive-text">{{\'TOTAL_RESERVED\' | translate}}: {{vm.reservePoints}}</span></div>\n                <div>\n                  <div class="ui horizontal list">\n                    <div class="item" ng-repeat="obj in vm.giftsDropped">\n                      <div class="ui {{obj.color}} message" ng-drag="true" ng-drag-data="obj" ng-drag-stop="vm.onDroppedDragEnd($data,$event)">\n                        <div class="content">\n                          <div class="header" style="font-size: x-small">{{obj.title | limitTo: 15}}</div>\n                          <div class="ui two column grid"><span class="column center aligned" ng-if="obj.pointsDropped">{{obj.pointsDropped}}p</span><span class="column right aligned">{{obj.amountDropped}}</span></div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n          </div>\n\n          <table class="ui fixed table striped" ng-if="vm.parent.listDrugstores.length > 1 && vm.giftsForDrugstores && vm.variesAmountPoints * vm.multiplier - vm.reservePoints >=0 && vm.giftsDropped.length">\n            <thead>\n            <tr>\n              <th class="six wide">{{\'NAME\' |translate}}</th>\n              <th ng-repeat="obj in vm.giftsDropped">{{obj.name}}</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="pharmacy in vm.parent.listDrugstores">\n              <td>{{pharmacy.name}}</td>\n              <td ng-repeat="obj in vm.giftsDropped">\n                <input type="number" ng-init="!pharmacy.gifts[obj.id].number ? pharmacy.gifts[obj.id].number = 0 : undefined" ng-model="pharmacy.gifts[obj.id].number" min="0" max="{{obj.remains + pharmacy.gifts[obj.id].number}}" ng-change="vm.changeAmountGiftsForDrugstore(obj, pharmacy)">\n              </td>\n            </tr>\n            </tbody>\n            <tfoot>\n            <tr class="active">\n              <td>remains:</td>\n              <td ng-repeat="obj in vm.giftsDropped">\n                {{obj.remains}}\n              </td>\n\n            </tr>\n            </tfoot>\n          </table>\n\n\n        </div>\n\n      </div>\n\n    </div>\n\n  </div>\n\n  <div class="ui basic segment" ng-if="!vm.waiting">\n\n    <div class="ui segments">\n\n      <div class="ui grid center aligned">\n\n        <div class="ui secondary segment sixteen wide column">\n\n          <div class="ui grid">\n            <div class="ten wide column left aligned"></div>\n            <!--\n            <div class="three wide column center aligned">\n              <b>{{\'SYSTEM\' | translate}}</b>\n            </div>\n            -->\n            <div class="two wide column left aligned">\n              <b>{{\'DRUGGIST\' | translate}}</b>\n            </div>\n            <div class="two wide column left aligned">\n              <b>{{\'REP\' | translate}}</b>\n            </div>\n            <div class="two wide column"></div>\n          </div>\n\n          <!--\n          <div class="ui segment" ng-if="vm.column[\'sellIn\'].visibility || vm.column[\'sellOut\'].visibility">\n            <div class="ui grid">\n              <div class="six wide column left aligned">\n                {{\'AMOUNT_VARIES\' | translate}}:\n              </div>\n              <div class="four wide column right aligned">\n                {{vm.variesAmount * vm.multiplier | number : 2 || 0}} <span ng-if="vm.variesAmountPoints">/ {{vm.variesAmountPoints * vm.multiplier | number : 0}} P</span>\n              </div>\n            </div>\n          </div>\n\n          <div class="ui segment" ng-if="vm.visibleFixedAmount">\n            <div class="ui grid">\n              <div class="six wide column left aligned">\n                {{vm.labelFixedAmount}}:\n              </div>\n              <div class="four wide column right aligned">\n                {{vm.fixedAmountFinRep * vm.multiplier | number : vm.earnedInFixedAmount == \'money\' ? 2 : 0}} <span ng-if="vm.earnedInFixedAmount != \'money\'">P</span>\n              </div>\n            </div>\n          </div>\n          -->\n          <!-- Services -->\n          <div class="ui basic megacollapsed segment">\n            <div class="ui segments" ng-repeat="service in vm.services">\n              <div class="ui segment" ng-class="{\'yellow inverted\': service.warning, \'red inverted\': service.blockPayment, \'marine\': !service.blockPayment && !service.warning}">\n\n                <div class="ui grid">\n                  <div class="six wide column left aligned">\n                    {{service.title}}\n                  </div>\n                  <div class="four wide column right aligned">\n                    {{service.blockPayment && !service.repDoServicePaid ? 0 : service.earns | number : 2}}\n                  </div>\n\n                  <div class="two wide column right aligned">\n                      <div class="ui toggle checkbox" ng-if="service.proposal_earns" ng-class="{\'red\':service.is_requirements_met == 0}">\n                        <input id="checkbox2_{{$index}}" type="checkbox" ng-model="service.is_requirements_met" ng-disabled="true" ng-true-value="true" ng-false-value="false">\n                        <label for="checkbox2_{{$index}}"></label>\n                      </div>\n                  </div>\n                  <div class="two wide column right aligned">\n                      <div class="ui toggle checkbox">\n                        <input id="checkbox1_{{$index}}" type="checkbox" ng-model="service.repDoServicePaid" ng-click="vm.makeServicePaid(service)" ng-disabled="vm.step.readOnly || vm.pageReadOnly" ng-true-value="true" ng-false-value="false">\n                        <label for="checkbox1_{{$index}}"></label>\n                      </div>\n                  </div>\n                  <div class="two wide column right aligned">\n                    <div class="ui blue icon" ng-click="vm.parent.listDrugstores.length > 1 ? service.showServiceDrugstores = !service.showServiceDrugstores: \'\'"><i class="caret down large icon" ng-if="!service.showServiceDrugstores"></i><i class="caret up large icon" ng-if="service.showServiceDrugstores"></i></div>\n                  </div>\n                </div>\n              </div>\n              <div ng-if="service.showServiceDrugstores" class="ui segment">\n                <div class="ui segment tertiary no-border collapsed" ng-repeat="drugstoreService in service.drugstores" ng-class="{\'text-yellow\': drugstoreService.service.warning, \'text-red\': drugstoreService.service.blockPayment, \'text-marine\': !drugstoreService.service.blockPayment}" style="margin-right: -1em">\n                  <div class="ui grid">\n                    <div class="six wide column left aligned clickable" ng-click="vm.parent.selectDrugstore(drugstoreService.drugstore_id)">\n                      <b>{{drugstoreService.drugstoreName}}</b><br>\n                      <span class="neutral-text">{{drugstoreService.address}}</span>\n                    </div>\n                    <div class="four wide column right aligned">\n                      <b>{{drugstoreService.service.blockPayment ? 0 : drugstoreService.service.earns * service.cycleValue | number : 2}}</b>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n          </div>\n\n          <!-- Additional Services -->\n          <div class="ui segment" ng-if="vm.allAddServicesVisible">\n            <div class="ui segments" ng-repeat="addService in vm.addServices" ng-if="addService.is_visible_in_mobile">\n              <div class="ui grid">\n                <div class="six wide column left aligned">\n                  {{addService.title}}\n                </div>\n                <div class="four wide column right aligned">\n                  {{addService.blockPayment && !addService.repDoServicePaid ? 0 : addService.price | number : 2}}\n                </div>\n\n                <div class="two wide column right aligned">\n                  <div class="ui toggle checkbox" ng-class="{\'red\':addService.is_requirements_met == 0}">\n                    <input id="checkbox3_{{$index}}" type="checkbox" ng-model="addService.is_requirements_met" ng-disabled="true" ng-true-value="true" ng-false-value="false">\n                    <label for="checkbox3_{{$index}}"></label>\n                  </div>\n                </div>\n                <div class="two wide column right aligned">\n                  <div class="ui toggle checkbox">\n                    <input id="checkbox11_{{$index}}" type="checkbox" ng-model="addService.repDoServicePaid" ng-click="vm.makeServicePaid(addService, true)" ng-disabled="vm.step.readOnly || vm.pageReadOnly" ng-true-value="true" ng-false-value="false">\n                    <label for="checkbox11_{{$index}}"></label>\n                  </div>\n                </div>\n                <div class="two wide column right aligned">\n\n                </div>\n              </div>\n            </div>\n\n          </div>\n          <div class="ui segment">\n            <div class="ui grid">\n              <div class="six wide column left aligned">\n                <b>{{\'AMOUNT_SERVICES\' | translate}}</b>:\n              </div>\n              <div class="four wide column right aligned">\n                {{vm.totalServices | number : 2}}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n\n  </div>\n\n  <div class="top-padded" ng-if="!vm.waiting">\n    {{totalAmount=vm.totalAmountFinRep();""}}\n    <div class="ui center aligned collapsed segment marine-bordered">\n      <table class="ui most basic table">\n        <tr ng-if="vm.column[\'sellIn\'].visibility || vm.column[\'sellOut\'].visibility">\n          <td class="four wide"></td>\n          <td class="six wide">{{\'AMOUNT_VARIES\' | translate}}:</td>\n          <td class="six wide">{{vm.variesAmount * vm.multiplier | number : 2 || 0}} <span ng-if="vm.earnedInFixedAmount != \'money\'">/ {{vm.variesAmountPoints * vm.multiplier | number : 0}} P</span></td>\n        </tr>\n        <tr ng-if="vm.visibleFixedAmount">\n          <td class="four wide"></td>\n          <td class="six wide">{{vm.labelFixedAmount}}:</td>\n          <td class="six wide">{{vm.fixedAmountFinRep * vm.multiplier | number : vm.earnedInFixedAmount == \'money\' ? 2 : 0}} <span ng-if="vm.earnedInFixedAmount != \'money\'">P</span></td>\n        </tr>\n        <tr ng-if="vm.services">\n          <td class="four wide"></td>\n          <td class="six wide">{{\'AMOUNT_SERVICES\' | translate}}:</td>\n          <td class="six wide">{{vm.totalServices | number : 2}}</td>\n        </tr>\n        <tr class="active">\n          <td class="four wide"></td>\n          <td class="six wide"><b>{{\'TOTAL_EARNINGS\' | translate}}:</b></td>\n          <td class="six wide"><b>{{vm.totalAmount | number : 2}} {{vm.totalAmountCopy !=null ? \'(A:\'+vm.totalAmountCopy+\')\':\'\'}}<span ng-if="vm.earnedInFixedAmount != \'money\'">/ {{totalAmount.totalPoints || 0}} P</span></b></td>\n        </tr>\n      </table>\n    </div>\n  </div>\n  <!-- Buttons -->\n  <div class="ui center aligned basic segment">\n\n    <div class="ui center aligned grid">\n\n      <div class="four wide column">\n        <div class="ui large pale button">\n          <i class="cancel icon"></i>\n          {{\'CANCEL\' | translate}}\n        </div>\n      </div>\n\n      <div class="six wide column">\n        <!--ng-click="vm.sendFinalReport()"-->\n        <button type="submit" class="ui navy large button" ng-class="{\'pale\':vm.pageReadOnly}" ng-disabled="vm.waiting || vm.lockForm || vm.parent.lockForm || vm.step.readOnly || vm.pageReadOnly || vm.parent.offlineMode || vm.specialDisable">\n          <i class="save icon" ng-hide="vm.lockForm || vm.parent.lockForm"></i>\n          <span class="ui active mini inline loader" ng-if="vm.lockForm || vm.parent.lockForm"></span>\n          {{\'GENERATE_FINAL_REPORT\' | translate}}\n        </button>\n      </div>\n\n      <div class="six wide column">\n        <button type="button" class="ui navy large button" ng-disabled="vm.waiting || !vm.isSendToCompany || vm.lockForm || vm.step.readOnly || vm.pageReadOnly || vm.parent.offlineMode" ng-click="vm.finishCampaign()">\n          <i class="send icon" ng-hide="vm.lockForm"></i>\n          <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n          {{\'SEND_TO_COMPANY\' | translate}}\n        </button>\n      </div>\n\n    </div>\n\n  </div>\n</form>\n\n<atl-modal-confirm-dialog modal-id="\'showAttentionNotEqualSum\'" modal-title="\'WARNING\' | translate">\n  <p>\n    Raport nie może być potwierdzony. Twoje stanowisko jest odmienne od stanowiska Apteki. Prosimy o ujednolicenie stanowisk!\n  </p>\n</atl-modal-confirm-dialog>\n<atl-modal-confirm-dialog modal-id="\'showAttentionTotalZero\'" modal-title="\'WARNING\' | translate">\n  <p>\n    Suma wynosi zero. Raport nie może być potwierdzony.\n  </p>\n</atl-modal-confirm-dialog>\n<atl-modal-confirm-dialog modal-id="\'showAttentionPaid\'" modal-title="\'WARNING\' | translate" on-confirm="vm.finishCampaign(true)">\n  <p>\n    Raport końcowy zostanie wysłany do firmy. Jeśli zawarte w nim stanowisko jest odmienne od ustaleń systemu, to o rozbieżnościach zostanie poinformowany RKS!\n  </p>\n</atl-modal-confirm-dialog>\n\n<atl-modal-form-dialog modal-id="\'showGift\'" show-action="false" modal-title="\'GIFT\' | translate">\n  <div class="ui grid" style="height:430px; overflow: auto">\n    <div class="column center aligned">\n      <div class="ui items">\n\n        <div class="item">\n          <div class="ui one column center aligned grid">\n\n            <div class="column">\n              <img ng-src="{{vm.showGift.image}}" style="max-height:200px">\n            </div>\n\n            <div class="column">\n\n              <div class="header">{{vm.showGift.name}}</div>\n\n              <div class="description">\n                <p>{{vm.showGift.description}}</p>\n              </div>\n\n              <div class="extra">\n                <div class="ui grid center aligned gift-props">\n                  <div class="ui four wide column">\n                    {{\'MARK\' | translate}}: <span class="ui label">{{vm.showGift.mark}}</span>\n                  </div>\n                  <div class="ui four wide column">\n                    {{\'PRICE\' | translate}}: <span class="ui circular label">{{vm.showGift.price}}</span> {{vm.showGift.currency}}\n                  </div>\n                  <div class="ui four wide column" ng-if="vm.showGift.points">\n                    {{\'POINTS\' | translate}}: <span class="ui circular label">{{vm.showGift.points}}</span> p\n                  </div>\n                  <div class="ui four wide column" ng-if="vm.showGift.points">\n                    {{\'AMOUNT\' | translate}}: <span class="ui circular label">{{vm.showGift.amount}}</span>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n</atl-modal-form-dialog>\n\n<atl-modal-form-dialog modal-id="\'showKamSoftPicture\'" show-action="false" modal-title="\'PHOTO\' | translate">\n  <div class="ui grid" style="height:550px">\n    <div class="center aligned one column row">\n      <div class="column">\n        <img ng-src="{{vm.showImg}}" style="max-height:500px">\n      </div>\n    </div>\n  </div>\n</atl-modal-form-dialog>\n</div>\n'),
$templateCache.put("app/campaigns/pages/templates/campaigns.generalInfo.html","<div ng-controller=\"CampaignsGeneralInfoController as vm\">\n  <div class=\"ui basic segment two column grid label-marked\">\n\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_id'] ? vm.page.properties['ds_id'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_id'].label || ('ID' | translate)}}:</label> <label><strong>{{vm.drugstore.identifier}}</strong></label>\n    </div>\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_nip'] ? vm.page.properties['ds_nip'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_nip'].label || ('NIP' | translate)}}:</label> <label><strong>{{vm.drugstore.NIP}}</strong></label>\n    </div>\n\n    <div class=\"column\">\n      <label>Nazwa Firmy:</label> <label><strong>{{vm.drugstore.fullname | uppercase}}</strong></label>\n    </div>\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_name'] ? vm.page.properties['ds_name'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_name'].label || ('NAME' | translate)}}:</label> <strong>{{vm.drugstore.name | uppercase}}</strong>\n    </div>\n\n    <div class=\"column\">\n      <label>Adres Firmy 1:</label> <label><strong>{{vm.drugstore.juridical_address.address_line_1}}</strong></label>\n    </div>\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_address_line_1'] ? vm.page.properties['ds_address_line_1'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_address_line_1'].label || (('ADDRESS_LINE' | translate) + '1')}}:</label> <label><strong>{{vm.drugstore.address.address_line_1}}</strong></label>\n    </div>\n\n    <div class=\"column\">\n      <label>Adres Firmy 2:</label> <label><strong>{{vm.drugstore.juridical_address.address_line_2}}</strong></label>\n    </div>\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_address_line_2'] ? vm.page.properties['ds_address_line_2'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_address_line_2'].label || (('ADDRESS_LINE' | translate) + '2')}}:</label> <label><strong>{{vm.drugstore.address.address_line_2}}</strong></label>\n    </div>\n\n    <div class=\"column\">\n      <label>KRS:</label> <label><strong>{{vm.drugstore.krs != '0000000000' ? vm.drugstore.krs : ''}}</strong></label>\n    </div>\n    <div class=\"column\">\n      <label>Regon:</label> <label><strong>{{vm.drugstore.regon}}</strong></label>\n    </div>\n\n    <div class=\"column\">\n      <label>Miasto Firmy:</label> <label><strong>{{vm.drugstore.juridical_address.city.name}}</strong></label>\n    </div>\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_city'] ? vm.page.properties['ds_city'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_city'].label || ('CITY' | translate)}}:</label> <label><strong>{{vm.drugstore.address.city.name}}</strong></label>\n    </div>\n\n    <div class=\"column\">\n      <label>Kod Firmy:</label> <label><strong>{{vm.drugstore.juridical_address.zip}}</strong></label>\n    </div>\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_zip'] ? vm.page.properties['ds_zip'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_zip'].label || ('ZIP' | translate)}}:</label> <label><strong>{{vm.drugstore.address.zip}}</strong></label>\n    </div>\n\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_email'] ? vm.page.properties['ds_email'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_email'].label || ('EMAIL' | translate)}}:</label> <label><a href=\"mailto:{{vm.drugstore.email}}\">{{vm.drugstore.email}}</a></label>\n    </div>\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_phone'] ? vm.page.properties['ds_phone'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_phone'].label || ('PHONE' | translate)}}:</label> <label><strong>{{vm.drugstore.address.phone}}</strong></label>\n    </div>\n\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_negotiation_point'] ? vm.page.properties['ds_negotiation_point'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_negotiation_point'].label || ('NEGOTIATION_POINT' | translate)}}:</label> <label><strong>{{ vm.drugstore.negotiation_point === true ? ('YES' | translate) : ('NO' | translate) }}</strong></label>\n    </div>\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_selling_point'] ? vm.page.properties['ds_selling_point'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_selling_point'].label || ('SELLING_POINT' | translate)}}:</label> <label><strong>{{ vm.drugstore.selling_point === true ? ('YES' | translate) : ('NO' | translate) }}</strong></label>\n    </div>\n\n    <div class=\"column\">\n      <label>{{'DRUGSTORES_NETWORK' | translate}}:</label> <label><strong>{{vm.drugstore.drugstores_network.name}}</strong></label>\n    </div>\n    <div class=\"column\" ng-if=\"vm.page.properties['ds_category'] ? vm.page.properties['ds_category'].visible == 'true' : 'true'\">\n      <label>{{vm.page.properties['ds_category'].label || ('CATEGORY' | translate)}}:</label> <label><strong>{{vm.drugstore.category.name}}</strong></label>\n    </div>\n\n    <div class=\"column\">\n      <label>{{'NUMBER_OF_SELLING_POINTS' | translate}}:</label> <label><strong>{{vm.drugstore.selling_points_number}}</strong></label>\n    </div>\n    <div class=\"column\">\n    </div>\n\n    <div class=\"ui bottom right attached icon massive transparent label\" ng-if=\"!vm.step.readOnly\">\n      <a ng-click=\"!vm.step.readOnly ? vm.editGeneralInfo(): ''\">\n        <i class=\"pencil icon\"></i>\n      </a>\n    </div>\n  </div>\n\n  <br clear=\"all\">\n  \n\n  <div class=\"ui main container\">\n    <!--\n    <h3> <div class=\"ui icon button basic black\">\n        <i class=\"add user icon\"></i>\n    </div> </h3>\n    -->\n    <ng-include src=\"'app/clients/mainInfo/clients.mainInfo.staff.html'\" ng-if=\"vm.page.properties['ds_employees_table'] ? vm.page.properties['ds_employees_table'].visible == 'true' : 'true'\"></ng-include>\n\n    <!-- <div class=\"ui divider\"></div> -->\n\n    <!-- div class=\"ui center aligned basic segment\">\n\n      <div class=\"ui paled button spaced\" ng-if=\"vm.page.properties['ds_confirm_frame_contract_signing'] ? vm.page.properties['ds_confirm_frame_contract_signing'].visible == 'true' : 'true'\">\n        <i class=\"icon edit\"></i>\n        {{vm.page.properties['ds_confirm_frame_contract_signing'].label || ('CONFIRM_FRAME_CONTRACT_SIGNING' | translate)}}\n      </div>\n\n      <div class=\"ui paled button spaced\" ng-if=\"vm.page.properties['ds_frame_contract_print'] ? vm.page.properties['ds_frame_contract_print'].visible == 'true' : 'true'\">\n        <i class=\"icon print\"></i>\n        {{vm.page.properties['ds_frame_contract_print'].label || ('FRAME_CONTRACT_PRINT' | translate)}}\n      </div>\n\n      <div class=\"ui navy button spaced\" ng-if=\"vm.page.properties['ds_view_scanned_frame_contract'] ? vm.page.properties['ds_view_scanned_frame_contract'].visible == 'true' : 'true'\">\n        <i class=\"icon search\"></i>\n        {{vm.page.properties['ds_view_scanned_frame_contract'].label || ('VIEW_SCANNED_FRAME_CONTRACT' | translate)}}\n      </div>\n\n    </div -->\n\n    \n\t<!-- \n\t<div class=\"ui divider\"></div>\n\n    <div class=\"ui segment two column grid\">\n\n      <div class=\"ui column\">\n\n        <div class=\"large ui green button\" ng-click = \"vm.editGeneralInfo()\">\n          <i class=\"icon edit\"></i>\n          Edit\n        </div>\n\n      </div>\n\n      <div class=\"ui right aligned column\">\n        <div class=\"large ui inverted blue button\" ng-click = \"vm.parent.prevGo()\">\n          <i class=\"icon arrow left\"></i> Previous\n        </div>\n\n        <div class=\"large ui inverted blue button\" ng-click = \"vm.parent.nextGo()\">\n          <i class=\"icon arrow right\"></i> Next\n        </div>\n\n      </div>\n -->\n\n\n    </div>\n  </div>\n"),$templateCache.put("app/campaigns/pages/templates/campaigns.generalInfoEdit.html",'<div ng-controller="CampaignsGeneralInfoEditController as vm">\n\n    <form class="ui form" name="drugstoreForm" novalidate ng-submit="drugstoreForm.$valid && vm.onFormSubmit()">\n\n        <div class="ui basic segment">\n            <table class="ui most basic table">\n                <tr>\n                    <td class="collapsing">{{\'TITLE\' | translate}}:</td>\n                    <td><input type="text" name="name" ng-model="vm.drugstore.name"></td>\n                    <td class="collapsing">{{\'EMAIL\' | translate}}:</td>\n                    <td ng-attr-colspan="{{vm.getEmailColspan()}}">\n                        <input type="email" name="email" ng-trim="true" atl-lower-case ng-disabled="vm.parent.offlineMode || vm.isUnRegisterButtonVisible()" ng-attr-readonly="{{vm.isEmailReadonly()}}" ng-change="vm.onChangeEmail(drugstoreForm.email.$valid)" ng-model="vm.drugstore.email">\n                    </td>\n                    <td ng-if="vm.isButtonVisible()">\n                        <button class="ui icon button" ng-if="vm.isRegisterButtonVisible()" ng-disabled="vm.lockRegisterAtPortal || vm.parent.offlineMode" type="button">\n                            <i class="add user icon" ng-click="vm.showRegisterAtPortalWindow()"></i>\n                        </button>\n                        <button class="ui icon button" ng-if="vm.isUnRegisterButtonVisible()" ng-disabled="vm.parent.offlineMode" type="button">\n                            <i class="ban icon" ng-click="vm.showUnregisterAtPortalWindow()"></i>\n                        </button>\n                    </td>\n                </tr>\n                <tr>\n                    <td class="collapsing">{{\'ADDRESS_LINE\' | translate}} 1:</td>\n                    <td><input type="text" name="name" ng-model="vm.drugstore.address.address_line_1"></td>\n                    <td class="collapsing">{{\'ADDRESS_LINE\' | translate}} 2:</td>\n                    <td colspan="2"><input type="text" name="name" ng-model="vm.drugstore.address.address_line_2"></td>\n                </tr>\n                <tr>\n                    <td class="collapsing">{{\'CITY\' | translate}}:</td>\n                    <td>\n                      <input type="text" name="drugstores_network_type" ng-model="vm.drugstore.address.city.name" readonly="readonly">\n                    </td>\n                    <td class="collapsing">{{\'PHONE\' | translate}}:</td>\n                    <td colspan="2"><input type="text" name="name" ng-model="vm.drugstore.address.phone"></td>\n                </tr>\n                <tr>\n                    <td class="collapsing">{{\'COUNTRY\' | translate}}:</td>\n                    <td>\n                        <input type="text" name="name" ng-model="vm.drugstore.address.country.name" readonly="readonly">\n                        <input type="hidden" name="name" ng-model="vm.drugstore.address.region.id" readonly="readonly">\n                    </td>\n                    <td class="collapsing">{{\'ZIP\' | translate}}:</td>\n                    <td colspan="2"><input type="text" name="name" ng-model="vm.drugstore.address.zip"></td>\n                </tr>\n            </table>\n        </div>\n\n        <ng-include src="\'app/clients/mainInfo/clients.mainInfoEdit.staff.html\'"></ng-include>\n\n        <div class="ui divider" ng-if="vm.editDrugstore"></div>\n\n        <div class="ui center aligned basic segment">\n            <div class="ui two column center aligned grid">\n                <div class="column">\n                    <div class="ui large pale button" ng-click="vm.cancelEditDrugstore()">\n                        <i class="cancel icon"></i>\n                        {{\'CANCEL\' | translate}}\n                    </div>\n                </div>\n                <div class="column">\n                    <button type="submit" class="ui navy large button" ng-disabled="vm.lockForm || !vm.parent.isVisit || vm.step.readOnly">\n                      <i class="save icon" ng-hide="vm.lockForm"></i>\n                      <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n                      {{\'SAVE\' | translate}}\n                    </button>\n                </div>\n            </div>\n        </div>\n\n    </form>\n\n    <ng-include src="\'app/clients/mainInfo/clients.mainInfoEdit.modals.html\'" ng-if="vm.editDrugstore"></ng-include>\n\n    <ng-include src="\'app/clients/mainInfo/clients.mainInfoEdit.staff.modals.html\'" ng-if="vm.editDrugstore"></ng-include>\n\n</div>'),$templateCache.put("app/campaigns/pages/templates/campaigns.invoice.html",'<div ng-controller="CampaignsInvoiceController as vm">\n<form class="ui form" name="sellingFormFinRep" novalidate ng-submit="sellingFormFinRep.$valid && vm.saveInvoice()">\n  <div class="ui basic segment collapsed">\n\n    <div class="ui segment grid">\n      <div class="ui grid">\n\n        <div class="eight wide column">\n          <div class="twelve wide field">\n            <label>{{\'DATA\' | translate}}</label>\n            <input type="date" id="dateInvoice" ng-model="vm.campaignInvoice.date">\n          </div>\n          <div class="twelve wide field">\n            <div class="ui checkbox">\n              <input type="checkbox" ng-disabled="{{!vm.parent.isVisit}}" id="invoiceOriginal" tabindex="0" class="hidden" ng-model="vm.campaignInvoice.original">\n              <label for="invoiceOriginal">{{\'ORIGINAL\' | translate}}/{{\'COPY\' | translate}}</label>\n            </div>\n          </div>\n        </div>\n\n        <div class="eight wide column">\n          <div class="twelve wide field">\n            <label>{{\'DRUGSTORE_NAME\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" id="drugstoreName" ng-model="vm.drugstore.name">\n          </div>\n          <div class="twelve wide field">\n            <label>{{\'DRUGSTORE_ID\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" id="drugstoreIdentifier" ng-model="vm.drugstore.identifier">\n          </div>\n        </div>\n\n      </div>\n\n      <div class="ui divider"></div>\n      <br>\n      <div class="ui center align grid">\n        <div class="eight wide column right aligned">\n          <p><label>{{\'INVOICE_NO\' | translate}}:</label></p>\n        </div>\n        <div class="eight wide column left aligned">\n          <div class="four wide field">\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.campaignInvoice.invoiceNr">\n          </div>\n        </div>\n      </div><br>\n      <br>\n      <div class="ui divider"></div>\n\n      <div class="ui grid">\n        <div class="eight wide column">\n          <p></p><h4>{{\'DEALER\' | translate}}:</h4><p></p>\n          <div class="field">\n            <label>{{\'TITLE\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.drugstore.name">\n          </div>\n          <div class="field">\n            <label>{{\'ADDRESS\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.drugstore.address.address_line_1">\n          </div>\n          <div class="field">\n            <label>{{\'NIP\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.drugstore.NIP">\n          </div>\n          <div class="field">\n            <label>{{\'BILL_NUMBER\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.campaignInvoice.seller.accountNumber">\n          </div>\n\n        </div>\n\n\n        <div class="eight wide column">\n          <p></p><h4>{{\'BUYER\' | translate}}:</h4><p></p>\n\n          <div class="field">\n            <label>{{\'TITLE\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.campaignInvoice.client.name">\n          </div>\n          <div class="field">\n            <label>{{\'ADDRESS\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.campaignInvoice.client.address">\n          </div>\n          <div class="field">\n            <label>{{\'NIP\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.campaignInvoice.client.NIP">\n          </div>\n          <div class="field">\n            <label>{{\'BILL_NUMBER\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.campaignInvoice.client.accountNumber">\n          </div>\n\n        </div>\n\n      </div>\n\n      <div class="ui divider"></div>\n      <br><br>\n\n      <div class="ui grid">\n        <div class="eight wide column">\n          <div class="field">\n            <label>{{\'PAYMENT_METHOD\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.campaignInvoice.waysToPay">\n          </div>\n        </div>\n        <div class="eight wide column">\n          <div class="field">\n            <label>{{\'PAYMENT_DATE\' | translate}}:</label>\n            <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.campaignInvoice.termNumber">\n          </div>\n        </div>\n      </div>\n\n    </div>\n  </div>\n\n\n\n  <div class="ui segment grid">\n    <div class="row">\n      <div class="column">\n        <table class="ui striped table">\n          <thead>\n          <tr>\n            <!--<th ng-if="vm.parent.listDrugstores.length>1">{{\'DRUGSTORE\' | translate}}</th>-->\n            <th>{{\'NO\' | translate}}</th>\n            <th>{{\'STREET\' | translate}}</th>\n            <th>{{\'AMOUNT\' | translate}}</th>\n            <th>{{\'PRICE\' | translate}}</th>\n            <th>{{\'VALUE\' | translate}}</th>\n            <th>{{\'VAT_RATE\' | translate}}</th>\n            <th>{{\'TAX\' | translate}}</th>\n            <th>{{\'GROSS_VALUE\' | translate}}</th>\n          </tr>\n          </thead>\n          <tbody>\n          <tr ng-repeat="service in vm.campaignInvoice.services">\n            <td>{{$index+1}}</td>\n            <td>{{service.title}}</td>\n            <td>{{service.earns}}</td>\n            <td>{{service.price}}</td>\n            <td></td>\n            <td></td>\n            <td></td>\n            <td></td>\n          </tr>\n          <!--\n          <tbody ng-repeat="drugstoreServices in vm.campaignInvoice.services">\n          <tr ng-repeat="service in drugstoreServices.services">\n            <td rowspan="{{drugstoreServices.services.length}}" ng-if="$index == 0 && vm.parent.listDrugstores.length>1"><div class="ui blue ribbon label">{{drugstoreServices.drugstore_name}}</div></td>\n            <td>{{$index+1}}</td>\n            <td>{{service.title}}</td>\n            <td>{{service.earns}}</td>\n            <td>{{service.price}}</td>\n            <td></td>\n            <td></td>\n            <td></td>\n            <td></td>\n          </tr>\n          -->\n          </tbody>\n        </table>\n      </div>\n    </div>\n    <div class="row">\n      <div class="eight wide column">\n        <div class="field">\n          <label>RAZEM:</label>\n          <input type="text" ng-disabled="{{!vm.parent.isVisit}}" ng-model="vm.campaignInvoice.totalAmount">\n        </div>\n      </div>\n      <div class="eight wide column">\n        <div class="field">\n          <label>{{\'IN_WORDS\' | translate}}:</label>\n          <input type="text" ng-disabled="{{!vm.parent.isVisit}}">\n        </div>\n      </div>\n    </div>\n    <div class="two column row">\n      <div class="eight wide column"></div>\n      <div class="eight wide column">\n        <div class="field">\n          <input type="text" ng-disabled="{{!vm.parent.isVisit}}">\n          <label>{{\'INSUING_SIGNATURE\' | translate}}</label>\n        </div>\n      </div>\n    </div>\n  </div>\n\n\n\n  <div class="ui center aligned basic segment">\n    <div class="ui three column center aligned grid">\n      <div class="column">\n        <div class="ui large pale button">\n          <i class="cancel icon"></i>\n          {{\'CANCEL\' | translate}}\n        </div>\n      </div>\n      <div class="column">\n        <button type="submit" class="ui navy large button" ng-disabled="{{!vm.parent.isVisit || vm.parent.campaignProgress.campaign_status != \'active\' || vm.step.readOnly}}">\n          <i class="save icon"></i>\n          {{\'SAVE\' | translate}}\n        </button>\n      </div>\n      <div class="column">\n        <button class="ui large orange button" ng-click="vm.senInvoiceToManager()" ng-disabled="{{!vm.parent.isVisit}}">\n          <i class="mail outline icon"></i>\n          {{\'SEND_TO_MANAGER\' | translate}}\n        </button>\n      </div>\n    </div>\n  </div>\n\n</form>\n\n\n<!-- <div class="ui segment two column grid">\n\n    <div class="ui column">\n\n        <div class="large ui positive button">\n            <i class="icon checkmark"></i>\n            Save\n        </div>\n\n        <div class="large ui negative button">\n            <i class="icon cancel"></i>\n            Cancel\n        </div>\n\n    </div>\n\n    <div class="ui right aligned column">\n\n        <div class="large ui inverted blue button" ng-click = "vm.parent.prevGo()">\n            <i class="icon arrow left"></i> Previous\n        </div>\n\n        <div class="large ui inverted blue button" ng-click = "vm.parent.nextGo()">\n            <i class="icon arrow right"></i> Next\n        </div>\n\n    </div>\n\n\n</div> -->\n\n\n</div>'),$templateCache.put("app/campaigns/pages/templates/campaigns.lastSellingInfo.html",'<div ng-controller="CampaignsLastSellingController as vm">\n\n    <div class="ui basic segment collapsed">\n        <div class="ui grid">\n            <div class="left aligned five wide column">\n                <p>{{\'PERIOD\' | translate}}: <label><strong>{{vm.lastSellingPeriod.start | date:\'dd.MM.yyyy\'}} —\n                    {{vm.lastSellingPeriod.end | date:\'dd.MM.yyyy\'}}</strong></label></p>\n            </div>\n            <div class="center aligned eight wide column">\n                <div ng-if="vm.messageSelling" class="{{vm.messageSellingClass}}">\n                    <b>{{vm.messageSelling | translate}}</b><br>\n                    <span ng-if="vm.addMessageSelling">{{vm.addMessageSelling}}</span>\n                </div>\n            </div>\n            <div class="right aligned three wide column" ng-if="vm.visibility.ds_btn_photo.visible">\n                <form class="ui form" id="uploadForm" action="/" method="post">\n                    <input type="file" id="uploadFormFile" name="uploadFormFile">\n                </form>\n            </div>\n        </div>\n    </div>\n\n    <form class="ui form" name="lastSellingForm" novalidate ng-submit="sellingForm.$valid">\n\n    <div class="ui three column left aligned grid" ng-if="vm.dataFromKamSoftMkSh">\n      <div class="left aligned six wide column">\n        <div class="ui left floated compact menu no-border">\n          <button type="button" class="ui marine button" ng-click="vm.parent.getKamSoftDataMkSh([vm.lastSellingPeriod.start, vm.lastSellingPeriod.end])" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n            <i class="download icon"></i>\n            {{\'GET_MARKET_SHARE\' | translate}}\n          </button>\n        </div>\n        <div class="ui left floated compact menu no-border">\n          <button type="button" class="ui compact dark-orchid icon button mk_sh_add_data" ng-disabled="!vm.parent.missingDataMkSh || !vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm" ng-click="vm.parent.storeKamsoftMissingData([vm.lastSellingPeriod.start, vm.lastSellingPeriod.end])">\n            <i class="plus large icon"></i>\n          </button>\n        </div>\n        <div class="ui left floated compact menu no-border">\n          <span class="campaign-inner-counter-apteka">\n\t\t\t      <img src="assets/img/icons/campaigns/campaign-icons/apteka-orchid-smaller.png">\n\t\t\t      <span class="floating ui teal circular tiny label">{{vm.parent.counterKamsoftDrugstores}}</span>\n\t\t      </span>\n        </div>\n      </div>\n      <div class="center aligned six wide column"></div>\n      <div class="right aligned four wide column"></div>\n    </div>\n\n    <div class="ui three column left aligned grid" ng-if="vm.dataFromKamSoft">\n\n      <div class="left aligned four wide column">\n        <div class="left aligned four wide column">\n          <button type="button" class="ui marine button" ng-click="vm.parent.showBarCodeScanner()" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n            <i class="qrcode icon"></i>\n            QR Code\n          </button>\n        </div>\n      </div>\n\n      <div class="center aligned eight wide column">\n        <div class="ui two column left aligned grid">\n          <div class="right aligned nine wide column">\n            <button type="button" class="ui green button" ng-class="{\'orange\': vm.canEditData}" ng-click="vm.editKamSoftData()" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n              <i class="edit icon"></i>\n              Edit KAM Soft data\n            </button>\n          </div>\n          <div class="left aligned seven wide column">\n            <div class="ui buttons">\n              <div class="ui left icon compact button" ng-class="{\'green\': vm.kamSoftPicture && vm.kamSoftPicture.src, \'pale\': vm.parent.lockForm}">\n                <label for="takePictureKam" class="no-space"><i class="camera icon"></i>\n                  <input type="hidden" name="kamPicture" ng-model="vm.kamSoftPicture">\n                  <input type="file" capture="camera" accept="image/*" id="takePictureKam" style="display:none" onchange="angular.element(this).scope().$parent.loadPhoto(this, angular.element(this).scope().vm.kamSoftPicture)" ng-disabled="vm.parent.lockForm || !vm.canEditData">\n                  Photo\n                </label>\n              </div>\n              <div class="ui compact button grayb" ng-class="{\'pale\': vm.parent.lockForm}" ng-click="vm.showKamSoftPicture()"><i class="unhide icon"></i></div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="right aligned four wide column">\n        <!--<button type="button" class="ui marine button" ng-click="vm.parent.getKamSoftData()">-->\n          <!--<i class="download icon"></i>-->\n          <!--Get KAM Soft data-->\n        <!--</button>-->\n      </div>\n\n    </div>\n\n    <div class="ui left aligned megacollapsed tertiary segment">\n      <atl-accordion>\n        <div class="title active left-padded">\n          <i class="dropdown icon"></i>\n          <span>{{\'DRUGS_GROUPS\' | translate}}</span>\n        </div>\n        <div class="content active">\n          <table class="ui striped table">\n            <thead>\n            <tr>\n              <th class="one wide">{{\'GROUP\' | translate}}</th>\n              <th class="six wide">{{\'NAME\' | translate}}</th>\n              <th ng-if="vm.visibility.sellIn">{{vm.page.properties[\'ds_drug_sell_in_column\'].label || (\'SELL_IN\' | translate)}}</th>\n              <th ng-if="vm.visibility.sellOut">{{vm.page.properties[\'ds_drug_sell_out_column\'].label || (\'SELL_OUT\' | translate)}}</th>\n            </tr>\n            </thead>\n            <tbody ng-repeat="group in vm.groupBy">\n            <tr ng-repeat="drug in group.groups">\n              <td rowspan="{{group.groups.length}}" ng-if="$index == 0"><div class="ui blue ribbon label">{{group.name}}</div></td>\n              <td>\n                <div class="field">\n                  <div>{{drug.name}}</div>\n                </div>\n              </td>\n              <td ng-if="vm.visibility.sellIn">\n                <input type="number" step="1" autocomplete="off" ng-model="drug.sellIn" ng-init="drug.sellIn = drug.sellIn || 0" ng-value="0" class="inputF" name="sellIn{{$index}}" ng-change="vm.sellChange(group, \'sellIn\')" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || !vm.canEditData">\n              </td>\n              <td ng-if="vm.visibility.sellOut">\n                <input type="number" step="1" autocomplete="off" ng-model="drug.sellOut" ng-init="drug.sellOut = drug.sellOut || 0" ng-value="0" class="inputF" name="sellOut{{$index}}" ng-change="vm.sellChange(group, \'sellOut\')" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || !vm.canEditData">\n              </td>\n            </tr>\n            </tbody>\n          </table>\n        </div>\n      </atl-accordion>\n    </div>\n\n    <table class="ui most basic table">\n      <tr>\n        <td class="eleven wide megacollapsed">\n\n          <table class="ui most basic table">\n            <tr ng-repeat="group in vm.groupBy">\n              <td>\n\n                <table class="ui most basic table">\n                  <tr>\n\n                    <td class="ui seven wide grayb">\n                      <div class="ui grid bottom aligned">\n                        <div class="column three wide middle aligned">\n                          <i class="big line chart icon"></i>\n                          <br><br>\n                        </div>\n                        <div class="column six wide">\n                          <div>\n                            {{group.name}}<br>\n                            {{\'OLD_POTENTIAL\' | translate}}\n                          </div>\n                          <b ng-if="vm.visibility.sellIn">{{group.oldPotential.sellIn.value * vm.amountDrugstores | number : 2}} {{vm.currency}}</b>\n                        </div>\n                        <div class="column right aligned five wide">\n                          <b ng-if="vm.visibility.sellOut">{{group.oldPotential.sellOut.value * vm.amountDrugstores | number : 2}} {{vm.currency}}</b>\n                        </div>\n                      </div>\n                    </td>\n\n                    <td class="ui two wide left aligned">\n                      <i class="huge icon caret right"></i>\n                    </td>\n\n                    <td class="ui seven wide {{group.newPotential.color}} filled" ng-if="group.newPotential.visible">\n                      <div class="ui grid bottom aligned">\n                        <div class="column three wide middle aligned">\n                          <i class="big line chart icon"></i>\n                          <br><br>\n                        </div>\n                        <div class="column six wide">\n                          <div>\n                            {{group.name}}<br>\n                            {{\'NEW_POTENTIAL\' | translate}}\n                          </div>\n                          <b ng-if="vm.visibility.sellIn">{{group.newPotential.sellIn.value * vm.amountDrugstores | number : 2}} <small ng-if="group.applyHelpCircle && vm.fieldCalculate == \'sellIn\'">({{\'APPLY_HELP\' | translate}} {{group.help_coefficient}})</small> {{vm.currency}}</b>\n                        </div>\n                        <div class="column right aligned five wide">\n                          <b ng-if="vm.visibility.sellOut">{{group.newPotential.sellOut.value * vm.amountDrugstores | number : 2}} <small ng-if="group.applyHelpCircle && vm.fieldCalculate == \'sellOut\'">({{\'APPLY_HELP\' | translate}} {{group.help_coefficient}})</small> {{vm.currency}}</b>\n                        </div>\n                      </div>\n                    </td>\n\n                  </tr>\n                  <tr><td></td><td></td><td></td></tr>\n                  <tr ng-if="vm.dataFromKamSoftMkSh">\n                    <td class="ui seven wide grayb">\n                      <div class="ui grid bottom aligned">\n                        <div class="column three wide middle aligned">\n                        </div>\n                        <div class="column eight wide">\n                          <div>\n                            Stary Market Share\n                          </div>\n                        </div>\n                        <div class="column right aligned three wide">\n                          <b>{{group.oldMkSh}}%</b>\n                        </div>\n                      </div>\n                    </td>\n\n                    <td class="ui two wide left aligned">\n                      <i class="huge icon caret right"></i>\n                    </td>\n\n                    <td class="ui seven wide navy filled">\n                      <div class="ui grid bottom aligned">\n                        <div class="column three wide middle aligned">\n                        </div>\n                        <div class="column eight wide">\n                          <div>\n                            Nowy Market Share\n                          </div>\n                        </div>\n                        <div class="column right aligned three wide">\n                          <b>{{group.newMkSh}}%</b>\n                        </div>\n                      </div>\n                    </td>\n                  </tr>\n                </table>\n\n              </td>\n            </tr>\n          </table>\n\n        </td>\n        <td class="five wide {{vm.totalNewPotential.color}} filled more-padded" ng-if="vm.visibility.totalNewPotential.visible">\n\n          <div class="ui grid middle aligned">\n            <div class="column four wide">\n              <i class="big line chart icon"></i>\n            </div>\n            <div class="column twelve wide">\n              <p>{{\'TOTAL\' | translate}}<br>\n                {{\'NEW_POTENTIAL\' | translate}} <b>{{vm.totalNewPotential.value * vm.amountDrugstores | number : 2}} {{vm.currency}}</b><br>\n                {{\'CALCULATE_FROM\'  | translate}} {{vm.fieldCalculate || (\'SELL_IN\' | translate)}}\n              </p>\n            </div>\n          </div>\n\n        </td>\n      </tr>\n    </table>\n\n    <table class="ui table {{vm.showSellingNews.type}} lastselling-message" ng-if="vm.showSellingNews.show">\n      <tr>\n        <td class="ui lastselling-message-column middle aligned center aligned">\n          <i class="inverted info large circle icon"></i>\n        </td>\n        <td class="ui fifteen wide center aligned lastselling-message-text-column">\n          <p ng-if="vm.showSellingNews.type == \'blue\'">{{\'SUITED_DRUGSTORE\' | translate}}</p>\n          <p ng-if="vm.showSellingNews.type == \'red\'">{{\'NOT_SUITED_DRUGSTORE\' | translate}}.</p>\n\n          <div class="lastselling-message-buttons">\n            <div class="ui left aligned basic megacollapsed segment" ng-if="vm.helpDisabled == false">\n              <button class="ui icon navy button" type="button" ng-click="vm.showHelpModal()">\n                <i class="emergency large icon"></i>\n              </button>\n              <span class="expl">{{\'LOWER_THRESHOLD_INPUT\' | translate}} {{vm.reducePercent}}%</span>\n            </div>\n            <div class="ui left aligned basic megacollapsed segment" ng-if="vm.letterDisabled == false">\n              <button class="ui icon navy button" title="{{\'LETTER_TO_RKS\' | translate}}" type="button" ng-click="vm.showModalLetter()">\n                <i class="mail outline large icon"></i>\n              </button>\n              <span class="expl">{{\'CONTACT_YOUR_SUPERVISOR_FOR_GREATER_THRESHOLD\' | translate}}</span>\n            </div>\n          </div>\n\n        </td>\n      </tr>\n    </table>\n\n\n\n\n    <div class="ui center aligned basic segment">\n\n      <div class="ui three column center aligned grid">\n\n        <div class="column">\n          <div class="ui large pale button">\n            <i class="cancel icon"></i>\n            {{\'CANCEL\' | translate}}\n          </div>\n        </div>\n\n        <div class="column" ng-if="vm.parent.isSuperAdmin">\n          <button type="button" class="ui green large button" ng-disabled="vm.lockForm" ng-click="vm.makeMinimumPotential()">\n            <i class="save icon" ng-hide="vm.lockForm"></i>\n            <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n            {{\'SET_MINIMUM_POTENTIAL\' | translate}}\n          </button>\n        </div>\n\n        <div class="column">\n          <button type="submit" class="ui navy large button" ng-disabled="vm.lockForm || vm.parent.lockForm || vm.step.readOnly || vm.pageReadOnly || vm.waiting || vm.specialDisable" ng-click="vm.saveSelling()">\n            <i class="save icon" ng-hide="vm.lockForm || vm.parent.lockForm"></i>\n            <span class="ui active mini inline loader" ng-if="vm.lockForm || vm.parent.lockForm"></span>\n            <span ng-hide="vm.needRecalculate">{{\'SAVE\' | translate}}</span>\n            <span ng-if="vm.needRecalculate"> {{\'RECALCULATE\' | translate}}</span>\n          </button>\n        </div>\n\n      </div>\n\n    </div>\n\n    <!--<div class="ui center aligned basic segment">-->\n        <!--<div class="ui column center aligned grid">-->\n            <!--<div class="column">-->\n                <!--<button type="button"-->\n                        <!--class="ui green large button"-->\n                        <!--ng-click="vm.showQrScanner()">-->\n                    <!--<i class="qrcode icon"></i>-->\n                    <!--{{\'QR_CODE_SCANNER\' | translate}}-->\n                <!--</button>-->\n            <!--</div>-->\n        <!--</div>-->\n    <!--</div>-->\n\n    </form>\n\n    <atl-modal-confirm-dialog modal-id="\'confirmHelpSelling\'" modal-title="\'HELP\' | translate" on-confirm="vm.confirmHelpSelling()">\n      {{\'CONFIRM_APPLYING_HELP_CIRCLE\' | translate}}\n    </atl-modal-confirm-dialog>\n    <atl-modal-confirm-dialog modal-id="\'sendMessageToRKS\'" modal-title="\'SEND_TO_RKS\' | translate" on-confirm="vm.sendMessageToRks()">\n      <div class="header">{{\'MESSAGE_TO_RKS\' | translate}}</div><br>\n      <div id="templateMessageToRKS">\n        <div class="ui grid">\n          <div class="ui three wide column">{{\'REP\' | translate}}:</div>\n          <div class="ui thirteen wide column"><strong>{{vm.parent.userData.firstName}} {{vm.parent.userData.lastName}}</strong></div>\n          <div class="ui three wide column">{{\'DRUGSTORE\' | translate}}: </div>\n          <div class="ui thirteen wide column"><strong>{{vm.drugstore.name}}</strong>, {{\'ID\'  | translate}}: <strong>{{vm.drugstore.identifier}}</strong>, {{\'NIP\'  | translate}}: <strong>{{vm.drugstore.NIP}}</strong></div>\n          <div class="ui three wide column">{{\'CAMPAIGN\' | translate}}: </div>\n          <div class="ui thirteen wide column"><strong>{{vm.parent.campaign.name}}</strong>, {{\'ID\'  | translate}}: <strong>{{vm.parent.campaign.identifier}}</strong></div>\n        </div><br>\n        <div>{{\'DRUGS_GROUP\' | translate}}:</div>\n        <div class="ui segment">\n          <div class="ui twelve wide column">\n            <div ng-repeat="group in vm.groupBy">\n              <div class="ui grid">\n                <div class="ui four wide column">{{group.name}}</div>\n                <div class="ui three wide column">{{\'OLD_POTENTIAL\' | translate}}<br>{{vm.parent.dominant == \'sell_in\' ? group.oldPotential.sellIn.value: group.oldPotential.sellOut.value | number : 2}} {{vm.currency}}</div>\n                <div class="ui three wide column">{{\'NEW_POTENTIAL\' | translate}}<br>{{vm.parent.dominant == \'sell_in\' ? group.newPotential.sellIn.value: group.newPotential.sellOut.value | number : 2}} {{vm.currency}}</div>\n                <div class="ui four wide column">\n                  <span class="negative-text" ng-if="vm.parent.dominant == \'sell_in\' ? group.newPotential.sellIn.value < group.minimalNewPotential: group.newPotential.sellOut.value < group.minimalNewPotential">{{\'NEED_MINIMAL_NEW_POTENTIAL\' | translate}}<br>{{group.minimalNewPotential}} {{vm.currency}}</span>\n                </div>\n              </div>\n              <div class="ui section divider"></div>\n            </div>\n          </div>\n        </div>\n        <div class="ui segment">\n          <div class="ui message">\n            {{\'NOT_HAVE_ENOUGH_POTENTIAL\' | translate}}<br>\n            {{\'PLEASE_CONFIRM\' | translate}}\n          </div>\n        </div>\n      </div>\n    </atl-modal-confirm-dialog>\n\n    <atl-modal-confirm-dialog modal-id="\'drugstoreNotCompliant\'" show-action="false" modal-title="\'MESSAGE_ATTENTION\' | translate" on-confirm="vm.saveSellingPotential()">\n      <p>Apteka nie spełnia zakładanych kryteriów dla tej Kampanii.</p>\n    </atl-modal-confirm-dialog>\n\n    <atl-modal-confirm-dialog modal-id="\'confirmSaved\'" modal-title="\'CONFIRM_SAVING_DATA\' | translate" on-confirm="vm.saveSellingPotential()">\n      Czy chcesz zapisać wprowadzone dane przed opuszczeniem strony?\n    </atl-modal-confirm-dialog>\n\n    <atl-modal-form-dialog modal-id="\'showKamSoftPicture\'" show-action="false" modal-title="\'PHOTO\' | translate">\n      <div class="ui grid" style="height:550px">\n        <div class="center aligned one column row">\n          <div class="column">\n            <img ng-src="{{vm.showImg}}" style="max-height:500px">\n          </div>\n        </div>\n      </div>\n    </atl-modal-form-dialog>\n\n    <!--<atl-modal-form-dialog modal-id="\'modalQRCode\'" show-action="false" modal-title="\'QR Code\'">-->\n    <!--<div class="ui basic supercollapsed segment" style="height:500px;overflow-y:auto">-->\n    <!--</div>-->\n    <!--</atl-modal-form-dialog>-->\n\n</div>\n'),
$templateCache.put("app/campaigns/pages/templates/campaigns.localInfo.html",'<div ng-controller="CampaignsLocalInfoController as vm">\n<form class="ui form" name="drugstoreAdditionalForm" novalidate ng-submit="drugstoreAdditionalForm.$valid && vm.saveLocalInfo()">\n<div class="ui basic segment">\n  <table class="ui most basic table">\n    <tr ng-repeat="property in vm.properties" ng-if="vm.page.properties[\'ds_prop_\'+property.id] ? vm.page.properties[\'ds_prop_\'+property.id].visible == \'true\' : \'true\'">\n      <td class="collapsing">{{vm.page.properties[\'ds_prop_\'+property.id].label || property.name}}</td>\n      <td>\n          <div ng-switch="property.type">\n\n              <section ng-switch-when="boolean">\n                  <div class="ui toggle checkbox" id="toggle_{{property.id}}">\n                      <input id="boolean_{{property.id}}" ng-disabled="{{!vm.parent.isVisit}}" type="checkbox" ng-model="vm.drugstoreMetadata[property.id]">\n                      <label for="boolean_{{property.id}}"></label>\n                  </div>\n              </section>\n\n              <section ng-switch-when="number">\n                  <div>\n                      <input type="number" ng-disabled="{{!vm.parent.isVisit}}" name="number_{{property.id}}" ng-model="vm.drugstoreMetadata[property.id]">\n                  </div>\n              </section>\n\n              <section ng-switch-when="string">\n                  <div>\n                      <input type="text" ng-disabled="{{!vm.parent.isVisit}}" name="string_{{property.id}}" ng-model="vm.drugstoreMetadata[property.id]">\n                  </div>\n              </section>\n\n              <section ng-switch-when="list">\n                  <div>\n                      <label ng-repeat="value in property.values">\n                          <input type="radio" ng-disabled="{{!vm.parent.isVisit}}" name="list_{{property.id}}" ng-model="vm.drugstoreMetadata[property.id]" ng-value="value.id" ng-click="(vm.page.properties[\'ds_prop_\'+property.id][\'ds_prop_\'+property.id] && vm.page.properties[\'ds_prop_\'+property.id][\'ds_prop_\'+property.id][value.id] && vm.page.properties[\'ds_prop_\'+property.id][\'ds_prop_\'+property.id][value.id] == \'1\') ? vm.showWarning($event) : undefined"> <span ng-class="{\'negative-text\':vm.page.properties[\'ds_prop_\'+property.id][\'ds_prop_\'+property.id] && vm.page.properties[\'ds_prop_\'+property.id][\'ds_prop_\'+property.id][value.id] && vm.page.properties[\'ds_prop_\'+property.id][\'ds_prop_\'+property.id][value.id] == \'1\'}">{{value.value}}</span>\n                      </label>\n                  </div>\n              </section>\n\n          </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n\n\n<div class="ui center aligned basic segment">\n\n  <div class="ui three column center aligned grid">\n\t\n\t<div class="column">\n\t  <div class="ui large pale button">\n\t\t<i class="cancel icon"></i>\n\t\t{{\'CANCEL\' | translate}}\n\t  </div>\n\t</div>\n\n\t<div class="column">\n\t  <button type="submit" class="ui navy large button" ng-disabled="vm.lockForm || !vm.parent.isVisit || vm.step.readOnly">\n      <i class="save icon" ng-hide="vm.lockForm"></i>\n      <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n\t\t  {{\'SAVE\' | translate}}\n\t  </button>\n\t</div>\n\t\n  </div>\n\n</div>\n\n\n<!-- <div class="ui basic segment two column grid">\n\n  <div class="ui column">\n\n    <button type="submit" class="large ui positive button">\n      <i class="icon checkmark"></i>\n      Save\n    </button>\n\n    <div class="large ui negative button">\n      <i class="icon cancel"></i>\n      Cancel\n    </div>\n\n  </div>\n\n  <div class="ui right aligned column">\n\n    <div class="large ui inverted blue button" ng-click = "vm.parent.prevGo()">\n      <i class="icon arrow left"></i> Previous\n    </div>\n\n    <div class="large ui inverted blue button" ng-click = "vm.parent.nextGo()">\n      <i class="icon arrow right"></i> Next\n    </div>\n\n  </div>\n</div> -->\n\n\n</form>\n  <atl-modal-confirm-dialog modal-id="\'warningLocalInfoModal\'" modal-title="\'WARNING\' | translate" on-confirm="vm.showWarning($event, true)">\n\n    <p align="center">{{\'VALUE_BLOCKS_DRUGSTORE\' | translate}}<br>\n      {{\'CONFIRM_EXCLUDEING_DRUGSTORE\' | translate}}</p>\n\n  </atl-modal-confirm-dialog>\n</div>\n\n'),$templateCache.put("app/campaigns/pages/templates/campaigns.localInfoControl.html",'<form class="ui form" name="drugstoreAdditionalForm" novalidate ng-submit="drugstoreAdditionalForm.$valid && vm.saveLocalInfo()">\n<div class="ui segment">\n  <table class="ui most basic table">\n    <tr ng-repeat="property in vm.properties">\n      <td class="collapsing">{{property.name}}</td>\n      <td>\n\n        <label ng-if="property.type == \'boolean\'">\n          <div class="ui toggle checkbox">\n            <input id="negotiationPoint" type="checkbox" ng-model="vm.drugstoreMetadata[property.id]">\n            <label for="negotiationPoint"></label>\n          </div>\n        </label>\n\n        <label ng-if="property.type == \'number\'">\n          <input type="number" name="name" ng-model="vm.drugstoreMetadata[property.id]">\n        </label>\n\n        <label ng-if="property.type == \'string\'">\n          <input type="text" name="name" ng-model="vm.drugstoreMetadata[property.id]">\n        </label>\n\n        <label ng-if="property.type == \'list\'">\n          <label ng-repeat="value in property.values">\n            <input type="radio" name="name" ng-model="$parent.vm.drugstoreMetadata[property.id]" ng-value="value.id"> {{value.value}}\n          </label>\n        </label>\n\n      </td>\n    </tr>\n  </table>\n</div>\n\n\n\n\n<div class="ui center aligned basic segment">\n\n  <div class="ui three column center aligned grid">\n\n\t<div class="column">\n\t  <div class="ui large pale button">\n\t\t<i class="cancel icon"></i>\n\t\t{{\'CANCEL\' | translate}}\n\t  </div>\n\t</div>\n\n\t<div class="column">\n\t  <button type="submit" class="ui navy large button">\n\t\t<i class="save icon"></i>\n\t\t{{\'SAVE\' | translate}}\n\t  </button>\n\t</div>\n\t\n  </div>\n\n</div>\n\n\n<!-- <div class="ui segment two column grid">\n\n  <div class="ui column">\n\n    <button type="submit" class="large ui positive button">\n      <i class="icon checkmark"></i>\n      Save\n    </button>\n\n    <div class="large ui negative button">\n      <i class="icon cancel"></i>\n      Cancel\n    </div>\n\n  </div>\n\n  <div class="ui right aligned column">\n\n    <div class="large ui inverted blue button" ng-click = "vm.prevGo()">\n      <i class="icon arrow left"></i> Previous\n    </div>\n\n    <div class="large ui inverted blue button" ng-click = "vm.nextGo()">\n      <i class="icon arrow right"></i> Next\n    </div>\n\n  </div>\n</div> -->\n\n\n</form>'),$templateCache.put("app/campaigns/pages/templates/campaigns.merchandising.html",'<div ng-controller="CampaignsMerchandisingController as vm">\n  <div class="ui basic segment collapsed">\n\n    <div class="ui three column left aligned grid">\n      <div class="left aligned column">\n        <p>{{\'PERIOD\' | translate}}: <b>{{vm.parent.period.start | date:\'dd.MM.yyyy\'}} — {{vm.parent.period.end | date:\'dd.MM.yyyy\'}}</b></p>\n      </div>\n      <div class="center aligned column">\n        <div class="ui buttons" ng-if="!vm.parent.campaign.hide_drugstore_photo && vm.parent.drugstore.photos_invalid_from">\n          <div class="ui left icon compact button" ng-class="{\'marine\': !vm.imageProps.img.drugstore.old_date && vm.imageProps.img.drugstore.src, \'red\': vm.imageProps.img.drugstore.old_date}">\n            <label for="takePictureDrugstore" class="no-space"><i class="camera icon"></i>\n            <input type="hidden" name="drugstore_pict" ng-model="vm.imageProps.drugstore_image_id">\n            <input type="file" capture="camera" for="drugstore_pict" accept="image/*" id="takePictureDrugstore" style="display:none" onchange="angular.element(this).scope().loadPhoto(this)" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly">\n            Zdjęcie apteki\n            </label>\n          </div>\n          <div class="ui compact button grayb" ng-disabled="!vm.imageProps.img.drugstore.src" ng-click="vm.showStandartPicture(vm.imageProps.img.drugstore.src || null)"><i class="unhide icon"></i></div>\n        </div>\n      </div>\n      <div class="right aligned column">\n        <div ng-if="vm.messageSelling" class="{{vm.messageSellingClass}}">\n          <b>{{vm.messageSelling | translate}}</b>\n        </div>\n      </div>\n    </div>\n\n    <div class="ui divider"></div>\n\n  </div>\n  <form class="ui form" name="drugstoreForm" novalidate ng-submit="drugstoreForm.$valid">\n    <div class="ui segments" ng-if="vm.page.properties.ds_merch_services_table ? vm.page.properties.ds_merch_services_table.visible == \'true\' : \'true\'">\n\n      <div class="ui basic supercollapsed segment no-border merch-grid-area">\n        <div class="ui basic supercollapsed segment" ng-repeat="service in vm.merch" ng-if="service.visible && service.include">\n          <input type="hidden" name="serviceId" ng-model="service.id">\n\n          <div class="ui grid left aligned">\n\n            <div class="ui three wide column">\n              <div class="ui basic megacollapsed segment">\n                <b>{{service.title}}</b>\n              </div>\n            </div>\n\n            <div class="ui five wide column">\n\n              <div class="ui buttons" ng-click="vm.showStandartPicture(service.standart_img[service.from].src || null)">\n                <div class="ui left icon compact button">\n                  <i class="camera icon"></i>\n                  {{\'STANDARD\' | translate}}\n                </div>\n                <div class="ui compact button grayb" ng-bind="service.drugs_number">1</div>\n              </div>\n\n              <!--<div class="ui transparent label"\tng-click="vm.showStandartPicture(service.standart_img[service.from].src || null)">\n                <i ng-hide="service.standart_img[service.from].src" class="camera icon"></i>\n                <img ng-if="service.standart_img[service.from].src" id="" ng-src="{{service.standart_img[service.from].src}}">\n              </div>-->\n\n            </div>\n\n            <div class="ui eight wide column photos">\n              <div class="ui buttons" ng-if="service.control_type.photo_shelf">\n                <div class="ui left icon compact button service_button" ng-class="{\'marine\': service.control_type.photo_shelf_controlled_by_manager && service.img.shelf.agreed == 1 || !service.control_type.photo_shelf_controlled_by_manager && service.img.shelf.src, \'yellow\': service.control_type.photo_shelf_controlled_by_manager && service.img.shelf.agreed == -1, \'red\': service.control_type.photo_shelf_controlled_by_manager && service.img.shelf.src && !service.img.shelf.agreed}">\n                  <label for="takePictureShelf_{{service.unique_id}}" class="no-space"><i class="camera icon"></i>\n                    <input type="hidden" name="shelfId_{{$index}}" ng-model="service.shelf_image_id">\n                    <input type="file" capture="camera" for="shelf_{{$index}}" accept="image/*" id="takePictureShelf_{{service.unique_id}}" style="display:none" onchange="angular.element(this).scope().loadPhoto(this)" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || !service.can_edit">\n                    {{\'SHELF\' | translate}}\n                  </label>\n                </div>\n                <div class="ui compact button grayb" ng-click="vm.showPicture($index,\'shelf\')"><i class="unhide icon"></i></div>\n              </div>\n\n              <div class="ui buttons" ng-if="service.control_type.photo_environment">\n                <div class="ui left icon compact button service_button" ng-class="{\'marine\': service.control_type.photo_env_controlled_by_manager && service.img.env.agreed == 1 || !service.control_type.photo_env_controlled_by_manager && service.img.env.src, \'yellow\': service.control_type.photo_env_controlled_by_manager && service.img.env.agreed == -1, \'red\': service.control_type.photo_env_controlled_by_manager && service.img.env.src && !service.img.env.agreed}">\n                  <label for="takePictureEnv_{{service.unique_id}}" class="no-space">\n                    <input type="hidden" name="envId_{{$index}}" ng-model="service.env_image_id"><i class="camera icon"></i>\n                    <input type="file" capture="camera" for="env_{{$index}}" accept="image/*" id="takePictureEnv_{{service.unique_id}}" style="display:none" onchange="angular.element(this).scope().loadPhoto(this)" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || !service.can_edit">\n                    {{\'ENVIRONMENT\' | translate}}\n                  </label>\n                </div>\n                <div class="ui compact button grayb" ng-click="vm.showPicture($index,\'env\')"><i class="unhide icon"></i></div>\n              </div>\n\n              <div class="ui left pointing basic red label" ng-if="service.wrongDate">\n                  {{\'WRONG_DATE\' | translate}}\n              </div>\n\n\n              <!--<div class="ui transparent label no-space" ng-click="vm.showPicture($index,\'shelf\')">\n                <i ng-hide="service.img.shelf.src" class="camera icon"></i>\n                <img ng-if="service.img.shelf.src" ng-src="{{service.img.shelf.src}}" id="pictureShelf_{{$index}}">\n              </div>-->\n\n              <!--<div class="ui transparent label no-space" ng-click="vm.showPicture($index,\'env\')" ng-if="service[\'control_type\'].photo_environment==true">\n                <i ng-hide="service.img.env.src" class="camera icon"></i>\n                <img ng-if="service.img.env.src" ng-src="{{service.img.env.src}}" id="pictureEnv_{{$index}}">\n              </div>-->\n\n\n            </div>\n\n          </div>\n\n          <div class="ui grid left aligned" ng-if="!vm.parent.not_paid_campaign">\n\n            <div class="ui three wide column">\n\n              <!-- Manager can change -->\n              <!--\n              <div class="ui form">\n                <div class="fields">\n                  <p>{{\'AGREED\' | translate}}</p>\n                  <div class="field">\n                    <div class="ui radio checkbox">\n                      <input type="radio" name="managerAgreed_{{$index}}" id="managerAgreedYes_{{$index}}" ng-disabled="!vm.isManager" ng-value="1" ng-model="service.manager_agreed">\n                      <label for="managerAgreedYes_{{$index}}" class="no-space">{{\'YES\' | translate}}</label>\n                    </div>\n                  </div>\n                  <div class="field">\n                    <div class="ui radio checkbox">\n                      <input type="radio" name="managerAgreed_{{$index}}" id="managerAgreedNo_{{$index}}" ng-disabled="!vm.isManager" ng-value="0" ng-model="service.manager_agreed">\n                      <label for="managerAgreedNo_{{$index}}" class="no-space">{{\'NO\' | translate}}</label>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              -->\n            </div>\n\n            <div class="ui six wide column">\n\n\n              <div class="read-only-content" ng-if="service.type == \'slider\'">\n                <ionslider dataindex="{{$index}}" min="{{service.map.startValue}}" max="{{service.map.endValue}}" values="{{service.map.values}}" from="{{service.from}}" grid="true" step="1" type="single" field="service" from-fixed="true" on-change="vm.changeServiceSlider"></ionslider>\n              </div>\n\n              <div ng-if="service.type == \'radio\'">\n                <div class="ui floated basic segment">\n                  <label ng-repeat="radio in service.map.values">\n                    <input type="radio" id="localization_{{$index}}" name="localization_{{$parent.$index}}" value="{{radio.earned}}" ng-checked="$index==service.from" ng-model="$parent.service.earns" disabled="disabled"> {{radio.label}}\n                  </label>\n                </div>\n              </div>\n\n\n            </div>\n            <div class="ui two wide column left aligned">\n              <div class="ui floated basic segment">\n                <input type="text" disabled="disabled" value="{{service.earns * service.cycleValue}}" style="width:70px" ng-if="service.earns >0">\n              </div>\n            </div>\n            <div class="ui five wide column left aligned" ng-if="service[\'control_type\'].yes_no_checkbox">\n              <div class="ui floated basic segment">\n                <!-- <label><input type="radio" name="service_{{$index}}" ng-value="1" ng-model="service.yes_no"> OK</label>\n                <label><input type="radio" name="service_{{$index}}" ng-value="0" ng-model="service.yes_no"> NO</label> -->\n\n                <div class="ui toggle checkbox">\n\n                  <input name="service_{{$index}}" id="service_{{$index}}" type="checkbox" parse-int ng-true-value="1" ng-false-value="0" ng-change="vm.parent.isPageChange = true" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly" ng-model="service.yes_no">\n                  <label for="service_{{$index}}">{{\'OK\' | translate}}</label>\n\n                </div>\n              </div>\n\n            </div>\n\n          </div>\n\n          <div class="ui divider"></div>\n\n        </div>\n\n        <!--<div class="ui basic supercollapsed center aligned segment no-border">\n          <div class="ui grid center aligned">\n            <div class="eight wide left aligned column" ng-bind-html="vm.debug"></div>\n          </div>\n        </div>-->\n\n      </div>\n\n\n    </div>\n\n\n\n    <div class="ui center aligned basic segment">\n\n      <div class="ui three column center aligned grid">\n\n        <div class="column">\n          <div class="ui large pale button">\n            <i class="cancel icon"></i>\n            {{\'CANCEL\' | translate}}\n          </div>\n        </div>\n        <div class="column">\n          <button type="submit" class="ui navy large button" ng-disabled="vm.lockForm || ((vm.step.readOnly || vm.pageReadOnly) && !vm.acceptEnable)" ng-click="vm.saveServiceControl()">\n            <i class="send icon"></i>\n            {{\'SAVE\' | translate}}\n          </button>\n        </div>\n        <div class="column" ng-if="!vm.isManager && (vm.isSendMessage || vm.page.needCloseStep)">\n          <button class="ui large navy button" ng-click="vm.sendMessageToManager();" ng-disabled="vm.lockForm || vm.step.readOnly || vm.pageReadOnly">\n            <i class="send icon"></i>\n            {{\'REPORT_TO_MANAGER\' | translate}}\n          </button>\n        </div>\n        <div class="column" ng-if="vm.isManager">\n          <button class="ui large navy button" ng-click="vm.showAllPhotos()" ng-disabled="vm.lockForm || !vm.acceptEnable">\n            <i class="checkmark box icon"></i>\n            {{\'ACCEPT\' | translate}}\n          </button>\n        </div>\n        <!--\n        <div class="column" ng-if="vm.page.needCloseStep">\n          <button class="ui large navy button" ng-click="vm.parent.closeStep(vm.parent.step)" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly">\n            <i class="checkmark box icon"></i>\n            {{\'ClOSE_STEP\' | translate}}\n          </button>\n        </div>\n        -->\n      </div>\n\n    </div>\n\n  </form>\n\n  <atl-modal-form-dialog modal-id="\'showPicture\'" show-action="false" modal-title="\'PHOTO\' | translate">\n    <div class="ui grid" style="height:500px">\n      <div class="center aligned one column row">\n        <div class="column">\n          <img ng-src="{{vm.showImg}}" style="max-height:400px">\n        </div>\n      </div>\n      <div class="center aligned one column row" ng-if="vm.showRksButtons">\n        <!-- <div><label>Agreed</label></div><br> -->\n        <div class="ui large buttons simple">\n          <button class="ui marine button" ng-click="vm.setRksAgreed(true)" ng-disabled="!vm.acceptEnable">Confirm</button>\n          <div class="or"></div>\n          <button class="ui red button" ng-click="vm.setRksAgreed(false)" ng-disabled="!vm.acceptEnable">Reject</button>\n        </div>\n      </div>\n    </div>\n  </atl-modal-form-dialog>\n\n  <atl-modal-form-dialog modal-id="\'showAcceptPhotos\'" show-action="false" modal-title="\'PHOTO_ACCEPT\' | translate">\n    <div class="photo-zoom-centered" ng-show="vm.isZoom" ng-click="vm.hideZoom($event)">\n      <img ng-src="{{vm.imgFileZoom}}" class="zoom-img-scale">\n    </div>\n    <div class="ui basic supercollapsed segment" style="height:500px;overflow-y:auto" ng-hide="vm.isZoom">\n      <div class="ui grid">\n        <div class="center aligned three column row">\n          <div class="column ui tertiary segment collapsed"><b>Service</b></div>\n          <div class="column ui tertiary segment collapsed"><b>Shelf photo</b></div>\n          <div class="column ui tertiary segment collapsed"><b>Env photo</b></div>\n        </div>\n      </div>\n      <div class="ui basic supercollapsed segment" ng-repeat="service in vm.merch" ng-if="service.visible && service.include">\n        <div class="ui three column grid">\n          <div class="column">\n            <div class="service-img-photo-holder">\n              <h3>{{service.title}}</h3>\n            </div>\n          </div>\n\n          <div class="center aligned column">\n            <div ng-if="service.control_type.photo_shelf">\n              <div ng-if="service.img.shelf.src" class="service-img-photo-holder" ng-class="{\'marine\': service.img.shelf.selectedToAccept && service.img.shelf.agreed == 1 || !service.control_type.photo_shelf_controlled_by_manager, \'yellow\': service.img.shelf.selectedToAccept && service.img.shelf.agreed != 1 && service.control_type.photo_shelf_controlled_by_manager, \'red\': !service.img.shelf.agreed || !service.img.shelf.selectedToAccept}">\n                <img ng-src="{{service.img.shelf.src}}" style="max-height:100%" ng-click="vm.isZoom = !vm.isZoom;vm.imgFileZoom = service.img.shelf.src">\n              </div>\n              <div ng-hide="service.img.shelf.src" class="service-img-photo-holder"><span class="negative-text">No photo</span></div>\n              <div class="service-img-checkbox-holder">\n                <div class="ui toggle checkbox">\n                  <input id="check_shelf{{$index}}" type="checkbox" ng-checked="service.img.shelf.selectedToAccept" ng-model="service.img.shelf.selectedToAccept" ng-init="service.img.shelf.selectedToAccept = true" ng-disabled="!service.control_type.photo_shelf_controlled_by_manager || service.img.shelf.agreed == 1">\n                  <label for="check_shelf{{$index}}"></label>\n                </div>\n              </div>\n            </div>\n            <div ng-hide="service.control_type.photo_shelf"><b>Not include</b></div>\n          </div>\n\n          <div class="center aligned column">\n            <div ng-if="service.control_type.photo_environment">\n              <div ng-if="service.img.env.src" class="service-img-photo-holder" ng-class="{\'marine\': service.img.env.selectedToAccept && service.img.env.agreed == 1 || !service.control_type.photo_env_controlled_by_manager, \'yellow\': service.img.env.selectedToAccept && service.img.env.agreed != 1 && service.control_type.photo_env_controlled_by_manager, \'red\': !service.img.env.agreed || !service.img.env.selectedToAccept}">\n                <img ng-src="{{service.img.env.src}}" style="max-height:100%" ng-click="vm.isZoom = !vm.isZoom; vm.imgFileZoom = service.img.env.src">\n              </div>\n              <div ng-hide="service.img.env.src" class="service-img-photo-holder"><span class="negative-text">No photo</span></div>\n              <div class="service-img-checkbox-holder">\n                <div class="ui toggle checkbox">\n                  <input id="check_env{{$index}}" type="checkbox" ng-checked="service.img.env.selectedToAccept" ng-model="service.img.env.selectedToAccept" ng-init="service.img.env.selectedToAccept = true" ng-disabled="!service.control_type.photo_env_controlled_by_manager || service.img.env.agreed == 1">\n                  <label for="check_env{{$index}}"></label>\n                </div>\n              </div>\n            </div>\n            <div ng-hide="service.control_type.photo_environment"><b>Not include</b></div>\n          </div>\n        </div>\n\n        <div class="ui divider"></div>\n      </div>\n      <div class="ui grid">\n        <div class="center aligned column">\n          <button class="ui marine button" ng-click="vm.showConfirmAgreed()" ng-disabled="!vm.acceptEnable">\n            {{\'SEND\' | translate}}\n          </button>\n          <!--<div class="ui large buttons simple">\n            <button class="ui green button" ng-click="vm.setRksAllAgreed(true)" ng-disabled="!vm.acceptEnable">Confirm</button>\n            <div class="or"></div>\n            <button class="ui red button" ng-click="vm.setRksAllAgreed(false)" ng-disabled="!vm.acceptEnable">Reject</button>\n          </div>-->\n        </div>\n      </div>\n    </div>\n  </atl-modal-form-dialog>\n  <atl-modal-confirm-dialog modal-id="\'confirmCloseStep\'" modal-title="\'CLOSE_STEP\' | translate" on-confirm="vm.saveServiceControl(true)">\n    {{\'CONFIRM_CLOSE_STEP_SERVICES\' | translate}}\n  </atl-modal-confirm-dialog>\n  <atl-modal-confirm-dialog modal-id="\'confirmRksAgreed\'" modal-title="\'CONFIRM_ACCEPT\' | translate" on-confirm="vm.setRksAllAgreed();vm.saveServiceControl()">\n    Czy jesteś pewien swojej decyzji?\n  </atl-modal-confirm-dialog>\n  <atl-modal-confirm-dialog modal-id="\'confirmSaved\'" modal-title="\'CONFIRM_SAVING_DATA\' | translate" on-confirm="vm.saveServiceControl()">\n    Czy chcesz zapisać wprowadzone dane przed opuszczeniem strony?\n  </atl-modal-confirm-dialog>\n</div>'),$templateCache.put("app/campaigns/pages/templates/campaigns.proposal.html",'<div ng-controller="CampaignsProposalController as vm">\n<form class="ui form" name="proposalForm" novalidate ng-submit="proposalForm.$valid && vm.saveProposal()">\n<div>\n\n  <div class="ui basic segment supercollapsed" ng-if="vm.messageSelling && vm.parent.campaign.campaign_scale != \'multi\'">\n    <div class="ui two column left aligned grid">\n      <div class="left aligned column"></div>\n      <div class="right aligned column">\n        <div class="{{vm.messageSellingClass}}">\n          <b>{{vm.messageSelling | translate}}</b>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="ui center aligned basic segment" ng-if="vm.parent.campaign.campaign_scale == \'multi\'">\n    <div class="ui middle aligned three column centered grid">\n\n      <div class="column">\n        <div ng-if="vm.parent.campaignProgress.campaign_status ==\'completed_cycle\'">\n          <button type="button" class="ui navy large button" ng-class="{\'pale\':vm.parent.campaignProgressActiveId}" ng-disabled="vm.parent.campaignProgressActiveId || !vm.parent.isVisit || vm.lockForm" ng-click="vm.startCampaign()">\n            <i class="play icon"></i>\n            {{\'START_NEW_CYCLE\' | translate}}\n          </button>\n        </div>\n      </div>\n\n      <div class="center aligned column">\n        <button type="button" class="ui navy large button" ng-click="vm.startMulti()">\n          <i class="save icon"></i>\n          {{\'MULTI\' | translate}}\n        </button>\n      </div>\n\n      <div class="right aligned column">\n        <div class="{{vm.messageSellingClass}}">\n          <b>{{vm.messageSelling | translate}}</b>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="ui basic megacollapsed attached segment" ng-repeat="drug in vm.groupBy" ng-if="drug.sellIn.visible || drug.sellOut.visible">\n    <div class="ui center aligned attached tertiary collapsed segment segment-heading">{{drug.name}}</div>\n\n    <div class="ui attached segment">\n\n      <div class="ui grid" ng-if="drug.sellIn.visible">\n\n        <div class="ui two wide column center aligned"></div>\n\n        <div class="ui two wide column center aligned">\n          <div class="ui basic segment">\n            <img src="assets/img/icons/campaigns/sell-in.png">\n            <br>\n            <nobr><b class="lightblue small-header">{{drug.sellIn.label}}</b></nobr>\n          </div>\n        </div>\n\n        <div class="ui seven wide column">\n\n          <div class="ui two column grid">\n            <div class="column">\n              <small><!--<span ng-if="drug.sellIn.showPercent">%</span>--></small>\n            </div>\n            <div class="column right aligned">\n              <small><!--<span ng-if="drug.sellIn.showPercent">%</span>--></small>\n            </div>\n          </div>\n          <div ng-class="{\'read-only-content\':vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit}">\n            <ionslider field="drug.sellIn" reset="drug.sellIn.reset" dynamic-value="{{drug.sellIn.dynamicValue}}" dynamic-change-values="{{drug.sellIn.dynamicChangeValues}}" type="{{drug.sellIn.type}}" min="{{drug.sellIn.startMultiple}}" max="{{drug.sellIn.endMultiple}}" from="{{drug.sellIn.from}}" postfix="{{drug.sellIn.showPercent ? \'%\' : \'\'}}" original-values="{{drug.sellIn.values.vals}}" values="{{drug.sellIn.values.valsMultiple}}" grid="true" from-fixed="{{vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit}}" on-change="vm.changeSlider" on-change-values="vm.changeValues" step="1"></ionslider>\n          </div>\n        </div>\n        <div class="ui five wide column left aligned top-padded">\n          <div class="ui basic megacollapsed segment">\n            <span ng-if="drug.sellIn.earned_visibility">\n\n              <span ng-if="vm.parent.potentialInputVisibility">\n                <div style="margin-top:-5px;margin-left:-25px">\n                  <table class="ui table striped light">\n                    <tr>\n                      <td>\n                        <span ng-if="vm.parent.potentialInputVisibility == \'one_drugstore\'">\n                          <div class="ui field right labeled input" ng-class="{\'error\': proposalForm[\'sellInAgreedPotential_{{drug.id}}\'].$invalid}">\n                            <input name="sellInAgreedPotential_{{drug.id}}" id="sellInAgreedPotential_{{drug.id}}" type="number" required ng-disabled="vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit" min="{{drug.sellIn.minAgreedPotential}}" max="{{drug.sellIn.maxAgreedPotential}}" ng-value="{{drug.sellIn.newAgreedPotential}}" ng-model="drug.sellIn.newAgreedPotential" ng-change="vm.changeNewAgreedPotential(drug, \'sellIn\')" step="1" class="full-input">\n                            <div class="ui basic label"><b>&#215;</b>{{vm.amountDrugstores}}</div>\n                            <div class="ui marine label">\n                              {{drug.sellIn.newAgreedPotential * vm.amountDrugstores | number:2}}\n                            </div>\n                          </div>\n                        </span>\n\n                        <span ng-if="vm.parent.potentialInputVisibility != \'one_drugstore\'">\n                          <div class="ui fluid labeled input" ng-class="{\'error\': proposalForm[\'sellInAgreedPotentialNetwork_{{drug.id}}\'].$invalid}">\n                            <div class="ui label">\n                              {{drug.sellIn.newAgreedPotential | number:2}}\n                            </div>\n                            <div class="ui label">\n                              <b>&#215;</b>{{vm.amountDrugstores}}\n                            </div>\n                            <input name="sellInAgreedPotentialNetwork_{{drug.id}}" id="sellInAgreedPotentialNetwork_{{drug.id}}" type="number" required ng-disabled="vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit" min="{{drug.sellIn.minAgreedPotential * vm.amountDrugstores}}" max="{{drug.sellIn.maxAgreedPotential * vm.amountDrugstores}}" ng-value="{{drug.sellIn.newAgreedPotentialMultiple}}" ng-model="drug.sellIn.newAgreedPotentialMultiple" ng-change="vm.changeNewAgreedPotential(drug, \'sellIn\')" step="1" class="full-input">\n                          </div>\n                        </span>\n                      </td>\n                    </tr>\n                  </table>\n                </div>\n              <b>{{drug.sellIn.earns * vm.amountDrugstores | number : drug.sellIn.sign != \'P\' ? 2 : 0}} {{drug.sellIn.sign}}</b>\n              </span>\n\n              <span ng-if="!vm.parent.potentialInputVisibility">\n                <div ng-if="drug.sellIn.newAgreedPotential">\n                  <small>{{drug.sellIn.newAgreedPotential * vm.amountDrugstores | number : drug.sellIn.sign != \'P\' ? 2 : 0}} {{drug.sellIn.sign}}</small>\n                </div>\n                <b>{{drug.sellIn.earns * vm.amountDrugstores | number : drug.sellIn.sign != \'P\' ? 2 : 0}} {{drug.sellIn.sign}}</b>\n              </span>\n\n            </span>\n          </div>\n        </div>\n\n      </div>\n\n      <div class="ui grid" ng-if="drug.sellOut.visible">\n\n        <div class="ui two wide column center aligned"></div>\n\n        <div class="ui two wide column center aligned">\n          <div class="ui basic segment">\n            <img src="assets/img/icons/campaigns/sell-out.png">\n            <br>\n            <nobr><b class="lightblue small-header">{{drug.sellOut.label}}</b></nobr>\n          </div>\n        </div>\n\n        <div class="ui seven wide column">\n\n          <div class="ui two column grid">\n            <div class="column">\n              <small><!--<span ng-if="drug.sellOut.showPercent">%</span>--></small>\n            </div>\n            <div class="column right aligned">\n              <small><!--<span ng-if="drug.sellOut.showPercent">%</span>--></small>\n            </div>\n          </div>\n          <div ng-class="{\'read-only-content\':vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit}">\n            <ionslider field="drug.sellOut" reset="drug.sellOut.reset" dynamic-value="{{drug.sellOut.dynamicValue}}" dynamic-change-values="{{drug.sellOut.dynamicChangeValues}}" type="{{drug.sellOut.type}}" min="{{drug.sellOut.startMultiple}}" max="{{drug.sellOut.endMultiple}}" from="{{drug.sellOut.from}}" postfix="{{drug.sellOut.showPercent ? \'%\' : \'\'}}" original-values="{{drug.sellOut.values.vals}}" values="{{drug.sellOut.values.valsMultiple}}" grid="true" from-fixed="{{vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit}}" on-change="vm.changeSlider" on-change-values="vm.changeValues" step="1"></ionslider>\n          </div>\n        </div>\n        <div class="ui five wide column left aligned top-padded">\n          <div class="ui basic megacollapsed segment" ng-if="drug.sellOut.earned_visibility">\n\n            <span ng-if="vm.parent.potentialInputVisibility">\n              <div style="margin-top:-5px;margin-left:-25px">\n                <table class="ui table striped light">\n                  <tr>\n                    <td>\n                      <span ng-if="vm.parent.potentialInputVisibility == \'one_drugstore\'">\n                        <div class="ui field right labeled input" ng-class="{\'error\': proposalForm[\'sellOutAgreedPotential_{{drug.id}}\'].$invalid}">\n                          <input name="sellOutAgreedPotential_{{drug.id}}" id="sellOutAgreedPotential_{{drug.id}}" type="number" required ng-disabled="vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit" min="{{drug.sellOut.minAgreedPotential}}" max="{{drug.sellOut.maxAgreedPotential}}" ng-value="{{drug.sellOut.newAgreedPotential}}" ng-model="drug.sellOut.newAgreedPotential" ng-change="vm.changeNewAgreedPotential(drug, \'sellOut\')" step="1" class="full-input">\n                          <div class="ui basic label"><b>&#215;</b>{{vm.amountDrugstores}}</div>\n                          <div class="ui marine label">\n                            {{drug.sellOut.newAgreedPotential * vm.amountDrugstores | number:2}}\n                          </div>\n                        </div>\n                      </span>\n                      <span ng-if="vm.parent.potentialInputVisibility != \'one_drugstore\'">\n                        <div class="ui fluid field labeled input" ng-class="{\'error\': proposalForm[\'sellOutAgreedPotentialNetwork_{{drug.id}}\'].$invalid}">\n                          <div class="ui label">\n                            {{drug.sellOut.newAgreedPotential | number:2}}\n                          </div>\n                          <div class="ui label">\n                            <b>&#215;</b>{{vm.amountDrugstores}}\n                          </div>\n                          <input name="sellOutAgreedPotentialNetwork_{{drug.id}}" id="sellOutAgreedPotentialNetwork_{{drug.id}}" type="number" required ng-disabled="vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit" min="{{drug.sellOut.minAgreedPotential * vm.amountDrugstores}}" max="{{drug.sellOut.maxAgreedPotential * vm.amountDrugstores}}" ng-value="{{drug.sellOut.newAgreedPotentialMultiple}}" ng-model="drug.sellOut.newAgreedPotentialMultiple" ng-change="vm.changeNewAgreedPotential(drug, \'sellOut\')" step="1" class="full-input">\n                        </div>\n                      </span>\n                    </td>\n                  </tr>\n                </table>\n              </div>\n              <b>{{drug.sellOut.earns * vm.amountDrugstores | number : drug.sellOut.sign != \'P\' ? 2 : 0}} {{drug.sellOut.sign}}</b>\n            </span>\n\n            <span ng-if="!vm.parent.potentialInputVisibility">\n              <div ng-if="drug.sellOut.newAgreedPotential">\n                <small>{{drug.sellOut.newAgreedPotential * vm.amountDrugstores | number : drug.sellOut.sign != \'P\' ? 2 : 0}} {{drug.sellOut.sign}}</small>\n              </div>\n              <b>{{drug.sellOut.earns * vm.amountDrugstores | number : drug.sellOut.sign != \'P\' ? 2 : 0}} {{drug.sellOut.sign}}</b>\n            </span>\n\n          </div>\n        </div>\n\n      </div>\n\n      <div class="ui grid" ng-if="vm.dataFromKamSoftMkSh && drug.sellOut.visible">\n        <div class="ui two wide column center aligned"></div>\n\n        <div class="ui two wide column center aligned">\n          <div class="ui megacollapsed basic segment">\n            <img src="assets/img/icons/campaigns/market-share.png">\n            <br>\n            <nobr><b class="lightblue small-header">Market Share:</b></nobr>\n          </div>\n        </div>\n\n        <div class="ui seven wide column">\n          <div>\n            <div class="ui column grid">\n              <div class="column center aligned">\n                <!--<h4>Market Share: {{drug.sellOut.mk_sh}}%</h4>-->\n                <div class="ui small progress teal">\n                  <div class="bar" style="width:{{drug.sellOut.mk_sh}}%">\n                    <div class="progress">{{drug.sellOut.mk_sh}}%</div>\n                  </div>\n                  <div class="label"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="ui five wide column left aligned top-padded"></div>\n\n      </div>\n\n      <div class="ui grid" ng-if="vm.page.properties[\'virtual_sell_in_values\'].length">\n        <div class="ui two wide column center aligned"></div>\n\n        <div class="ui ten wide column center aligned">\n          <div class="ui collapsed segment">\n\n            <div class="ui grid">\n\n              <div class="ui three wide column"></div>\n\n              <div class="ui twelve wide column">\n                <div class="ui grid">\n                  <div class="three wide column left aligned">\n                    <img src="assets/img/icons/campaigns/sell-in.png">\n                  </div>\n                  <div class="six wide column">\n                    <div class="ui fluid menu">\n                      <atl-dropdown class="ui fluid dropdown item">\n                        <div class="text">\n                          <div class="header"><nobr><b class="lightblue small-header"></b></nobr> %</div>\n                        </div>\n                        <i class="dropdown icon"></i>\n                        <div class="menu">\n                          <div class="item" ng-repeat="virtual_sell_in in vm.page.properties[\'virtual_sell_in_values\']" ng-style="{\'background-color\':vm.virtual_sell_in_colors[$index]}" ng-click="vm.calculateVirtualPotential(virtual_sell_in.value)">\n                            {{::virtual_sell_in.value}}%\n                          </div>\n                        </div>\n                      </atl-dropdown>\n                    </div>\n                  </div>\n                  <div class="ui seven wide column left aligned">\n                    <img class="ui middle aligned image" src="assets/img/icons/campaigns/icon-money.png">\n                    <span><b>{{vm.virtualPotential | number:2}}</b></span>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n          </div>\n        </div>\n        <div class="ui four wide column left aligned top-padded"></div>\n      </div>\n\n    </div>\n\n  </div>\n\n\n  <div class="ui center aligned attached tertiary collapsed segment segment-heading" ng-if="vm.gifts.length">{{\'GIFTS\' | translate}}</div>\n  <div class="ui grid attached segment" ng-if="vm.gifts.length">\n\n    <div class="one column row">\n\n      <div class="ui center aligned column basic segment collapsed">\n        <div class="ui horizontal list">\n          <div class="item item-gift" ng-repeat="obj in vm.gifts">\n            <div class="ui segment {{obj.color}} button drag-object">\n              <div class="content">\n                <div class="img">\n                  <img ng-if="obj.image" ng-src="{{obj.image}}" id="photo_{{$index}}" alt="photo">\n                  <i ng-hide="obj.image" class="gift big icon"></i>\n                </div>\n                <div class="header" style="font-size: smaller">{{obj.name}}</div>\n                <div class="ui two column grid small-text"><small class="column center aligned">{{obj.points}}<i ng-if="obj.points">p</i></small><small class="column center aligned">{{obj.amount}}</small></div>\n              </div>\n              <div ng-drag="true" ng-drag-data="obj" ng-drag="true" ng-drag-data="obj" ng-drag-start="vm.onDragStart($data,$event)" ng-drag-stop="vm.onDragEnd($data,$event)"></div>\n              <div class="ui floating circular label clickable" ng-click="vm.showGiftInfo(obj)"><i class="icon info"></i></div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="ui column">\n\n        <div class="ui top attached tertiary collapsed segment" ng-if="vm.bagVisibility">{{\'BAG_WITH_GIFTS\' | translate}}<span class="positive-text">Total Reserved: {{vm.reservePoints}}</span></div>\n        <div class="ui bottom attached segment" ng-if="vm.bagVisibility" ng-drop="true" ng-drop-success="vm.onDropComplete($data,$event)">\n          <div>\n            <div class="ui horizontal list">\n              <div class="item" ng-repeat="obj in vm.giftsDropped">\n                <div class="ui {{obj.color}} message" ng-drag="true" ng-drag-data="obj" ng-drag-stop="vm.onDroppedDragEnd($data,$event)">\n                  <div class="content">\n                    <div class="header" style="font-size: x-small">{{obj.title | limitTo: 15}}</div>\n                    <div class="ui two column grid"><span class="column center aligned" ng-if="obj.pointsDropped">{{obj.pointsDropped}}p</span><span class="column right aligned">{{obj.amountDropped}}</span></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n\n  <div class="ui two column grid blue inverted secondary supercollapsed bottom attached basic segment no-border" ng-if="vm.visibleFixedAmount || vm.visibleVariesAmount">\n    <div class="column">\n      <div ng-if="vm.visibleFixedAmount">\n        {{vm.labelFixedAmount}}: {{vm.fixedAmount * vm.amountDrugstores | number : vm.earnedInFixedAmount == \'money\' ? 2 : 0}} <span ng-if="vm.earnedInFixedAmount != \'money\'">P</span>\n      </div>\n    </div>\n    <div class="column right aligned">\n      <!--<div ng-if="vm.visibleVariesAmount">\n        {{amountVaries=vm.getVariesAmount();""}}\n        {{\'AMOUNT_VARIERS\' | translate}}: {{amountVaries.total * vm.amountDrugstores | number : 2}} <span style="display:none">/ {{amountVaries.totalPoints * vm.amountDrugstores}} P</span>\n      </div>-->\n      <div ng-if="vm.visibleVariesAmount && !vm.waiting">\n        {{\'AMOUNT_VARIES\' | translate}}: {{vm.totalAmount.variesAmount.total * vm.amountDrugstores | number : 2}} <span style="display:none">/ {{vm.totalAmount.variesAmount.totalPoints * vm.amountDrugstores}} P</span>\n      </div>\n    </div>\n  </div>\n\n\n</div>\n\n<div class="top-padded" ng-if="vm.page.properties[\'ds_proposal_services_table\'] ? vm.page.properties[\'ds_proposal_services_table\'].visible == \'true\' : \'true\'">\n\n  <div class="ui megacollapsed segment top attached">\n    <table class="ui table striped light sortable">\n      <thead>\n      <tr>\n        <th class="one wide"></th>\n        <th class="four wide">{{vm.page.properties[\'ds_proposal_services_table\'].label || (\'SERVICES\' | translate)}}</th>\n        <th class="one wide"></th>\n        <th class="six wide">{{\'STANDARD_FOR_DRUGSTOR\' | translate}}</th>\n        <th class="two wide">{{\'AMOUNT_ONE_DRUGSTORE\' | translate}}</th>\n        <th class="two wide">{{\'AMOUNT\' | translate}}</th>\n        <th class="one wide">{{\'PHOTO\' | translate}}</th>\n        <th></th>\n      </tr>\n      </thead>\n      <tbody ng-repeat="serviceGroup in vm.groupsServices" class="bordered" ng-class="{\'yellow\':serviceGroup.group}">\n      <tr ng-repeat="service in serviceGroup.services">\n        <td ng-if="$index == 0" rowspan="{{serviceGroup.services.length}}">\n          <div class="ui orange ribbon label" ng-if="serviceGroup.group">\n            {{serviceGroup.groupIndex}}\n            <!--\n            <span ng-if="serviceGroup.group">{{$parent.$index+1}}</span>\n            <span ng-if="!serviceGroup.group">&nbsp;</span>-->\n         </div>\n        </td>\n        <td>\n          <h4 ng-class="(!service.include && service.isBlocksPayment) ? \'ui orange header\': \'ui grey header\'">{{service.title}}</h4>\n        </td>\n        <td>\n          <div class="ui form">\n            <div class="ui toggle checkbox">\n              <input id="serviceInclude_{{service.unique_id}}" type="checkbox" ng-disabled="vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit" ng-model="service.include" ng-true-value="true" ng-false-value="false" ng-change="vm.toggleServiceInclude(service, $index)">\n              <label for="serviceInclude_{{service.unique_id}}"></label>\n            </div>\n          </div>\n        </td>\n        <td>\n          <div ng-class="{\'read-only-content\':!service.include || vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit || service.readOnly}" ng-if="service.type == \'slider\'">\n            <ionslider dataindex="{{service.unique_id}}_{{$index}}" min="{{service.map.startValue}}" max="{{service.map.endValue}}" values="{{service.map.values}}" from="{{service.from}}" grid="true" step="1" from-fixed="{{!service.include || vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit || service.readOnly}}" type="single" field="service" on-change="vm.changeServiceSlider"></ionslider>\n          </div>\n          <div ng-if="service.type == \'radio\'">\n            <label ng-repeat="radio in service.map.values">\n              <input type="radio" id="localization_{{service.unique_id}}_{{$index}}" name="service_{{service.unique_id}}" ng-disabled="!service.include || vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit || service.readOnly" value="{{$index}}" ng-checked="$index==service.from" ng-model="service.from" ng-change="vm.radioChange($parent.service, $index)">\n              {{radio.label}}\n            </label>\n          </div>\n        </td>\n        <td>\n          <div class="ui top attached center aligned" ng-if="service.earnsInit != 0">\n            <a class="ui basic icon button" ng-click="vm.nextServiceEarns(service)" style="box-shadow:none">\n              <i class="caret up large icon"></i>\n            </a>\n          </div>\n          <div class="ui one column grid">\n            <div class="column center aligned" style="margin:0;padding:5px">\n              <div class="ui small field" ng-class="{\'error\': proposalForm[\'inputNumber_{{service.unique_id}}\'].$invalid}">\n                <input type="number" name="inputNumber_{{service.unique_id}}" id="inputNumber_{{service.unique_id}}" required ng-disabled="!service.include || vm.step.readOnly || vm.pageReadOnly || !vm.parent.isVisit || service.readOnly" step="10" ng-pattern="/[0-9]+/" ng-change="vm.changeEarnsNumber(service)" min="{{service.earns_range.min}}" max="{{service.earns_range.max}}" ng-if="service.earnsInit != 0" ng-value="service.earns" ng-model="service.earns" ng-model-options="{debounce: 1000}" atl-integer-multiple-step>\n              </div>\n            </div>\n          </div>\n          <div class="ui bottom attached center aligned" ng-if="service.earnsInit != 0">\n            <a class="ui basic icon button" ng-click="vm.prevServiceEarns(service)" style="box-shadow: none">\n              <i class="caret down large icon" style="color:grey"></i>\n            </a>\n          </div>\n        </td>\n        <td>\n          <nobr ng-if="service.earnsInit != 0">\n            <div class="ui marine image label">{{service.earnsMultiple}}\n             <div class="ui detail">\n              {{service.earns ? service.earns : service.earnsCopy}}&#215;{{service.multiplier}}&#215;{{service.cycleValue}}\n             </div>\n            </div>\n          </nobr>\n        </td>\n        <td>\n          <a href="" ng-click="vm.showStandartPicture(service.standart_img[service.from].src || null)" ng-if="service.standart_img[service.from].src">{{\'PHOTO\' | translate}}</a>\n        </td>\n        <td>\n          <div ng-if="service.isInBudget && !vm.parent.isManager">\n            <!-- <div id="load-bar-frame" atl-popup inline="true" direction="left center">\n              <div id="load-bar" style="background: linear-gradient(to top, #4da8ba {{vm.service_budget[service.budget_id].percent}}%, #feffff {{vm.service_budget[service.budget_id].percent}}%, #feffff 100%)">\n                <i class="dollar large icon"></i>\n              </div>\n            </div> -->\n\n            <div class="money-bag-area" atl-popup inline="true" direction="left center">\n                <div class="money-bag-progress" style="height: {{!vm.errorNotSetBudget ? vm.service_budget[service.budget_id].percent/2 : 0}}px"></div>\n                <div class="money-bag" ng-class="$odd ? \'money-bag-gray\' : \'\'"></div>\n            </div>\n\n            <div class="ui popup" ng-if="!vm.errorNotSetBudget">\n              <h4 ng-if="vm.service_budget[service.budget_id].common_budget_mode">{{\'TITLE_COMMON_BUDGET\' | translate}}</h4>\n              <h4 ng-if="!vm.service_budget[service.budget_id].common_budget_mode">{{\'TITLE_SIMPLE_BUDGET\' | translate}}</h4>\n              <div class="ui two column grid">\n                <div class="right aligned column">\n                  {{\'BUDGET\' | translate}}:\n                </div>\n                <div class="right aligned column">\n                  <a class="ui tag label">{{vm.service_budget[service.budget_id].budget}}</a>\n                </div>\n                <div class="right aligned column">\n                  {{\'BUDGET_USED\' | translate}}:\n                </div>\n                <div class="right aligned column">\n                  <a class="ui green tag label">{{vm.service_budget[service.budget_id].actual}}</a>\n                </div>\n                <!--\n                <div class="right aligned column">\n                  {{vm.service_budget[service.budget_id].actual_bunch[service.drugs_bunch_id].name}}:\n                </div>\n                <div class="right aligned column">\n                  <a class="ui teal tag label">{{vm.service_budget[service.budget_id].actual_bunch[service.drugs_bunch_id].actual}}</a>\n                </div>\n                -->\n                <div class="right aligned column">\n                  {{\'BUDGET_REST\' | translate}}:\n                </div>\n                <div class="right aligned column">\n                  <a class="ui orange tag label">{{vm.service_budget[service.budget_id].restBudget}}</a>\n                </div>\n                <div class="right aligned column" ng-if="vm.service_budget[service.budget_id].overrunBudget">\n                  {{\'BUDGET_OVERRUN\' | translate}}:\n                </div>\n                <div class="right aligned column" ng-if="vm.service_budget[service.budget_id].overrunBudget">\n                  <a class="ui red tag label">{{vm.service_budget[service.budget_id].overrunBudget}}</a>\n                </div>\n                <div class="ui divider"></div>\n                <div class="right aligned column">\n                  {{\'BUDGET_PLANNED\' | translate}}:\n                </div>\n                <div class="right aligned column">\n                  <a class="ui green tag label" ng-class="{\'red\': vm.service_budget[service.budget_id].plannedOverrunBudget}">{{vm.service_budget[service.budget_id].current_planned}}</a>\n                </div>\n                <!--\n                <div class="right aligned column">\n                  <a class="ui green tag label">{{vm.service_budget[service.budget_id].planned}}</a>\n                </div>\n                <div class="right aligned column">\n                  {{\'BUDGET_PLANNED_REST\' | translate}}:\n                </div>\n                <div class="right aligned column">\n                  <a class="ui orange tag label">{{vm.service_budget[service.budget_id].plannedRestBudget}}</a>\n                </div>\n                <div class="right aligned column" ng-if="vm.service_budget[service.budget_id].plannedOverrunBudget">\n                  {{\'BUDGET_PLANNED_OVERRUN\' | translate}}:\n                </div>\n                <div class="right aligned column" ng-if="vm.service_budget[service.budget_id].plannedOverrunBudget">\n                  <a class="ui red tag label">{{vm.service_budget[service.budget_id].plannedOverrunBudget}}</a>\n                </div>\n                -->\n              </div>\n            </div>\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n    <div class="ui basic segment" ng-if="vm.parent.servicesGroups.length && vm.groupsServices.length">\n      <div class="ui ignored info message">\n        <div ng-repeat="serviceGroup in vm.groupsServices" ng-if="serviceGroup.group">\n          <div class="ui grid">\n            <div class="six wide column">{{serviceGroup.groupIndex}}: {{serviceGroup.group.name}}</div>\n            <div class="four wide column left aligned"><span class="ui red circular label">{{serviceGroup.group.mandatory_services_number}}</span> | <span class="ui green circular label">{{vm.includeServicesByGroup[serviceGroup.group.id]}}</span></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="ui two column grid bottom attached blue inverted secondary basic supercollapsed segment no-border">\n    <div class="column">\n      <div>\n        <b><!--Reachout Earnings: 1000 Zł--></b>\n      </div>\n    </div>\n    <div class="column right aligned">\n      <div>\n        <b>{{\'AMOUNT_SERVICES\' | translate}}: {{vm.totalAmount.totalServices | number : 2}}</b>\n      </div>\n    </div>\n  </div>\n\n</div>\n\n<div class="top-padded" ng-if="!vm.waiting">\n\n  <div class="ui center aligned collapsed segment marine-bordered">\n    {{totalAmount=vm.getProposalTotalAmount();""}}\n    <table class="ui most basic table center aligned">\n      <tr ng-if="vm.visibleVariesAmount">\n        <td class="four wide"></td>\n        <td class="six wide">{{\'AMOUNT_VARIES\' | translate}}:</td>\n        <td class="six wide">{{totalAmount.variesAmount.total * vm.amountDrugstores | number : 2}} <span style="display:none">/ {{totalAmount.variesAmount.totalPoints * vm.amountDrugstores}} P</span></td>\n      </tr>\n      <tr ng-if="vm.visibleFixedAmount">\n        <td class="four wide"></td>\n        <td class="six wide">{{vm.labelFixedAmount}}:</td>\n        <td class="six wide">{{vm.fixedAmount * vm.amountDrugstores | number : vm.earnedInFixedAmount == \'money\' ? 2 : 0}} <span ng-if="vm.earnedInFixedAmount != \'money\'">P</span></td>\n      </tr>\n      <tr ng-if="vm.page.properties[\'ds_proposal_services_table\'].visible == \'true\'">\n        <td class="four wide"></td>\n        <td class="six wide">{{\'AMOUNT_SERVICES\' | translate}}:</td>\n        <td class="six wide">{{totalAmount.totalServices | number : 2}}</td>\n      </tr>\n      <tr class="active">\n        <td class="four wide"></td>\n        <td class="six wide"><b>{{\'TOTAL_EARNINGS\' | translate}}:</b></td>\n        <td class="six wide"><b>{{totalAmount.total | number : 2}}<span ng-if="totalAmount.totalPoints"> / {{totalAmount.totalPoints || 0}} P</span></b></td>\n      </tr>\n    </table>\n  </div>\n</div>\n\n<div class="ui center aligned basic segment">\n  <div class="ui three column center aligned grid">\n    <div class="column">\n      <div class="ui large pale button">\n        <i class="cancel icon"></i>\n        {{\'CANCEL\' | translate}}\n      </div>\n    </div>\n\n    <div class="column" ng-if="vm.needRecalculate">\n      <button type="button" class="ui navy large button" ng-disabled="!proposalForm.$valid || vm.lockForm || vm.step.readOnly || vm.pageReadOnly || vm.waiting || vm.needRecalculatePotential" ng-click="vm.resetProposal()">\n        <i class="save icon" ng-hide="vm.lockForm"></i>\n        <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n        {{\'RECALCULATE\' | translate}}\n      </button>\n    </div>\n\n    <div class="column" ng-hide="vm.needRecalculate">\n      <button type="submit" class="ui navy large button" ng-disabled="!proposalForm.$valid || vm.lockForm || vm.step.readOnly || vm.pageReadOnly || vm.waiting">\n        <i class="save icon" ng-hide="vm.lockForm"></i>\n        <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n        {{\'SAVE\' | translate}}\n      </button>\n    </div>\n\n  </div>\n</div>\n</form>\n\n<atl-modal-confirm-dialog modal-id="\'confirmIfBockService\'" modal-title="\'PLEASE_CONFIRM\' | translate" on-confirm="vm.saveProposal()">\n  There are services that are not included, and they block the payments.\n  Are you sure you want to save?\n</atl-modal-confirm-dialog>\n\n\n<atl-modal-form-dialog modal-id="\'showServicePicture\'" show-action="false" modal-title="\'PHOTO\' | translate">\n  <div class="ui grid" style="height:450px">\n    <div class="center aligned one column row">\n      <div class="column">\n        <img ng-src="{{vm.showServiceImg}}" style="max-height:400px">\n      </div>\n    </div>\n  </div>\n</atl-modal-form-dialog>\n\n<atl-modal-form-dialog modal-id="\'showGift\'" show-action="false" modal-title="\'GIFT\' | translate">\n  <div class="ui grid" style="height:430px; overflow: auto">\n    <div class="column center aligned">\n      <div class="ui items">\n\n        <div class="item">\n          <div class="ui one column center aligned grid">\n\n            <div class="column">\n              <img ng-src="{{vm.showGift.image}}" style="max-height:200px">\n            </div>\n\n            <div class="column">\n\n              <div class="header">{{vm.showGift.name}}</div>\n\n              <div class="description">\n                <p>{{vm.showGift.description}}</p>\n              </div>\n\n              <div class="extra">\n                <div class="ui grid center aligned gift-props">\n                  <div class="ui four wide column">\n                    {{\'MARK\' | translate}}: <span class="ui label">{{vm.showGift.mark}}</span>\n                  </div>\n                  <div class="ui four wide column">\n                    {{\'PRICE\' | translate}}: <span class="ui circular label">{{vm.showGift.price}}</span> {{vm.showGift.currency}}\n                  </div>\n                  <div class="ui four wide column" ng-if="vm.showGift.points">\n                    {{\'POINTS\' | translate}}: <span class="ui circular label">{{vm.showGift.points}}</span> p\n                  </div>\n                  <div class="ui four wide column" ng-if="vm.showGift.points">\n                    {{\'AMOUNT\' | translate}}: <span class="ui circular label">{{vm.showGift.amount}}</span>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n</atl-modal-form-dialog>\n\n<atl-modal-form-dialog modal-id="\'showMulti\'" show-action="false" modal-title="\'MULTI_CAMPAIGN\' | translate">\n  <form class="ui form" name="multiForm">\n  <div class="ui grid" style="height: 450px; overflow: auto">\n    <div class="center aligned one column row">\n      <div class="ui segment grid">\n        <div class="ui grid">\n\n          <div class="eight wide column">\n            <div class="ui field">\n              <label for="dateStartCampaign">{{\'CAMPAIGN_DATE_START\' | translate}}</label>\n              <input type="date" id="dateStartCampaign" ng-model="vm.campaignDateStart" readonly="readonly">\n            </div>\n          </div>\n          <div class="eight wide column">\n            <div class="ui field">\n              <label for="dateEndCampaign">{{\'CAMPAIGN_DATE_END\' | translate}}</label>\n              <input type="date" id="dateEndCampaign" ng-model="vm.campaignDateEnd" readonly="readonly">\n            </div>\n          </div>\n          <!--\n          <div class="eight wide column">\n            <div class="ui field">\n              <label for="campaignStatus">{{\'CAMPAIGN_STATUS\' | translate}}</label>\n              <select ng-model="vm.campaignStatus" id="campaignStatus" class="ui dropdown">\n                <option ng-repeat="status in vm.campaignStatuses" value="{{status}}" ng-selected="status == vm.campaignStatus">{{status}}</option>\n              </select>\n            </div>\n          </div>\n          <div class="eight wide column"></div>\n          -->\n\n          <div class="eight wide column">\n            <div class="ui field">\n              <label for="cycleType">{{\'CYCLE_TYPE\' | translate}}</label>\n              <input type="text" id="cycleType" ng-model="vm.parent.campaign.display_campaign_cycle_type" readonly="readonly">\n            </div>\n          </div>\n          <div class="eight wide column">\n            <div class="ui field">\n              <label for="cycleDuration">{{\'SELECT_CYCLE_DURATION\' | translate}}</label>\n              <select ng-model="vm.cycleValue" ng-options="cycleValue for cycleValue in vm.cycleValues" id="cycleDuration" ng-change="vm.changeCycleDuration()" class="ui dropdown">\n              </select>\n            </div>\n          </div>\n\n          <div class="eight wide column">\n            <div class="ui field" ng-class="{\'error\': multiForm[\'dateNameStartCycle\'].$invalid}">\n              <label for="dateStartCycle">{{\'CYCLE_DATE_START\' | translate}}</label>\n              <input type="date" id="dateStartCycle" name="dateNameStartCycle" min="{{vm.cycleDateMin | date:\'yyyy-MM-dd\'}}" max="{{vm.cycleDateMax | date:\'yyyy-MM-dd\'}}" ng-model="vm.cycleDateStart" ng-change="vm.changeCycleDuration()">\n            </div>\n          </div>\n          <div class="eight wide column">\n            <div class="ui field" ng-class="{\'error\': multiForm[\'dateNameEndCycle\'].$invalid}">\n              <label for="dateEndCycle">{{\'CYCLE_DATE_END\' | translate}}</label>\n              <input type="date" id="dateEndCycle" name="dateNameEndCycle" ng-model="vm.cycleDateEnd" max="{{vm.campaignDateEnd | date:\'yyyy-MM-dd\'}}" readonly="readonly">\n            </div>\n          </div>\n\n        </div>\n      </div>\n\n      <div class="right aligned one column row">\n        <button type="button" class="ui navy large button" ng-disabled="vm.lockForm || !multiForm.$valid || vm.step.readOnly || vm.pageReadOnly" ng-click="vm.saveMulti()">\n          <i class="save icon"></i>\n          {{\'SAVE\' | translate}}\n        </button>\n      </div>\n\n    </div>\n  </div>\n  </form>\n</atl-modal-form-dialog>\n<atl-modal-form-dialog modal-id="\'drugstoreNotCompliant\'" show-action="false" modal-title="\'MESSAGE_ATTENTION\' | translate">\n  <p>Apteka nie spełnia zakładanych kryteriów dla tej Kampanii. Propozycja nie zostanie zapisana.</p>\n  <div class="ui right aligned basic segment">\n    <button class="ui marine button" ng-click="vm.parent.hideModal(\'drugstoreNotCompliant\')">Ok</button>\n  </div>\n</atl-modal-form-dialog>\n<atl-modal-form-dialog modal-id="\'drugstoreNotHasPotential\'" show-action="false" modal-title="\'MESSAGE_ATTENTION\' | translate">\n  <p>Potencjał jest zero! Propozycja nie zostanie zapisana.</p>\n  <div class="ui right aligned basic segment">\n    <button class="ui marine button" ng-click="vm.parent.hideModal(\'drugstoreNotHasPotential\')">Ok</button>\n  </div>\n</atl-modal-form-dialog>\n\n</div>\n'),
$templateCache.put("app/campaigns/pages/templates/campaigns.proposalGift.html",'<div class="ui two column grid segment">\n\n    <div class="ui column" ng-repeat="drug in vm.drugsProposal">\n\n        <h3 class="ui center aligned header">{{drug.name}}</h3>\n\n        <div class="ui grid" ng-if="drug.sellIn.visible">\n\n            <div class="ui four wide column right aligned">\n                <div class="ui basic segment">\n                    <b>{{drug.sellIn.label}}</b>\n                </div>\n            </div>\n\n            <div class="ui eight wide column" ng-if="drug.sellIn.visible">\n\n                <div class="ui two column grid">\n                    <div class="column">\n                        <small><!--<span ng-if="drug.sellIn.showPercent">%</span>--></small>\n                    </div>\n                    <div class="column right aligned">\n                        <small><!--<span ng-if="drug.sellIn.showPercent">%</span>--></small>\n                    </div>\n                </div>\n                <div>\n                    <ionslider field="drug.sellIn" type="{{drug.sellIn.type}}" min="{{drug.sellIn.startValue}}" max="{{drug.sellIn.endValue}}" from="{{drug.sellIn.from}}" postfix="{{drug.sellOut.showPercent ? \'%\' : \'\'}}" values="{{drug.sellIn.values.vals}}" grid="true" on-change="vm.changeSlider" step="1"></ionslider>\n                </div>\n            </div>\n            <div class="ui four wide column left aligned">\n                <div class="ui basic segment">\n                    <b>{{drug.sellIn.earns}} {{drug.sellIn.sign}}</b>\n                </div>\n            </div>\n\n        </div>\n\n        <div class="ui grid" ng-if="drug.sellOut.visible">\n\n            <div class="ui four wide column right aligned">\n                <div class="ui basic segment">\n                    <b ng-if="drug.sellIn.earned_visibility">{{drug.sellOut.label}}</b>\n                </div>\n            </div>\n\n            <div class="ui eight wide column">\n\n                <div class="ui two column grid">\n                    <div class="column">\n                        <small><!--<span ng-if="drug.sellOut.showPercent">%</span>--></small>\n                    </div>\n                    <div class="column right aligned">\n                        <small><!--<span ng-if="drug.sellOut.showPercent">%</span>--></small>\n                    </div>\n                </div>\n                <div>\n                    <ionslider field="drug.sellOut" type="{{drug.sellOut.type}}" min="{{drug.sellOut.startValue}}" max="{{drug.sellOut.endValue}}" from="{{drug.sellOut.from}}" postfix="{{drug.sellOut.showPercent ? \'%\' : \'\'}}" values="{{drug.sellOut.values.vals}}" grid="true" step="1" on-change="vm.changeSlider"></ionslider>\n                </div>\n\n            </div>\n            <div class="ui four wide column left aligned">\n                <div class="ui basic segment">\n                    <b ng-if="drug.sellOut.earned_visibility">{{drug.sellOut.earns}} {{drug.sellIn.sign}}</b>\n                </div>\n            </div>\n\n        </div>\n\n\n\n    </div>\n\n    <div class="ui column">&nbsp;</div>\n\n    <div class="ui divider"></div>\n\n    <div class="ui center aligned column">\n        <div class="ui horizontal list">\n            <div class="item" ng-repeat="obj in vm.gifts">\n                <div class="ui segment {{obj.color}} button drag-object">\n                    <div class="content">\n                        <div class="img">\n                            <img ng-if="obj.image" ng-src="{{obj.image}}" id="photo_{{$index}}" alt="photo">\n                            <i ng-hide="obj.image" class="gift big icon"></i>\n                        </div>\n                        <div class="header" style="font-size: smaller">{{obj.name}}</div>\n                        <div class="ui two column grid"><span class="column left aligned" ng-if="obj.points">{{obj.points}}p</span><span class="column right aligned">{{obj.amount}}</span></div>\n                    </div>\n                    <div ng-drag="true" ng-drag-data="obj" ng-drag="true" ng-drag-data="obj" ng-drag-start="vm.onDragStart($data,$event)" ng-drag-stop="vm.onDragEnd($data,$event)"></div>\n                </div>\n\n            </div>\n        </div>\n    </div>\n\n    <div class="ui column">\n\n        <div class="ui segment" ng-if="vm.bagVisibility" ng-drop="true" ng-drop-success="vm.onDropComplete($data,$event)">\n            <div class="ui top left attached label">{{\'BAG_WITH_GIFTS\' | translate}} <span class="positive-text">{{\'TOTAL_RESERVED\' | translate}}: {{vm.reservePoints}}</span></div>\n            <div>\n                <div class="ui horizontal list">\n                    <div class="item" ng-repeat="obj in vm.giftsDropped">\n                        <div class="ui {{obj.color}} message" ng-drag="true" ng-drag-data="obj" ng-drag-stop="vm.onDroppedDragEnd($data,$event)">\n                            <div class="content">\n                                <div class="header" style="font-size: x-small">{{obj.title}}</div>\n                                <div class="ui two column grid"><span class="column center aligned" ng-if="obj.pointsDropped">{{obj.pointsDropped}}p</span><span class="column right aligned">{{obj.amountDropped}}</span></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n    </div>\n\n</div>\n\n\n\n\n\n<div class="ui two column grid">\n    <div class="column">\n        <div class="ui horizontal segment">\n            {{\'FIXED_AMOUNT\' | translate}}: {{vm.fixedAmount}}\n        </div>\n    </div>\n    <div class="column right aligned">\n        <div class="ui horizontal segment">\n            {{\'AMOUNT_VARIERS\' | translate}}: {{vm.getVariesAmount()}}\n        </div>\n    </div>\n</div>\n\n\n\n<div class="ui segments" ng-if="vm.page.properties[\'ds_proposal_services_table\'] ? vm.page.properties[\'ds_proposal_services_table\'].visible == \'true\' : \'true\'">\n    <div class="ui segment">\n        <div class="ui two column grid">\n            <div class="column">\n                <h3>{{vm.page.properties[\'ds_proposal_services_table\'].label || (\'SERVICES\' | translate)}}</h3>\n            </div>\n            <div class="right aligned column">\n                <i class="icon dropdown"></i>\n            </div>\n        </div>\n    </div>\n    <div class="ui secondary segment">\n\n\n        <div class="ui grid" ng-repeat="service in vm.servicesProperties">\n\n            <div class="ui four wide column right aligned">\n                <div class="ui basic segment">\n                    <b>{{service.title}}</b>\n                </div>\n            </div>\n\n            <div class="ui eight wide column" ng-if="service.type == \'slider\'">\n\n                <!--<div class="ui two column grid">\n                    <div class="column">\n                        <small>10000</small>\n                    </div>\n                    <div class="column right aligned">\n                        <small>30000</small>\n                    </div>\n                </div>-->\n                <div>\n                    <ionslider dataindex="{{$index}}" min="{{service.map.startValue}}" max="{{service.map.endValue}}" from="{{service.from}}" values="{{service.map.values}}" grid="true" step="1" type="single" field="service" on-change="vm.changeServiceSlider"></ionslider>\n                </div>\n\n\n            </div>\n\n            <div class="ui eight wide column" ng-if="service.type == \'radio\'">\n                <div class="ui center aligned segment">\n\n                    <label ng-repeat="radio in service.map.values"><input type="radio" id="localization_{{$index}}" name="servicegift_{{$parent.$index}}" value="{{radio.earned}}" ng-checked="$index==service.from" ng-model="$parent.service.earns" ng-change="vm.servicesProperties[$parent.$index].from = $index;"> {{radio.name}}</label>\n\n                </div>\n            </div>\n\n            <div class="ui four wide column left aligned">\n                <div class="ui basic segment">\n                    <b>{{service.earns}}</b>\n                </div>\n            </div>\n\n        </div>\n\n\n    </div>\n</div>\n\n\n\n<div class="ui two column grid">\n    <div class="column">\n        <div class="ui horizontal segment">\n            <b><!--Reachout Earnings: 1000 Zł--></b>\n        </div>\n    </div>\n    <div class="column right aligned">\n        <div class="ui horizontal segment">\n            <b>{{\'TOTAL_EARNINGS\' | translate}}: {{vm.getProposalTotalAmount()}}</b>\n        </div>\n    </div>\n</div>\n\n\n\n\n\n\n<div class="ui center aligned basic segment">\n  <div class="ui two column center aligned grid">\n\t<div class="column">\n\t  <div class="ui large pale button">\n\t\t<i class="cancel icon"></i>\n\t\t{{\'CANCEL\' | translate}}\n\t  </div>\n\t</div>\n\t<div class="column">\n\t  <button type="submit" class="ui navy large button" data-modal="podsumowanie" ng-click="vm.saveProposal()">\n\t\t<i class="save icon"></i>\n\t\t{{\'SAVE\' | translate}}\n\t  </button>\n\t</div>\n  </div>\n</div>\n\n\n\n\n\n<!-- <div class="ui segment two column grid">\n\n    <div class="ui column">\n\n        <div id="saveProposalGifts" class="large ui positive button modal-call" data-modal="podsumowanie"  ng-click="vm.saveProposal()">\n            <i class="icon checkmark"></i>\n            Save\n        </div>\n\n        <div class="large ui negative button">\n            <i class="icon cancel"></i>\n            Cancel\n        </div>\n\n    </div>\n\n    <div class="ui right aligned column">\n\n        <div class="large ui inverted blue button" ng-click="vm.goToTemplate(\'proposal\')">\n            <a><i class="icon arrow left"></i> Previous</a>\n        </div>\n\n    </div>\n\n</div> -->\n'),$templateCache.put("app/campaigns/pages/templates/campaigns.proposalTotal.html",'<div ng-controller="CampaignsProposalTotalController as vm">\n\n  <div class="ui basic segment supercollapsed" ng-if="vm.messageSelling">\n    <div class="ui two column left aligned grid">\n      <div class="left aligned column"></div>\n      <div class="right aligned column">\n        <div class="{{vm.messageSellingClass}}">\n          <b>{{vm.messageSelling | translate}}</b>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="ui segment marine top attached no-border segment-heading-white collapsed">\n    {{\'PROPOSAL_TOTAL\' | translate}}\n  </div>\n\n  <div class="ui segment attached" ng-if="!vm.waiting">\n    <div class="ui grid" ng-if="vm.parent.campaignProposal.length">\n      <div class="ui four wide column"></div>\n      <div class="ui eight wide column">\n        <table class="ui most basic table">\n          <tr ng-if="vm.newAgreedPotential.sellIn || vm.newAgreedPotential.sellOut">\n            <td>{{\'POTENTIAL\' | translate}}</td>\n            <td class="right aligned">\n              <span ng-if="vm.newAgreedPotential.sellIn>=0 && vm.parent.dominant == \'sell_in\'">\n                {{vm.newAgreedPotential.sellIn * vm.multiplier | number : 2}}\n              </span>\n              <span ng-if="vm.newAgreedPotential.sellOut>=0 && vm.parent.dominant == \'sell_out\'">\n                {{vm.newAgreedPotential.sellOut * vm.multiplier | number : 2}}\n              </span>\n            </td>\n          </tr>\n          <tr ng-if="vm.dataKamSoftMkSh" ng-repeat="data_mk_sh in vm.dataKamSoftMkSh">\n            <td>{{\'MARKET_SHARE\' | translate}} ({{data_mk_sh.group_name}})</td>\n            <td class="right aligned">{{data_mk_sh.mk_sh}}%</td>\n          </tr>\n          <tr ng-if="vm.variesAmount || vm.variesAmountPoints">\n            <td>{{\'AMOUNT_VARIES\' | translate}}</td>\n            <td class="right aligned">{{vm.variesAmount | number : 2}} <span style="display:none">/ {{vm.variesAmountPoints}} P</span></td>\n          </tr>\n          <tr ng-if="vm.variesAmount || vm.variesAmountPoints">\n            <td colspan="2" class="bottom-bordered"></td>\n          </tr>\n          <tr>\n            <td colspan="2">{{\'SERVICES\'  | translate}}:</td>\n          </tr>\n          <tr ng-repeat="service in vm.services" ng-if="service.include">\n            <td>{{service.title}}</td>\n            <td class="right aligned"><span ng-if="service.earnsMultiple!=0">{{service.earnsMultiple | number : 2}}</span></td>\n          </tr>\n          <!--\n          <tr>\n            <td colspan="2" class="bottom-bordered"></td>\n          </tr>\n          <tr>\n            <td>{{\'TOTAL\' | translate}}</td>\n            <td class="right aligned">{{vm.total | number : 2}}<span style="display:none"> / {{vm.variesAmountPoints}} P</span></td>\n          </tr>\n          <tr>\n            <td><b>{{\'AMOUNT_SERVICES\' | translate}}</b></td>\n            <td><b>{{vm.servicesEarned}}</b></td>\n          </tr>-->\n        </table>\n      </div>\n      <div class="ui four wide column"></div>\n\n      <div class="ui four wide column"></div>\n      <div class="ui eight wide column">\n        <div class="ui segment attached">\n          <table class="ui most basic table">\n            <tr ng-if="vm.fixedAmount">\n              <td>{{\'BONUS\' | translate}}</td>\n              <td class="right aligned">{{vm.fixedAmount * vm.multiplier | number : 2}}</td>\n            </tr>\n            <tr ng-if="vm.variesAmount || vm.variesAmountPoints">\n              <td>{{\'AMOUNT_VARIES\' | translate}}:</td>\n              <td class="right aligned">{{vm.variesAmount | number : 2}} <span ng-if="vm.variesAmountPoints">/ {{vm.variesAmountPoints}} P</span></td>\n            </tr>\n            <tr>\n              <td>{{\'AMOUNT_SERVICES\' | translate}}:</td>\n              <td class="right aligned">{{vm.servicesEarned | number : 2}}</td>\n            </tr>\n            <tr class="active">\n              <td><b>{{\'TOTAL_EARNINGS\' | translate}}:</b></td>\n              <td class="right aligned"><b>{{vm.total | number : 2}}<span ng-if="vm.variesAmountPoints"> / {{vm.variesAmountPoints}} P</span></b></td>\n            </tr>\n          </table>\n        </div>\n      </div>\n      <div class="ui four wide column"></div>\n\n      <div class="ui four wide column"></div>\n      <div class="ui eight wide column">\n        <div class="ui segment attached">\n          <table class="ui most basic table" style="font-size: small">\n            <thead>\n            <tr>\n              <th>{{\'CAMPAIGN_DATE\' | translate}}</th>\n              <th ng-if="vm.parent.campaign.campaign_scale == \'multi\'">{{\'CYCLE_DATE\' | translate}}</th>\n              <th ng-if="vm.parent.campaign.campaign_scale == \'multi\'">{{\'CYCLE_DURATION\' | translate}}</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr>\n              <td>{{vm.parent.period.campaign_start | date:\'dd.MM.yyyy\'}} &mdash; {{vm.parent.period.campaign_end | date:\'dd.MM.yyyy\'}}</td>\n              <td ng-if="vm.parent.campaign.campaign_scale == \'multi\'">\n                {{vm.cycleStartDisplay | date:\'dd.MM.yyyy\'}} &mdash; {{vm.cycleEndDisplay | date:\'dd.MM.yyyy\'}}\n              </td>\n              <td ng-if="vm.parent.campaign.campaign_scale == \'multi\'">\n                {{vm.parent.campaignProgress.cycle_number || 1}}\n              </td>\n            </tr>\n            </tbody>\n          </table>\n          <div class="ui divider"></div>\n          <table class="ui most basic table" style="font-size: small">\n            <thead>\n            <tr>\n              <th>{{\'NAME\' | translate}}</th>\n              <th>{{\'CITY\' | translate}}</th>\n              <th>{{\'STREET\' | translate}}</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="pharmacy in vm.drugstores">\n              <td>{{::pharmacy.name}}</td>\n              <td>{{::pharmacy.address.city.name}}</td>\n              <td>{{::pharmacy.address.address_line_1}}</td>\n            </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n      <div class="ui four wide column"></div>\n    </div>\n\n    <div class="ui grid">\n      <div class="ui four wide column"></div>\n      <div class="ui eight wide column">\n        <!--<small>{{\'INFO_ABOUT_ONSEND\' | translate}}</small>-->\n        <small>Po kliknięciu "{{\'GENERATE_PROPOSAL\' | translate}}",\n          zlecienie zostanie automatycznie wygenerowane i przesłane na adres\n          {{vm.parent.drugstore.email}} Aby rozpocząć Kampanię, Apteka musi zaakceptować zlecenie.\n        </small>\n      </div>\n      <div class="ui four wide column"></div>\n    </div>\n\n    <div class="ui center aligned basic segment">\n      <div class="ui two column center aligned grid">\n        <div class="column">\n          <!-- please attach ng-if to the button below to save the column -->\n          <div class="ui large pale button">\n            <i class="cancel icon"></i>\n            {{\'CANCEL\' | translate}}\n          </div>\n        </div>\n        <div class="column">\n          <button type="button" ng-class="{pale: !vm.parent.campaignProposal.length || vm.parent.step.readOnly, marine: vm.parent.campaignProposal.length}" class="ui large button" ng-disabled="vm.lockForm || vm.generateDisabled" ng-click="vm.generateProposal()">\n            <i class="send icon" ng-hide="vm.lockForm"></i>\n            <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n            {{\'GENERATE_PROPOSAL\' | translate}}\n          </button>\n        </div>\n        <!--<div class="column">-->\n        <!--&lt;!&ndash; please attach ng-if to the button below to save the column &ndash;&gt;-->\n        <!--<button type="button" class="ui navy large button"-->\n        <!--ng-class="{\'pale\':vm.parent.campaignProgressActiveId}"-->\n        <!--ng-disabled="vm.parent.campaignProgressActiveId || vm.pageReadOnly || !vm.parent.isVisit" ng-click="vm.startCampaign()">-->\n        <!--<i class="play icon"></i>-->\n        <!--{{\'START_CAMPAIGN\' | translate}}-->\n        <!--</button>-->\n        <!--</div>-->\n      </div>\n    </div>\n\n  </div>\n\n  <div class="ui segment marine bottom attached no-border collapsed"></div>\n\n\n  <atl-modal-confirm-dialog modal-id="\'confirmSetMulti\'" modal-title="\'PROPOSAL_DURATION\' | translate" ok-disabled="vm.parent.step.readOnly" on-confirm="vm.sendProposalTotal()">\n    {{\'CONFIRM_MULTI_CYCLE\' | translate}}\n  </atl-modal-confirm-dialog>\n  <atl-modal-form-dialog modal-id="\'drugstoreWithoutAddress\'" show-action="false" modal-title="\'MESSAGE_ATTENTION\' | translate">\n    <p>Brak potrzebnych danych apteki. Zlecenie nie może być zgenerowane.</p>\n    <div class="ui right aligned basic segment">\n      <button class="ui marine button" ng-click="vm.parent.hideModal(\'drugstoreWithoutAddress\')">Ok</button>\n    </div>\n  </atl-modal-form-dialog>\n  <atl-modal-form-dialog modal-id="\'proposalTotalZero\'" show-action="false" modal-title="\'MESSAGE_ATTENTION\' | translate">\n    <p>Wartość zlecenia zero. Zlecenie nie zostanie zgenerowane.</p>\n    <div class="ui right aligned basic segment">\n      <button class="ui marine button" ng-click="vm.parent.hideModal(\'proposalTotalZero\')">Ok</button>\n    </div>\n  </atl-modal-form-dialog>\n\n</div>'),$templateCache.put("app/campaigns/pages/templates/campaigns.sellingInfo.html",'<div ng-controller="CampaignsSellingInfoController as vm">\n<div class="ui basic segment collapsed">\n\n  <div class="ui three column left aligned grid">\n    <div class="left aligned column">\n      <p>{{\'PERIOD\' | translate}}: <b>{{vm.parent.period.start | date:\'dd.MM.yyyy\' }} — {{vm.parent.period.end | date:\'dd.MM.yyyy\'}}</b></p>\n    </div>\n    <div class="center aligned column">\n      <div ng-if="vm.messageSelling" class="{{vm.messageSellingClass}}">\n        <b>{{vm.messageSelling | translate}}</b><br>\n        <span ng-if="vm.addMessageSelling">{{vm.addMessageSelling}}</span>\n      </div>\n    </div>\n    <div class="right aligned column" ng-if="vm.column.btn_photo.visible">\n      <div class="ui marine button">\n        <label for="uploadFormFile"><i class="download icon"></i>\n          <input type="hidden" name="uploadFormFileId">\n          <input type="file" capture="camera" accept="image/*" id="uploadFormFile" style="display:none">\n          {{vm.column.btn_photo.label}}\n        </label>\n      </div>\n    </div>\n  </div>\n\n</div>\n\n\n<form class="ui form" name="sellingForm" autocomplete="off" novalidate ng-submit="sellingForm.$valid && vm.saveSellingInfo(true)">\n\n  <div class="ui three column left aligned grid" ng-if="vm.dataFromKamSoftMkSh && !vm.useCycle">\n    <div class="left aligned six wide column">\n      <div class="ui left floated compact menu no-border">\n        <button type="button" class="ui marine button" ng-click="vm.parent.getKamSoftDataDailyMarketShareReports([vm.parent.period.start, vm.parent.period.now])" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n          <i class="download icon"></i>\n          {{\'GET_MARKET_SHARE\' | translate}}\n        </button>\n      </div>\n      <div class="ui left floated compact menu no-border">\n        <span class="campaign-inner-counter-apteka">\n\t\t\t    <img src="assets/img/icons/campaigns/campaign-icons/apteka-orchid-smaller.png">\n\t\t\t    <span class="floating ui teal circular tiny label">{{vm.parent.counterKamsoftDrugstores}}</span>\n\t\t    </span>\n      </div>\n    </div>\n    <div class="center aligned six wide column"></div>\n    <div class="right aligned four wide column"></div>\n  </div>\n\n  <div class="ui three column left aligned grid" ng-if="vm.dataFromKamSoft">\n    <div class="left aligned four wide column">\n      <button type="button" class="ui marine button" ng-click="vm.parent.showBarCodeScanner()" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n        <i class="qrcode icon"></i>\n        QR Code\n      </button>\n    </div>\n\n    <div class="center aligned eight wide column">\n      <div class="ui two column left aligned grid">\n        <div class="left aligned nine wide column">\n          <button type="button" class="ui green button" ng-class="{\'orange\': vm.canEditData}" ng-click="vm.editKamSoftData()" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n            <i class="edit icon"></i>\n            Edit KAM Soft data\n          </button>\n        </div>\n        <div class="left aligned seven wide column">\n          <div class="ui buttons">\n            <div class="ui left icon compact button" ng-class="{\'green\': vm.kamSoftPicture && vm.kamSoftPicture.src, \'pale\': vm.parent.lockForm}">\n              <label for="takePictureKam" class="no-space"><i class="camera icon"></i>\n                <input type="hidden" name="kamPicture" ng-model="vm.kamSoftPicture">\n                <input type="file" capture="camera" accept="image/*" id="takePictureKam" style="display:none" onchange="angular.element(this).scope().$parent.loadPhoto(this, angular.element(this).scope().vm.kamSoftPicture)" ng-disabled="vm.lockForm || !vm.canEditData">\n                Photo\n              </label>\n            </div>\n            <div class="ui compact button grayb" ng-class="{\'pale\': vm.parent.lockForm}" ng-click="vm.showKamSoftPicture()"><i class="unhide icon"></i></div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="right aligned four wide column">\n      <!--\n      <button type="button" class="ui marine button" ng-click="vm.parent.getKamSoftData()" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n        <i class="download icon"></i>\n        Get KAM Soft data\n      </button>\n      -->\n    </div>\n\n  </div>\n\n  <div class="ui three column left aligned grid" ng-if="vm.useCycle">\n    <div class="left aligned column">\n      <div ng-if="vm.dataFromKamSoftMkSh">\n        <div class="ui left floated compact menu no-border">\n          <button type="button" class="ui marine button" ng-click="vm.parent.getKamSoftDataDailyMarketShareReports([vm.parent.period.start, vm.parent.period.now])" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || vm.parent.lockForm">\n            <i class="download icon"></i>\n            {{\'GET_MARKET_SHARE\' | translate}}\n          </button>\n        </div>\n        <div class="ui left floated compact menu no-border">\n          <span class="campaign-inner-counter-apteka">\n\t  \t\t    <img src="assets/img/icons/campaigns/campaign-icons/apteka-orchid-smaller.png">\n\t\t  \t    <span class="floating ui teal circular tiny label">{{vm.parent.counterKamsoftDrugstores}}</span>\n\t\t      </span>\n        </div>\n      </div>\n    </div>\n    <div class="center aligned column">\n      <span>{{\'CURRENT_CYCLE\' | translate}}:</span> <span class="ui circular big label cycle_counter" ng-class="{\'green\': !vm.cycleNewCounter, \'marine\': vm.cycleNewCounter}">{{vm.cycleCounter}}</span>\n      <button type="button" class="ui marine icon button" ng-disabled="vm.cycleCounterDisabled" ng-click="vm.changeCycleNumber()">\n        <i class="plus icon"></i>\n      </button>\n    </div>\n    <div class="right aligned column">\n      <span>{{\'MIN_CYCLE_NUMBER\' | translate}}:</span> <span class="ui red circular big label">{{vm.minCycleNumber}}</span>\n    </div>\n\n  </div>\n\n  <div class="ui left aligned megacollapsed tertiary segment">\n    <atl-accordion>\n      <div class="title active left-padded">\n        <i class="dropdown icon"></i>\n        <span>{{\'DRUGS_GROUPS\' | translate}}</span>\n      </div>\n      <div class="content active">\n        <table class="ui striped table">\n          <thead>\n          <tr>\n            <th class="one wide">{{\'GROUP\' | translate}}</th>\n            <th class="six wide">{{\'NAME\' | translate}}</th>\n            <th ng-if="vm.column[\'sellIn\'].visibility">{{vm.column[\'sellIn\'].label}}</th>\n            <th ng-if="vm.column[\'sellOut\'].visibility">{{vm.column[\'sellOut\'].label}}</th>\n            <th ng-if="vm.column[\'stock\'].visibility">{{vm.column[\'stock\'].label}}</th>\n          </tr>\n          </thead>\n          <tbody ng-repeat="group in vm.groupBy">\n          <tr ng-repeat="drug in group.groups">\n            <td rowspan="{{group.groups.length}}" ng-if="$index == 0"><div class="ui blue ribbon label">{{group.name}}</div></td>\n            <td>{{drug.name}}</td>\n            <td ng-if="vm.column[\'sellIn\'].visibility"><input type="number" step="1" autocomplete="off" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || !vm.canEditData" name="sellInInfo{{$index}}" ng-model="drug.sellIn" ng-value="0" ng-change="vm.changeSellField(group, drug, \'sellIn\')" ng-style="vm.selling_style"></td>\n            <td ng-if="vm.column[\'sellOut\'].visibility"><input type="number" step="1" autocomplete="off" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || !vm.canEditData" name="sellOutInfo{{$index}}" ng-model="drug.sellOut" ng-value="0" ng-change="vm.changeSellField(group, drug, \'sellOut\')" ng-style="vm.selling_style"></td>\n            <td ng-if="vm.column[\'stock\'].visibility"><input ng-style="vm.selling_style" type="number" step="1" autocomplete="off" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly || !vm.canEditData" name="sellStockInfo{{$index}}" ng-model="drug.stock" ng-change="vm.changeSellField(group, drug, \'stock\')"></td>\n          </tr>\n          </tbody>\n          <tbody>\n          <tr class="warning">\n            <td></td>\n            <td><b>{{\'TOTAL_MONEY\' | translate}}</b></td>\n            <td ng-if="vm.column[\'sellIn\'].visibility"><input type="text" value="{{vm.sellInTotal || 0 | number:2}}" readonly="readonly"></td>\n            <td ng-if="vm.column[\'sellOut\'].visibility"><input type="text" value="{{vm.sellOutTotal || 0 | number:2}}" readonly="readonly"></td>\n            <td ng-if="vm.column[\'stock\'].visibility"><input type="text" value="{{vm.stockTotal || 0 | number:2}}" readonly="readonly"></td>\n          </tr>\n          </tbody>\n        </table>\n      </div>\n    </atl-accordion>\n  </div>\n\n\n  <div class="ui segment grid">\n\n    <div class="ui four wide column center aligned">\n      <div>\n        <div class="ui-knob">\n          <atl-knob knob-data="vm.percentDays" knob-change-value="vm.campaignDaysBeforeEnd" width="150" height="150" read-only="true" display-previous="true"></atl-knob>\n          <p>{{\'DAYS_LEFT\' | translate}}</p>\n        </div>\n      </div>\n      <br><br>\n      <div ng-if="vm.campaign.campaign_scale == \'multi\'">\n        <div class="ui-knob ui-knob-small">\n          <atl-knob knob-data="vm.cyclePercentDays" knob-change-value="vm.cycleDaysBeforeEnd" width="75" height="75" display-previous="true" read-only="true" fg-color="#a44575"></atl-knob>\n          <p>{{\'DAYS_LEFT\' | translate}}</p>\n        </div>\n      </div>\n\n    </div>\n\n    <div class="ui twelve wide column">\n\n      <!-- <div class="ui two column grid segment"> -->\n      <div class="ui basic megacollapsed attached segment" ng-repeat="group in vm.groupBy">\n        <div class="ui center aligned attached tertiary collapsed segment segment-heading">{{group.name}}</div>\n\n        <!-- progressbar content div -->\n        <div class="ui attached segment">\n\n          <div class="ui grid" ng-if="vm.properties[group.id].sellIn.visible && vm.column[\'sellIn\'].visibility">\n\n            <div class="ui four wide column center aligned">\n              <div class="ui basic segment">\n                <img src="assets/img/icons/campaigns/sell-in.png">\n                <br>\n                <b class="lightblue small-header">{{\'SELL_IN\' | translate}}</b>\n              </div>\n            </div>\n\n            <div class="ui twelve wide column">\n\n              <div class="ui grid">\n\n                <div class="ui twelve wide column">\n\n                  <div class="ui two column grid">\n                    <div class="column">\n                      <small>0%</small>\n                    </div>\n                    <div class="column right aligned">\n                      <small>100%</small>\n                    </div>\n                  </div>\n\n                  <div class="ui small progress teal">\n                    <div class="bar" style="width:{{group.sellInPointsProgress}}%">\n                      <div class="progress">{{group.sellInRealPointsProgress}}%</div>\n                    </div>\n                    <div class="for-small-bar" ng-if="group.sellInHundredsNumber">\n                      <div class="bar small-bar" ng-repeat="n in [] | range:group.sellInHundredsNumber" style="width:{{group.sellInRealPointsProgress-100 * (n+1) >100 ? 100 : group.sellInRealPointsProgress-100 * (n+1)}}%; background: #{{vm.colors[n]}} !important">\n                      </div>\n                    </div>\n                    <div class="mark light" style="left:{{group.sellInMinPercent}}%"> <small class="mark-text">{{group.sellInMinPercent}}%</small></div>\n                    <!-- <div class="label">{{group.sellInRealPointsProgress}}%</div> -->\n                  </div>\n\n                </div>\n                <div class="ui four wide column">\n                  <div class="ui basic segment" ng-if="vm.properties[group.id].earned_visibility.sellIn">\n                    <b>{{group.sellInMoney * vm.multiplier | number : group.sellInSign != \'P\' ? 2 : 0 || 0.00}} {{group.sellInSign}}</b>\n                  </div>\n                </div>\n\n              </div>\n\n            </div>\n          </div>\n\n          <div class="ui grid" ng-if="vm.properties[group.id].sellOut.visible && vm.column[\'sellOut\'].visibility">\n\n            <div class="ui four wide column center aligned">\n              <div class="ui basic segment">\n                <img src="assets/img/icons/campaigns/sell-out.png">\n                <br>\n                <b class="lightblue small-header">{{\'SELL_OUT\' | translate}}</b>\n              </div>\n            </div>\n\n            <div class="ui twelve wide column">\n\n              <div class="ui grid">\n\n                <div class="ui twelve wide column">\n\n                  <div class="ui two column grid">\n                    <div class="column">\n                      <small>0%</small>\n                    </div>\n                    <div class="column right aligned">\n                      <small>100%</small>\n                    </div>\n                  </div>\n\n                  <div class="ui small progress teal">\n                    <div class="bar" style="width:{{group.sellOutPointsProgress}}%">\n                      <div class="progress">{{group.sellOutRealPointsProgress}}%</div>\n                    </div>\n                    <div class="for-small-bar" ng-if="group.sellOutHundredsNumber">\n                      <div class="bar small-bar" ng-repeat="n in [] | range:group.sellOutHundredsNumber" style="width:{{group.sellOutRealPointsProgress-100 * (n+1) >100 ? 100 : group.sellOutRealPointsProgress-100 * (n+1)}}%; background: #{{vm.colors[n]}} !important">\n                      </div>\n                    </div>\n                    <div class="mark light" style="left:{{group.sellOutMinPercent}}%"> <small class="mark-text">{{group.sellOutMinPercent}}%</small></div>\n                    <div class="label"></div>\n                  </div>\n\n                </div>\n                <div class="ui four wide column">\n                  <div class="ui basic segment" ng-if="vm.properties[group.id].earned_visibility.sellOut && !vm.dataFromKamSoftMkSh">\n                    <b>{{group.sellOutMoney * vm.multiplier | number : group.sellOutSign != \'P\' ? 2 : 0 || 0.00}} {{group.sellOutSign}}</b>\n                  </div>\n                </div>\n\n              </div>\n            </div>\n\n          </div>\n\n          <div class="ui grid" ng-if="vm.dataFromKamSoftMkSh">\n            <div class="ui four wide column center aligned">\n              <div class="ui basic segment">\n                <img src="assets/img/icons/campaigns/market-share.png">\n                <br>\n                <b class="lightblue small-header">Market Share</b>\n              </div>\n            </div>\n\n            <div class="ui twelve wide column">\n\n              <div class="ui grid">\n\n                <div class="ui twelve wide column">\n\n                  <div class="ui two column grid">\n                    <div class="column">\n                      <small>0%</small>\n                    </div>\n                    <div class="column right aligned">\n                      <small>{{100}}%</small>\n                    </div>\n                  </div>\n\n                  <div class="ui small progress teal">\n                    <div class="bar" style="width:{{group.mkShPointsProgress}}%">\n                      <div class="progress">{{group.mkShPointsProgress}}%</div>\n                    </div>\n                    <div class="mark red" style="left:{{group.sellOutMkSh}}%"> <small class="mark-text">{{group.sellOutMkSh}}</small></div>\n                    <div class="label"></div>\n                  </div>\n\n                </div>\n                <div class="ui four wide column">\n                  <div class="ui basic segment" ng-if="vm.properties[group.id].earned_visibility.sellOut">\n                    <b>{{group.sellOutMoney * vm.multiplier | number : group.sellOutSign != \'P\' ? 2 : 0 || 0.00}} {{group.sellOutSign}}</b>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <!-- end progressbar content div -->\n        </div>\n      </div>\n\n      <!-- </div> -->\n\n    </div>\n\n  </div>\n\n  <div class="ui segment grid" ng-if="vm.dataFromKamSoftMkSh">\n    <div class="ui sixteen wide column">\n      <nvd3 options="options" data="chartData"></nvd3>\n    </div>\n\n  </div>\n\n\n\n  <div class="ui center aligned basic segment">\n    <div class="ui two column center aligned grid">\n      <div class="column">\n        <div class="ui large pale button">\n          <i class="cancel icon"></i>\n          {{\'CANCEL\' | translate}}\n        </div>\n      </div>\n      <div class="column">\n        <button type="submit" class="ui navy large button" ng-disabled="vm.lockForm || vm.parent.lockForm || vm.step.readOnly || vm.pageReadOnly || vm.specialDisable">\n          <i class="save icon" ng-hide="vm.lockForm || vm.parent.lockForm"></i>\n          <span class="ui active mini inline loader" ng-if="vm.lockForm || vm.parent.lockForm"></span>\n          {{\'SAVE\' | translate}}\n        </button>\n      </div>\n      <!--\n      <div class="column" ng-if="vm.page.needCloseStep">\n        <button class="ui large navy button" ng-click="vm.parent.closeStep(vm.parent.step)" ng-disabled="!vm.parent.isVisit || vm.step.readOnly || vm.pageReadOnly">\n          <i class="checkmark box icon"></i>\n          {{\'ClOSE_STEP\' | translate}}\n        </button>\n      </div>\n      -->\n    </div>\n  </div>\n</form>\n<atl-modal-confirm-dialog modal-id="\'confirmCloseStep\'" modal-title="\'CLOSE_STEP\' | translate" on-confirm="vm.saveSelling(true)">\n  {{\'CONFIRM_CLOSE_STEP_SELLING\' | translate}}\n</atl-modal-confirm-dialog>\n<atl-modal-confirm-dialog modal-id="\'confirmSaved\'" modal-title="\'CONFIRM_SAVING_DATA\' | translate" on-confirm="vm.saveSelling(false)">\n  Czy chcesz zapisać wprowadzone dane przed opuszczeniem strony?\n</atl-modal-confirm-dialog>\n<atl-modal-form-dialog modal-id="\'showKamSoftPicture\'" show-action="false" modal-title="\'PHOTO\' | translate">\n  <div class="ui grid" style="height:550px">\n    <div class="center aligned one column row">\n      <div class="column">\n        <img ng-src="{{vm.showImg}}" style="max-height:500px">\n      </div>\n    </div>\n  </div>\n</atl-modal-form-dialog>\n</div>'),
$templateCache.put("app/gazetki/templates/previewTemplates/tlo1_3moduly.html",'<!--<div class="ui link cards gazetka-background center aligned container"-->\n<!--style="background-image: url(\'{{(vm.gazetka.backgrounds[vm.currentPreviewPage] !== undefined ? (vm.imagesPath + \'background/\' + vm.gazetka.pages[vm.currentPreviewPage].backgrounds[vm.gazetka.backgrounds[vm.currentPreviewPage]].name) : \'\')}}\')">-->\n<!--top-->\n\n<div class="ui grid gazetka-background gazetki-layout-preview-3">\n\t <div class="ui grid">\n\t\t<div class="ui sixteen wide column bottom-collapsed">\n\t\t\t<div class="ui segment short-segment">\n\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[0].price}}\n\t\t\t</div>\n\t\t\t\t<div class="ui two column grid">\n\t\t\t\t\t<div class="ui bottom aligned column">\n\t\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].header}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].subheader}}</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].description}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui column">\n\t\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].image.name}}" alt="no image">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[0].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[0].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="ui grid">\n\t\t<div class="ui eight wide column">\n\t\t\t<div class="ui segment">\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[1].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[1].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[1].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ui eight wide column">\n\t\t\t<div class="ui segment gazetki-3-3">\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[2].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[2].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[2].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'),$templateCache.put("app/gazetki/templates/previewTemplates/tlo1_4moduly.html",'<!--<div class="ui link cards gazetka-background center aligned container"-->\n<!--style="background-image: url(\'{{(vm.gazetka.backgrounds[vm.currentPreviewPage] !== undefined ? (vm.imagesPath + \'background/\' + vm.gazetka.pages[vm.currentPreviewPage].backgrounds[vm.gazetka.backgrounds[vm.currentPreviewPage]].name) : \'\')}}\')">-->\n<!--top-->\n\n<div class="ui grid gazetka-background gazetki-layout-preview-4">\n    <div class="ui grid">\n\t\t<div class="ui eight wide column bottom-collapsed">\n\t\t\t<div class="ui segment">\n\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[0].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[0].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[0].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class="ui eight wide column bottom-collapsed">\n\t\t\t<div class="ui segment gazetki-3-3">\n\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[1].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[1].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[1].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="ui eight wide column">\n\t\t\t<div class="ui segment">\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[2].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[2].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[2].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ui eight wide column">\n\t\t\t<div class="ui segment gazetki-3-3">\n\t\t\t\t<div class="image">\n\t\t\t\t\t<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].image.name}}" alt="no image">\n\t\t\t\t</div>\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].header}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta gazetka-price" ng-show="vm.gazetka.price">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[3].price}}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="meta subheader">\n\t\t\t\t\t\t<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].subheader}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">\n\t\t\t\t\t\t{{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].description}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="extra content">\n\t\t\t\t\t<div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[3].id)">\n\t\t\t\t\t\t<i class="caret left icon"></i></div>\n\t\t\t\t\t<div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[3].id)">\n\t\t\t\t\t\t<i class="caret right icon"></i></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n</div>\n'),$templateCache.put("app/gazetki/templates/previewTemplates/tlo1_5moduly.html",'<!--<div class="ui link cards gazetka-background center aligned container"-->\n<!--style="background-image: url(\'{{(vm.gazetka.backgrounds[vm.currentPreviewPage] !== undefined ? (vm.imagesPath + \'background/\' + vm.gazetka.pages[vm.currentPreviewPage].backgrounds[vm.gazetka.backgrounds[vm.currentPreviewPage]].name) : \'\')}}\')">-->\n<!--top-->\n\n<!--<div class="ui three column divided grid gazetka-background"-->\n     <!--style="background-image: url(\'{{(vm.gazetka.backgrounds[vm.currentPreviewPage] !== undefined ? (vm.imagesPath + \'background/\' + vm.gazetka.pages[vm.currentPreviewPage].backgrounds[vm.gazetka.backgrounds[vm.currentPreviewPage]].name) : \'\')}}\')">-->\n    <!--<div class="stretched row">-->\n        <!--<div class="column">-->\n            <!--<div class="ui segment">-->\n                <!--<div class="image">-->\n                    <!--<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].image.name"-->\n                         <!--ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].image.name}}"-->\n                         <!--alt="no image"/>-->\n                <!--</div>-->\n                <!--<div class="content">-->\n                    <!--<div class="header">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].header}}-->\n                    <!--</div>-->\n                    <!--<div class="meta gazetka-price" ng-show="vm.gazetka.price">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[0].price}}-->\n                    <!--</div>-->\n                    <!--<div class="meta subheader">-->\n                        <!--<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].subheader}}</a>-->\n                    <!--</div>-->\n                    <!--<div class="description">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].description}}-->\n                    <!--</div>-->\n                <!--</div>-->\n                <!--<div class="extra content">-->\n                    <!--<div class="ui bottom left attached label"-->\n                         <!--ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[0].id)">-->\n                        <!--<i class="caret left icon"></i></div>-->\n                    <!--<div class="ui bottom right attached label"-->\n                         <!--ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[0].id)">-->\n                        <!--<i class="caret right icon"></i></div>-->\n                <!--</div>-->\n            <!--</div>-->\n\n            <!--<div class="ui segment">-->\n                <!--<div class="image">-->\n                    <!--<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].image.name"-->\n                         <!--ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].image.name}}"-->\n                         <!--alt="no image"/>-->\n                <!--</div>-->\n                <!--<div class="content">-->\n                    <!--<div class="header">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].header}}-->\n                    <!--</div>-->\n                    <!--<div class="meta gazetka-price" ng-show="vm.gazetka.price">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[3].price}}-->\n                    <!--</div>-->\n                    <!--<div class="meta subheader">-->\n                        <!--<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].subheader}}</a>-->\n                    <!--</div>-->\n                    <!--<div class="description">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].description}}-->\n                    <!--</div>-->\n                <!--</div>-->\n                <!--<div class="extra content">-->\n                    <!--<div class="ui bottom left attached label"-->\n                         <!--ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[3].id)">-->\n                        <!--<i class="caret left icon"></i></div>-->\n                    <!--<div class="ui bottom right attached label"-->\n                         <!--ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[3].id)">-->\n                        <!--<i class="caret right icon"></i></div>-->\n                <!--</div>-->\n            <!--</div>-->\n        <!--</div>-->\n        <!--<div class="column">-->\n            <!--<div class="ui segment">-->\n                <!--<div class="image">-->\n                    <!--<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].image.name"-->\n                         <!--ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].image.name}}"-->\n                         <!--alt="no image"/>-->\n                <!--</div>-->\n                <!--<div class="content">-->\n                    <!--<div class="header">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].header}}-->\n                    <!--</div>-->\n                    <!--<div class="meta gazetka-price" ng-show="vm.gazetka.price">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[2].price}}-->\n                    <!--</div>-->\n                    <!--<div class="meta subheader">-->\n                        <!--<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].subheader}}</a>-->\n                    <!--</div>-->\n                    <!--<div class="description">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].description}}-->\n                    <!--</div>-->\n                <!--</div>-->\n                <!--<div class="extra content">-->\n                    <!--<div class="ui bottom left attached label"-->\n                         <!--ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[2].id)">-->\n                        <!--<i class="caret left icon"></i></div>-->\n                    <!--<div class="ui bottom right attached label"-->\n                         <!--ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[2].id)">-->\n                        <!--<i class="caret right icon"></i></div>-->\n                <!--</div>-->\n            <!--</div>-->\n            <!--<div class="ui segment">-->\n                <!--<div class="image">-->\n                    <!--<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].image.name"-->\n                         <!--ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].image.name}}"-->\n                         <!--alt="no image"/>-->\n                <!--</div>-->\n                <!--<div class="content">-->\n                    <!--<div class="header">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].header}}-->\n                    <!--</div>-->\n                    <!--<div class="meta gazetka-price" ng-show="vm.gazetka.price">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[4].price}}-->\n                    <!--</div>-->\n                    <!--<div class="meta subheader">-->\n                        <!--<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].subheader}}</a>-->\n                    <!--</div>-->\n                    <!--<div class="description">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].description}}-->\n                    <!--</div>-->\n                <!--</div>-->\n                <!--<div class="extra content">-->\n                    <!--<div class="ui bottom left attached label"-->\n                         <!--ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[4].id)">-->\n                        <!--<i class="caret left icon"></i></div>-->\n                    <!--<div class="ui bottom right attached label"-->\n                         <!--ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[4].id)">-->\n                        <!--<i class="caret right icon"></i></div>-->\n                <!--</div>-->\n            <!--</div>-->\n        <!--</div>-->\n        <!--<div class="column">-->\n            <!--<div class="ui segment">-->\n                <!--<div class="image">-->\n                    <!--<img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[5].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[5].id]].image.name"-->\n                         <!--ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[5].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[5].id]].image.name}}"-->\n                         <!--alt="no image"/>-->\n                <!--</div>-->\n                <!--<div class="content">-->\n                    <!--<div class="header">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[5].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[5].id]].header}}-->\n                    <!--</div>-->\n                    <!--<div class="meta gazetka-price" ng-show="vm.gazetka.price">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[5].price}}-->\n                    <!--</div>-->\n                    <!--<div class="meta subheader">-->\n                        <!--<a>{{vm.gazetka.pages[vm.currentPreviewPage].units[5].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[5].id]].subheader}}</a>-->\n                    <!--</div>-->\n                    <!--<div class="description">-->\n                        <!--{{vm.gazetka.pages[vm.currentPreviewPage].units[5].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[5].id]].description}}-->\n                    <!--</div>-->\n                <!--</div>-->\n                <!--<div class="extra content">-->\n                    <!--<div class="ui bottom left attached label"-->\n                         <!--ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[5].id)">-->\n                        <!--<i class="caret left icon"></i></div>-->\n                    <!--<div class="ui bottom right attached label"-->\n                         <!--ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[5].id)">-->\n                        <!--<i class="caret right icon"></i></div>-->\n                <!--</div>-->\n            <!--</div>-->\n        <!--</div>-->\n    <!--</div>-->\n<!--</div>-->\n\n<div class="ui three column grid gazetka-background gazetki-layout-preview-5">\n\n\t<div class="column">\n\n            <div class="ui segment">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[0].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[0].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[0].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n\n\t\t\t<div class="ui segment">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[2].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[2].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[2].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n\n\n\n    </div>\n    <div class="ui column">\n\n            <div class="ui segment gazetki-3-5">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[1].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[1].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[1].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n\n\t\t\t<div class="ui segment gazetki-3-5">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[3].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[3].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[3].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n\n        </div>\n        <div class="column">\n\n            <div class="ui segment toll-segment gazetki-3-5">\n                <div class="image">\n                    <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].image.name}}" alt="no image">\n                </div>\n                <div class="content">\n                    <div class="header">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].header}}\n                    </div>\n                    <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[4].price}}\n                    </div>\n                    <div class="meta subheader">\n                        <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].subheader}}</a>\n                    </div>\n                    <div class="description">\n                        {{vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].description}}\n                    </div>\n                </div>\n                <div class="extra content">\n                    <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[4].id)">\n                        <i class="caret left icon"></i></div>\n                    <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[4].id)">\n                        <i class="caret right icon"></i></div>\n                </div>\n            </div>\n        \n\t\t</div>\n\n</div>'),
$templateCache.put("app/gazetki/templates/previewTemplates/tlo1_6moduly.html",'<!--<div class="ui link cards gazetka-background center aligned container"-->\n<!--style="background-image: url(\'{{(vm.gazetka.backgrounds[vm.currentPreviewPage] !== undefined ? (vm.imagesPath + \'background/\' + vm.gazetka.pages[vm.currentPreviewPage].backgrounds[vm.gazetka.backgrounds[vm.currentPreviewPage]].name) : \'\')}}\')">-->\n<!--top-->\n\n<div class="ui grid gazetka-background gazetki-layout-preview-6">\n\t <div class="ui grid">\n\n    <div class="ui eight wide column bottom-collapsed">\n\t<div class="ui segment">\n        <div class="image">\n            <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].image.name}}" alt="no image">\n        </div>\n        <div class="content">\n            <div class="header">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].header}}\n            </div>\n            <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[0].price}}\n            </div>\n            <div class="meta subheader">\n                <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].subheader}}</a>\n            </div>\n            <div class="description">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[0].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[0].id]].description}}\n            </div>\n        </div>\n        <div class="extra content">\n            <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[0].id)">\n                <i class="caret left icon"></i></div>\n            <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[0].id)">\n                <i class="caret right icon"></i></div>\n        </div>\n    </div>\n\t</div>\n    <div class="ui eight wide column bottom-collapsed">\n\t<div class="ui segment gazetki-3-3">\n        <div class="image">\n            <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].image.name}}" alt="no image">\n        </div>\n        <div class="content">\n            <div class="header">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].header}}\n            </div>\n            <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[1].price}}\n            </div>\n            <div class="meta subheader">\n                <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].subheader}}</a>\n            </div>\n            <div class="description">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[1].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[1].id]].description}}\n            </div>\n        </div>\n        <div class="extra content">\n            <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[1].id)">\n                <i class="caret left icon"></i></div>\n            <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[1].id)">\n                <i class="caret right icon"></i></div>\n        </div>\n    </div>\n\t</div>\n    <div class="ui eight wide column bottom-collapsed">\n\t<div class="ui segment">\n        <div class="image">\n            <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].image.name}}" alt="no image">\n        </div>\n        <div class="content">\n            <div class="header">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].header}}\n            </div>\n            <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[2].price}}\n            </div>\n            <div class="meta subheader">\n                <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].subheader}}</a>\n            </div>\n            <div class="description">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[2].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[2].id]].description}}\n            </div>\n        </div>\n        <div class="extra content">\n            <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[2].id)">\n                <i class="caret left icon"></i></div>\n            <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[2].id)">\n                <i class="caret right icon"></i></div>\n        </div>\n    </div>\n\t</div>\n    <div class="ui eight wide column bottom-collapsed">\n\t<div class="ui segment gazetki-3-3">\n        <div class="image">\n            <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].image.name}}" alt="no image">\n        </div>\n        <div class="content">\n            <div class="header">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].header}}\n            </div>\n            <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[3].price}}\n            </div>\n            <div class="meta subheader">\n                <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].subheader}}</a>\n            </div>\n            <div class="description">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[3].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[3].id]].description}}\n            </div>\n        </div>\n        <div class="extra content">\n            <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[3].id)">\n                <i class="caret left icon"></i></div>\n            <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[3].id)">\n                <i class="caret right icon"></i></div>\n        </div>\n    </div>\n\t</div>\n    <div class="ui eight wide column">\n\t<div class="ui segment">\n        <div class="image">\n            <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].image.name}}" alt="no image">\n        </div>\n        <div class="content">\n            <div class="header">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].header}}\n            </div>\n            <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[4].price}}\n            </div>\n            <div class="meta subheader">\n                <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].subheader}}</a>\n            </div>\n            <div class="description">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[4].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[4].id]].description}}\n            </div>\n        </div>\n        <div class="extra content">\n            <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[4].id)">\n                <i class="caret left icon"></i></div>\n            <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[4].id)">\n                <i class="caret right icon"></i></div>\n        </div>\n    </div>\n\t</div>\n    <div class="ui eight wide column">\n\t<div class="ui segment gazetki-3-3">\n        <div class="image">\n            <img ng-if="vm.gazetka.pages[vm.currentPreviewPage].units[5].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[5].id]].image.name" ng-src="{{vm.unitsImagesPath + vm.gazetka.pages[vm.currentPreviewPage].units[5].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[5].id]].image.name}}" alt="no image">\n        </div>\n        <div class="content">\n            <div class="header">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[5].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[5].id]].header}}\n            </div>\n            <div class="meta gazetka-price" ng-show="vm.gazetka.price">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[5].price}}\n            </div>\n            <div class="meta subheader">\n                <a>{{vm.gazetka.pages[vm.currentPreviewPage].units[5].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[5].id]].subheader}}</a>\n            </div>\n            <div class="description">\n                {{vm.gazetka.pages[vm.currentPreviewPage].units[5].layouts[vm.currentLayouts[vm.currentPreviewPage][vm.gazetka.pages[vm.currentPreviewPage].units[5].id]].description}}\n            </div>\n        </div>\n        <div class="extra content">\n            <div class="ui bottom left attached label" ng-click="vm.prevUnit(vm.gazetka.pages[vm.currentPreviewPage].units[5].id)">\n                <i class="caret left icon"></i></div>\n            <div class="ui bottom right attached label" ng-click="vm.nextUnit(vm.gazetka.pages[vm.currentPreviewPage].units[5].id)">\n                <i class="caret right icon"></i></div>\n        </div>\n    </div>\n\t</div>\n\n\n\t</div>\n</div>\n'),$templateCache.put("app/__modules/budgeting/budgets/edit/budgets.edit.html",'<div id="container" class="ui segment main container container-left-spaced">\n    <ng-include src="vm.getTemplateSrc()"></ng-include>\n</div>\n'),$templateCache.put("app/__modules/budgeting/budgets/main/budgets.main.html",'<div id="container" class="ui segment main container container-left-spaced">\n    <ng-include src="vm.getTemplateSrc()"></ng-include>\n</div>\n'),$templateCache.put("app/__modules/budgeting/budgets/modals/confirm-enabling-common-budget-mode.modal-window.html","<atl-modal-confirm-dialog modal-id=\"'confirm_enabling_common_budget_mode'\" modal-title=\"'CONFIRM_SAVING_DATA' | translate\" on-confirm=\"vm.commonBudgetModeEnable()\">\n\n    <p>{{'CONFIRM_COMMON_BUDGET_MODE_ENABLE' | translate}}</p>\n\n    <br>\n\n</atl-modal-confirm-dialog>\n"),$templateCache.put("app/__modules/budgeting/budgets/edit/partials-templates/budget.representants-list.html",'<div role="tabpanel" class="tab-pane" ng-controller="BudgetRepresentantsListPartialController as vm" ng-class="{active: vm.tab == \'budget_representants_list\'}" id="budget-representants-list">\n\n    <div class="ui main container">\n        <h1 class="h1">\n        <span class="campaign-header-text">\n            <span>{{\'BUDGET\' | translate}} &mdash; {{vm.parent.budget.name}}</span>\n        </span>\n        </h1>\n\n        <table class="ui most basic table">\n            <tr>\n                <td class="collapsing">{{\'ID\' | translate}}:</td>\n                <td><strong>{{vm.parent.budget.identifier}}</strong></td>\n                <td class="collapsing">{{\'CURRENCY\' | translate}}:</td>\n                <td><strong>{{vm.parent.budget.currency}}</strong></td>\n            </tr>\n\n            <tr>\n                <td class="collapsing">{{\'BUDGET_TOTAL\' | translate}}:</td>\n                <td><strong>{{vm.parent.rksBudget.budget}}</strong></td>\n                <td class="collapsing">{{\'BUDGET_ACTUAL\' | translate}}:</td>\n                <td><strong>{{vm.parent.rksBudget.actual}}</strong></td>\n            </tr>\n        </table>\n\n        <br>\n\n        <div class="ui basic data-header data-header-people">\n            <div class="ui two column grid">\n                <div class="column">\n                    <h3>{{\'REPRESENTANTS\' | translate}}</h3>\n                </div>\n                <div class="column">\n\n                </div>\n            </div>\n        </div>\n\n        <div class="ui basic segment">\n            <div class="ui segments">\n                <div class="ui grid">\n                    <div class="eight wide column left aligned">\n                        {{\'COMMON_BUDGET_MODE_IS_ON\' | translate}}\n                    </div>\n                    <div class="four wide column">\n                        <div class="ui toggle checkbox">\n                            <input id="common-budget-mode-is-on" ng-disabled="true" ng-change="vm.onCommonBudgetModeChange()" type="checkbox" ng-model="vm.parent.rksBudget.common_budget_mode" ng-true-value="true" ng-false-value="false">\n                            <label for="common-budget-mode-is-on"></label>\n                        </div>\n                    </div>\n                    <div class="four wide column">&nbsp;</div>\n                </div>\n            </div>\n        </div>\n\n        <div class="ui basic megacollapsed segment right aligned negative-text" ng-if="vm.parent.isOverbudget">\n            <b>{{\'OVERBUDGET\' | translate}}</b>\n        </div>\n\n        <form class="ui form" name="budgetEditForm" novalidate ng-submit="budgetEditForm.$valid && vm.onFormSubmit()">\n\n            <table class="ui table celled striped sortable listView">\n                <col width="20%">\n                <col width="40%">\n                <col ng-if="vm.parent.rksBudget.common_budget_mode" width="40%">\n                <col ng-if="!vm.parent.rksBudget.common_budget_mode" width="20%">\n                <col ng-if="!vm.parent.rksBudget.common_budget_mode" width="20%">\n                <thead>\n                <tr>\n                    <th>{{\'NAME\' | translate}}</th>\n                    <th>{{\'PROGRESS\' | translate}}</th>\n                    <th ng-if="!vm.parent.rksBudget.common_budget_mode">{{\'BUDGET\' | translate}}</th>\n                    <th>{{\'ACTUAL\' | translate}}</th>\n                </tr>\n                </thead>\n                <tbody>\n                <tr ng-repeat="pm in vm.parent.budget.representants | orderBy:\'lastName\':false">\n                    <td>{{pm.firstName}} {{pm.lastName}}</td>\n                    <td style="text-align: center">\n                        <div class="ui progress" style="height: 2.1em!important; margin: 0!important" ng-if="vm.parent.rksBudget.common_budget_mode || (pm.actual <= pm.budget)">\n                            <div class="bar" style="width: {{vm.getRepProgress(pm)}}%; height: 2.1em!important"></div>\n                            <div class="title"><p class="lead"><a>{{vm.getRepProgress(pm)}} %</a></p></div>\n                        </div>\n                        <div class="negative-text" style="height: 2.1em!important; margin: 0!important" ng-if="!vm.parent.rksBudget.common_budget_mode && pm.actual > pm.budget">\n                            <b>{{\'BUDGET_TOO_LOW\' | translate}}</b>\n                        </div>\n                    </td>\n                    <td ng-if="!vm.parent.rksBudget.common_budget_mode">\n                        <input type="number" style="text-align: right" name="budget" ng-disabled="vm.parent.isCommonBudgetModeAlreadyOn" ng-change="vm.parent.recalculateBudgetTotal()" ng-model="pm.budget">\n                    </td>\n                    <td style="text-align: right">{{pm.actual | number:2}}</td>\n                </tr>\n                </tbody>\n                <tfoot>\n                <tr>\n                    <th>{{\'TOTAL\' | translate}}</th>\n                    <th>\n                        <div class="ui progress" style="height: 2.1em!important; margin: 0!important">\n                            <div class="bar" style="width: {{vm.getBudgetProgress()}}%; height: 2.1em!important"></div>\n                            <div class="title"><p class="lead"><a>{{vm.getBudgetProgress()}} %</a></p></div>\n                        </div>\n                    </th>\n                    <th style="text-align: right" ng-if="!vm.parent.rksBudget.common_budget_mode">{{vm.parent.budgetTotal | number:2}}</th>\n                    <th style="text-align: right">{{vm.parent.actualTotal | number:2}}</th>\n                </tr>\n                </tfoot>\n            </table>\n\n            <div class="ui center aligned basic segment">\n                <div class="ui two column center aligned grid">\n                    <div class="column">\n                        <div class="ui large pale button" ng-click="vm.backToList()">\n                            <i class="cancel icon"></i>\n                            {{\'CANCEL\' | translate}}\n                        </div>\n                    </div>\n                    <div class="column">\n                        <button type="submit" ng-disabled="vm.parent.isOverbudget || vm.parent.isActualGreaterThanBudget || vm.parent.isCommonBudgetModeAlreadyOn" class="ui navy large button">\n                            <i class="save icon" ng-hide="vm.lockForm"></i>\n                            <span class="ui active mini inline loader" ng-if="vm.lockForm"></span>\n                            {{\'SAVE\' | translate}}\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n        </form>\n    </div>\n\n    <ng-include src="\'app/__modules/budgeting/budgets/modals/confirm-enabling-common-budget-mode.modal-window.html\'"></ng-include>\n\n</div>\n\n'),$templateCache.put("app/__modules/budgeting/budgets/main/partials-templates/budgets.list.html",'<div role="tabpanel" class="ui main container" ng-controller="BudgetsListPartialController as vm" ng-class="{active: vm.tab == \'budgets_list\'}" id="budgets-list">\n\n    \n    <div class="ui warning message" ng-if="vm.budgets.length<1">\n      <div class="header">\n        {{\'NO_BUDGETS\' | translate}}\n      </div>\n    </div>\n    \n    <div class="ui segment silver campaign-item" ng-repeat="budget in vm.budgets | orderBy:\'id\'">\n\n        <!--<p>budget.name</p>-->\n\n        <div class="ui grid">\n            <div class="ui sexteen wide column right aligned">\n                <p>{{\'DURATION\' | translate}}:\n                    <b>\n                        {{budget.date_start | date:\'dd.MM.yyyy\'}} &mdash;\n                        {{budget.date_end | date:\'dd.MM.yyyy\'}}\n                    </b>\n                </p>\n            </div>\n        </div>\n\n        <div class="ui two column grid">\n            <div class="column">\n\n                <div class="ui progress" ui-sref="budgets.edit({id: budget.id})">\n                    <div class="bar" style="width: {{vm.getBudgetFulfillment(budget)}}%"></div>\n                    <div class="title"><p class="lead"><a>{{budget.name | uppercase}} &mdash;\n                        {{vm.getBudgetFulfillment(budget)}} %</a></p></div>\n                </div>\n\n                <div class="ui container">\n                    <p>{{budget.description}}</p>\n                </div>\n            </div>\n\n            <div class="column right aligned">\n                <span class="ui yellow tag label">{{budget.currency}} {{vm.getBudgetTotal(budget)  | number:2}}</span><p></p>\n            </div>\n\n        </div>\n\n        <div class="ui left top attached icon orange big label campaign-identifier-label" ui-sref="budgets.edit({id: budget.id})">\n            {{budget.identifier}}\n        </div>\n\n    </div>\n\n</div>\n'),$templateCache.put("app/core/404.html",'<!-- row -->\n<div class="row">\n\n    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">\n\n        <div class="row">\n            <div class="col-sm-12">\n                <div class="text-center error-box">\n                    <h1 class="error-text-2 bounceInDown animated"> Error 404 <span class="particle particle--c"></span><span class="particle particle--a"></span><span class="particle particle--b"></span></h1>\n                    <h2 class="font-xl"><strong><i class="fa fa-fw fa-warning fa-lg text-warning"></i> Page <u>Not</u> Found</strong></h2>\n                    <br>\n                    <p class="lead">\n                        The page you requested could not be found, either contact your webmaster or try again. Use your browsers <b>Back</b> button to navigate to the page you have prevously come from\n                    </p>\n                    <p class="font-md">\n                        <b>... That didn\'t work on you? Dang. May we suggest a search, then?</b>\n                    </p>\n                    <br>\n                    <div class="error-search well well-lg padding-10">\n                        <div class="input-group">\n                            <input class="form-control input-lg" type="text" placeholder="let\'s try this again" id="search-error">\n                            <span class="input-group-addon"><i class="fa fa-fw fa-lg fa-search"></i></span>\n                        </div>\n                    </div>\n\n                    <div class="row">\n\n                        <div class="col-sm-12">\n                            <ul class="list-inline">\n                                <li>\n                                    &nbsp;<a href="javascript:void(0);">Dashbaord</a>&nbsp;\n                                </li>\n                                <li>\n                                    .\n                                </li>\n                                <li>\n                                    &nbsp;<a href="javascript:void(0);">Inbox (14)</a>&nbsp;\n                                </li>\n                                <li>\n                                    .\n                                </li>\n                                <li>\n                                    &nbsp;<a href="javascript:void(0);">Calendar</a>&nbsp;\n                                </li>\n                                <li>\n                                    .\n                                </li>\n                                <li>\n                                    &nbsp;<a href="javascript:void(0);">Gallery</a>&nbsp;\n                                </li>\n                                <li>\n                                    .\n                                </li>\n                                <li>\n                                    &nbsp;<a href="javascript:void(0);">My Profile</a>&nbsp;\n                                </li>\n                            </ul>\n                        </div>\n\n                    </div>\n\n                </div>\n\n            </div>\n\n        </div>\n\n    </div>\n\n    <!-- end row -->\n\n</div>\n'),$templateCache.put("app/core/accessdenied.html",'<!-- row -->\n<div class="row">\n\n    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">\n\n        <div class="row">\n            <div class="col-sm-12">\n                <div class="text-center error-box">\n                    <h1 class="error-text-2 bounceInDown animated"> Error 403 <span class="particle particle--c"></span><span class="particle particle--a"></span><span class="particle particle--b"></span></h1>\n                    <h2 class="font-xl"><strong><i class="fa fa-fw fa-warning fa-lg text-warning"></i> Page <u>Not</u> Found</strong></h2>\n                    <br>\n                    <p class="lead">\n                        Your access has been denied.\n                        <br>\n                        Your current user roles does not have permission to access the requested page.\n                    </p>\n                    <p class="font-md">\n                        <b>Please sign in as the user with proper permissions.</b>\n                    </p>\n                    <br>\n                    <div class="error-search well well-lg padding-10">\n                        <div class="input-group">\n                            <input class="form-control input-lg" type="text" placeholder="let\'s try this again" id="search-error">\n                            <span class="input-group-addon"><i class="fa fa-fw fa-lg fa-search"></i></span>\n                        </div>\n                    </div>\n\n                    <div class="row">\n\n                        <div class="col-sm-12">\n                            <ul class="list-inline">\n                                <li>\n                                    &nbsp;<a href="javascript:void(0);">Dashbaord</a>&nbsp;\n                                </li>\n                                <li>\n                                    .\n                                </li>\n                                <li>\n                                    &nbsp;<a href="javascript:void(0);">Inbox (14)</a>&nbsp;\n                                </li>\n                                <li>\n                                    .\n                                </li>\n                                <li>\n                                    &nbsp;<a href="javascript:void(0);">Calendar</a>&nbsp;\n                                </li>\n                                <li>\n                                    .\n                                </li>\n                                <li>\n                                    &nbsp;<a href="javascript:void(0);">Gallery</a>&nbsp;\n                                </li>\n                                <li>\n                                    .\n                                </li>\n                                <li>\n                                    &nbsp;<a href="javascript:void(0);">My Profile</a>&nbsp;\n                                </li>\n                            </ul>\n                        </div>\n\n                    </div>\n\n                </div>\n\n            </div>\n\n        </div>\n\n    </div>\n\n    <!-- end row -->\n\n</div>\n')}]),angular.module("app.i18n").factory("languages",function($cacheFactory){var cache=$cacheFactory("languages");return cache.put("app/auth/i18n/en.json",'{"WELCOME_LOGIN":"Welcome, log in with your e mail address.","LOGIN":"LOGIN","REMIND_PASS":"Remind the password","USERNAME":"Username","EMAIL":"E-mail","PHONE":"Phone","COMPANY":"Company","MESSAGE":"Message","CANCEL":"Cancel","SEND":"Send","HELP":"Help","WELCOME_RESET_PASSWORD":"A new password will be sent to your email.","SENT_NEW_PASS":"New password sent to your email.","CLOSE":"Close"}'),cache.put("app/auth/i18n/pl.json",'{"WELCOME_LOGIN":"Witaj, zaloguj się używając swojego adresu email.","LOGIN":"ZALOGUJ","REMIND_PASS":"Przypomnij hasło","USERNAME":"Login","EMAIL":"E-mail","PHONE":"Telefon","COMPANY":"Firma","MESSAGE":"Wiadomość","CANCEL":"Anuluj","SEND":"Wyślij","HELP":"Pomoc","WELCOME_RESET_PASSWORD":"Nowe hasło zostanie wysłane na mail.","SENT_NEW_PASS":"Nowe hasło zostało wysłane na mail.","CLOSE":"Zamknij","AUTHORIZATION_ERROR":"Wystąpił błąd autoryzacji","OLD_VERSION_ERROR":"Używasz starej wersji aplikacji. Należy ją zaktualizować poprzez AppStore."}'),cache.put("app/campaigns/i18n/en.json",'{"ID":"ID","NIP":"NIP","NAME":"Name","LAST_NAME":"Last Name","JOB_TITLE":"Job Title","EMPLOYEES":"Employees","CATEGORY":"Category","CITY":"City","ZIP":"ZIP","STREET":"Street","CAMPAIGN":"Campaign","IT_REMAINS":"It remains","DAYS_LEFT":"days left","SHOPPING":"Shopping","SALE":"Sale","DYNAMIC_SEARCH":"dynamic search","SELECT_REP":"Select Rep","REP":"Rep","ADDRESS":"Address","DURATION":"The duration of","PERIOD":"Period","SEL_IN_EARNINGS":"sell In Earnings","SEL_OUT_EARNINGS":"sell Out Earnings","TOTAL_EARNINGS":"TOTAL Earnings","SELL_IN":"sell In","SELL_OUT":"sell Out","TOTAL_VARIES":"Total varies","POINTS":"Points","RESERVED":"Reserved","YOU_HAVE_ENOUGH_POINTS":"You have enough points","TO_GET_THE_RESERVED_GIFT":"to get the reserved gift.","YOU_HAVE_TO_COLLECT":"You have to collect","GIFTS":"Gifts","GIFT":"Gift","TO_GET_GIFT":"to get gift","YOU_HAVE_NOT_ENOUGH_POINTS":"You have not enough points","SAVE":"Save","MARK":"Mark","PRICE":"Price","AMOUNT":"Amount","AMOUNT_ONE_DRUGSTORE":"per pharmacy","DAYS":"days","CANCEL":"Cancel","PREVIOUS":"Previous","CONFERENCE":"Conference","PARTICIPATES":"Participates","DATE":"Date","HOTEL":"Hotel","ROOM":"Room","BED":"bed","BEDS":"beds","COMMON_SETTINGS":"Common Settings","CHOOSE_ROOM":"Choose Room","GENERATE_INVITATIONS":"Generate Invitations","GENERATE_PROPOSAL":"Generate Proposal","GENERATE_FINAL_REPORT":"Generate Final Report","CONFIRM_DESPACH_DRUGSTORES":"Are you sure you want to detach this drugstores from campaign?","TOTAL_MONEY":"TOTAL Money","MESSAGE_PRIZES_TO_CENTRAL":"The message prizes to Central","DISPOSES_AWARDS":"Disposes awards","TOTAL_RESERVED":"Total Reserved","BAG_WITH_GIFTS":"A bag with the gifts.","AMOUNT_VARIERS":"The amount varies","SEND_EMAIL_TO":"Send Email to","FILL_REPORTS":"to FILL the Final Report","SYSTEM":"System","DRUGGIST":"Druggist","TOTAL":"Total","CONFIRM_PREPARED_REPORTS":"Confirm Prepared Report","SEND_AGAIN_TO":"Send Again to","REFILL_REPORTS":"to Re-fill the Report","FINISH_CYCLE":"Finish Cycle","FINISH_CAMPAIGN":"Finish Campaign","TITLE":"Title","EMAIL":"E-mail","DRUGSTORES_NETWORK":"Drugstores Network","LOCAL_DRUGSTORE":"Local Drugstore","NETWORK_TYPE":"Network Type","NUMBER_OF_SELLING_POINTS":"Number of Selling Points","NEGOTIATION_POINT":"Negotiation Point","SELLING_POINT":"Selling Point","ADDRESS_LINE":"Address Line","PHONE":"Phone","COUNTRY":"Country","DATA":"Data","ORIGINAL":"Original","COPY":"Copy","DRUGSTORE_NAME":"Drugstore Name","DRUGSTORE_ID":"Drugstore ID","INVOICE_NO":"ONVOICE NO","DEALER":"DEALER","BILL_NUMBER":"Bill number","BUYER":"BUYER","PAYMENT_METHOD":"Payment method","PAYMENT_DATE":"Payment Date","DRUGSTORE":"Drugstore","NUMBER":"No.","VALUE":"The net value","VAT_RATE":"VAT Rate","TAX":"Tax","GROSS_VALUE":"Gross Value","IN_WORDS":"In Words","INSUING_SIGNATURE":"Insuing signature","SEND_TO_MANAGER":"Send to manager","GROUP":"Group","OLD_POTENTIAL":"Old potential","NEW_POTENTIAL":"New potential","APPLY_HELP":"apply Help","CALCULATE_FROM":"Calculate from","SUITED_DRUGSTORE":"This Drugstore is very suited for the current Campaign.","NOT_SUITED_DRUGSTORE":"Unfortunately, this Apteka is not suited for the current Campaign.","MORE_INFORMATION":"More Information","LOWER_THRESHOLD_INPUT":"lower the threshold input of","CONTACT_YOUR_SUPERVISOR_FOR_GREATER_THRESHOLD":"to contact your supervisor for a greater reduction threshold","CONFIRM_APPLYING_HELP_CIRCLE":"You are applying help circle. Please confirm","HELP":"Help","SEND_MESSAGE_TO_RKS":"Send message to RKS","MESSAGE_TO_RKS":"Message to RKS","SEND_TO_RKS":"Send to RKS","DRUGS_GROUP":"Drugs Group","NEED_MINIMAL_NEW_POTENTIAL":"Need Minimal New Potential","THIS_DRUGSTORE":"This drugstore","NOT_HAVE_ENOUGH_POTENTIAL":"does not have enough potential to participate in the campaign but it should be there.","PLEASE_CONFIRM":"Please Confirm","CONFIRM_FRAME_CONTRACT_SIGNING":"Confirm Frame Contract Signing","FRAME_CONTRACT_PRINT":"Frame Contract Print","VIEW_SCANNED_FRAME_CONTRACT":"View Scanned Frame Contract","VALUE_BLOCKS_DRUGSTORE":"This value blocks this drugstore to participate in the Campaign!","CONFIRM_EXCLUDEING_DRUGSTORE":"If You are sure, click Confirm and this drugstore will be excluded from the campaign","STANDARD":"Standard","SHELF":"Shelf","ENVIRONMENT":"Environment","AGREED":"Agreed","YES":"Yes","NO":"No","OK":"OK","REPORT_TO_MANAGER":"Report to the manager","SERVICES":"Services","STANDARD_FOR_DRUGSTOR":"The standard for one Drugstore","PHOTO":"Photo","MULTI":"Multi","CAMPAIGN_DATE_START":"Campaign Date Start","CAMPAIGN_DATE_END":"Campaign Date End","CAMPAIGN_STATUS":"Campaign Status","CYCLE_TYPE":"Cycle type","SELECT_CYCLE_DURATION":"Select the cycle duration","CYCLE_DATE_START":"Cycle Date Start","CYCLE_DATE_END":"Cycle Date End","START_NEW_CYCLE":"Start New Cycle","FIXED_AMOUNT":"Fixed Amount","AMOUNT_SERVICES":"Fixed amount for services","PROPOSAL_TOTAL":"Proposal Total","POTENTIAL":"Potential","BONUS":"Bonus","AMOUNT_VARIES":"The Amount Varies","INFO_ABOUT_ONSEND":"After clicking \\"Generate Proposal\\", the order is automatically generated and sent to the address apteka@wit.com.pl. To implement the campaign for the pharmacy is necessary: confirmation of the terms by the Pharmacy and your signature.","START_CAMPAIGN":"Start Campaign","SEND":"Send","DRUGSTORE_NETWORK_LIST":"Drugstores Network List","CONFIRM_CLOSE_STEP_SERVICES":"Step will be closed, step include service control page(s), you can not make photos anymore before RKS confirms","CONFIRM_CLOSE_STEP_SELLING":"Step will be closed, step include selling info page(s), when you press the Confirm you can not change the data ","SEND_TO_COMPANY":"Send to company","CONFIRM_DRUGSTORE_REGISTRATION_1":"Registration link will be sent to","CONFIRM_DRUGSTORE_REGISTRATION_2":"","CONFIRM_MULTI_CYCLE":"Have you set the proposal cycle duration?","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_1":"Entered email address is belongs to portal account of drugstore","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_2":"Are you sure you want to append this drugstore to existent account?","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_3":"If not, enter unique email for this drugstore.","comment:":"=============Calendar==========","START_DATE":"Start Date","START_TIME":"Start Time","END_DATE":"End Date","END_TIME":"End Time","ALL_DAY":"All day","DESCRIPTION":"Description","CAMPAIGN_DATE":"Campaign date","CYCLE_DATE":"Cycle date","CYCLE_DURATION":"Cycle duration","CAMPAIGN_NOT_DOMINANT":"Please set dominant in admin","CAMPAIGN_MANY_MAIN_OFFICE":"Drugstores with negotiation_point in this NetWork","CAMPAIGN_FINISHED":"Congratulations - the campaign has been completed","CAMPAIGN_NEED_RECALCULATE":"Drugstore number is changed, click to recalculate","RECALCULATE":"Recalculate","SET_MINIMUM_POTENTIAL":"Set minimum potential","NOT_RIGHTS_FOR_EDIT":"You do not have permission to edit this drugstore","NOT_REGISTERED":"This drugstore is not registered in the portal","TOTAL_IS_ZERO":"Attention! The total amount of the contract - 0","CAMPAIGN_NOT_ACTIVE":"This Campaign is not active","MULTI_CAMPAIGN":"Multicampaign","WARNING":"Warning","CURRENT_CYCLE":"Current cycle","MIN_CYCLE_NUMBER":"Minimum cycles number","STEP_NOT_IN_DATE":"Step is not in date","ONE_CYCLE_PER_DAY":"Cannot create more than 1 cycle per day","PROPOSAL_END_DATE":"Proposal end date","STEP_START":"start","STEP_TURN":"turn","STEP_OK":"OK","STEP_WAIT":"wait","STEP_ATTENTION":"attention","NO_PROPOSAL_DATA":"No data from proposal","MK_SH_ERROR_NO_MK_SH":"No market share data for","MK_SH_ERROR_NO_SELL":"No Sell Out data for","MK_SH_ERROR_NO_DATA":"No data from kam soft","TITLE_COMMON_BUDGET":"Common Budget","TITLE_SIMPLE_BUDGET":"Budget","BUDGET":"Budget","BUDGET_USED":"Used Budget","BUDGET_PLANNED":"Planned Budget","BUDGET_REST":"Rest","BUDGET_PLANNED_REST":"Rest Planned Budget","BUDGET_OVERRUN":"Overrun","BUDGET_PLANNED_OVERRUN":"Overrun Planned Budget","MESSAGE_BUDGET_OVERRUN":"Budget overrun","MESSAGE_PLANNED_BUDGET_OVERRUN":"Overrun Planned Budge!","MESSAGE_NOT_SET_BUDGET":"Budget is not set","DRUGSTORE_NOT_COMPLIANT":"Drugstore is not compliant","MESSAGE_ATTENTION":"Attention!","MESSAGE_CONFIRMATION":"Confirmation!","CONFIRM_ADD_STEP":"Are you sure you want to clone step?","WARNING_CAN_NOT_CLONE_STEP":"Step can be cloned only if it\'s closed, or it\'s outdated, or there is less then 7 days until the end of the step","WARNING_DATE_GREATER_CAMPAIGN_DATE_END":"Today\'s date is greater than campaign end date","CONFIRM_SAVING_DATA":"Confirm saving data","PHOTO_ACCEPT":"Accept photo","CLOSE_STEP":"Close step","CONFIRM_ACCEPT":"Confirm acceptance","PROPOSAL_DURATION":"Proposal duration","ADD_EVENT":"Add event","DRUGS_GROUPS":"Drugs Groups","MARKET_SHARE":"Market Share","GET_MARKET_SHARE":"Get Kamsoft Data","APPLY_AVERAGE_DATA":"Average data were added","WRONG_DATE":"Wrong date"}'),
cache.put("app/campaigns/i18n/pl.json",'{"ID":"ID","NIP":"NIP","NAME":"Nazwa","LAST_NAME":"Nazwisko","JOB_TITLE":"Stanowisko","EMPLOYEES":"Pracownicy","CATEGORY":"Kategoria","CITY":"Miasto","ZIP":"Kod","STREET":"Ulica","CAMPAIGN":"Kampanie","IT_REMAINS":"Pozostało","DAYS_LEFT":"Pozostałe dni","SHOPPING":"Zakupy","SALE":"Sprzedaż","DYNAMIC_SEARCH":"Dynamiczne wyszukiwanie","SELECT_REP":"Wybierz Przedstawiciela","REP":"Przedstawiciel","ADDRESS":"Adres","DURATION":"Okres trwania","PERIOD":"Okres","SEL_IN_EARNINGS":"Zakupy","SEL_OUT_EARNINGS":"Sprzedaż","TOTAL_EARNINGS":"RAZEM","SELL_IN":"Zakupy","SELL_OUT":"Sprzedaż","TOTAL_VARIES":"Suma Kwota Zmienna","POINTS":"Punkty","RESERVED":"Zarezerwowano","YOU_HAVE_ENOUGH_POINTS":"Masz wystarczająco dużo punktów","TO_GET_THE_RESERVED_GIFT":"aby odebrać zarezerwowaną nagrodę","YOU_HAVE_TO_COLLECT":"Musisz zebrać","GIFTS":"Nagrody","GIFT":"Nagroda","TO_GET_GIFT":"otrzymać nagrodę","YOU_HAVE_NOT_ENOUGH_POINTS":"Nie masz wystarczającej liczby punktów,","SAVE":"Zapisz","MARK":"Marka","PRICE":"Cena","AMOUNT":"Liczba","AMOUNT_ONE_DRUGSTORE":"Na Aptekę","DAYS":"Dni","CANCEL":"Anuluj","PREVIOUS":"Poprzedni","CONFERENCE":"Konferencja","PARTICIPATES":"Uczestniczy","DATE":"Data","HOTEL":"Hotel","ROOM":"Pokój","BED":"Łóżko","BEDS":"Łóżka","COMMON_SETTINGS":"Ustawienia","CHOOSE_ROOM":"Wybierz Pokój","GENERATE_INVITATIONS":"Generowanie Zaproszenia","GENERATE_PROPOSAL":"Generuj Zlecenie","GENERATE_FINAL_REPORT":"Generowanie Raport","CONFIRM_DESPACH_DRUGSTORES":"Potwierdź usunięcie Apteki z tej Kampanii","TOTAL_MONEY":"Suma","MESSAGE_PRIZES_TO_CENTRAL":"Wydaj nagrody do Centrali Sieci","DISPOSES_AWARDS":"Rozdysponuj nagrody","TOTAL_RESERVED":"Zarezerwowane","BAG_WITH_GIFTS":"Koszyk nagród","AMOUNT_VARIERS":"Kwota zmienna","SEND_EMAIL_TO":"Wyślij e-mail do","FILL_REPORTS":"Wypełnij raport","SYSTEM":"System","DRUGGIST":"Farmaceuta","TOTAL":"Suma","CONFIRM_PREPARED_REPORTS":"Potwierdź Raport","SEND_AGAIN_TO":"Wyślij ponownie do","REFILL_REPORTS":"Uzupełnij Raport","FINISH_CYCLE":"Zakończenie Cyklu","FINISH_CAMPAIGN":"Zakończenie Kampanii","TITLE":"Nazwa","EMAIL":"E-mail","DRUGSTORES_NETWORK":"Sieć","LOCAL_DRUGSTORE":"Sieci Lokalne","NETWORK_TYPE":"Typ sieci","NUMBER_OF_SELLING_POINTS":"Liczba punktów sprzedaży","NEGOTIATION_POINT":"Centrala Sieci","SELLING_POINT":"Apteka","ADDRESS_LINE":"Adres","PHONE":"Telefon","COUNTRY":"Kraj","DATA":"Data","ORIGINAL":"Oryginał","COPY":"Kopia","DRUGSTORE_NAME":"Nazwa Apteki","DRUGSTORE_ID":"ID Apteki","INVOICE_NO":"Numer Faktury","DEALER":"Sprzedawca","BILL_NUMBER":"Numer Rachunku","BUYER":"Nabywca","PAYMENT_METHOD":"Forma płatności","PAYMENT_DATE":"Termin platności:","DRUGSTORE":"Apteka","NUMBER":"Lp","VALUE":"Wartość Netto","VAT_RATE":"VAT","TAX":"Kwota podatku","GROSS_VALUE":"Wartość Brutto","IN_WORDS":"Słownie","INSUING_SIGNATURE":"Fakturę wystawił","SEND_TO_MANAGER":"Wysłać do kierownika","GROUP":"Grupa","OLD_POTENTIAL":"Stary potencjał","NEW_POTENTIAL":"Nowy potencjał","APPLY_HELP":"Pomoc","CALCULATE_FROM":"Liczona od","SUITED_DRUGSTORE":"Apteka spełnia zakładane kryteria dla tej Kampanii","NOT_SUITED_DRUGSTORE":"Niestety, Apteka nie spełnia zakładanych kryteriów dla tej Kampanii","MORE_INFORMATION":"Więcej informacji","LOWER_THRESHOLD_INPUT":"Obniżyć próg wejściowy o","CONTACT_YOUR_SUPERVISOR_FOR_GREATER_THRESHOLD":"Skontaktuj się z Kierownikiem, aby bardziej obniżyć próg wejsciowy dla tej Apteki","CONFIRM_APPLYING_HELP_CIRCLE":"Potwierdź użycie koła ratunkowego","HELP":"Pomoc","SEND_MESSAGE_TO_RKS":"Wyślij wiadomość do swojego Kierownika","MESSAGE_TO_RKS":"Wiadomość dla Kierownika","SEND_TO_RKS":"Wyślij do Kierownika","DRUGS_GROUP":"Grupa Leków","NEED_MINIMAL_NEW_POTENTIAL":"Minimalny nowy potencjał","THIS_DRUGSTORE":"Ta apteka","NOT_HAVE_ENOUGH_POTENTIAL":"Niestety apteka nie spełnia zakładanych kryteriów Kampanii. Możesz wnioskować o obniżenie progu wejścia do Kampanii. Po naciśnięciu ,,Zatwierdź” prośba zostanie przesłana do Helpdesku. Gdy uzyskamy zgodę na dopuszczenie apteki do Kampanii, skontaktujemy się z Tobą.","PLEASE_CONFIRM":"Potwierdź","CONFIRM_FRAME_CONTRACT_SIGNING":"Potwierdz podpisanie Umowy Ramowej","FRAME_CONTRACT_PRINT":"Drukuj Umowę Ramową","VIEW_SCANNED_FRAME_CONTRACT":"Podgląd zeskanowanej Umowy Ramowej","VALUE_BLOCKS_DRUGSTORE":"Zbyt niska wartość - Apteka nie może przystąpić do Kampanii","CONFIRM_EXCLUDEING_DRUGSTORE":"Potwierdź usunięcie Apteki z tej Kampanii","STANDARD":"Standard","SHELF":"Półka","ENVIRONMENT":"Witryna","AGREED":"Zatwierdź","YES":"Tak","NO":"Nie","OK":"Tak","REPORT_TO_MANAGER":"Zgłoś do kierownika","SERVICES":"Usługi","STANDARD_FOR_DRUGSTOR":"Standard","PHOTO":"Zdjęcie","MULTI":"Wybierz Okres","CAMPAIGN_DATE_START":"Data rozpoczęcia Kampanii","CAMPAIGN_DATE_END":"Data zakończenia Kampanii","CAMPAIGN_STATUS":"Status Kampanii","CYCLE_TYPE":"Rodzaj cyklu","SELECT_CYCLE_DURATION":"Wybierz czas trwania Cyklu","CYCLE_DATE_START":"Data rozpoczęcia Cyklu","CYCLE_DATE_END":"Data zakończenia Cyklu ","START_NEW_CYCLE":"Zacznij nowy Cykl","FIXED_AMOUNT":"Kwota stała","AMOUNT_SERVICES":"Kwota stała za usługi","PROPOSAL_TOTAL":"Finalne ustalenia","POTENTIAL":"Potencjał","BONUS":"Bonus","AMOUNT_VARIES":"Estymowana kwota zmienna","INFO_ABOUT_ONSEND":"Po kliknięciu \\"Wyslij\\", zlecenie zostanie automatycznie wygenerowane i przesłane na adres apteka@wit.com.pl. Aby rozpocząć Kampanię, Apteka musi zaakceptować zlecenie.","START_CAMPAIGN":"Rozpocznij Kampanię","SEND":"Wyślij","DRUGSTORE_NETWORK_LIST":"Spis Aptek","CONFIRM_CLOSE_STEP_SERVICES":"Czy na pewno chcesz wysłać zdjęcia do akceptacji? Po wysłaniu zdjęć krok (Kontrola usług) zostanie zamknięty. Nie będziesz mógł już nic zmienić","CONFIRM_CLOSE_STEP_SELLING":"Potwierdź poprawność danych. Po naciśnięciu Zatwierdź nie będzie można już zmienić danych rotacji","SEND_TO_COMPANY":"Potwierdź","CONFIRM_DRUGSTORE_REGISTRATION_1":"Na adres e-mail","CONFIRM_DRUGSTORE_REGISTRATION_2":"zostanie wysłana wiadomość wraz z linkiem umożliwiającym dokończenie rejestracji Apteki w Portalu Klienta","CONFIRM_MULTI_CYCLE":"Czy na pewno wybrałeś prawidłowy okres trwania Zlecenia?","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_1":"Wprowadzony adres e-mail jest wykorzystywany w Portalu Klienta przez aptekę","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_2":"Czy chcesz przyłączyć aptekę, w której aktualnie jesteś, do już istniejącego konta?","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_3":"Jeśli nie, wprowadź inny adres e-mail dla tej apteki.","comment:":"=============Calendar==========","START_DATE":"Data Rozpoczęcia","START_TIME":"Czas","END_DATE":"Data Końcowa","END_TIME":"Koniec Czasu","ALL_DAY":"Cały dzień","DESCRIPTION":"Opis","CAMPAIGN_DATE":"Data ramowa kampanii","CYCLE_DATE":"Daty cyklu","CYCLE_DURATION":"Liczba okresów","CAMPAIGN_NOT_DOMINANT":"Proszę ustawić dominującym","CAMPAIGN_MANY_MAIN_OFFICE":"Uwaga! W tej sieci jest więcej niż jeden Punkt Negocjacyjny. Zlecenie nie powinno być generowane","CAMPAIGN_FINISHED":"Gratulujemy - kampania została zakończona","CAMPAIGN_NEED_RECALCULATE":"Liczba aptek w sieci uległa zmianie. Przelicz","RECALCULATE":"Przelicz","SET_MINIMUM_POTENTIAL":"Wstaw minimalny potencjał","NOT_RIGHTS_FOR_EDIT":"Nie masz uprawnień do edytowania tej apteki","NOT_REGISTERED":"Apteka nie jest zarejestrowana w portalu","TOTAL_IS_ZERO":"Ostrzeżenie! Łączna kwota zamówienia wynosi 0","CAMPAIGN_NOT_ACTIVE":"Kampania nie jest aktywna","MULTI_CAMPAIGN":"Multikampania","WARNING":"Ostrzeżenie","CURRENT_CYCLE":"Obecny cykl","MIN_CYCLE_NUMBER":"Minimalna liczba cykli","STEP_NOT_IN_DATE":"Daty kroku przekroczone","ONE_CYCLE_PER_DAY":"Można zrobić nie więcej niż jedną kontrolę dziennie","PROPOSAL_END_DATE":"Koniec Zlecenia","STEP_START":"start","STEP_TURN":"wróć","STEP_OK":"OK","STEP_WAIT":"czekaj","STEP_ATTENTION":"uwaga","NO_PROPOSAL_DATA":"Brak danych w propozycji","MK_SH_ERROR_NO_MK_SH":"Brak danych Market Share dla","MK_SH_ERROR_NO_SELL":"Brak danych Sell Out dla","MK_SH_ERROR_NO_DATA":"Brak danych","TITLE_COMMON_BUDGET":"Wspólny budżet","TITLE_SIMPLE_BUDGET":"Wartość budżetu","BUDGET":"Budżet","BUDGET_USED":"Wykorzystany budżet","BUDGET_PLANNED":"Planowany Budget","BUDGET_REST":"Pozostały budżet","BUDGET_PLANNED_REST":"Rest Planned Budget","BUDGET_OVERRUN":"Budżet przekroczony","BUDGET_PLANNED_OVERRUN":"Overrun Planned Budget","MESSAGE_BUDGET_OVERRUN":"Budżet przekroczony!","MESSAGE_PLANNED_BUDGET_OVERRUN":"Planowany budżet przekroczony!","MESSAGE_NOT_SET_BUDGET":"Budżet nie jest ustawiony!","DRUGSTORE_NOT_COMPLIANT":"Apteka nie spełnia zakładanych kryteriów","MESSAGE_ATTENTION":"Uwaga!","MESSAGE_CONFIRMATION":"Potwierdzenie!","CONFIRM_ADD_STEP":"Potwierdź, że chcesz dodać nowy krok: kontrola usług","WARNING_CAN_NOT_CLONE_STEP":"Nowy Krok: Kontrola Usług może być dodany, tylko wtedy jeśli poprzedni jest zamknięty lub poza datą wizyty. Sprawdź poprzedni krok Kontrola Usług","WARNING_DATE_GREATER_CAMPAIGN_DATE_END":"Niestety, nie możesz dodać kolejnego kroku, bo jesteś poza datami kampanii","CONFIRM_SAVING_DATA":"Potwierdzenie zapisywania danych","PHOTO_ACCEPT":"Akceptacja zdjęcia","CLOSE_STEP":"Zamknięcie kroku","CONFIRM_ACCEPT":"Potwierdź akceptację","PROPOSAL_DURATION":"Okres trwania Zlecenia","ADD_EVENT":"Dodaj wydarzenie","DRUGS_GROUPS":"Grupy leków","MARKET_SHARE":"Udział Rynkowy","GET_MARKET_SHARE":"Pobierz Dane","APPLY_AVERAGE_DATA":"Średnie dane zostały dodane","WRONG_DATE":"Zła data"}'),cache.put("app/clients/i18n/en.json",'{"ALERT_FORM_ERROR":"There are errors on the form. Please fix them before continuing.","ID":"ID","NAME":"Name","LAST_NAME":"Last Name","CATEGORY":"Category","CITY":"City","ZIP":"ZIP","STREET":"Street","ADITIONAL_INFORMATION":"Additional Information","YES":"yes","NO":"no","EDITING_ADITIONAL_INFORMATION":"Editing Additional Information","CANCEL":"Cancel","SAVE":"Save","ACTIVITY_STAFF":"The Activity Staff","PHONE":"Phone","NIP":"Nip","ACTUAL_CAMPAIGN":"Actual campaigns","DURATION_OF":"The duration of","HISTORY":"History","JOB_TITLE":"Job Title","AWARDS_DETALING":"Awards - detailing","CONFERENCES":"Conferences","INVITATION_TO_CONFERENCE":"Invitation to Conference","SELECT_CONFERENCE":"Select Conference","TOPIC":"Topic","DESCRIPTION":"Description","SELECT_CITY":"Select City","SELECT_DATE":"Select Date","BED":"bed","BEDS":"beds","PARTICIPATES":"Participates","ROOM":"Room","INCLUDE":"Include","SELECT_ROOM":"Select Room","COMMON_SETTINGS":"Common Settings","PLACEMENT":"Placement","GENERATE_INVITATIONS":"Generate Invitations","CLIENT_LIST":"Client List","SELECT_REP":"Select Rep","REP":"Rep","REPS":"Representants","ADDRESS":"Address","GENERAL_INFORMATION":"General Information","TITLE":" Title","EMAIL":"E-mail","DRUGSTORES_NETWORK":"Drugstores Network","NEGOTIATION_POINT":"Negotiation Point","SELLING_POINT":"Selling Point","NUMBER_OF_SELLING_POINT":"Number of Selling Point","ADDRESS_LINE":"Address Line","COUNTRY":"Country","CONFIRM_FRAME_CONTRACT_SIGNING":"Confirm Frame Contract Signing...","FRAME_CONTRACT_PRINT":"Frame Contract Print...","UPLOAD_SCANNED_FRAME_CONTRACT":"Upload Scanned Frame Contract...","VIEW_SCANNED_FRAME_CONTRACT":"View Scanned Frame Contract...","CONFIRM_CONTRACT_SIGNED_UP":"Confirm Contract Signed Up","CONFIRM_CONTRACT_SIGNED_BY_DRUGSTORE":"Please confirm that the frame contract was signed by drugstore.","OK":"OK","PRINT_FRAME_CONTRACT":"Print Frame Contract","UPLOAD_SIGNED_CONTRACT_SCAN":"Upload Signed Contract Scan","TYPE_FILE_TO_UPLOAD":"Please select file of type JPEG, PNG, GIF, TIFF or PDF to upload.","SELECT_FILE":"Select File","UPLOAD_FRAME_CONTRACT":"Upload Frame Contract","VIEW_SIGNED_CONTRACT_SCAN":"View Signed Contract Scan","CLOSE":"Close","CREATE_DRUGSTORE":"Create Drugstore","INFO":"Info","YOU_CHANGED":"You changed","APPROPRIATE_WILL_SEND":"The appropriate Annex to the contract will be send to","ANNEX_NEEDS_TO_BE_CONFIRMED":"This Annex needs to be confirmed by Drugstore.","LOCAL_DRUGSTORE":"Local Drugstore","SIGN_CONTRACT_ANNEX":"Sign Contract Annex","CONFIRM_CHANGES_AND_SIGN_CONTRACT_ANNEX":"Confirm Changes and Sign Contract Annex","EMPLOYEES":"Employees","ADD":"Add","REGISTER":"Register","EDIT":"Edit","DELETE":"Delete","CONFIRM_REMOVING_USER":"Are you sure you want to remove this user?","CHOOSE_JOB_TITLE":"Choose Job Title","PROFESSION_NUMBER":"Profession Number","SEARCH_TAGS":"Search tags...","DYNAMIC_SEARCH":"dynamic search","SELECT":"Select","CONFIRM_DRUGSTORE_REGISTRATION_1":"Registration link will be sent to","CONFIRM_DRUGSTORE_REGISTRATION_2":"","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_1":"Entered email address is belongs to portal account of drugstore","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_2":"Are you sure you want to append this drugstore to existent account?","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_3":"If not, enter unique email for this drugstore.","comment:":"=============Calendar==========","START_DATE":"Start Date","START_TIME":"Start Time","END_DATE":"End Date","END_TIME":"End Time","ALL_DAY":"All day","ACTION_NAME":"Action","PAGE":"Page","STEP_START":"start","STEP_TURN":"turn","STEP_OK":"OK","STEP_WAIT":"wait","STEP_ATTENTION":"attention","OLD_DATE_PHOTO":"Date outdated!","MESSAGE_ATTENTION":"Attention!","MESSAGE_CONFIRMATION":"Confirmation!","CONFIRM_ADD_STEP":"Are you sure you want to clone step?","WARNING_CAN_NOT_CLONE_STEP":"Step can be cloned only if it\'s closed, or it\'s outdated, or there is less then 7 days until the end of the step","WARNING_DATE_GREATER_CAMPAIGN_DATE_END":"Today\'s date is greater than campaign end date","CONFIRM_OFFLINE_MODE":"Confirm offline mode","DONE_IN_OFFLINE_MODE":"Done in offline mode","DRUGSTORES_LIST":"Drugstores list","CONFIRM_DRUGSTORE_REGISTRATION":"Confirm drugstore registration in Portal","CONFIRM_DRUGSTORE_EMAIL_REMOVAL":"Confirm drugstore email removal from Portal","CONFIRM_DRUGSTORE_EMAIL_CHANGE":"Confirm drugstore email change","DRUGSTORE_EMAIL_CHANGE_UNAVAILABLE":"Drugstore email change unavailable","REGISTRATION_REMOVAL_UNAVAILABLE":"Registration removal unavailable","ADD_DRUGSTORE_TO_DRUGSTORES_FAMILY":"Add drugstore to drugstores family","CONFIRM_REMOVAL":"Confirm removal","EDITING_USER_DATA":"Editing user data","ADD_EVENT":"Add event","PHOTO_REJECTED":"Was rejected"}'),cache.put("app/clients/i18n/pl.json",'{"ALERT_FORM_ERROR":"Błędy w formularzu. Proszę naprawić przed kontynuowaniem.","ID":"ID","NAME":"Nazwa","LAST_NAME":"Nazwisko","CATEGORY":"Kategoria","CITY":"Miasto","ZIP":"Kod","STREET":"Ulica","ADITIONAL_INFORMATION":"Dodatkowe informacje","YES":"tak","NO":"nie","EDITING_ADITIONAL_INFORMATION":"Edycja dodatkowe informacje","CANCEL":"Anuluj","SAVE":"Zapisz","ACTIVITY_STAFF":"Aktywność Pracowników","PHONE":"Telefon","NIP":"NIP","ACTUAL_CAMPAIGN":"Aktualne kampanie","DURATION_OF":"Okres trwania","HISTORY":"Historia","JOB_TITLE":"Stanowisko","AWARDS_DETALING":"Nagrody — Detailing","CONFERENCES":"Konferencje","INVITATION_TO_CONFERENCE":"Zaproszenie na Konferencję","SELECT_CONFERENCE":"Wybierz Konferencję","TOPIC":"Temat","DESCRIPTION":"Opis","SELECT_CITY":"Wybierz miasto","SELECT_DATE":"Wybierz datę","BED":"Łóżko","BEDS":"Łóżka","PARTICIPATES":"Uczestniczy","ROOM":"Pokój","INCLUDE":"Zawierać","SELECT_ROOM":"Wybierz typ pokoju","COMMON_SETTINGS":"Ustawienia","PLACEMENT":"Umieszczenie","GENERATE_INVITATIONS":"Wygeneruj Zaproszenia","CLIENT_LIST":"Lista Klientów","SELECT_REP":"Wybierz Przedstawiciela","REP":"Przedstawiciel","REPS":"Przedstawicieli","ADDRESS":"Adres","GENERAL_INFORMATION":"Informacje Ogólne","TITLE":"Nazwa","EMAIL":"E-mail","DRUGSTORES_NETWORK":"Sieć","NEGOTIATION_POINT":"Centrala","SELLING_POINT":"Apteka","NUMBER_OF_SELLING_POINT":"Ilość Aptek","ADDRESS_LINE":"Adres","COUNTRY":"Kraj","CONFIRM_FRAME_CONTRACT_SIGNING":"Potwierdz podpisanie Umowy Ramowej","FRAME_CONTRACT_PRINT":"Drukuj Umowę Ramową","UPLOAD_SCANNED_FRAME_CONTRACT":"Prześlij zeskanowaną Umowę Ramową","VIEW_SCANNED_FRAME_CONTRACT":"Zobacz zeskanowaną Umowę Ramową","CONFIRM_CONTRACT_SIGNED_UP":"Umowa Ramwa podpisana","CONFIRM_CONTRACT_SIGNED_BY_DRUGSTORE":"Potwierdz podpisanie Umowy Ramowej przez Aptekę","OK":"Tak","PRINT_FRAME_CONTRACT":"Drukuj Umowę Ramową","UPLOAD_SIGNED_CONTRACT_SCAN":"Prześlij skan podpisanej Umowy Ramowej","TYPE_FILE_TO_UPLOAD":"Wybierz plik typu JPEG, PNG, GIF, TIFF lub PDF do przesłania","SELECT_FILE":"Wybierz Plik","UPLOAD_FRAME_CONTRACT":"Przeslij Umowę Ramową","VIEW_SIGNED_CONTRACT_SCAN":"Zobacz skan podpisanej Umowy Ramowej","CLOSE":"Zamknij","CREATE_DRUGSTORE":"Dodaj Aptekę lub Utwórz Aptekę","INFO":"Informacje","YOU_CHANGED":"Dokonano zmiany","APPROPRIATE_WILL_SEND":"Odpowiedni załacznik do Umowy zostanie wysłany do…","ANNEX_NEEDS_TO_BE_CONFIRMED":"Załącznik musi być potwierdzony przez Aptekę.","LOCAL_DRUGSTORE":"Apteka Lokalna","SIGN_CONTRACT_ANNEX":"Podpisz Aneks do Umowy","CONFIRM_CHANGES_AND_SIGN_CONTRACT_ANNEX":"Potwierdź zmiany i podpisz Aneks do Umowy","EMPLOYEES":"Pracownicy","ADD":"Dodaj","REGISTER":"Zarejestruj","EDIT":"Edytuj","DELETE":"Usuń","CONFIRM_REMOVING_USER":"Potwierdz usunięcie Użytkownika","CHOOSE_JOB_TITLE":"Wybierz nazwę zawodu","PROFESSION_NUMBER":"Numer Zawodu","SEARCH_TAGS":"Szukaj Tagów","DYNAMIC_SEARCH":"Dynamiczne wyszukiwanie","SELECT":"Wybierz","CONFIRM_DRUGSTORE_REGISTRATION_1":"Na adres e-mail","CONFIRM_DRUGSTORE_REGISTRATION_2":"zostanie wysłana wiadomość wraz z linkiem umożliwiającym dokończenie rejestracji Apteki w Portalu Klienta","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_1":"Wprowadzony adres e-mail jest wykorzystywany w Portalu Klienta przez aptekę","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_2":"Czy chcesz przyłączyć aptekę, w której aktualnie jesteś, do już istniejącego konta?","CONFIRM_DRUGSTORE_REGISTRATION_ATTACH_3":"Jeśli nie, wprowadź inny adres e-mail dla tej apteki.","comment:":"=============Calendar==========","START_DATE":"Data Rozpoczęcia","START_TIME":"Czas","END_DATE":"Koniec Zlecenia","END_TIME":"Koniec Czasu","ALL_DAY":"Cały dzień","ACTION_NAME":"Akcja","PAGE":"Krok","STEP_START":"start","STEP_TURN":"wróć","STEP_OK":"OK","STEP_WAIT":"czekaj","STEP_ATTENTION":"uwaga","OLD_DATE_PHOTO":"Data nieaktualna!","MESSAGE_ATTENTION":"Uwaga!","MESSAGE_CONFIRMATION":"Potwierdzenie!","CONFIRM_ADD_STEP":"Potwierdź, że chcesz dodać nowy krok: kontrola usług","WARNING_CAN_NOT_CLONE_STEP":"Nowy Krok: Kontrola Usług może być dodany, tylko wtedy jeśli poprzedni jest zamknięty lub poza datą wizyty. Sprawdź poprzedni krok Kontrola Usług","WARNING_DATE_GREATER_CAMPAIGN_DATE_END":"Niestety, nie możesz dodać kolejnego kroku, bo jesteś poza datami kampanii","CONFIRM_OFFLINE_MODE":"Potwierdź trybie offline","DONE_IN_OFFLINE_MODE":"Akcje realizowane w trybie offline","DRUGSTORES_LIST":"Spis Aptek","CONFIRM_DRUGSTORE_REGISTRATION":"Potwierdź rejestrację Apteki w Portalu Klienta","CONFIRM_DRUGSTORE_EMAIL_REMOVAL":"Potwierdź usunięcie e-mail Apteki z Portalu Klienta","CONFIRM_DRUGSTORE_EMAIL_CHANGE":"Potwierdź zmianę adresu e-mail","DRUGSTORE_EMAIL_CHANGE_UNAVAILABLE":"Nie możliwa zmiana E-maila Apteki","REGISTRATION_REMOVAL_UNAVAILABLE":"Nie możliwe anulowanie rejestracji","ADD_DRUGSTORE_TO_DRUGSTORES_FAMILY":"Dołącz Aptekę do Rodziny Aptek","CONFIRM_REMOVAL":"Potwierdź usunięcie","EDITING_USER_DATA":"Edycja danych Użytkownika","ADD_EVENT":"Dodaj wydarzenie","PHOTO_REJECTED":"Został odrzucony"}'),cache.put("app/detailing/i18n/en.json",'{"DETAILING":"Detailing","REPLAY_PDF":"Replay PDF","POINTS_FOR_PRESENTATION":"Points For The Presentation","POINTS_FOR_GIFT":"Points For Gifts","EMPLOYEES":"Employees","SEEN_PRESENTATION":"Seen the presentation","POINTS":"Points","SPENT_POINTS":"Spent Points","AVAILABLE_POINTS":"Available Points","GIFTS":"Gifts","GIFT":"Gift","TO_GIVE_ON":"To give on","GIVE_PRESENTS":"Give Presents","CANCEL":"Cancel","SAVE":"Save","EXPORT_TO_EXCEL":"Export to Excel","SAVE_SPREADSHEET":"Save Spreadsheet","MARK":"Mark","PRICE":"Price","AMOUNT":"Amounst","CURRENT_CYCLE_DETAILING":"Current Cycle Detailing","TOTAL_DETAILING":"Total Detailing","DAYS":"days","YOUR_NEXT_DETAILING":"Your next detailing","BASE_OF_DETAILING":"Base of detaling","PREVIEW_FILMS":"Preview Films","NAME":"Name","CITY":"City","CODE":"Code","STREET":"Street","ID":"ID","ADDRESS":"Address","DETAILING_PREVIEW_FILMS":"Detailing Preview Films","CAMPAIGN":"Campaign","TOTAL_POINTS":"Total Points","TITLE":"Title","START_DATE":"Start Date","END_DATE":"End Date","ACTION":"Action","PLAY_PDF":"Play PDF","DYNAMIC_SEARCH":"dynamic search","ADD_EVENT":"Add event"}'),cache.put("app/detailing/i18n/pl.json",'{"DETAILING":"Detailing","REPLAY_PDF":"Odtwórz ponownie","POINTS_FOR_PRESENTATION":"Ilośc punktów za prezentacje","POINTS_FOR_GIFT":"Ilość punktów za nagrody","EMPLOYEES":"Personel Apteki","SEEN_PRESENTATION":"Przeszkolono","POINTS":"Punkty","SPENT_POINTS":"Punkty wydane","AVAILABLE_POINTS":"Punkty na koncie","GIFTS":"Nagrody","GIFT":"Nagroda","TO_GIVE_ON":"aby dać na","GIVE_PRESENTS":"Wydawać nagrody","CANCEL":"Anuluj","SAVE":"Zapisz","EXPORT_TO_EXCEL":"Eksportuj do Excel","SAVE_SPREADSHEET":"Zapisz arkusz","MARK":"Marka","PRICE":"Cena","AMOUNT":"Ilość","CURRENT_CYCLE_DETAILING":"Detailing — Bieżący Cykl","TOTAL_DETAILING":"Razem","DAYS":"dni","YOUR_NEXT_DETAILING":"Twój następny Detailing","BASE_OF_DETAILING":"Baza Detailingów","PREVIEW_FILMS":"Podgląd","NAME":"Nazwisko","CITY":"Miasto","CODE":"Kod","STREET":"Ulica","ID":"ID","ADDRESS":"Adres","DETAILING_PREVIEW_FILMS":"Detailing — Ogladaj prezentacje","CAMPAIGN":"Kampania","TOTAL_POINTS":"Suma Punktów","TITLE":"Nazwa","START_DATE":"Data rozpoczęcia","END_DATE":"Data końcowa","ACTION":"Akcja","PLAY_PDF":"Odtwórz","DYNAMIC_SEARCH":"Dynamiczne wyszukiwanie","ADD_EVENT":"Dodaj wydarzenie"}'),cache.put("app/gazetki/i18n/en.json",'{"INCLUDE_PRICE":"include price in text","PREVIEW":"Preview","PAGE":"Page","PRINTING":"Printing","SELECT_ADDRESSER":"Select Address","MAIN_OFFICE":"Main Office","DRUGSTORE":"Drugstore","REPRESENTANT":"Representant","SEND_TO_DRUGSTORE":"Send to Drugstore","DELIVERY_ADDRESS":"DELIVERY ADDRESS","CANCEL":"Cancel","SAVE":"Save","SEND":"Send","GAZETKI_LIST":"Gazetki List","ID":"ID","NAME":"Name","CATEGORY":"Category","CITY":"City","ZIP":"ZIP","STREET":"Street","ADDRESS":"Address","DYNAMIC_SEARCH":"dynamic search","ADD_EVENT":"Add event"}'),cache.put("app/gazetki/i18n/pl.json",'{"INCLUDE_PRICE":"Dodaj ceny","PREVIEW":"Podgląd","PAGE":"Strona","PRINTING":"Drukuj","SELECT_ADDRESSER":"Wybierz adresy","MAIN_OFFICE":"Centrala","DRUGSTORE":"Apteka","REPRESENTANT":"Przedstawiciel","SEND_TO_DRUGSTORE":"Wyślij do Apteki","DELIVERY_ADDRESS":"Adres dostawy","CANCEL":"Anuluj","SAVE":"Zapisz","SEND":"Wyślij","GAZETKI_LIST":"Lista gazetek","ID":"ID","NAME":"Nazwa","CATEGORY":"Kategoria","CITY":"Miasto","ZIP":"Kod","STREET":"Ulica","ADDRESS":"Adres","DYNAMIC_SEARCH":"Dynamiczne wyszukiwanie","ADD_EVENT":"Dodaj wydarzenie"}'),cache.put("app/layout/i18n/en.json",'{"comment:":"===============404============","THAT_HAPPENS_NOT_TO_BE_A_PAGE":"That happens not to be a page","REWIND_AND_TRY_ANOTHER_ONE":"Rewind and try another one","comment:":"=============Calendar==========","START_DATE":"Start Date","START_TIME":"Start Time","END_DATE":"End Date","END_TIME":"End Time","ALL_DAY":"All day","TITLE":"Title","DESCRIPTION":"Description","comment:":"==============Presentation===============","SLIDERSHOW_DELAY":"Slideshow Delay","SECONDS":"seconds","MINUTE":"minute","HOME":"Home","CLIENTS":"Clients","ADD_EVENT":"Add event","EDIT_BOOKMARKS":"Edit bookmarks"}'),cache.put("app/layout/i18n/pl.json",'{"comment:":"===============404============","THAT_HAPPENS_NOT_TO_BE_A_PAGE":"To się zdarza, aby to nie jest stroną","REWIND_AND_TRY_ANOTHER_ONE":"Odświerz i spróbuj jeszcze raz","comment:":"=============Calendar==========","START_DATE":"Data Rozpoczęcia","START_TIME":"Czas","END_DATE":"Data Końcowa","END_TIME":"Koniec Czasu","ALL_DAY":"Cały dzień","TITLE":"Nazwa","DESCRIPTION":"Opis","comment:":"===============Presentation=============","SLIDERSHOW_DELAY":"Opóźnienie pokazu slajdów","SECONDS":"sekundy","MINUTE":"minuty","HOME":"Home","CLIENTS":"Klienci","ADD_EVENT":"Dodaj wydarzenie","EDIT_BOOKMARKS":"Edytuj zakładkę"}'),cache.put("app/messaging/i18n/en.json",'{"INBOX":"Inbox","SENT":"Sent","TRASH":"Trash","SORT_BY":"Sort by","ALL":"All","SELECT_ALL":"Select all","DATE":"date","NEW_MESSAGE":"New Message","DELETE":"Delete","DELETE_SELECTED":"Delete selected","DELETED_MESSAGES":"Deleted Messages","SELECT_MESSAGE_FROM_LEFT_SIDE":"Select a message from the list at the left side.","TO":"To","OUTGOING_MESSAGE":"Outgoing Messages","DISCARD":"Discard","SAVE":"Save","SEND":"Send","SUBJECT":"Subject","FROM":"From","FAST_REPLY":"Fast reply","MESSAGE":"Message","DYNAMIC_SEARCH":"dynamic search","ORIGINAL_MESSAGE":"Original message","DOWNLOAD":"Download","comment:":"=============Calendar==========","START_DATE":"Start Date","START_TIME":"Start Time","END_DATE":"End Date","END_TIME":"End Time","ALL_DAY":"All day","TITLE":"Title","DESCRIPTION":"Description","ATTACHMENT":"Attachment","CONFIRM_REPORT_ACCEPTANCE":"Confirm report acceptance","CONFIRM_REPORT_REJECTION":"Confirm report rejection","CONFIRM_PROPOSAL_ACCEPTANCE":"Confirm proposal acceptance","CONFIRM_PROPOSAL_REJECTION":"Confirm proposal rejection","ADD_EVENT":"Add event"}'),cache.put("app/messaging/i18n/pl.json",'{"INBOX":"Przychodzące","SENT":"Wysłane","TRASH":"Kosz","SORT_BY":"Sortuj według","ALL":"Wszystko","SELECT_ALL":"Zaznacz wszystko","DATE":"Data","NEW_MESSAGE":"Nowa wiadomość","DELETE":"Usuń","DELETE_SELECTED":"Usuń zaznaczone","DELETED_MESSAGES":"Usunięte wiadomości","SELECT_MESSAGE_FROM_LEFT_SIDE":"Wybierz wiadomość z listy po lewej stronie","TO":"Do","OUTGOING_MESSAGE":"Wychodząca wiadomość","DISCARD":"Odrzuć","SAVE":"Zapisz","SEND":"Wyślij","SUBJECT":"Temat","FROM":"Od","FAST_REPLY":"Odpowiedz","MESSAGE":"Wiadomość","DYNAMIC_SEARCH":"Dynamiczne wyszukiwanie","ORIGINAL_MESSAGE":"Oryginalna wiadomość","DOWNLOAD":"Ściągnij","comment:":"=============Calendar==========","START_DATE":"Data Rozpoczęcia","START_TIME":"Czas","END_DATE":"Data Końcowa","END_TIME":"Koniec Czasu","ALL_DAY":"Cały dzień","TITLE":"Nazwa","DESCRIPTION":"Opis","ATTACHMENT":"Załącznik","CONFIRM_REPORT_ACCEPTANCE":"Potwierdź akceptację raportu","CONFIRM_REPORT_REJECTION":"Potwierdź odrzucenie raportu","CONFIRM_PROPOSAL_ACCEPTANCE":"Potwierdź akceptację zlecenia","CONFIRM_PROPOSAL_REJECTION":"Potwierdź odrzucenie zlecenia","ADD_EVENT":"Dodaj wydarzenie"}'),cache.put("app/profile/i18n/en.json",'{"comment:":"===============Main===============","ALERT_FORM_ERROR":"There are errors on the form. Please fix them before continuing.","ID":"ID","NAME":"Name","CATEGORY":"Category","CITY":"City","ZIP":"ZIP","STREET":"Street","JOB_TITLE":"Job Title","REGION":"Region","ADDRESS":"Address","CALENDAR":"Calendar","TODO":"TODO","COACHING":"Coaching","DICTIONARY":"Dictionary","CHANGE_PASS":"Change Password","EMAIL":"e-mail","OLD_PASS":"Old Password","NEW_PASS":"New Password","CONFIRM_PASS":"Confirm Password","comment:":"============Coachinng============","ALERT_OPEN_SESSION_ERROR":"You have an open session. Please, close it first, before creating new one.","ALL_CARDS":"All Cards","CHART":"Chart","TABLE":"Table","TEAM":"Team","SHEMA":"Shema","EXCEL":"EXCEL","PDF":"PDF","REPRESENTATIVES":"Representatives","NO_COACHING":"No Coaching","comment:":"===============Session==============","SESSIONS":"Sessions","SESSION":"Session","NEW_SESSION":"New Session","STEP":"Step","STEPS":"Steps","SUB_STEP":"Sub Step","NOTE":"Note","GOALS":"Goals","COACHING_GOALS":"Coaching goals","TOTAL":"Total","ACTION":"Action","SAVE":"Save","QUESTION":"Question","SEND_TO_REP":"Send to Rep","SEND_TO_RKS":"Send to RKS","comment:":"================Calendar==============","CONFIRM_REMOVE_EVENT":"Are you sure you want to remove this event?","CONFIRM_SAVE_EVENT":"Are you sure you want to save this event?","DESCRIPTION":"Description","TITLE":"Title","REPEAT":"Repeat","ALL_DAY":"All Day","END_TIME":"End Time","END_DATE":"End Date","START_TIME":"Start Time","START_DATE":"Start Date","CANCEL":"Cancel","comment:":"================Todo==============","PROPOSAL":"Proposal","SERVICES":"Services","SHELF":"Shelf","ENVIRONMENT":"Environment","AMOUNT_VARIES":"The Amount Varies","BONUS":"Bonus","POTENTIAL":"Potential","CONFIRM_MODAL_TITLE":"Confirm","CAMPAIGN":"Campaign","DRUGSTORE":"Drugstore","REP":"Representative","SEND":"Send","ACCEPT":"Accept","PHOTO":"Photo","TOTAL_SUM":"Total value","NOT_INCLUDE":"Not include","CAMPAIGN_DATE":"Campaign date","CYCLE_DATE":"Cycle date","CYCLE_DURATION":"Cycle duration","REJECT_REASON":"Reasons for refusal","CONFIRM_PROPOSAL_ACCEPTANCE":"Confirm proposal acceptance","CONFIRM_PROPOSAL_REJECTION":"Confirm proposal rejection","GOING_TO_ACCEPT_PROPOSAL":"You are going to accept proposal","GOING_TO_REJECT_PROPOSAL":"You are going to reject proposal","CONFIRM_REPORT_ACCEPTANCE":"Confirm report acceptance","CONFIRM_REPORT_REJECTION":"Confirm report rejection","GOING_TO_ACCEPT_REPORT":"You are going to accept report","GOING_TO_REJECT_REPORT":"You are going to reject report","ARE_YOU_SURE":"Are you sure?","CONFIRM_REMOVAL":"Confirm removal","CONFIRM_SAVING_DATA":"Confirm saving data","ADD_EVENT":"Add event","CONFIRM":"Confirm","ACCEPT_PHOTO":"Accept photo","CONFIRM_CONTROL":"Confirm control"}'),cache.put("app/profile/i18n/pl.json",'{"comment:":"===============Main===============","ALERT_FORM_ERROR":"W formularzu są błedy — sprawdź dane","ID":"ID","NAME":"Nazwisko","CATEGORY":"Kategoria","CITY":"Miasto","ZIP":"Kod","STREET":"Ulica","JOB_TITLE":"Stanowisko","REGION":"Region","ADDRESS":"Adres","CALENDAR":"Kalendarz","TODO":"Do zrobienia","COACHING":"Coaching","DICTIONARY":"Słownik","CHANGE_PASS":"Zmień hasło","EMAIL":"e-mail","OLD_PASS":"Stare hasło","NEW_PASS":"Nowe hasło","CONFIRM_PASS":"Potwierdź hasło","comment:":"============Coachinng============","ALERT_OPEN_SESSION_ERROR":"Masz otwartą sesję — zamknij ją, przed otwarciem nowej","ALL_CARDS":"Karty Coachingowe","CHART":"Wykres","TABLE":"Tabelka","TEAM":"Zespół","SHEMA":"Schemat","EXCEL":"EXCEL","PDF":"PDF","REPRESENTATIVES":"Przedstawiciele","NO_COACHING":"Moduł Coaching niedostępny","comment:":"===============Session==============","SESSIONS":"Sesje","SESSION":"Sesja","NEW_SESSION":"Nowa Sesja","STEP":"Krok","STEPS":"Kroki","SUB_STEP":"Etap","NOTE":"Notatka","SESSION_DESCRIPTION":"Skala poziomu kompetencji","COACHING_CHART":"Aktualna Karta Coachingowa","GOALS":"Cel autoszkoleniowy","YOUR_GOALS":"Twój cel autoszkoleniowy","COACHING_GOALS":"Cel coachingu","TOTAL":"Mocne strony / Obszary do poprawy","ACTION":"Aktywność","SAVE":"Zapisz","QUESTION":"Pytanie","SEND_TO_REP":"Wyślij do Przedstawiciela","SEND_TO_RKS":"Wyslij do Kierownika","comment:":"================Calendar==============","CONFIRM_REMOVE_EVENT":"Potwierdź usuniętę wydarzenie","CONFIRM_SAVE_EVENT":"Potwierdź dane","DESCRIPTION":"Opis","TITLE":"Tytuł","REPEAT":"Potwórz","ALL_DAY":"Cały dzień","END_TIME":"Koniec czasu","END_DATE":"Data końcowa","START_TIME":"Czas","START_DATE":"Data startu","CANCEL":"Anuluj","comment:":"================Todo==============","PROPOSAL":"Finalne ustalenia","SERVICES":"Usługi","ENVIRONMENT":"Witryna","SHELF":"Półka","AMOUNT_VARIES":"Kwota zmienna","BONUS":"Bonus","POTENTIAL":"Potencjał","CONFIRM_MODAL_TITLE":"Potwierdzić","CAMPAIGN":"Kampania","DRUGSTORE":"Apteka","REP":"Przedstawiciel","SEND":"Wyślij","ACCEPT":"Zaakceptuj","PHOTO":"Photo","TOTAL_SUM":"Wartość total","NOT_INCLUDE":"Nie zawiera","CAMPAIGN_DATE":"Data ramowa kampanii","CYCLE_DATE":"Daty cyklu","CYCLE_DURATION":"Liczba okresów","REJECT_REASON":"Powody odrzucenia","CONFIRM_PROPOSAL_ACCEPTANCE":"Potwierdź warunki zlecenia","CONFIRM_PROPOSAL_REJECTION":"Potwierdź odrzucenie zlecenia","GOING_TO_ACCEPT_PROPOSAL":"Akceptujesz warunki zlecenia.","GOING_TO_REJECT_PROPOSAL":"Chcesz odrzucić warunki zlecenia kampanii.","CONFIRM_REPORT_ACCEPTANCE":"Potwierdź warunki raporta","CONFIRM_REPORT_REJECTION":"Potwierdź odrzucenie raporta","GOING_TO_ACCEPT_REPORT":"Akceptujesz warunki raporta.","GOING_TO_REJECT_REPORT":"Chcesz odrzucić warunki raporta kampanii.","ARE_YOU_SURE":"Czy jesteś pewny, że chcesz zapisać swoją decyzję?","CONFIRM_REMOVAL":"Potwierdź usunięcie","CONFIRM_SAVING_DATA":"Potwierdzenie zapisywania danych","ADD_EVENT":"Dodaj wydarzenie","CONFIRM":"Potwierdź","ACCEPT_PHOTO":"Zaakceptuj zdjęcie","CONFIRM_CONTROL":"Potwierdź Kontrolę"}'),
cache.put("app/__modules/budgeting/i18n/en.json",'{"BUDGETING":"Budgeting","DURATION":"Duration","SAVE":"Save","CANCEL":"Cancel","ID":"Identifier","BUDGET":"Budget","CURRENCY":"Currency","BUDGET_TOTAL":"Budget total","BUDGET_ACTUAL":"Budget fullfillment","REPRESENTANTS":"Pharmaceutical representatives","NAME":"Name","PROGRESS":"Progress","ACTUAL":"Fullfillment","EMAIL":"E-Mail","TOTAL":"Total","OVERBUDGET":"Overbudget","COMMON_BUDGET_MODE_IS_ON":"Common budget mode is on","BUDGET_TOO_LOW":"Budget too low","CONFIRM_COMMON_BUDGET_MODE_ENABLE":"You\'re going to enable common budget mode. Are you sure?","NO_BUDGETS":"You don’t have any budget","CONFIRM_SAVING_DATA":"Confirm saving data","ADD_EVENT":"Add event"}'),cache.put("app/__modules/budgeting/i18n/pl.json",'{"BUDGETING":"Budżet","DURATION":"Okres trwania","SAVE":"Zapisz","CANCEL":"Anuluj","ID":"Identyfikator","BUDGET":"Budżet","CURRENCY":"Waluta","BUDGET_TOTAL":"Suma budżetu","BUDGET_ACTUAL":"Realizacja budżetu","REPRESENTANTS":"Przedstawiciele medyczni","NAME":"Imię","PROGRESS":"Postęp","ACTUAL":"Realizacja","EMAIL":"E-mail","TOTAL":"Suma","OVERBUDGET":"Przekroczenie budżetu","COMMON_BUDGET_MODE_IS_ON":"Wspólny budżet","BUDGET_TOO_LOW":"Budżet już wykorzystany","CONFIRM_COMMON_BUDGET_MODE_ENABLE":"Wybrano wariant Budżet Wspólny. Potwierdź","NO_BUDGETS":"Nie masz budżetu","CONFIRM_SAVING_DATA":"Potwierdzenie zapisywania danych","ADD_EVENT":"Dodaj wydarzenie"}'),cache}),function(){"use strict";function atlAccordion($timeout){return{restrict:"E",transclude:!0,template:'<div class="ui fluid accordion" ng-transclude></div>',link:function(scope,elm,attr){$timeout(function(){elm.accordion()},0)}}}angular.module("app.core").directive("atlAccordion",atlAccordion),atlAccordion.$inject=["$timeout"]}(),function(){"use strict";function atlDropdown($timeout){return{restrict:"E",scope:{direction:"@"},link:function(scope,elm,attr){$timeout(function(){elm.dropdown({direction:scope.direction})},0)}}}angular.module("app.core").directive("atlDropdown",atlDropdown),atlDropdown.$inject=["$timeout"]}(),function(){"use strict";function atlInfiniteScroll(){return{scope:{atlInfiniteScroll:"&",containerToScroll:"@"},link:function(scope,element,attrs){var raw=angular.element("#"+scope.containerToScroll)[0],scrollContainer=function(){raw.scrollTop+raw.offsetHeight+10>=raw.scrollHeight&&scope.$apply(scope.atlInfiniteScroll)};angular.element("#"+scope.containerToScroll).bind("scroll",scrollContainer),scope.$on("$destroy",function(){angular.element("#"+scope.containerToScroll).unbind("scroll",scrollContainer)})}}}angular.module("app.core").directive("atlInfiniteScroll",atlInfiniteScroll)}(),function(){"use strict";function atlIntegerMultipleStep(){return{restrict:"A",require:"?ngModel",link:function(scope,element,attrs,modelCtrl){modelCtrl.$parsers.push(function(inputValue){var remainder,transformedInput,step=10,min=attrs.min,max=attrs.max;return inputValue?inputValue<=min||inputValue>=max?inputValue:(transformedInput=inputValue,remainder=transformedInput%step,remainder&&(remainder>=step/2?transformedInput+=step-remainder:transformedInput-=remainder),transformedInput!==inputValue&&(modelCtrl.$setViewValue(Number(transformedInput)),modelCtrl.$render()),transformedInput):0})}}}angular.module("app.core").directive("atlIntegerMultipleStep",atlIntegerMultipleStep)}(),function(){"use strict";function atlKnob($timeout){return{restrict:"EA",replace:!0,template:'<input value="{{knobData}}"/>',scope:{knobData:"=",knobOptions:"&",width:"@",height:"@",readOnly:"@",fgColor:"@",knobChangeValue:"="},link:function($scope,$element){$scope.$watch("knobData",function(newValue,oldValue){newValue!=oldValue&&$element.val(newValue).change()}),$scope.$watch("knobChangeValue",function(newValue,oldValue){newValue!=oldValue&&$element.val(newValue)}),$element.val($scope.knobData).knob({width:$scope.width,height:$scope.height,displayPrevious:!0,readOnly:$scope.readOnly,thickness:.1,fgColor:$scope.fgColor?$scope.fgColor:"#28bcde"}),"undefined"!=typeof $scope.knobChangeValue&&$element.val($scope.knobChangeValue)}}}angular.module("app.core").directive("atlKnob",atlKnob),atlKnob.$inject=["$timeout"]}(),function(){"use strict";function atlListSlider($timeout){return{restrict:"AE",replace:!0,transclude:!0,require:"?ngModel",scope:{classList:"@",listId:"@",startIndex:"@",displayNumber:"@",stepNumber:"@",targetId:"@",listIndex:"@",hScroll:"=ngModel"},templateUrl:"app/widgets/atl.listSlider.html",link:function($scope,$element,$attrs,modelCtrl){function moveNext(stepNumber){var step,nextIndex=startIndex+stepNumber;nextIndex<numberItems&&listItems[nextIndex]&&(step=-listItems[nextIndex].offsetLeft,startIndex+=stepNumber,container.css({marginLeft:step})),startIndex>0&&arrowBack.css({visibility:"visible"})}function setContainerWidth(){for(var element,ww=0,hh=0,w=0,obj={width:0,height:0},len=displayNumberItems,i=0;i<len;i++)element=angular.element(listItems[i]),0===i&&(hh=element.outerHeight(),w=element.outerWidth()),ww+=parseInt(element.css("margin-left"))+parseInt(w)+parseInt(element.css("margin-right"));ww+=parseInt(parentContainer.css("border-left-width"))+parseInt(parentContainer.css("border-right-width")),modelCtrl?(obj.width=ww,obj.height=hh,modelCtrl.$setViewValue(obj),modelCtrl.$render()):parentContainer.css({width:ww+"px",height:hh+"px"})}function controlContainerWidth(){$timeout(function(){listItems=$element.find(".list-slider-item"),numberItems=listItems.length||0,numberItems&&(setContainerWidth(),startIndex>0&&moveNext(0))},0)}function setArrowsVisibility(){$timeout(function(){listItems=$element.find(".list-slider-item"),numberItems=listItems.length||0,$scope.arrowsVisibility=numberItems>displayNumberItems?"visible":"hidden"},0)}var parentContainer,container,arrowBack,arrowForward,listItems,displayNumberItems,stepNumberItem,listIndex,numberItems,startIndex=0;parentContainer=$element.find(".h-scrollable"),container=parentContainer.find(".slider"),arrowBack=$element.find(".arrow-left"),arrowForward=$element.find(".arrow-right"),displayNumberItems=Number($scope.displayNumber),stepNumberItem=$scope.stepNumber?Number($scope.stepNumber):displayNumberItems,startIndex=Number($scope.startIndex)||0,listIndex=parseInt($scope.listIndex)||0,0===listIndex&&controlContainerWidth(),setArrowsVisibility(),$scope.scrollNext=function($event){$event.stopPropagation(),moveNext(stepNumberItem)},$scope.scrollPrev=function($event){var step,prevIndex=startIndex-stepNumberItem>=0?startIndex-stepNumberItem:0;$event.stopPropagation(),prevIndex>=0&&listItems[prevIndex]&&(step=-listItems[prevIndex].offsetLeft,prevIndex>0?startIndex-=stepNumberItem:startIndex=0,container.css({marginLeft:step}))},$scope.$on("addElement",function(event,data){$scope.targetId==data.targetId&&(controlContainerWidth(),setArrowsVisibility())})}}}angular.module("app.core").directive("atlListSlider",atlListSlider),atlListSlider.$inject=["$timeout"]}(),function(){"use strict";function atlLowerCase(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){modelCtrl.$parsers.push(function(inputValue){var transformedInput=inputValue.toLowerCase().replace(/\s+/g,"");return transformedInput!=inputValue&&(modelCtrl.$setViewValue(transformedInput),modelCtrl.$render()),transformedInput})}}}angular.module("app.core").directive("atlLowerCase",atlLowerCase)}(),function(){"use strict";function atlModalAttentionForm(){function link(scope,element,attrs){scope.hideModal=function(){}}var directive={restrict:"E",scope:{modalId:"=",modalTitle:"="},transclude:!0,templateUrl:"app/widgets/atl.modal.attention.form.html",link:link};return directive}angular.module("app.core").directive("atlModalAttentionForm",atlModalAttentionForm)}(),function(){"use strict";function atlModalConfirmDialog(){function link(scope,element,attrs){scope.lockForm=!1,scope.hideModal=function(){},element.modal({onHidden:function(){scope.lockForm=!1},onApprove:function(){scope.lockForm=!0}}),scope.$on("$destroy",function(){element.modal("hide"),element.remove()})}var directive={restrict:"E",scope:{modalId:"=",modalTitle:"=",confirm:"&onConfirm",okDisabled:"="},replace:!0,transclude:!0,templateUrl:"app/widgets/atl.modal.confirm.dialog.html",link:link};return directive}angular.module("app.core").directive("atlModalConfirmDialog",atlModalConfirmDialog)}(),function(){"use strict";function atlModalFormDialog(){function link(scope,element,attrs,ngModel){scope.lockForm=!1,scope.hideModal=function(){},element.modal({onHidden:function(){scope.lockForm=!1},onApprove:function(){scope.lockForm=!0}}),scope.$on("$destroy",function(){element.modal("hide"),element.remove()})}var directive={restrict:"E",scope:{modalId:"=",modalTitle:"=",save:"&onSave",showDelete:"=",showAction:"=","delete":"&onDelete"},replace:!0,transclude:!0,templateUrl:"app/widgets/atl.modal.form.dialog.html",link:link};return directive}angular.module("app.core").directive("atlModalFormDialog",atlModalFormDialog)}(),function(){"use strict";function atlPopup($timeout){return{restrict:"A",scope:{direction:"@",inline:"@"},link:function(scope,elm,attr){$timeout(function(){elm.popup({on:"click",inline:scope.inline,position:scope.direction})},0)}}}angular.module("app.core").directive("atlPopup",atlPopup),atlPopup.$inject=["$timeout"]}(),function(){"use strict";function atlRating($timeout){return{restrict:"E",replace:!0,scope:{rating:"=",maxRating:"@",interactive:"="},template:'<div class="ui star huge rating"></div>',link:function(scope,e,attr){scope.$watch("rating",function(){e.rating({initialRating:scope.rating,maxRating:scope.maxRating,interactive:scope.interactive,onRate:function(value){$timeout(function(){scope.rating=value})}})})}}}angular.module("app.core").directive("atlRating",atlRating),atlRating.$inject=["$timeout"]}(),function(){"use strict";function atlTabs($timeout){return{restrict:"E",transclude:!0,template:'<div class="ui two column grid"><div class="column"></div><div class="column right aligned"><div class="ui top attached right compact tabular menu message-menu" ng-transclude></div></div></div>',link:function(scope,elm,attr){$timeout(function(){$(".menu .item").tab()},0)}}}angular.module("app.core").directive("atlTabs",atlTabs),atlTabs.$inject=["$timeout"]}(),function(){"use strict";angular.module("app.core").directive("ionslider",function(){return{restrict:"E",scope:{min:"@",max:"@",type:"@",from:"@",to:"@",disable:"@",fromFixed:"@",values:"@",originalValues:"@",prefix:"@",maxPostfix:"@",grid:"@",prettify:"@",hasGrid:"@",gridMargin:"@",postfix:"@",step:"@",hideMinMax:"@",hideFromTo:"@",field:"=",reset:"@",name:"@",onChange:"=",onChangeValues:"=",dataindex:"@",dynamicValue:"@",dynamicChangeValues:"@"},template:"<div></div>",replace:!0,controller:function($rootScope,$scope,$element){var slider;!function(){var values=$scope.values;if("string"!=typeof $scope.fromFixed)try{$scope.fromFixed=$scope.fromFixed.toString()}catch(e){}$scope.fromFixed="true"===$scope.fromFixed,values&&($scope.values=values.split(","));var props={min:$scope.min,max:$scope.max,type:$scope.type,from:$scope.from,to:$scope.to,disable:$scope.disable,values:$scope.values,prefix:$scope.prefix,maxPostfix:$scope.maxPostfix,grid:$scope.grid,prettify:$scope.prettify,hasGrid:$scope.hasGrid,gridMargin:$scope.gridMargin,postfix:$scope.postfix,step:$scope.step,hideMinMax:$scope.hideMinMax,hideFromTo:$scope.hideFromTo,from_fixed:$scope.fromFixed,to_fixed:$scope.fromFixed,onChange:function(data){data&&$scope.onChange&&($scope.name||($scope.name=""),$scope.dataindex=parseInt($scope.dataindex)>=0?parseInt($scope.dataindex):null,$scope.onChange(data.from,$scope.dataindex,$scope.field,$scope.name))}};angular.element($element).ionRangeSlider(props),slider=angular.element($element).data("ionRangeSlider")}(),$scope.$watch("from",function(newVal,oldVal){newVal==oldVal||"true"!=$scope.fromFixed&&!$scope.reset||slider.update({from:newVal})}),$scope.$watch("fromFixed",function(newVal,oldVal){newVal!=oldVal&&(newVal="true"===newVal,slider.update({from_fixed:newVal,to_fixed:newVal}),newVal||slider.reset())}),$scope.$watch("dynamicValue",function(newVal,oldVal){var minArr,ind,vals,newVals;newVal&&$scope.originalValues&&(vals=$scope.originalValues.split(","),ind=vals.indexOf(newVal),"true"==$scope.dynamicChangeValues&&ind==-1&&(minArr=findMinRang(newVal,vals),ind=minArr.index+1,ind<vals.length?newVal!=minArr.min&&vals.splice(ind,0,newVal):ind=vals.length-1),newVals=$scope.onChangeValues($scope.field,vals,newVal,ind),slider.update({values:newVals,from:ind}))})}}})}(),function(){"use strict";function uiDropdownSelection($parse){function link($scope,$element,$attrs,$ctrls){var $model=$ctrls[0],config=$parse($attrs.options)($scope)||{},defaults={};$scope.items=$parse($attrs.items)($scope)||[],$scope.config=$.extend({},defaults,config),$($element).dropdown(),$scope.$watch("selectorValue",function(val,old){val!==old&&$model.$setViewValue(val||"")})}var directive;return directive={templateUrl:"app/widgets/ui-dropdown-selection.html",restrict:"E",transclude:!0,replace:!0,scope:!0,require:["ngModel"],link:link}}angular.module("app.core").directive("uiDropdownSelection",uiDropdownSelection),uiDropdownSelection.$inject=["$parse"]}(),function(){"use strict";function uiModalDialog(){function link($scope,$element,$attrs){$scope.title=$attrs.title,$scope.$watch($attrs.visible,function(value){$($element).modal(value?"show":"hide")}),$($element).modal({onShow:function(){$scope.$parent[$attrs.visible]=!0}}),$($element).modal({onHide:function(){$scope.$parent[$attrs.visible]=!1}})}var directive;return directive={templateUrl:"app/widgets/ui-modal-dialog.html",restrict:"E",transclude:!0,replace:!0,scope:!0,link:link}}angular.module("app.core").directive("uiModalDialog",uiModalDialog)}();