!function(root,factory){"function"==typeof define&&define.amd?define([],function(){return factory()}):"object"==typeof exports?module.exports=factory():factory()}(this,function(){function $translatePartialLoader(){"use strict";function Part(name,priority){this.name=name,this.isActive=!0,this.tables={},this.priority=priority||0}function hasPart(name){return Object.prototype.hasOwnProperty.call(parts,name)}function isStringValid(str){return angular.isString(str)&&""!==str}function isPartAvailable(name){if(!isStringValid(name))throw new TypeError("Invalid type of a first argument, a non-empty string expected.");return hasPart(name)&&parts[name].isActive}function deepExtend(dst,src){for(var property in src)src[property]&&src[property].constructor&&src[property].constructor===Object?(dst[property]=dst[property]||{},deepExtend(dst[property],src[property])):dst[property]=src[property];return dst}function getPrioritizedParts(){var prioritizedParts=[];for(var part in parts)parts[part].isActive&&prioritizedParts.push(parts[part]);return prioritizedParts.sort(function(a,b){return a.priority-b.priority}),prioritizedParts}Part.prototype.parseUrl=function(urlTemplate,targetLang){return angular.isFunction(urlTemplate)?urlTemplate(this.name,targetLang):urlTemplate.replace(/\{part\}/g,this.name).replace(/\{lang\}/g,targetLang)},Part.prototype.getTable=function(lang,$q,$http,$httpOptions,urlTemplate,errorHandler){if(this.tables[lang])return $q.when(this.tables[lang]);var self=this;return $http(angular.extend({method:"GET",url:this.parseUrl(urlTemplate,lang)},$httpOptions)).then(function(result){return self.tables[lang]=result.data,result.data},function(){return errorHandler?errorHandler(self.name,lang).then(function(data){return self.tables[lang]=data,data},function(){return $q.reject(self.name)}):$q.reject(self.name)})};var parts={};this.addPart=function(name,priority){if(!isStringValid(name))throw new TypeError("Couldn't add part, part name has to be a string!");return hasPart(name)||(parts[name]=new Part(name,priority)),parts[name].isActive=!0,this},this.setPart=function(lang,part,table){if(!isStringValid(lang))throw new TypeError("Couldn't set part.`lang` parameter has to be a string!");if(!isStringValid(part))throw new TypeError("Couldn't set part.`part` parameter has to be a string!");if("object"!=typeof table||null===table)throw new TypeError("Couldn't set part. `table` parameter has to be an object!");return hasPart(part)||(parts[part]=new Part(part),parts[part].isActive=!1),parts[part].tables[lang]=table,this},this.deletePart=function(name){if(!isStringValid(name))throw new TypeError("Couldn't delete part, first arg has to be string.");return hasPart(name)&&(parts[name].isActive=!1),this},this.isPartAvailable=isPartAvailable,this.$get=["$rootScope","$injector","$q","$http",function($rootScope,$injector,$q,$http){var service=function(options){if(!isStringValid(options.key))throw new TypeError("Unable to load data, a key is not a non-empty string.");if(!isStringValid(options.urlTemplate)&&!angular.isFunction(options.urlTemplate))throw new TypeError("Unable to load data, a urlTemplate is not a non-empty string or not a function.");var errorHandler=options.loadFailureHandler;if(void 0!==errorHandler){if(!angular.isString(errorHandler))throw new Error("Unable to load data, a loadFailureHandler is not a string.");errorHandler=$injector.get(errorHandler)}var loaders=[],prioritizedParts=getPrioritizedParts();return angular.forEach(prioritizedParts,function(part){loaders.push(part.getTable(options.key,$q,$http,options.$http,options.urlTemplate,errorHandler)),part.urlTemplate=options.urlTemplate}),$q.all(loaders).then(function(){var table={};return prioritizedParts=getPrioritizedParts(),angular.forEach(prioritizedParts,function(part){deepExtend(table,part.tables[options.key])}),table},function(){return $q.reject(options.key)})};return service.addPart=function(name,priority){if(!isStringValid(name))throw new TypeError("Couldn't add part, first arg has to be a string");return hasPart(name)?parts[name].isActive||(parts[name].isActive=!0,$rootScope.$emit("$translatePartialLoaderStructureChanged",name)):(parts[name]=new Part(name,priority),$rootScope.$emit("$translatePartialLoaderStructureChanged",name)),service},service.deletePart=function(name,removeData){if(!isStringValid(name))throw new TypeError("Couldn't delete part, first arg has to be string");if(void 0===removeData)removeData=!1;else if("boolean"!=typeof removeData)throw new TypeError("Invalid type of a second argument, a boolean expected.");if(hasPart(name)){var wasActive=parts[name].isActive;if(removeData){var $translate=$injector.get("$translate"),cache=$translate.loaderCache();"string"==typeof cache&&(cache=$injector.get(cache)),"object"==typeof cache&&angular.forEach(parts[name].tables,function(value,key){cache.remove(parts[name].parseUrl(parts[name].urlTemplate,key))}),delete parts[name]}else parts[name].isActive=!1;wasActive&&$rootScope.$emit("$translatePartialLoaderStructureChanged",name)}return service},service.isPartLoaded=function(name,lang){return angular.isDefined(parts[name])&&angular.isDefined(parts[name].tables[lang])},service.getRegisteredParts=function(){var registeredParts=[];return angular.forEach(parts,function(p){p.isActive&&registeredParts.push(p.name)}),registeredParts},service.isPartAvailable=isPartAvailable,service}]}return angular.module("pascalprecht.translate").provider("$translatePartialLoader",$translatePartialLoader),$translatePartialLoader.displayName="$translatePartialLoader","pascalprecht.translate"});